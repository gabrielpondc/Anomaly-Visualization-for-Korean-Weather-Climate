!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mapbox-gl")):"function"==typeof define&&define.amd?define(["exports","mapbox-gl"],t):t((e=e||self).L7={},e.mapboxgl)}(this,(function(e,t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var n={},r={},i=function(e){return r[e]},o=function(e,t){r[e]=t},a=function(e,t){n[e]=t},s={},u={};function l(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function c(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function h(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function f(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+h(-e,6):e>9999?"+"+h(e,6):h(e,4)}(e.getUTCFullYear())+"-"+h(e.getUTCMonth()+1,2)+"-"+h(e.getUTCDate(),2)+(i?"T"+h(t,2)+":"+h(n,2)+":"+h(r,2)+"."+h(i,3)+"Z":r?"T"+h(t,2)+":"+h(n,2)+":"+h(r,2)+"Z":n||t?"T"+h(t,2)+":"+h(n,2)+"Z":"")}var p=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,l=0,c=o<=0,h=!1;function f(){if(c)return u;if(h)return h=!1,s;var t,r,i=a;if(34===e.charCodeAt(i)){for(;a++<o&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=o?c=!0:10===(r=e.charCodeAt(a++))?h=!0:13===r&&(h=!0,10===e.charCodeAt(a)&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=e.charCodeAt(t=a++)))h=!0;else if(13===r)h=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(i,t)}return c=!0,e.slice(i,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=f())!==u;){for(var p=[];r!==s&&r!==u;)p.push(r),r=f();t&&null==(p=t(p,l++))||i.push(p)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function o(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?f(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=l(e);return function(r,i){return t(n(r),i,e)}}(e,t):l(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=c(t)),[n.map(a).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=c(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}(",").parse;function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(){g=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),a=new A(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return T()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var c={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(C([])));m&&m!==t&&n.call(m,i)&&(d=m);var y=p.prototype=h.prototype=Object.create(d);function _(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,s){var u=l(e[i],e,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,s)}))}s(u.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function C(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=p,s(y,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},_(b.prototype),s(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new b(u(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(y),s(y,a,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=C,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){y(o,r,i,a,s,"next",e)}function s(e){y(o,r,i,a,s,"throw",e)}a(void 0)}))}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function w(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function M(e,t,n){return(M=w()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&T(i,n.prototype),i}).apply(null,arguments)}function k(e){var t="function"==typeof Map?new Map:void 0;return(k=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return M(e,arguments,C(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),T(r,e)})(e)}function O(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return P(e)}function I(e){var t=w();return function(){var n,r=C(e);if(t){var i=C(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return L(this,n)}}function R(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}function N(){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=R(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||B(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e){return function(e){if(Array.isArray(e))return z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||B(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function j(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=B(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function U(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function V(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var H="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function G(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function W(e,t){return e(t={exports:{}},t.exports),t.exports}var Y,X,Z=function(e){return e&&e.Math==Math&&e},q=Z("object"==typeof globalThis&&globalThis)||Z("object"==typeof window&&window)||Z("object"==typeof self&&self)||Z("object"==typeof H&&H)||function(){return this}()||Function("return this")(),K=Object.defineProperty,Q=function(e,t){try{K(q,e,{value:t,configurable:!0,writable:!0})}catch(n){q[e]=t}return t},$=q["__core-js_shared__"]||Q("__core-js_shared__",{}),J=W((function(e){(e.exports=function(e,t){return $[e]||($[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})})),ee=function(e){try{return!!e()}catch(e){return!0}},te=!ee((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),ne=Function.prototype,re=ne.call,ie=te&&ne.bind.bind(re,re),oe=function(e){return te?ie(e):function(){return re.apply(e,arguments)}},ae=oe({}.toString),se=oe("".slice),ue=function(e){return se(ae(e),8,-1)},le=function(e){if("Function"===ue(e))return oe(e)},ce=function(e){return null==e},he=TypeError,fe=function(e){if(ce(e))throw he("Can't call method on "+e);return e},pe=Object,de=function(e){return pe(fe(e))},ve=le({}.hasOwnProperty),ge=Object.hasOwn||function(e,t){return ve(de(e),t)},me=0,ye=Math.random(),_e=le(1..toString),be=function(e){return"Symbol("+(void 0===e?"":e)+")_"+_e(++me+ye,36)},xe="object"==typeof document&&document.all,Se={all:xe,IS_HTMLDDA:void 0===xe&&void 0!==xe},Ee=Se.all,Ae=Se.IS_HTMLDDA?function(e){return"function"==typeof e||e===Ee}:function(e){return"function"==typeof e},Ce=function(e){return Ae(e)?e:void 0},Te=function(e,t){return arguments.length<2?Ce(q[e]):q[e]&&q[e][t]},we=Te("navigator","userAgent")||"",Me=q.process,ke=q.Deno,Oe=Me&&Me.versions||ke&&ke.version,Pe=Oe&&Oe.v8;Pe&&(X=(Y=Pe.split("."))[0]>0&&Y[0]<4?1:+(Y[0]+Y[1])),!X&&we&&(!(Y=we.match(/Edge\/(\d+)/))||Y[1]>=74)&&(Y=we.match(/Chrome\/(\d+)/))&&(X=+Y[1]);var Le=X,Ie=!!Object.getOwnPropertySymbols&&!ee((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Le&&Le<41})),Re=Ie&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ne=J("wks"),De=q.Symbol,Fe=De&&De.for,Be=Re?De:De&&De.withoutSetter||be,ze=function(e){if(!ge(Ne,e)||!Ie&&"string"!=typeof Ne[e]){var t="Symbol."+e;Ie&&ge(De,e)?Ne[e]=De[e]:Ne[e]=Re&&Fe?Fe(t):Be(t)}return Ne[e]},je={};je[ze("toStringTag")]="z";var Ue="[object z]"===String(je),Ve=!ee((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),He=Se.all,Ge=Se.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:Ae(e)||e===He}:function(e){return"object"==typeof e?null!==e:Ae(e)},We=q.document,Ye=Ge(We)&&Ge(We.createElement),Xe=function(e){return Ye?We.createElement(e):{}},Ze=!Ve&&!ee((function(){return 7!=Object.defineProperty(Xe("div"),"a",{get:function(){return 7}}).a})),qe=Ve&&ee((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ke=String,Qe=TypeError,$e=function(e){if(Ge(e))return e;throw Qe(Ke(e)+" is not an object")},Je=Function.prototype.call,et=te?Je.bind(Je):function(){return Je.apply(Je,arguments)},tt=le({}.isPrototypeOf),nt=Object,rt=Re?function(e){return"symbol"==typeof e}:function(e){var t=Te("Symbol");return Ae(t)&&tt(t.prototype,nt(e))},it=String,ot=function(e){try{return it(e)}catch(e){return"Object"}},at=TypeError,st=function(e){if(Ae(e))return e;throw at(ot(e)+" is not a function")},ut=function(e,t){var n=e[t];return ce(n)?void 0:st(n)},lt=TypeError,ct=TypeError,ht=ze("toPrimitive"),ft=function(e,t){if(!Ge(e)||rt(e))return e;var n,r=ut(e,ht);if(r){if(void 0===t&&(t="default"),n=et(r,e,t),!Ge(n)||rt(n))return n;throw ct("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var n,r;if("string"===t&&Ae(n=e.toString)&&!Ge(r=et(n,e)))return r;if(Ae(n=e.valueOf)&&!Ge(r=et(n,e)))return r;if("string"!==t&&Ae(n=e.toString)&&!Ge(r=et(n,e)))return r;throw lt("Can't convert object to primitive value")}(e,t)},pt=function(e){var t=ft(e,"string");return rt(t)?t:t+""},dt=TypeError,vt=Object.defineProperty,gt=Object.getOwnPropertyDescriptor,mt={f:Ve?qe?function(e,t,n){if($e(e),t=pt(t),$e(n),"function"==typeof e&&"prototype"===t&&"value"in n&&"writable"in n&&!n.writable){var r=gt(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return vt(e,t,n)}:vt:function(e,t,n){if($e(e),t=pt(t),$e(n),Ze)try{return vt(e,t,n)}catch(e){}if("get"in n||"set"in n)throw dt("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},yt=Function.prototype,_t=Ve&&Object.getOwnPropertyDescriptor,bt=ge(yt,"name"),xt={EXISTS:bt,PROPER:bt&&"something"===function(){}.name,CONFIGURABLE:bt&&(!Ve||Ve&&_t(yt,"name").configurable)},St=le(Function.toString);Ae($.inspectSource)||($.inspectSource=function(e){return St(e)});var Et,At,Ct,Tt=$.inspectSource,wt=q.WeakMap,Mt=Ae(wt)&&/native code/.test(String(wt)),kt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ot=Ve?function(e,t,n){return mt.f(e,t,kt(1,n))}:function(e,t,n){return e[t]=n,e},Pt=J("keys"),Lt=function(e){return Pt[e]||(Pt[e]=be(e))},It={},Rt=q.TypeError,Nt=q.WeakMap;if(Mt||$.state){var Dt=$.state||($.state=new Nt);Dt.get=Dt.get,Dt.has=Dt.has,Dt.set=Dt.set,Et=function(e,t){if(Dt.has(e))throw Rt("Object already initialized");return t.facade=e,Dt.set(e,t),t},At=function(e){return Dt.get(e)||{}},Ct=function(e){return Dt.has(e)}}else{var Ft=Lt("state");It[Ft]=!0,Et=function(e,t){if(ge(e,Ft))throw Rt("Object already initialized");return t.facade=e,Ot(e,Ft,t),t},At=function(e){return ge(e,Ft)?e[Ft]:{}},Ct=function(e){return ge(e,Ft)}}var Bt={set:Et,get:At,has:Ct,enforce:function(e){return Ct(e)?At(e):Et(e,{})},getterFor:function(e){return function(t){var n;if(!Ge(t)||(n=At(t)).type!==e)throw Rt("Incompatible receiver, "+e+" required");return n}}},zt=W((function(e){var t=xt.CONFIGURABLE,n=Bt.enforce,r=Bt.get,i=Object.defineProperty,o=Ve&&!ee((function(){return 8!==i((function(){}),"length",{value:8}).length})),a=String(String).split("String"),s=e.exports=function(e,r,s){"Symbol("===String(r).slice(0,7)&&(r="["+String(r).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),s&&s.getter&&(r="get "+r),s&&s.setter&&(r="set "+r),(!ge(e,"name")||t&&e.name!==r)&&(Ve?i(e,"name",{value:r,configurable:!0}):e.name=r),o&&s&&ge(s,"arity")&&e.length!==s.arity&&i(e,"length",{value:s.arity});try{s&&ge(s,"constructor")&&s.constructor?Ve&&i(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var u=n(e);return ge(u,"source")||(u.source=a.join("string"==typeof r?r:"")),e};Function.prototype.toString=s((function(){return Ae(this)&&r(this).source||Tt(this)}),"toString")})),jt=function(e,t,n,r){r||(r={});var i=r.enumerable,o=void 0!==r.name?r.name:t;if(Ae(n)&&zt(n,o,r),r.global)i?e[t]=n:Q(t,n);else{try{r.unsafe?e[t]&&(i=!0):delete e[t]}catch(e){}i?e[t]=n:mt.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},Ut=ze("toStringTag"),Vt=Object,Ht="Arguments"==ue(function(){return arguments}()),Gt=Ue?ue:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Vt(e),Ut))?n:Ht?ue(t):"Object"==(r=ue(t))&&Ae(t.callee)?"Arguments":r},Wt=Ue?{}.toString:function(){return"[object "+Gt(this)+"]"};Ue||jt(Object.prototype,"toString",Wt,{unsafe:!0});var Yt={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Xt=Xe("span").classList,Zt=Xt&&Xt.constructor&&Xt.constructor.prototype,qt=Zt===Object.prototype?void 0:Zt,Kt=le(le.bind),Qt=function(e,t){return st(e),void 0===t?e:te?Kt(e,t):function(){return e.apply(t,arguments)}},$t=Object,Jt=le("".split),en=ee((function(){return!$t("z").propertyIsEnumerable(0)}))?function(e){return"String"==ue(e)?Jt(e,""):$t(e)}:$t,tn=Math.ceil,nn=Math.floor,rn=Math.trunc||function(e){var t=+e;return(t>0?nn:tn)(t)},on=function(e){var t=+e;return t!=t||0===t?0:rn(t)},an=Math.min,sn=function(e){return e>0?an(on(e),9007199254740991):0},un=function(e){return sn(e.length)},ln=Array.isArray||function(e){return"Array"==ue(e)},cn=function(){},hn=[],fn=Te("Reflect","construct"),pn=/^\s*(?:class|function)\b/,dn=le(pn.exec),vn=!pn.exec(cn),gn=function(e){if(!Ae(e))return!1;try{return fn(cn,hn,e),!0}catch(e){return!1}},mn=function(e){if(!Ae(e))return!1;switch(Gt(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return vn||!!dn(pn,Tt(e))}catch(e){return!0}};mn.sham=!0;var yn=!fn||ee((function(){var e;return gn(gn.call)||!gn(Object)||!gn((function(){e=!0}))||e}))?mn:gn,_n=ze("species"),bn=Array,xn=function(e,t){return new(function(e){var t;return ln(e)&&(t=e.constructor,(yn(t)&&(t===bn||ln(t.prototype))||Ge(t)&&null===(t=t[_n]))&&(t=void 0)),void 0===t?bn:t}(e))(0===t?0:t)},Sn=le([].push),En=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(u,l,c,h){for(var f,p,d=de(u),v=en(d),g=Qt(l,c),m=un(v),y=0,_=h||xn,b=t?_(u,m):n||a?_(u,0):void 0;m>y;y++)if((s||y in v)&&(p=g(f=v[y],y,d),e))if(t)b[y]=p;else if(p)switch(e){case 3:return!0;case 5:return f;case 6:return y;case 2:Sn(b,f)}else switch(e){case 4:return!1;case 7:Sn(b,f)}return o?-1:r||i?i:b}},An={forEach:En(0),map:En(1),filter:En(2),some:En(3),every:En(4),find:En(5),findIndex:En(6),filterReject:En(7)},Cn=function(e,t){var n=[][e];return!!n&&ee((function(){n.call(null,t||function(){return 1},1)}))},Tn=An.forEach,wn=Cn("forEach")?[].forEach:function(e){return Tn(this,e,arguments.length>1?arguments[1]:void 0)},Mn=function(e){if(e&&e.forEach!==wn)try{Ot(e,"forEach",wn)}catch(t){e.forEach=wn}};for(var kn in Yt)Yt[kn]&&Mn(q[kn]&&q[kn].prototype);Mn(qt);var On={}.propertyIsEnumerable,Pn=Object.getOwnPropertyDescriptor,Ln={f:Pn&&!On.call({1:2},1)?function(e){var t=Pn(this,e);return!!t&&t.enumerable}:On},In=function(e){return en(fe(e))},Rn=Object.getOwnPropertyDescriptor,Nn={f:Ve?Rn:function(e,t){if(e=In(e),t=pt(t),Ze)try{return Rn(e,t)}catch(e){}if(ge(e,t))return kt(!et(Ln.f,e,t),e[t])}},Dn=Math.max,Fn=Math.min,Bn=function(e,t){var n=on(e);return n<0?Dn(n+t,0):Fn(n,t)},zn=function(e){return function(t,n,r){var i,o=In(t),a=un(o),s=Bn(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},jn={includes:zn(!0),indexOf:zn(!1)},Un=jn.indexOf,Vn=le([].push),Hn=function(e,t){var n,r=In(e),i=0,o=[];for(n in r)!ge(It,n)&&ge(r,n)&&Vn(o,n);for(;t.length>i;)ge(r,n=t[i++])&&(~Un(o,n)||Vn(o,n));return o},Gn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Wn=Gn.concat("length","prototype"),Yn={f:Object.getOwnPropertyNames||function(e){return Hn(e,Wn)}},Xn={f:Object.getOwnPropertySymbols},Zn=le([].concat),qn=Te("Reflect","ownKeys")||function(e){var t=Yn.f($e(e)),n=Xn.f;return n?Zn(t,n(e)):t},Kn=function(e,t,n){for(var r=qn(t),i=mt.f,o=Nn.f,a=0;a<r.length;a++){var s=r[a];ge(e,s)||n&&ge(n,s)||i(e,s,o(t,s))}},Qn=/#|\.prototype\./,$n=function(e,t){var n=er[Jn(e)];return n==nr||n!=tr&&(Ae(t)?ee(t):!!t)},Jn=$n.normalize=function(e){return String(e).replace(Qn,".").toLowerCase()},er=$n.data={},tr=$n.NATIVE="N",nr=$n.POLYFILL="P",rr=$n,ir=Nn.f,or=function(e,t){var n,r,i,o,a,s=e.target,u=e.global,l=e.stat;if(n=u?q:l?q[s]||Q(s,{}):(q[s]||{}).prototype)for(r in t){if(o=t[r],i=e.dontCallGetSet?(a=ir(n,r))&&a.value:n[r],!rr(u?r:s+(l?".":"#")+r,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;Kn(o,i)}(e.sham||i&&i.sham)&&Ot(o,"sham",!0),jt(n,r,o,e)}},ar=ze("species"),sr=function(e){return Le>=51||!ee((function(){var t=[];return(t.constructor={})[ar]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},ur=An.filter,lr=sr("filter");or({target:"Array",proto:!0,forced:!lr},{filter:function(e){return ur(this,e,arguments.length>1?arguments[1]:void 0)}});var cr=function e(t,n){var r,i=t&&t.type;if("FeatureCollection"===i)for(r=0;r<t.features.length;r++)e(t.features[r],n);else if("GeometryCollection"===i)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],n);else if("Feature"===i)e(t.geometry,n);else if("Polygon"===i)hr(t.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<t.coordinates.length;r++)hr(t.coordinates[r],n);return t};function hr(e,t){if(0!==e.length){fr(e[0],t);for(var n=1;n<e.length;n++)fr(e[n],!t)}}function fr(e,t){for(var n=0,r=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!t&&e.reverse()}var pr={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function dr(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function vr(e,t,n){void 0===n&&(n={});for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return dr({type:"Polygon",coordinates:e},t,n)}function gr(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return dr({type:"LineString",coordinates:e},t,n)}function mr(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function yr(e){return 180*(e%(2*Math.PI))/Math.PI}function _r(e){return e%360*Math.PI/180}function br(e,t){!function(e,t){var n,r,i,o,a,s,u,l,c,h,f=0,p="FeatureCollection"===e.type,d="Feature"===e.type,v=p?e.features.length:1;for(n=0;n<v;n++){for(s=p?e.features[n].geometry:d?e.geometry:e,l=p?e.features[n].properties:d?e.properties:{},c=p?e.features[n].bbox:d?e.bbox:void 0,h=p?e.features[n].id:d?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,f,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],f,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,l,c,h))return!1;f++}}(e,(function(e,n,r,i,o){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==t(dr(e,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<e.coordinates.length;u++){var l=e.coordinates[u];if(!1===t(dr({type:a,coordinates:l},r),n,u))return!1}}))}function xr(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Sr(e){return"Feature"===e.type?e.geometry:e}function Er(e,t){var n=t.x,r=t.y,i=t.x1,o=t.y1,a=t.coordinates,s=t.geometry,u=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter((function(e){return e[s]&&e[s].type&&e[s].coordinates&&e[s].coordinates.length>0})).forEach((function(e,t){var n=v({},e[s]);br(cr(n,!0),(function(n){var r=xr(n),i=v(v({},e),{},{_id:t,coordinates:r});u.push(i)}))})),{dataArray:u};for(var l=0;l<e.length;l++){var c=e[l],h=[];if(a){var f="Polygon";Array.isArray(a[0])||(f="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(f="LineString");var p={type:f,coordinates:F(c[a])};h=cr(p,!0).coordinates}else if(n&&r&&i&&o){h=[[parseFloat(c[n]),parseFloat(c[r])],[parseFloat(c[i]),parseFloat(c[o])]]}else n&&r&&(h=[parseFloat(c[n]),parseFloat(c[r])]);var d=v(v({},c),{},{_id:l,coordinates:h});u.push(d)}return{dataArray:u}}var Ar=String,Cr=function(e){if("Symbol"===Gt(e))throw TypeError("Cannot convert a Symbol value to a string");return Ar(e)},Tr=function(){var e=$e(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},wr=RegExp.prototype,Mr=function(e){var t=e.flags;return void 0!==t||"flags"in wr||ge(e,"flags")||!tt(wr,e)?t:et(Tr,e)},kr=xt.PROPER,Or=RegExp.prototype.toString,Pr=ee((function(){return"/a/b"!=Or.call({source:"a",flags:"b"})})),Lr=kr&&"toString"!=Or.name;(Pr||Lr)&&jt(RegExp.prototype,"toString",(function(){var e=$e(this);return"/"+Cr(e.source)+"/"+Cr(Mr(e))}),{unsafe:!0});var Ir,Rr,Nr,Dr,Fr="process"==ue(q.process),Br=String,zr=TypeError,jr=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=le(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return $e(n),function(e){if("object"==typeof e||Ae(e))return e;throw zr("Can't set "+Br(e)+" as a prototype")}(r),t?e(n,r):n.__proto__=r,n}}():void 0),Ur=mt.f,Vr=ze("toStringTag"),Hr=function(e,t,n){e&&!n&&(e=e.prototype),e&&!ge(e,Vr)&&Ur(e,Vr,{configurable:!0,value:t})},Gr=ze("species"),Wr=function(e){var t=Te(e),n=mt.f;Ve&&t&&!t[Gr]&&n(t,Gr,{configurable:!0,get:function(){return this}})},Yr=TypeError,Xr=function(e,t){if(tt(t,e))return e;throw Yr("Incorrect invocation")},Zr=TypeError,qr=function(e){if(yn(e))return e;throw Zr(ot(e)+" is not a constructor")},Kr=ze("species"),Qr=function(e,t){var n,r=$e(e).constructor;return void 0===r||ce(n=$e(r)[Kr])?t:qr(n)},$r=Function.prototype,Jr=$r.apply,ei=$r.call,ti="object"==typeof Reflect&&Reflect.apply||(te?ei.bind(Jr):function(){return ei.apply(Jr,arguments)}),ni=Te("document","documentElement"),ri=le([].slice),ii=TypeError,oi=function(e,t){if(e<t)throw ii("Not enough arguments");return e},ai=/(?:ipad|iphone|ipod).*applewebkit/i.test(we),si=q.setImmediate,ui=q.clearImmediate,li=q.process,ci=q.Dispatch,hi=q.Function,fi=q.MessageChannel,pi=q.String,di=0,vi={};try{Ir=q.location}catch(e){}var gi=function(e){if(ge(vi,e)){var t=vi[e];delete vi[e],t()}},mi=function(e){return function(){gi(e)}},yi=function(e){gi(e.data)},_i=function(e){q.postMessage(pi(e),Ir.protocol+"//"+Ir.host)};si&&ui||(si=function(e){oi(arguments.length,1);var t=Ae(e)?e:hi(e),n=ri(arguments,1);return vi[++di]=function(){ti(t,void 0,n)},Rr(di),di},ui=function(e){delete vi[e]},Fr?Rr=function(e){li.nextTick(mi(e))}:ci&&ci.now?Rr=function(e){ci.now(mi(e))}:fi&&!ai?(Dr=(Nr=new fi).port2,Nr.port1.onmessage=yi,Rr=Qt(Dr.postMessage,Dr)):q.addEventListener&&Ae(q.postMessage)&&!q.importScripts&&Ir&&"file:"!==Ir.protocol&&!ee(_i)?(Rr=_i,q.addEventListener("message",yi,!1)):Rr="onreadystatechange"in Xe("script")?function(e){ni.appendChild(Xe("script")).onreadystatechange=function(){ni.removeChild(this),gi(e)}}:function(e){setTimeout(mi(e),0)});var bi,xi,Si,Ei,Ai,Ci,Ti,wi,Mi={set:si,clear:ui},ki=/ipad|iphone|ipod/i.test(we)&&void 0!==q.Pebble,Oi=/web0s(?!.*chrome)/i.test(we),Pi=Nn.f,Li=Mi.set,Ii=q.MutationObserver||q.WebKitMutationObserver,Ri=q.document,Ni=q.process,Di=q.Promise,Fi=Pi(q,"queueMicrotask"),Bi=Fi&&Fi.value;Bi||(bi=function(){var e,t;for(Fr&&(e=Ni.domain)&&e.exit();xi;){t=xi.fn,xi=xi.next;try{t()}catch(e){throw xi?Ei():Si=void 0,e}}Si=void 0,e&&e.enter()},ai||Fr||Oi||!Ii||!Ri?!ki&&Di&&Di.resolve?((Ti=Di.resolve(void 0)).constructor=Di,wi=Qt(Ti.then,Ti),Ei=function(){wi(bi)}):Fr?Ei=function(){Ni.nextTick(bi)}:(Li=Qt(Li,q),Ei=function(){Li(bi)}):(Ai=!0,Ci=Ri.createTextNode(""),new Ii(bi).observe(Ci,{characterData:!0}),Ei=function(){Ci.data=Ai=!Ai}));var zi=Bi||function(e){var t={fn:e,next:void 0};Si&&(Si.next=t),xi||(xi=t,Ei()),Si=t},ji=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Ui=function(){this.head=null,this.tail=null};Ui.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var Vi,Hi,Gi,Wi=Ui,Yi=q.Promise,Xi="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Zi=!Xi&&!Fr&&"object"==typeof window&&"object"==typeof document,qi=(Yi&&Yi.prototype,ze("species")),Ki=!1,Qi=Ae(q.PromiseRejectionEvent),$i={CONSTRUCTOR:rr("Promise",(function(){var e=Tt(Yi),t=e!==String(Yi);if(!t&&66===Le)return!0;if(!Le||Le<51||!/native code/.test(e)){var n=new Yi((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[qi]=r,!(Ki=n.then((function(){}))instanceof r))return!0}return!t&&(Zi||Xi)&&!Qi})),REJECTION_EVENT:Qi,SUBCLASSING:Ki},Ji=TypeError,eo=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw Ji("Bad Promise constructor");t=e,n=r})),this.resolve=st(t),this.reject=st(n)},to={f:function(e){return new eo(e)}},no=Mi.set,ro=$i.CONSTRUCTOR,io=$i.REJECTION_EVENT,oo=$i.SUBCLASSING,ao=Bt.getterFor("Promise"),so=Bt.set,uo=Yi&&Yi.prototype,lo=Yi,co=uo,ho=q.TypeError,fo=q.document,po=q.process,vo=to.f,go=vo,mo=!!(fo&&fo.createEvent&&q.dispatchEvent),yo=function(e){var t;return!(!Ge(e)||!Ae(t=e.then))&&t},_o=function(e,t){var n,r,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,u=e.resolve,l=e.reject,c=e.domain;try{s?(a||(2===t.rejection&&Ao(t),t.rejection=1),!0===s?n=o:(c&&c.enter(),n=s(o),c&&(c.exit(),i=!0)),n===e.promise?l(ho("Promise-chain cycle")):(r=yo(n))?et(r,n,u,l):u(n)):l(o)}catch(e){c&&!i&&c.exit(),l(e)}},bo=function(e,t){e.notified||(e.notified=!0,zi((function(){for(var n,r=e.reactions;n=r.get();)_o(n,e);e.notified=!1,t&&!e.rejection&&So(e)})))},xo=function(e,t,n){var r,i;mo?((r=fo.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),q.dispatchEvent(r)):r={promise:t,reason:n},!io&&(i=q["on"+e])?i(r):"unhandledrejection"===e&&function(e,t){var n=q.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},So=function(e){et(no,q,(function(){var t,n=e.facade,r=e.value;if(Eo(e)&&(t=ji((function(){Fr?po.emit("unhandledRejection",r,n):xo("unhandledrejection",n,r)})),e.rejection=Fr||Eo(e)?2:1,t.error))throw t.value}))},Eo=function(e){return 1!==e.rejection&&!e.parent},Ao=function(e){et(no,q,(function(){var t=e.facade;Fr?po.emit("rejectionHandled",t):xo("rejectionhandled",t,e.value)}))},Co=function(e,t,n){return function(r){e(t,r,n)}},To=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,bo(e,!0))},wo=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw ho("Promise can't be resolved itself");var r=yo(t);r?zi((function(){var n={done:!1};try{et(r,t,Co(wo,n,e),Co(To,n,e))}catch(t){To(n,t,e)}})):(e.value=t,e.state=1,bo(e,!1))}catch(t){To({done:!1},t,e)}}};if(ro&&(co=(lo=function(e){Xr(this,co),st(e),et(Vi,this);var t=ao(this);try{e(Co(wo,t),Co(To,t))}catch(e){To(t,e)}}).prototype,(Vi=function(e){so(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new Wi,rejection:!1,state:0,value:void 0})}).prototype=jt(co,"then",(function(e,t){var n=ao(this),r=vo(Qr(this,lo));return n.parent=!0,r.ok=!Ae(e)||e,r.fail=Ae(t)&&t,r.domain=Fr?po.domain:void 0,0==n.state?n.reactions.add(r):zi((function(){_o(r,n)})),r.promise})),Hi=function(){var e=new Vi,t=ao(e);this.promise=e,this.resolve=Co(wo,t),this.reject=Co(To,t)},to.f=vo=function(e){return e===lo||void 0===e?new Hi(e):go(e)},Ae(Yi)&&uo!==Object.prototype)){Gi=uo.then,oo||jt(uo,"then",(function(e,t){var n=this;return new lo((function(e,t){et(Gi,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete uo.constructor}catch(e){}jr&&jr(uo,co)}or({global:!0,constructor:!0,wrap:!0,forced:ro},{Promise:lo}),Hr(lo,"Promise",!1),Wr("Promise");var Mo={},ko=ze("iterator"),Oo=Array.prototype,Po=function(e){return void 0!==e&&(Mo.Array===e||Oo[ko]===e)},Lo=ze("iterator"),Io=function(e){if(!ce(e))return ut(e,Lo)||ut(e,"@@iterator")||Mo[Gt(e)]},Ro=TypeError,No=function(e,t){var n=arguments.length<2?Io(e):t;if(st(n))return $e(et(n,e));throw Ro(ot(e)+" is not iterable")},Do=function(e,t,n){var r,i;$e(e);try{if(!(r=ut(e,"return"))){if("throw"===t)throw n;return n}r=et(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return $e(r),n},Fo=TypeError,Bo=function(e,t){this.stopped=e,this.result=t},zo=Bo.prototype,jo=function(e,t,n){var r,i,o,a,s,u,l,c=n&&n.that,h=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),d=!(!n||!n.INTERRUPTED),v=Qt(t,c),g=function(e){return r&&Do(r,"normal",e),new Bo(!0,e)},m=function(e){return h?($e(e),d?v(e[0],e[1],g):v(e[0],e[1])):d?v(e,g):v(e)};if(f)r=e.iterator;else if(p)r=e;else{if(!(i=Io(e)))throw Fo(ot(e)+" is not iterable");if(Po(i)){for(o=0,a=un(e);a>o;o++)if((s=m(e[o]))&&tt(zo,s))return s;return new Bo(!1)}r=No(e,i)}for(u=f?e.next:r.next;!(l=et(u,r)).done;){try{s=m(l.value)}catch(e){Do(r,"throw",e)}if("object"==typeof s&&s&&tt(zo,s))return s}return new Bo(!1)},Uo=ze("iterator"),Vo=!1;try{var Ho=0,Go={next:function(){return{done:!!Ho++}},return:function(){Vo=!0}};Go[Uo]=function(){return this},Array.from(Go,(function(){throw 2}))}catch(e){}var Wo=function(e,t){if(!t&&!Vo)return!1;var n=!1;try{var r={};r[Uo]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Yo=$i.CONSTRUCTOR||!Wo((function(e){Yi.all(e).then(void 0,(function(){}))}));or({target:"Promise",stat:!0,forced:Yo},{all:function(e){var t=this,n=to.f(t),r=n.resolve,i=n.reject,o=ji((function(){var n=st(t.resolve),o=[],a=0,s=1;jo(e,(function(e){var u=a++,l=!1;s++,et(n,t,e).then((function(e){l||(l=!0,o[u]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise}});var Xo=$i.CONSTRUCTOR,Zo=Yi&&Yi.prototype;if(or({target:"Promise",proto:!0,forced:Xo,real:!0},{catch:function(e){return this.then(void 0,e)}}),Ae(Yi)){var qo=Te("Promise").prototype.catch;Zo.catch!==qo&&jt(Zo,"catch",qo,{unsafe:!0})}or({target:"Promise",stat:!0,forced:Yo},{race:function(e){var t=this,n=to.f(t),r=n.reject,i=ji((function(){var i=st(t.resolve);jo(e,(function(e){et(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}}),or({target:"Promise",stat:!0,forced:$i.CONSTRUCTOR},{reject:function(e){var t=to.f(this);return et(t.reject,void 0,e),t.promise}});var Ko=$i.CONSTRUCTOR;Te("Promise");or({target:"Promise",stat:!0,forced:Ko},{resolve:function(e){return function(e,t){if($e(e),Ge(t)&&t.constructor===e)return t;var n=to.f(e);return(0,n.resolve)(t),n.promise}(this,e)}});var Qo=function(e){return e};var $o=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},Jo=Math.max;var ea=function(e,t,n){return t=Jo(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Jo(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),$o(e,this,s)}};var ta=function(e){return function(){return e}},na="object"==typeof H&&H&&H.Object===Object&&H,ra="object"==typeof self&&self&&self.Object===Object&&self,ia=na||ra||Function("return this")(),oa=ia.Symbol,aa=Object.prototype,sa=aa.hasOwnProperty,ua=aa.toString,la=oa?oa.toStringTag:void 0;var ca=function(e){var t=sa.call(e,la),n=e[la];try{e[la]=void 0;var r=!0}catch(e){}var i=ua.call(e);return r&&(t?e[la]=n:delete e[la]),i},ha=Object.prototype.toString;var fa=function(e){return ha.call(e)},pa=oa?oa.toStringTag:void 0;var da=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":pa&&pa in Object(e)?ca(e):fa(e)};var va=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var ga=function(e){if(!va(e))return!1;var t=da(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},ma=ia["__core-js_shared__"],ya=function(){var e=/[^.]+$/.exec(ma&&ma.keys&&ma.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var _a=function(e){return!!ya&&ya in e},ba=Function.prototype.toString;var xa=function(e){if(null!=e){try{return ba.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Sa=/^\[object .+?Constructor\]$/,Ea=Function.prototype,Aa=Object.prototype,Ca=Ea.toString,Ta=Aa.hasOwnProperty,wa=RegExp("^"+Ca.call(Ta).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ma=function(e){return!(!va(e)||_a(e))&&(ga(e)?wa:Sa).test(xa(e))};var ka=function(e,t){return null==e?void 0:e[t]};var Oa=function(e,t){var n=ka(e,t);return Ma(n)?n:void 0},Pa=function(){try{var e=Oa(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),La=Pa?function(e,t){return Pa(e,"toString",{configurable:!0,enumerable:!1,value:ta(t),writable:!0})}:Qo,Ia=Date.now;var Ra=function(e){var t=0,n=0;return function(){var r=Ia(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(La);var Na=function(e,t){return Ra(ea(e,t,Qo),e+"")};var Da=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var Fa=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1};var Ba=function(e){return e!=e};var za=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1};var ja=function(e,t,n){return t==t?za(e,t,n):Fa(e,Ba,n)};var Ua=function(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1};var Va=function(e){return function(t){return e(t)}};var Ha=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},Ga=Array.prototype.splice;var Wa=function(e,t,n,r){var i=r?Ua:ja,o=-1,a=t.length,s=e;for(e===t&&(t=Ha(t)),n&&(s=Da(e,Va(n)));++o<a;)for(var u=0,l=t[o],c=n?n(l):l;(u=i(s,c,u,r))>-1;)s!==e&&Ga.call(s,u,1),Ga.call(e,u,1);return e};var Ya,Xa=Na((function(e,t){return e&&e.length&&t&&t.length?Wa(e,t):e})),Za="\t\n\v\f\r                　\u2028\u2029\ufeff",qa=le("".replace),Ka="["+Za+"]",Qa=RegExp("^"+Ka+Ka+"*"),$a=RegExp(Ka+Ka+"*$"),Ja=function(e){return function(t){var n=Cr(fe(t));return 1&e&&(n=qa(n,Qa,"")),2&e&&(n=qa(n,$a,"")),n}},es={start:Ja(1),end:Ja(2),trim:Ja(3)},ts=xt.PROPER,ns=es.trim;or({target:"String",proto:!0,forced:(Ya="trim",ee((function(){return!!Za[Ya]()||"​᠎"!=="​᠎"[Ya]()||ts&&Za[Ya].name!==Ya})))},{trim:function(){return ns(this)}});var rs,is=q.RegExp,os=ee((function(){var e=is("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),as=os||ee((function(){return!is("a","y").sticky})),ss={BROKEN_CARET:os||ee((function(){var e=is("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:as,UNSUPPORTED_Y:os},us=Object.keys||function(e){return Hn(e,Gn)},ls={f:Ve&&!qe?Object.defineProperties:function(e,t){$e(e);for(var n,r=In(t),i=us(t),o=i.length,a=0;o>a;)mt.f(e,n=i[a++],r[n]);return e}},cs=Lt("IE_PROTO"),hs=function(){},fs=function(e){return"<script>"+e+"<\/script>"},ps=function(e){e.write(fs("")),e.close();var t=e.parentWindow.Object;return e=null,t},ds=function(){try{rs=new ActiveXObject("htmlfile")}catch(e){}var e,t;ds="undefined"!=typeof document?document.domain&&rs?ps(rs):((t=Xe("iframe")).style.display="none",ni.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(fs("document.F=Object")),e.close(),e.F):ps(rs);for(var n=Gn.length;n--;)delete ds.prototype[Gn[n]];return ds()};It[cs]=!0;var vs=Object.create||function(e,t){var n;return null!==e?(hs.prototype=$e(e),n=new hs,hs.prototype=null,n[cs]=e):n=ds(),void 0===t?n:ls.f(n,t)},gs=q.RegExp,ms=ee((function(){var e=gs(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),ys=q.RegExp,_s=ee((function(){var e=ys("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),bs=Bt.get,xs=J("native-string-replace",String.prototype.replace),Ss=RegExp.prototype.exec,Es=Ss,As=le("".charAt),Cs=le("".indexOf),Ts=le("".replace),ws=le("".slice),Ms=function(){var e=/a/,t=/b*/g;return et(Ss,e,"a"),et(Ss,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),ks=ss.BROKEN_CARET,Os=void 0!==/()??/.exec("")[1];(Ms||Os||ks||ms||_s)&&(Es=function(e){var t,n,r,i,o,a,s,u=this,l=bs(u),c=Cr(e),h=l.raw;if(h)return h.lastIndex=u.lastIndex,t=et(Es,h,c),u.lastIndex=h.lastIndex,t;var f=l.groups,p=ks&&u.sticky,d=et(Tr,u),v=u.source,g=0,m=c;if(p&&(d=Ts(d,"y",""),-1===Cs(d,"g")&&(d+="g"),m=ws(c,u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==As(c,u.lastIndex-1))&&(v="(?: "+v+")",m=" "+m,g++),n=new RegExp("^(?:"+v+")",d)),Os&&(n=new RegExp("^"+v+"$(?!\\s)",d)),Ms&&(r=u.lastIndex),i=et(Ss,p?n:u,m),p?i?(i.input=ws(i.input,g),i[0]=ws(i[0],g),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:Ms&&i&&(u.lastIndex=u.global?i.index+i[0].length:r),Os&&i&&i.length>1&&et(xs,i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&f)for(i.groups=a=vs(null),o=0;o<f.length;o++)a[(s=f[o])[0]]=i[s[1]];return i});var Ps=Es;or({target:"RegExp",proto:!0,forced:/./.exec!==Ps},{exec:Ps});var Ls=ze("species"),Is=RegExp.prototype,Rs=function(e,t,n,r){var i=ze(e),o=!ee((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=o&&!ee((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Ls]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!a||n){var s=le(/./[i]),u=t(i,""[e],(function(e,t,n,r,i){var a=le(e),u=t.exec;return u===Ps||u===Is.exec?o&&!i?{done:!0,value:s(t,n,r)}:{done:!0,value:a(n,t,r)}:{done:!1}}));jt(String.prototype,e,u[0]),jt(Is,i,u[1])}r&&Ot(Is[i],"sham",!0)},Ns=le("".charAt),Ds=le("".charCodeAt),Fs=le("".slice),Bs=function(e){return function(t,n){var r,i,o=Cr(fe(t)),a=on(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=Ds(o,a))<55296||r>56319||a+1===s||(i=Ds(o,a+1))<56320||i>57343?e?Ns(o,a):r:e?Fs(o,a,a+2):i-56320+(r-55296<<10)+65536}},zs={codeAt:Bs(!1),charAt:Bs(!0)},js=zs.charAt,Us=function(e,t,n){return t+(n?js(e,t).length:1)},Vs=Math.floor,Hs=le("".charAt),Gs=le("".replace),Ws=le("".slice),Ys=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Xs=/\$([$&'`]|\d{1,2})/g,Zs=function(e,t,n,r,i,o){var a=n+e.length,s=r.length,u=Xs;return void 0!==i&&(i=de(i),u=Ys),Gs(o,u,(function(o,u){var l;switch(Hs(u,0)){case"$":return"$";case"&":return e;case"`":return Ws(t,0,n);case"'":return Ws(t,a);case"<":l=i[Ws(u,1,-1)];break;default:var c=+u;if(0===c)return o;if(c>s){var h=Vs(c/10);return 0===h?o:h<=s?void 0===r[h-1]?Hs(u,1):r[h-1]+Hs(u,1):o}l=r[c-1]}return void 0===l?"":l}))},qs=TypeError,Ks=function(e,t){var n=e.exec;if(Ae(n)){var r=et(n,e,t);return null!==r&&$e(r),r}if("RegExp"===ue(e))return et(Ps,e,t);throw qs("RegExp#exec called on incompatible receiver")},Qs=ze("replace"),$s=Math.max,Js=Math.min,eu=le([].concat),tu=le([].push),nu=le("".indexOf),ru=le("".slice),iu="$0"==="a".replace(/./,"$0"),ou=!!/./[Qs]&&""===/./[Qs]("a","$0");Rs("replace",(function(e,t,n){var r=ou?"$":"$0";return[function(e,n){var r=fe(this),i=ce(e)?void 0:ut(e,Qs);return i?et(i,e,r,n):et(t,Cr(r),e,n)},function(e,i){var o=$e(this),a=Cr(e);if("string"==typeof i&&-1===nu(i,r)&&-1===nu(i,"$<")){var s=n(t,o,a,i);if(s.done)return s.value}var u=Ae(i);u||(i=Cr(i));var l=o.global;if(l){var c=o.unicode;o.lastIndex=0}for(var h=[];;){var f=Ks(o,a);if(null===f)break;if(tu(h,f),!l)break;""===Cr(f[0])&&(o.lastIndex=Us(a,sn(o.lastIndex),c))}for(var p,d="",v=0,g=0;g<h.length;g++){for(var m=Cr((f=h[g])[0]),y=$s(Js(on(f.index),a.length),0),_=[],b=1;b<f.length;b++)tu(_,void 0===(p=f[b])?p:String(p));var x=f.groups;if(u){var S=eu([m],_,y,a);void 0!==x&&tu(S,x);var E=Cr(ti(i,void 0,S))}else E=Zs(m,a,y,_,x,i);y>=v&&(d+=ru(a,v,y)+E,v=y+m.length)}return d+ru(a,v)}]}),!!ee((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!iu||ou);var au=ze("match"),su=function(e){var t;return Ge(e)&&(void 0!==(t=e[au])?!!t:"RegExp"==ue(e))},uu=function(e,t,n){var r=pt(t);r in e?mt.f(e,r,kt(0,n)):e[r]=n},lu=Array,cu=Math.max,hu=function(e,t,n){for(var r=un(e),i=Bn(t,r),o=Bn(void 0===n?r:n,r),a=lu(cu(o-i,0)),s=0;i<o;i++,s++)uu(a,s,e[i]);return a.length=s,a},fu=ss.UNSUPPORTED_Y,pu=Math.min,du=[].push,vu=le(/./.exec),gu=le(du),mu=le("".slice);Rs("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=Cr(fe(this)),i=void 0===n?4294967295:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!su(e))return et(t,r,e,i);for(var o,a,s,u=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,h=new RegExp(e.source,l+"g");(o=et(Ps,h,r))&&!((a=h.lastIndex)>c&&(gu(u,mu(r,c,o.index)),o.length>1&&o.index<r.length&&ti(du,u,hu(o,1)),s=o[0].length,c=a,u.length>=i));)h.lastIndex===o.index&&h.lastIndex++;return c===r.length?!s&&vu(h,"")||gu(u,""):gu(u,mu(r,c)),u.length>i?hu(u,0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:et(t,this,e,n)}:t,[function(t,n){var i=fe(this),o=ce(t)?void 0:ut(t,e);return o?et(o,t,i,n):et(r,Cr(i),t,n)},function(e,i){var o=$e(this),a=Cr(e),s=n(r,o,a,i,r!==t);if(s.done)return s.value;var u=Qr(o,RegExp),l=o.unicode,c=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(fu?"g":"y"),h=new u(fu?"^(?:"+o.source+")":o,c),f=void 0===i?4294967295:i>>>0;if(0===f)return[];if(0===a.length)return null===Ks(h,a)?[a]:[];for(var p=0,d=0,v=[];d<a.length;){h.lastIndex=fu?0:d;var g,m=Ks(h,fu?mu(a,d):a);if(null===m||(g=pu(sn(h.lastIndex+(fu?d:0)),a.length))===p)d=Us(a,d,l);else{if(gu(v,mu(a,p,d)),v.length===f)return v;for(var y=1;y<=m.length-1;y++)if(gu(v,m[y]),v.length===f)return v;d=p=g}}return gu(v,mu(a,p)),v}]}),!!ee((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),fu);var yu=function(e,t,n){var r,i;return jr&&Ae(r=t.constructor)&&r!==n&&Ge(i=r.prototype)&&i!==n.prototype&&jr(e,i),e},_u=mt.f,bu=function(e,t,n){n in e||_u(e,n,{configurable:!0,get:function(){return t[n]},set:function(e){t[n]=e}})},xu=Yn.f,Su=Bt.enforce,Eu=ze("match"),Au=q.RegExp,Cu=Au.prototype,Tu=q.SyntaxError,wu=le(Cu.exec),Mu=le("".charAt),ku=le("".replace),Ou=le("".indexOf),Pu=le("".slice),Lu=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Iu=/a/g,Ru=/a/g,Nu=new Au(Iu)!==Iu,Du=ss.MISSED_STICKY,Fu=ss.UNSUPPORTED_Y,Bu=Ve&&(!Nu||Du||ms||_s||ee((function(){return Ru[Eu]=!1,Au(Iu)!=Iu||Au(Ru)==Ru||"/a/i"!=Au(Iu,"i")})));if(rr("RegExp",Bu)){for(var zu=function(e,t){var n,r,i,o,a,s,u=tt(Cu,this),l=su(e),c=void 0===t,h=[],f=e;if(!u&&l&&c&&e.constructor===zu)return e;if((l||tt(Cu,e))&&(e=e.source,c&&(t=Mr(f))),e=void 0===e?"":Cr(e),t=void 0===t?"":Cr(t),f=e,ms&&"dotAll"in Iu&&(r=!!t&&Ou(t,"s")>-1)&&(t=ku(t,/s/g,"")),n=t,Du&&"sticky"in Iu&&(i=!!t&&Ou(t,"y")>-1)&&Fu&&(t=ku(t,/y/g,"")),_s&&(e=(o=function(e){for(var t,n=e.length,r=0,i="",o=[],a={},s=!1,u=!1,l=0,c="";r<=n;r++){if("\\"===(t=Mu(e,r)))t+=Mu(e,++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:wu(Lu,Pu(e,r+1))&&(r+=2,u=!0),i+=t,l++;continue;case">"===t&&u:if(""===c||ge(a,c))throw new Tu("Invalid capture group name");a[c]=!0,o[o.length]=[c,l],u=!1,c="";continue}u?c+=t:i+=t}return[i,o]}(e))[0],h=o[1]),a=yu(Au(e,t),u?this:Cu,zu),(r||i||h.length)&&(s=Su(a),r&&(s.dotAll=!0,s.raw=zu(function(e){for(var t,n=e.length,r=0,i="",o=!1;r<=n;r++)"\\"!==(t=Mu(e,r))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),i+=t):i+="[\\s\\S]":i+=t+Mu(e,++r);return i}(e),n)),i&&(s.sticky=!0),h.length&&(s.groups=h)),e!==f)try{Ot(a,"source",""===f?"(?:)":f)}catch(e){}return a},ju=xu(Au),Uu=0;ju.length>Uu;)bu(zu,Au,ju[Uu++]);Cu.constructor=zu,zu.prototype=Cu,jt(q,"RegExp",zu,{constructor:!0})}Wr("RegExp");var Vu=le([].join),Hu=en!=Object,Gu=Cn("join",",");or({target:"Array",proto:!0,forced:Hu||!Gu},{join:function(e){return Vu(In(this),void 0===e?",":e)}});var Wu=mt.f,Yu=ze("unscopables"),Xu=Array.prototype;null==Xu[Yu]&&Wu(Xu,Yu,{configurable:!0,value:vs(null)});var Zu=function(e){Xu[Yu][e]=!0},qu=An.find,Ku=!0;"find"in[]&&Array(1).find((function(){Ku=!1})),or({target:"Array",proto:!0,forced:Ku},{find:function(e){return qu(this,e,arguments.length>1?arguments[1]:void 0)}}),Zu("find");var Qu=TypeError,$u=function(e){if(e>9007199254740991)throw Qu("Maximum allowed index exceeded");return e},Ju=ze("isConcatSpreadable"),el=Le>=51||!ee((function(){var e=[];return e[Ju]=!1,e.concat()[0]!==e})),tl=sr("concat"),nl=function(e){if(!Ge(e))return!1;var t=e[Ju];return void 0!==t?!!t:ln(e)};or({target:"Array",proto:!0,arity:1,forced:!el||!tl},{concat:function(e){var t,n,r,i,o,a=de(this),s=xn(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(nl(o=-1===t?a:arguments[t]))for(i=un(o),$u(u+i),n=0;n<i;n++,u++)n in o&&uu(s,u,o[n]);else $u(u+1),uu(s,u++,o);return s.length=u,s}});var rl=An.map,il=sr("map");or({target:"Array",proto:!0,forced:!il},{map:function(e){return rl(this,e,arguments.length>1?arguments[1]:void 0)}});var ol=Ln.f,al=le(ol),sl=le([].push),ul=function(e){return function(t){for(var n,r=In(t),i=us(r),o=i.length,a=0,s=[];o>a;)n=i[a++],Ve&&!al(r,n)||sl(s,e?[n,r[n]]:r[n]);return s}},ll={entries:ul(!0),values:ul(!1)},cl=ll.entries;or({target:"Object",stat:!0},{entries:function(e){return cl(e)}});var hl=xt.EXISTS,fl=mt.f,pl=Function.prototype,dl=le(pl.toString),vl=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,gl=le(vl.exec);Ve&&!hl&&fl(pl,"name",{configurable:!0,get:function(){try{return gl(vl,dl(this))[1]}catch(e){return""}}});var ml=sr("slice"),yl=ze("species"),_l=Array,bl=Math.max;or({target:"Array",proto:!0,forced:!ml},{slice:function(e,t){var n,r,i,o=In(this),a=un(o),s=Bn(e,a),u=Bn(void 0===t?a:t,a);if(ln(o)&&(n=o.constructor,(yn(n)&&(n===_l||ln(n.prototype))||Ge(n)&&null===(n=n[yl]))&&(n=void 0),n===_l||void 0===n))return ri(o,s,u);for(r=new(void 0===n?_l:n)(bl(u-s,0)),i=0;s<u;s++,i++)s in o&&uu(r,i,o[s]);return r.length=i,r}});var xl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Sl(e){this.message=e}function El(e){for(var t,n,r,i,o="",a=0,s=(e=String(e)).length%3;a<e.length;){if((n=e.charCodeAt(a++))>255||(r=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");o+=xl.charAt((t=n<<16|r<<8|i)>>18&63)+xl.charAt(t>>12&63)+xl.charAt(t>>6&63)+xl.charAt(63&t)}return s?o.slice(0,s-3)+"===".substring(s):o}Sl.prototype=new Error,Sl.prototype.name="InvalidCharacterError";var Al,Cl=function(){function e(t,n){b(this,e),this.buffers=t,this.type=n}return S(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(e,t,n){throw new Error("not implemented")}}]),e}();or({global:!0,forced:q.globalThis!==q},{globalThis:q}),Al="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(e){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(e){return null},clearMeasures:function(e){return null},clearMarks:function(e){return null},measure:function(e,t,n){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(e){return!0},Event:function(e,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window;var Tl="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Al.devicePixelRatio,wl=TypeError,Ml=Object.getOwnPropertyDescriptor,kl=Ve&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}()?function(e,t){if(ln(e)&&!Ml(e,"length").writable)throw wl("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},Ol=TypeError,Pl=function(e,t){if(!delete e[t])throw Ol("Cannot delete property "+ot(t)+" of "+ot(e))},Ll=sr("splice"),Il=Math.max,Rl=Math.min;or({target:"Array",proto:!0,forced:!Ll},{splice:function(e,t){var n,r,i,o,a,s,u=de(this),l=un(u),c=Bn(e,l),h=arguments.length;for(0===h?n=r=0:1===h?(n=0,r=l-c):(n=h-2,r=Rl(Il(on(t),0),l-c)),$u(l+n-r),i=xn(u,r),o=0;o<r;o++)(a=c+o)in u&&uu(i,o,u[a]);if(i.length=r,n<r){for(o=c;o<l-r;o++)s=o+n,(a=o+r)in u?u[s]=u[a]:Pl(u,s);for(o=l;o>l-r+n;o--)Pl(u,o-1)}else if(n>r)for(o=l-r;o>c;o--)s=o+n-1,(a=o+r-1)in u?u[s]=u[a]:Pl(u,s);for(o=0;o<n;o++)u[o+c]=arguments[o+2];return kl(u,l-r+n),i}});var Nl=S((function e(t,n){b(this,e),E(this,"cancelBubble",void 0),E(this,"cancelable",void 0),E(this,"target",void 0),E(this,"currentTarget",void 0),E(this,"preventDefault",void 0),E(this,"stopPropagation",void 0),E(this,"type",void 0),E(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=t,this.timeStamp=Date.now()})),Dl=Object.assign,Fl=Object.defineProperty,Bl=le([].concat),zl=!Dl||ee((function(){if(Ve&&1!==Dl({b:1},Dl(Fl({},"a",{enumerable:!0,get:function(){Fl(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=Dl({},e)[n]||"abcdefghijklmnopqrst"!=us(Dl({},t)).join("")}))?function(e,t){for(var n=de(e),r=arguments.length,i=1,o=Xn.f,a=Ln.f;r>i;)for(var s,u=en(arguments[i++]),l=o?Bl(us(u),o(u)):us(u),c=l.length,h=0;c>h;)s=l[h++],Ve&&!et(a,u,s)||(n[s]=u[s]);return n}:Dl;or({target:"Object",stat:!0,arity:2,forced:Object.assign!==zl},{assign:zl});var jl=An.findIndex,Ul=!0;"findIndex"in[]&&Array(1).findIndex((function(){Ul=!1})),or({target:"Array",proto:!0,forced:Ul},{findIndex:function(e){return jl(this,e,arguments.length>1?arguments[1]:void 0)}}),Zu("findIndex");var Vl,Hl,Gl,Wl=!ee((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Yl=Lt("IE_PROTO"),Xl=Object,Zl=Xl.prototype,ql=Wl?Xl.getPrototypeOf:function(e){var t=de(e);if(ge(t,Yl))return t[Yl];var n=t.constructor;return Ae(n)&&t instanceof n?n.prototype:t instanceof Xl?Zl:null},Kl=ze("iterator"),Ql=!1;[].keys&&("next"in(Gl=[].keys())?(Hl=ql(ql(Gl)))!==Object.prototype&&(Vl=Hl):Ql=!0),(!Ge(Vl)||ee((function(){var e={};return Vl[Kl].call(e)!==e})))&&(Vl={}),Ae(Vl[Kl])||jt(Vl,Kl,(function(){return this}));var $l={IteratorPrototype:Vl,BUGGY_SAFARI_ITERATORS:Ql},Jl=$l.IteratorPrototype,ec=function(){return this},tc=function(e,t,n,r){var i=t+" Iterator";return e.prototype=vs(Jl,{next:kt(+!r,n)}),Hr(e,i,!1),Mo[i]=ec,e},nc=xt.PROPER,rc=xt.CONFIGURABLE,ic=$l.IteratorPrototype,oc=$l.BUGGY_SAFARI_ITERATORS,ac=ze("iterator"),sc=function(){return this},uc=function(e,t,n,r,i,o,a){tc(n,t,r);var s,u,l,c=function(e){if(e===i&&v)return v;if(!oc&&e in p)return p[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},h=t+" Iterator",f=!1,p=e.prototype,d=p[ac]||p["@@iterator"]||i&&p[i],v=!oc&&d||c(i),g="Array"==t&&p.entries||d;if(g&&(s=ql(g.call(new e)))!==Object.prototype&&s.next&&(ql(s)!==ic&&(jr?jr(s,ic):Ae(s[ac])||jt(s,ac,sc)),Hr(s,h,!0)),nc&&"values"==i&&d&&"values"!==d.name&&(rc?Ot(p,"name","values"):(f=!0,v=function(){return et(d,this)})),i)if(u={values:c("values"),keys:o?v:c("keys"),entries:c("entries")},a)for(l in u)(oc||f||!(l in p))&&jt(p,l,u[l]);else or({target:t,proto:!0,forced:oc||f},u);return p[ac]!==v&&jt(p,ac,v,{name:i}),Mo[t]=v,u},lc=function(e,t){return{value:e,done:t}},cc=mt.f,hc=Bt.set,fc=Bt.getterFor("Array Iterator"),pc=uc(Array,"Array",(function(e,t){hc(this,{type:"Array Iterator",target:In(e),index:0,kind:t})}),(function(){var e=fc(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,lc(void 0,!0)):lc("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values"),dc=Mo.Arguments=Mo.Array;if(Zu("keys"),Zu("values"),Zu("entries"),Ve&&"values"!==dc.name)try{cc(dc,"name",{value:"values"})}catch(e){}var vc=zs.charAt,gc=Bt.set,mc=Bt.getterFor("String Iterator");uc(String,"String",(function(e){gc(this,{type:"String Iterator",string:Cr(e),index:0})}),(function(){var e,t=mc(this),n=t.string,r=t.index;return r>=n.length?lc(void 0,!0):(e=vc(n,r),t.index+=e.length,lc(e,!1))}));var yc=function(e,t,n){for(var r in t)jt(e,r,t[r],n);return e},_c=Yn.f,bc="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],xc={f:function(e){return bc&&"Window"==ue(e)?function(e){try{return _c(e)}catch(e){return hu(bc)}}(e):_c(In(e))}},Sc=ee((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),Ec=Object.isExtensible,Ac=ee((function(){Ec(1)}))||Sc?function(e){return!!Ge(e)&&((!Sc||"ArrayBuffer"!=ue(e))&&(!Ec||Ec(e)))}:Ec,Cc=!ee((function(){return Object.isExtensible(Object.preventExtensions({}))})),Tc=W((function(e){var t=mt.f,n=!1,r=be("meta"),i=0,o=function(e){t(e,r,{value:{objectID:"O"+i++,weakData:{}}})},a=e.exports={enable:function(){a.enable=function(){},n=!0;var e=Yn.f,t=le([].splice),i={};i[r]=1,e(i).length&&(Yn.f=function(n){for(var i=e(n),o=0,a=i.length;o<a;o++)if(i[o]===r){t(i,o,1);break}return i},or({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:xc.f}))},fastKey:function(e,t){if(!Ge(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!ge(e,r)){if(!Ac(e))return"F";if(!t)return"E";o(e)}return e[r].objectID},getWeakData:function(e,t){if(!ge(e,r)){if(!Ac(e))return!0;if(!t)return!1;o(e)}return e[r].weakData},onFreeze:function(e){return Cc&&n&&Ac(e)&&!ge(e,r)&&o(e),e}};It[r]=!0})),wc=(Tc.enable,Tc.fastKey,Tc.getWeakData,Tc.onFreeze,function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=q[e],s=a&&a.prototype,u=a,l={},c=function(e){var t=le(s[e]);jt(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!Ge(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return i&&!Ge(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!Ge(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(rr(e,!Ae(a)||!(i||s.forEach&&!ee((function(){(new a).entries().next()})))))u=n.getConstructor(t,e,r,o),Tc.enable();else if(rr(e,!0)){var h=new u,f=h[o](i?{}:-0,1)!=h,p=ee((function(){h.has(1)})),d=Wo((function(e){new a(e)})),v=!i&&ee((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));d||((u=t((function(e,t){Xr(e,s);var n=yu(new a,e,u);return ce(t)||jo(t,n[o],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=u),(p||v)&&(c("delete"),c("has"),r&&c("get")),(v||f)&&c(o),i&&s.clear&&delete s.clear}return l[e]=u,or({global:!0,constructor:!0,forced:u!=a},l),Hr(u,e),i||n.setStrong(u,e,r),u}),Mc=Tc.getWeakData,kc=Bt.set,Oc=Bt.getterFor,Pc=An.find,Lc=An.findIndex,Ic=le([].splice),Rc=0,Nc=function(e){return e.frozen||(e.frozen=new Dc)},Dc=function(){this.entries=[]},Fc=function(e,t){return Pc(e.entries,(function(e){return e[0]===t}))};Dc.prototype={get:function(e){var t=Fc(this,e);if(t)return t[1]},has:function(e){return!!Fc(this,e)},set:function(e,t){var n=Fc(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=Lc(this.entries,(function(t){return t[0]===e}));return~t&&Ic(this.entries,t,1),!!~t}};var Bc,zc={getConstructor:function(e,t,n,r){var i=e((function(e,i){Xr(e,o),kc(e,{type:t,id:Rc++,frozen:void 0}),ce(i)||jo(i,e[r],{that:e,AS_ENTRIES:n})})),o=i.prototype,a=Oc(t),s=function(e,t,n){var r=a(e),i=Mc($e(t),!0);return!0===i?Nc(r).set(t,n):i[r.id]=n,e};return yc(o,{delete:function(e){var t=a(this);if(!Ge(e))return!1;var n=Mc(e);return!0===n?Nc(t).delete(e):n&&ge(n,t.id)&&delete n[t.id]},has:function(e){var t=a(this);if(!Ge(e))return!1;var n=Mc(e);return!0===n?Nc(t).has(e):n&&ge(n,t.id)}}),yc(o,n?{get:function(e){var t=a(this);if(Ge(e)){var n=Mc(e);return!0===n?Nc(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),i}},jc=Bt.enforce,Uc=!q.ActiveXObject&&"ActiveXObject"in q,Vc=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Hc=wc("WeakMap",Vc,zc);if(Mt&&Uc){Bc=zc.getConstructor(Vc,"WeakMap",!0),Tc.enable();var Gc=Hc.prototype,Wc=le(Gc.delete),Yc=le(Gc.has),Xc=le(Gc.get),Zc=le(Gc.set);yc(Gc,{delete:function(e){if(Ge(e)&&!Ac(e)){var t=jc(this);return t.frozen||(t.frozen=new Bc),Wc(this,e)||t.frozen.delete(e)}return Wc(this,e)},has:function(e){if(Ge(e)&&!Ac(e)){var t=jc(this);return t.frozen||(t.frozen=new Bc),Yc(this,e)||t.frozen.has(e)}return Yc(this,e)},get:function(e){if(Ge(e)&&!Ac(e)){var t=jc(this);return t.frozen||(t.frozen=new Bc),Yc(this,e)?Xc(this,e):t.frozen.get(e)}return Xc(this,e)},set:function(e,t){if(Ge(e)&&!Ac(e)){var n=jc(this);n.frozen||(n.frozen=new Bc),Yc(this,e)?Zc(this,e,t):n.frozen.set(e,t)}else Zc(this,e,t);return this}})}var qc=ze("iterator"),Kc=ze("toStringTag"),Qc=pc.values,$c=function(e,t){if(e){if(e[qc]!==Qc)try{Ot(e,qc,Qc)}catch(t){e[qc]=Qc}if(e[Kc]||Ot(e,Kc,t),Yt[t])for(var n in pc)if(e[n]!==pc[n])try{Ot(e,n,pc[n])}catch(t){e[n]=pc[n]}}};for(var Jc in Yt)$c(q[Jc]&&q[Jc].prototype,Jc);$c(qt,"DOMTokenList");var eh,th,nh,rh,ih=new WeakMap,oh=function(){function e(){b(this,e),ih.set(this,{})}return S(e,[{key:"addEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=ih.get(this);r||(r={}),r[e]||(r[e]=[]),r[e].push(t),ih.set(this,r),n.capture,n.once,n.passive}},{key:"removeEventListener",value:function(e,t){var n=ih.get(this);if(n){var r=n[e];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===t){r.splice(i,1);break}}}},{key:"dispatchEvent",value:function(e){var t=ih.get(this)[e.type];if(t){var n,r=j(t);try{for(r.s();!(n=r.n()).done;){(0,n.value)(e)}}catch(e){r.e(e)}finally{r.f()}}}}]),e}(),ah=function(e){A(n,e);var t=I(n);function n(){var e;return b(this,n),E(P(e=t.call(this)),"childNodes",void 0),e.childNodes=[],e}return S(n,[{key:"appendChild",value:function(e){this.childNodes.push(e)}},{key:"cloneNode",value:function(){var e=Object.create(this);return Object.assign(e,this),e}},{key:"removeChild",value:function(e){var t=this.childNodes.findIndex((function(t){return t===e}));return t>-1?this.childNodes.splice(t,1):null}}]),n}(oh),sh=function(e){A(n,e);var t=I(n);function n(){var e;return b(this,n),E(P(e=t.call(this)),"className",void 0),E(P(e),"children",void 0),e.className="",e.children=[],e}return S(n,[{key:"setAttribute",value:function(e,t){this[e]=t}},{key:"getAttribute",value:function(e){return this[e]}},{key:"setAttributeNS",value:function(e,t){this[e]=t}},{key:"getAttributeNS",value:function(e){return this[e]}}]),n}(ah);if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var uh=my.getSystemInfoSync();eh=uh.screenWidth,th=uh.screenHeight,nh=uh.windowWidth,rh=uh.windowHeight}else{var lh=Al.innerWidth,ch=Al.innerHeight;eh=lh,th=ch,nh=lh,rh=ch}var hh={width:eh,height:th,availWidth:nh,availHeight:rh,availLeft:0,availTop:0},fh=hh.availWidth,ph=hh.availHeight,dh={style:[]};function vh(e,t){var n,r;"parentNode"in e||(n=0===t?function(){return null}:1===t?function(){return dh}:function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:n}));"parentElement"in e||(r=0===t?function(){return null}:1===t?function(){return dh}:function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:r}))}function gh(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:fh+"px",height:ph+"px",margin:"0px",padding:"0px"})}function mh(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=fh,e.clientHeight=ph),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function yh(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=fh,e.offsetHeight=ph)}function _h(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=fh,e.scrollHeight=ph)}function bh(e){var t=function(){return!0};e.classList=[],e.classList.add=t,e.classList.remove=t,e.classList.contains=t,e.classList.toggle=t}function xh(){}var Sh=function(e){A(n,e);var t=I(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return b(this,n),E(P(e=t.call(this)),"className",void 0),E(P(e),"children",void 0),E(P(e),"focus",void 0),E(P(e),"blur",void 0),E(P(e),"insertBefore",void 0),E(P(e),"appendChild",void 0),E(P(e),"removeChild",void 0),E(P(e),"remove",void 0),E(P(e),"innerHTML",void 0),E(P(e),"tagName",void 0),e.className="",e.children=[],e.focus=xh,e.blur=xh,e.insertBefore=xh,e.appendChild=xh,e.removeChild=xh,e.remove=xh,e.innerHTML="",e.tagName=r.toUpperCase(),vh(P(e),i),gh(P(e)),bh(P(e)),mh(P(e)),yh(P(e)),_h(P(e)),e}return S(n)}(sh),Eh=function(e){A(n,e);var t=I(n);function n(e){return b(this,n),t.call(this,e)}return S(n,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),n}(Sh),Ah=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.call(this,"video")}return S(n)}(Eh),Ch={};function Th(){return Ch}var wh=S((function e(){b(this,e);var t=Th(),n=t.createImage&&t.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=e.prototype),vh(n),bh(n),Object.assign(n,{addEventListener:function(e,t){n["on".concat(e)]=t.bind(n)},removeEventListener:function(e){n["on".concat(e)]=null}}),n})),Mh={href:"",protocol:"",host:""},kh=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.call(this,"body",0)}return S(n,[{key:"addEventListener",value:function(e,t){}},{key:"removeEventListener",value:function(e,t,n){}},{key:"dispatchEvent",value:function(e){}}]),n}(Sh),Oh=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.call(this,"html",0)}return S(n,[{key:"addEventListener",value:function(e,t){}},{key:"removeEventListener",value:function(e,t){}},{key:"dispatchEvent",value:function(e){}}]),n}(Sh),Ph={},Lh={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Mh,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(e){return"canvas"===(e=e.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===e?new wh:"video"===e?new Ah:new Sh(e)},createElementNS:function(e,t){return this.createElement(t)},createTextNode:function(e){return e},getElementById:function(e){return null},getElementsByTagName:function(e){return e=e.toLowerCase(),[]},getElementsByTagNameNS:function(e,t){return this.getElementsByTagName(t)},getElementsByName:function(e){return[]},querySelector:function(e){return null},querySelectorAll:function(e){return[]},addEventListener:function(e,t,n){Ph[e]||(Ph[e]=[]),Ph[e].push(t)},removeEventListener:function(e,t){var n=Ph[e];if(n&&n.length>0)for(var r=n.length;r--;r>0)if(n[r]===t){n.splice(r,1);break}},dispatchEvent:function(e){var t=e.type,n=Ph[t];if(n)for(var r=0;r<n.length;r++)n[r](e);e.target&&"function"==typeof e.target["on"+t]&&e.target["on"+t](e)},createEvent:function(e){return new Nl(e)}};Lh.documentElement=new Oh,Lh.head=new Sh("head"),Lh.body=new kh;var Ih,Rh,Nh,Dh=Object,Fh="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Bh=mt.f,zh=Bt.enforce,jh=Bt.get,Uh=q.Int8Array,Vh=Uh&&Uh.prototype,Hh=q.Uint8ClampedArray,Gh=Hh&&Hh.prototype,Wh=Uh&&ql(Uh),Yh=Vh&&ql(Vh),Xh=Object.prototype,Zh=q.TypeError,qh=ze("toStringTag"),Kh=be("TYPED_ARRAY_TAG"),Qh=Fh&&!!jr&&"Opera"!==Gt(q.opera),$h=!1,Jh={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ef={BigInt64Array:8,BigUint64Array:8},tf=function(e){var t=ql(e);if(Ge(t)){var n=jh(t);return n&&ge(n,"TypedArrayConstructor")?n.TypedArrayConstructor:tf(t)}},nf=function(e){if(!Ge(e))return!1;var t=Gt(e);return ge(Jh,t)||ge(ef,t)};for(Ih in Jh)(Nh=(Rh=q[Ih])&&Rh.prototype)?zh(Nh).TypedArrayConstructor=Rh:Qh=!1;for(Ih in ef)(Nh=(Rh=q[Ih])&&Rh.prototype)&&(zh(Nh).TypedArrayConstructor=Rh);if((!Qh||!Ae(Wh)||Wh===Function.prototype)&&(Wh=function(){throw Zh("Incorrect invocation")},Qh))for(Ih in Jh)q[Ih]&&jr(q[Ih],Wh);if((!Qh||!Yh||Yh===Xh)&&(Yh=Wh.prototype,Qh))for(Ih in Jh)q[Ih]&&jr(q[Ih].prototype,Yh);if(Qh&&ql(Gh)!==Yh&&jr(Gh,Yh),Ve&&!ge(Yh,qh))for(Ih in $h=!0,Bh(Yh,qh,{get:function(){return Ge(this)?this[Kh]:void 0}}),Jh)q[Ih]&&Ot(q[Ih],Kh,Ih);var rf={NATIVE_ARRAY_BUFFER_VIEWS:Qh,TYPED_ARRAY_TAG:$h&&Kh,aTypedArray:function(e){if(nf(e))return e;throw Zh("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Ae(e)&&(!jr||tt(Wh,e)))return e;throw Zh(ot(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,r){if(Ve){if(n)for(var i in Jh){var o=q[i];if(o&&ge(o.prototype,e))try{delete o.prototype[e]}catch(n){try{o.prototype[e]=t}catch(e){}}}Yh[e]&&!n||jt(Yh,e,n?t:Qh&&Vh[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(Ve){if(jr){if(n)for(r in Jh)if((i=q[r])&&ge(i,e))try{delete i[e]}catch(e){}if(Wh[e]&&!n)return;try{return jt(Wh,e,n?t:Qh&&Wh[e]||t)}catch(e){}}for(r in Jh)!(i=q[r])||i[e]&&!n||jt(i,e,t)}},getTypedArrayConstructor:tf,isView:function(e){if(!Ge(e))return!1;var t=Gt(e);return"DataView"===t||ge(Jh,t)||ge(ef,t)},isTypedArray:nf,TypedArray:Wh,TypedArrayPrototype:Yh},of=rf.NATIVE_ARRAY_BUFFER_VIEWS,af=q.ArrayBuffer,sf=q.Int8Array,uf=!of||!ee((function(){sf(1)}))||!ee((function(){new sf(-1)}))||!Wo((function(e){new sf,new sf(null),new sf(1.5),new sf(e)}),!0)||ee((function(){return 1!==new sf(new af(2),1,void 0).length})),lf=RangeError,cf=function(e){if(void 0===e)return 0;var t=on(e),n=sn(t);if(t!==n)throw lf("Wrong length or index");return n},hf=Array,ff=Math.abs,pf=Math.pow,df=Math.floor,vf=Math.log,gf=Math.LN2,mf=function(e,t,n){var r,i,o,a=hf(n),s=8*n-t-1,u=(1<<s)-1,l=u>>1,c=23===t?pf(2,-24)-pf(2,-77):0,h=e<0||0===e&&1/e<0?1:0,f=0;for((e=ff(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=df(vf(e)/gf),e*(o=pf(2,-r))<1&&(r--,o*=2),(e+=r+l>=1?c/o:c*pf(2,1-l))*o>=2&&(r++,o/=2),r+l>=u?(i=0,r=u):r+l>=1?(i=(e*o-1)*pf(2,t),r+=l):(i=e*pf(2,l-1)*pf(2,t),r=0));t>=8;)a[f++]=255&i,i/=256,t-=8;for(r=r<<t|i,s+=t;s>0;)a[f++]=255&r,r/=256,s-=8;return a[--f]|=128*h,a},yf=function(e,t){var n,r=e.length,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,u=r-1,l=e[u--],c=127&l;for(l>>=7;s>0;)c=256*c+e[u--],s-=8;for(n=c&(1<<-s)-1,c>>=-s,s+=t;s>0;)n=256*n+e[u--],s-=8;if(0===c)c=1-a;else{if(c===o)return n?NaN:l?-1/0:1/0;n+=pf(2,t),c-=a}return(l?-1:1)*n*pf(2,c-t)},_f=function(e){for(var t=de(this),n=un(t),r=arguments.length,i=Bn(r>1?arguments[1]:void 0,n),o=r>2?arguments[2]:void 0,a=void 0===o?n:Bn(o,n);a>i;)t[i++]=e;return t},bf=Yn.f,xf=mt.f,Sf=xt.PROPER,Ef=xt.CONFIGURABLE,Af=Bt.get,Cf=Bt.set,Tf=q.ArrayBuffer,wf=Tf,Mf=wf&&wf.prototype,kf=q.DataView,Of=kf&&kf.prototype,Pf=Object.prototype,Lf=q.Array,If=q.RangeError,Rf=le(_f),Nf=le([].reverse),Df=mf,Ff=yf,Bf=function(e){return[255&e]},zf=function(e){return[255&e,e>>8&255]},jf=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Uf=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Vf=function(e){return Df(e,23,4)},Hf=function(e){return Df(e,52,8)},Gf=function(e,t){xf(e.prototype,t,{get:function(){return Af(this)[t]}})},Wf=function(e,t,n,r){var i=cf(n),o=Af(e);if(i+t>o.byteLength)throw If("Wrong index");var a=Af(o.buffer).bytes,s=i+o.byteOffset,u=hu(a,s,s+t);return r?u:Nf(u)},Yf=function(e,t,n,r,i,o){var a=cf(n),s=Af(e);if(a+t>s.byteLength)throw If("Wrong index");for(var u=Af(s.buffer).bytes,l=a+s.byteOffset,c=r(+i),h=0;h<t;h++)u[l+h]=c[o?h:t-h-1]};if(Fh){var Xf=Sf&&"ArrayBuffer"!==Tf.name;if(ee((function(){Tf(1)}))&&ee((function(){new Tf(-1)}))&&!ee((function(){return new Tf,new Tf(1.5),new Tf(NaN),1!=Tf.length||Xf&&!Ef})))Xf&&Ef&&Ot(Tf,"name","ArrayBuffer");else{(wf=function(e){return Xr(this,Mf),new Tf(cf(e))}).prototype=Mf;for(var Zf,qf=bf(Tf),Kf=0;qf.length>Kf;)(Zf=qf[Kf++])in wf||Ot(wf,Zf,Tf[Zf]);Mf.constructor=wf}jr&&ql(Of)!==Pf&&jr(Of,Pf);var Qf=new kf(new wf(2)),$f=le(Of.setInt8);Qf.setInt8(0,2147483648),Qf.setInt8(1,2147483649),!Qf.getInt8(0)&&Qf.getInt8(1)||yc(Of,{setInt8:function(e,t){$f(this,e,t<<24>>24)},setUint8:function(e,t){$f(this,e,t<<24>>24)}},{unsafe:!0})}else Mf=(wf=function(e){Xr(this,Mf);var t=cf(e);Cf(this,{bytes:Rf(Lf(t),0),byteLength:t}),Ve||(this.byteLength=t)}).prototype,Of=(kf=function(e,t,n){Xr(this,Of),Xr(e,Mf);var r=Af(e).byteLength,i=on(t);if(i<0||i>r)throw If("Wrong offset");if(i+(n=void 0===n?r-i:sn(n))>r)throw If("Wrong length");Cf(this,{buffer:e,byteLength:n,byteOffset:i}),Ve||(this.buffer=e,this.byteLength=n,this.byteOffset=i)}).prototype,Ve&&(Gf(wf,"byteLength"),Gf(kf,"buffer"),Gf(kf,"byteLength"),Gf(kf,"byteOffset")),yc(Of,{getInt8:function(e){return Wf(this,1,e)[0]<<24>>24},getUint8:function(e){return Wf(this,1,e)[0]},getInt16:function(e){var t=Wf(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Wf(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Uf(Wf(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return Uf(Wf(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return Ff(Wf(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return Ff(Wf(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Yf(this,1,e,Bf,t)},setUint8:function(e,t){Yf(this,1,e,Bf,t)},setInt16:function(e,t){Yf(this,2,e,zf,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Yf(this,2,e,zf,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Yf(this,4,e,jf,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Yf(this,4,e,jf,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Yf(this,4,e,Vf,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Yf(this,8,e,Hf,t,arguments.length>2?arguments[2]:void 0)}});Hr(wf,"ArrayBuffer"),Hr(kf,"DataView");var Jf={ArrayBuffer:wf,DataView:kf},ep=Math.floor,tp=Number.isInteger||function(e){return!Ge(e)&&isFinite(e)&&ep(e)===e},np=RangeError,rp=RangeError,ip=function(e,t){var n=function(e){var t=on(e);if(t<0)throw np("The argument can't be less than 0");return t}(e);if(n%t)throw rp("Wrong offset");return n},op=le("".slice),ap=function(e){return"Big"===op(Gt(e),0,3)},sp=TypeError,up=function(e){var t=ft(e,"number");if("number"==typeof t)throw sp("Can't convert number to bigint");return BigInt(t)},lp=rf.aTypedArrayConstructor,cp=function(e){var t,n,r,i,o,a,s,u,l=qr(this),c=de(e),h=arguments.length,f=h>1?arguments[1]:void 0,p=void 0!==f,d=Io(c);if(d&&!Po(d))for(u=(s=No(c,d)).next,c=[];!(a=et(u,s)).done;)c.push(a.value);for(p&&h>2&&(f=Qt(f,arguments[2])),n=un(c),r=new(lp(l))(n),i=ap(r),t=0;n>t;t++)o=p?f(c[t],t):c[t],r[t]=i?up(o):+o;return r},hp=W((function(e){var t=Yn.f,n=An.forEach,r=Bt.get,i=Bt.set,o=Bt.enforce,a=mt.f,s=Nn.f,u=Math.round,l=q.RangeError,c=Jf.ArrayBuffer,h=c.prototype,f=Jf.DataView,p=rf.NATIVE_ARRAY_BUFFER_VIEWS,d=rf.TYPED_ARRAY_TAG,v=rf.TypedArray,g=rf.TypedArrayPrototype,m=rf.aTypedArrayConstructor,y=rf.isTypedArray,_=function(e,t){m(e);for(var n=0,r=t.length,i=new e(r);r>n;)i[n]=t[n++];return i},b=function(e,t){a(e,t,{get:function(){return r(this)[t]}})},x=function(e){var t;return tt(h,e)||"ArrayBuffer"==(t=Gt(e))||"SharedArrayBuffer"==t},S=function(e,t){return y(e)&&!rt(t)&&t in e&&tp(+t)&&t>=0},E=function(e,t){return t=pt(t),S(e,t)?kt(2,e[t]):s(e,t)},A=function(e,t,n){return t=pt(t),!(S(e,t)&&Ge(n)&&ge(n,"value"))||ge(n,"get")||ge(n,"set")||n.configurable||ge(n,"writable")&&!n.writable||ge(n,"enumerable")&&!n.enumerable?a(e,t,n):(e[t]=n.value,e)};Ve?(p||(Nn.f=E,mt.f=A,b(g,"buffer"),b(g,"byteOffset"),b(g,"byteLength"),b(g,"length")),or({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:E,defineProperty:A}),e.exports=function(e,s,h){var m=e.match(/\d+$/)[0]/8,b=e+(h?"Clamped":"")+"Array",S="get"+e,E="set"+e,A=q[b],C=A,T=C&&C.prototype,w={},M=function(e,t){a(e,t,{get:function(){return function(e,t){var n=r(e);return n.view[S](t*m+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var i=r(e);h&&(n=(n=u(n))<0?0:n>255?255:255&n),i.view[E](t*m+i.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};p?uf&&(C=s((function(e,t,n,r){return Xr(e,T),yu(Ge(t)?x(t)?void 0!==r?new A(t,ip(n,m),r):void 0!==n?new A(t,ip(n,m)):new A(t):y(t)?_(C,t):et(cp,C,t):new A(cf(t)),e,C)})),jr&&jr(C,v),n(t(A),(function(e){e in C||Ot(C,e,A[e])})),C.prototype=T):(C=s((function(e,t,n,r){Xr(e,T);var o,a,s,u=0,h=0;if(Ge(t)){if(!x(t))return y(t)?_(C,t):et(cp,C,t);o=t,h=ip(n,m);var p=t.byteLength;if(void 0===r){if(p%m)throw l("Wrong length");if((a=p-h)<0)throw l("Wrong length")}else if((a=sn(r)*m)+h>p)throw l("Wrong length");s=a/m}else s=cf(t),o=new c(a=s*m);for(i(e,{buffer:o,byteOffset:h,byteLength:a,length:s,view:new f(o)});u<s;)M(e,u++)})),jr&&jr(C,v),T=C.prototype=vs(g)),T.constructor!==C&&Ot(T,"constructor",C),o(T).TypedArrayConstructor=C,d&&Ot(T,d,b);var k=C!=A;w[b]=C,or({global:!0,constructor:!0,forced:k,sham:!p},w),"BYTES_PER_ELEMENT"in C||Ot(C,"BYTES_PER_ELEMENT",m),"BYTES_PER_ELEMENT"in T||Ot(T,"BYTES_PER_ELEMENT",m),Wr(b)}):e.exports=function(){}}));hp("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0);var fp=Math.min,pp=le([].copyWithin||function(e,t){var n=de(this),r=un(n),i=Bn(e,r),o=Bn(t,r),a=arguments.length>2?arguments[2]:void 0,s=fp((void 0===a?r:Bn(a,r))-o,r-i),u=1;for(o<i&&i<o+s&&(u=-1,o+=s-1,i+=s-1);s-- >0;)o in n?n[i]=n[o]:Pl(n,i),i+=u,o+=u;return n}),dp=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("copyWithin",(function(e,t){return pp(dp(this),e,t,arguments.length>2?arguments[2]:void 0)}));var vp=An.every,gp=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("every",(function(e){return vp(gp(this),e,arguments.length>1?arguments[1]:void 0)}));var mp=rf.aTypedArray,yp=rf.exportTypedArrayMethod,_p=le("".slice);yp("fill",(function(e){var t=arguments.length;mp(this);var n="Big"===_p(Gt(this),0,3)?up(e):+e;return et(_f,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),ee((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var bp=rf.aTypedArrayConstructor,xp=rf.getTypedArrayConstructor,Sp=function(e){return bp(Qr(e,xp(e)))},Ep=function(e,t){return function(e,t){for(var n=0,r=un(t),i=new e(r);r>n;)i[n]=t[n++];return i}(Sp(e),t)},Ap=An.filter,Cp=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("filter",(function(e){var t=Ap(Cp(this),e,arguments.length>1?arguments[1]:void 0);return Ep(this,t)}));var Tp=An.find,wp=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("find",(function(e){return Tp(wp(this),e,arguments.length>1?arguments[1]:void 0)}));var Mp=An.findIndex,kp=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("findIndex",(function(e){return Mp(kp(this),e,arguments.length>1?arguments[1]:void 0)}));var Op=An.forEach,Pp=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("forEach",(function(e){Op(Pp(this),e,arguments.length>1?arguments[1]:void 0)}));var Lp=jn.includes,Ip=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("includes",(function(e){return Lp(Ip(this),e,arguments.length>1?arguments[1]:void 0)}));var Rp=jn.indexOf,Np=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("indexOf",(function(e){return Rp(Np(this),e,arguments.length>1?arguments[1]:void 0)}));var Dp=ze("iterator"),Fp=q.Uint8Array,Bp=le(pc.values),zp=le(pc.keys),jp=le(pc.entries),Up=rf.aTypedArray,Vp=rf.exportTypedArrayMethod,Hp=Fp&&Fp.prototype,Gp=!ee((function(){Hp[Dp].call([1])})),Wp=!!Hp&&Hp.values&&Hp[Dp]===Hp.values&&"values"===Hp.values.name,Yp=function(){return Bp(Up(this))};Vp("entries",(function(){return jp(Up(this))}),Gp),Vp("keys",(function(){return zp(Up(this))}),Gp),Vp("values",Yp,Gp||!Wp,{name:"values"}),Vp(Dp,Yp,Gp||!Wp,{name:"values"});var Xp=rf.aTypedArray,Zp=rf.exportTypedArrayMethod,qp=le([].join);Zp("join",(function(e){return qp(Xp(this),e)}));var Kp=Math.min,Qp=[].lastIndexOf,$p=!!Qp&&1/[1].lastIndexOf(1,-0)<0,Jp=Cn("lastIndexOf"),ed=$p||!Jp?function(e){if($p)return ti(Qp,this,arguments)||0;var t=In(this),n=un(t),r=n-1;for(arguments.length>1&&(r=Kp(r,on(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:Qp,td=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return ti(ed,td(this),t>1?[e,arguments[1]]:[e])}));var nd=An.map,rd=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("map",(function(e){return nd(rd(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(Sp(e))(t)}))}));var id=TypeError,od=function(e){return function(t,n,r,i){st(n);var o=de(t),a=en(o),s=un(o),u=e?s-1:0,l=e?-1:1;if(r<2)for(;;){if(u in a){i=a[u],u+=l;break}if(u+=l,e?u<0:s<=u)throw id("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=l)u in a&&(i=n(i,a[u],u,o));return i}},ad={left:od(!1),right:od(!0)},sd=ad.left,ud=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return sd(ud(this),e,t,t>1?arguments[1]:void 0)}));var ld=ad.right,cd=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return ld(cd(this),e,t,t>1?arguments[1]:void 0)}));var hd=rf.aTypedArray,fd=rf.exportTypedArrayMethod,pd=Math.floor;fd("reverse",(function(){for(var e,t=hd(this).length,n=pd(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var dd=q.RangeError,vd=q.Int8Array,gd=vd&&vd.prototype,md=gd&&gd.set,yd=rf.aTypedArray,_d=rf.exportTypedArrayMethod,bd=!ee((function(){var e=new Uint8ClampedArray(2);return et(md,e,{length:1,0:3},1),3!==e[1]})),xd=bd&&rf.NATIVE_ARRAY_BUFFER_VIEWS&&ee((function(){var e=new vd(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));_d("set",(function(e){yd(this);var t=ip(arguments.length>1?arguments[1]:void 0,1),n=de(e);if(bd)return et(md,this,n,t);var r=this.length,i=un(n),o=0;if(i+t>r)throw dd("Wrong length");for(;o<i;)this[t+o]=n[o++]}),!bd||xd);var Sd=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("slice",(function(e,t){for(var n=ri(Sd(this),e,t),r=Sp(this),i=0,o=n.length,a=new r(o);o>i;)a[i]=n[i++];return a}),ee((function(){new Int8Array(1).slice()})));var Ed=An.some,Ad=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("some",(function(e){return Ed(Ad(this),e,arguments.length>1?arguments[1]:void 0)}));var Cd=Math.floor,Td=function(e,t){var n=e.length,r=Cd(n/2);return n<8?wd(e,t):Md(e,Td(hu(e,0,r),t),Td(hu(e,r),t),t)},wd=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},Md=function(e,t,n,r){for(var i=t.length,o=n.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?r(t[a],n[s])<=0?t[a++]:n[s++]:a<i?t[a++]:n[s++];return e},kd=Td,Od=we.match(/firefox\/(\d+)/i),Pd=!!Od&&+Od[1],Ld=/MSIE|Trident/.test(we),Id=we.match(/AppleWebKit\/(\d+)\./),Rd=!!Id&&+Id[1],Nd=rf.aTypedArray,Dd=rf.exportTypedArrayMethod,Fd=q.Uint16Array,Bd=Fd&&le(Fd.prototype.sort),zd=!(!Bd||ee((function(){Bd(new Fd(2),null)}))&&ee((function(){Bd(new Fd(2),{})}))),jd=!!Bd&&!ee((function(){if(Le)return Le<74;if(Pd)return Pd<67;if(Ld)return!0;if(Rd)return Rd<602;var e,t,n=new Fd(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(Bd(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));Dd("sort",(function(e){return void 0!==e&&st(e),jd?Bd(this,e):kd(Nd(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!jd||zd);var Ud=rf.aTypedArray;(0,rf.exportTypedArrayMethod)("subarray",(function(e,t){var n=Ud(this),r=n.length,i=Bn(e,r);return new(Sp(n))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,sn((void 0===t?r:Bn(t,r))-i))}));var Vd=q.Int8Array,Hd=rf.aTypedArray,Gd=rf.exportTypedArrayMethod,Wd=[].toLocaleString,Yd=!!Vd&&ee((function(){Wd.call(new Vd(1))}));Gd("toLocaleString",(function(){return ti(Wd,Yd?ri(Hd(this)):Hd(this),ri(arguments))}),ee((function(){return[1,2].toLocaleString()!=new Vd([1,2]).toLocaleString()}))||!ee((function(){Vd.prototype.toLocaleString.call([1,2])})));var Xd=rf.exportTypedArrayMethod,Zd=q.Uint8Array,qd=Zd&&Zd.prototype||{},Kd=[].toString,Qd=le([].join);ee((function(){Kd.call({})}))&&(Kd=function(){return Qd(this)});var $d=qd.toString!=Kd;Xd("toString",Kd,$d);var Jd,ev,tv,nv,rv=function(){function e(){b(this,e),E(this,"_w",void 0),E(this,"_h",void 0),E(this,"_data",void 0);var t=arguments.length;if(2===t){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this._w=arguments[0],this._h=arguments[1],void(this._data=new Uint8ClampedArray(this._w*this._h*4))}else 3===t&&"object"===m(arguments[0])&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return S(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}();if(Rs("match",(function(e,t,n){return[function(t){var n=fe(this),r=ce(t)?void 0:ut(t,e);return r?et(r,t,n):new RegExp(t)[e](Cr(n))},function(e){var r=$e(this),i=Cr(e),o=n(t,r,i);if(o.done)return o.value;if(!r.global)return Ks(r,i);var a=r.unicode;r.lastIndex=0;for(var s,u=[],l=0;null!==(s=Ks(r,i));){var c=Cr(s[0]);u[l]=c,""===c&&(r.lastIndex=Us(i,sn(r.lastIndex),a)),l++}return 0===l?null:u}]})),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var iv=my.getSystemInfoSync();Jd=iv.system,ev=iv.platform,tv=iv.language}else{var ov={versions:(nv=Al.navigator.userAgent,{trident:nv.indexOf("Trident")>-1,presto:nv.indexOf("Presto")>-1,webKit:nv.indexOf("AppleWebKit")>-1,gecko:nv.indexOf("Gecko")>-1&&-1===nv.indexOf("KHTML"),mobile:!!nv.match(/AppleWebKit.*Mobile.*/),ios:!!nv.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:nv.indexOf("Android")>-1||nv.indexOf("Linux")>-1,iPhone:nv.indexOf("iPhone")>-1,iPad:nv.indexOf("iPad")>-1,webApp:-1===nv.indexOf("Safari"),weixin:nv.indexOf("MicroMessenger")>-1,qq:" qq"===nv.match(/\sQQ/i)}),language:(Al.navigator.browserLanguage||Al.navigator.language).toLowerCase()};ov.versions.android?ev="android":ov.versions.trident?ev="IE":ov.versions.presto?ev="Opera":ov.versions.webKit?ev="webKit":ov.versions.gecko?ev="Firefox":ov.versions.mobile?ev="mobile":ov.versions.ios?ev="ios":ov.versions.iPhone?ev="iPhone":ov.versions.iPad?ev="ipad":ov.versions.webApp?ev="webApp":ov.versions.weixin?ev="weixin":ov.versions.qq&&(ev="qq"),Jd=Al.navigator.userAgent,tv=ov.language}var av=-1!==Jd.toLowerCase().indexOf("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",sv="Mozilla/5.0 (".concat(av,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(tv),uv={platform:ev,language:tv,appVersion:"5.0 (".concat(av,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:sv},lv=0;hp("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var cv=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";b(this,e),E(this,"href",void 0),0!=t.indexOf("http://")&&0!=t.indexOf("https://")?this.href=n+t:this.href=t}return S(e,null,[{key:"createObjectURL",value:function(e){var t=e.buffers[0],n=e.type,r=function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return El(t)}(t);return"data:".concat(n,";base64, ")+r}}]),e}();var hv=mt.f,fv=Tc.fastKey,pv=Bt.set,dv=Bt.getterFor,vv={getConstructor:function(e,t,n,r){var i=e((function(e,i){Xr(e,o),pv(e,{type:t,index:vs(null),first:void 0,last:void 0,size:0}),Ve||(e.size=0),ce(i)||jo(i,e[r],{that:e,AS_ENTRIES:n})})),o=i.prototype,a=dv(t),s=function(e,t,n){var r,i,o=a(e),s=u(e,t);return s?s.value=n:(o.last=s={index:i=fv(t,!0),key:t,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=s),r&&(r.next=s),Ve?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},u=function(e,t){var n,r=a(e),i=fv(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return yc(o,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Ve?e.size=0:this.size=0},delete:function(e){var t=a(this),n=u(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),Ve?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=a(this),r=Qt(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),yc(o,n?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Ve&&hv(o,"size",{get:function(){return a(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=dv(t),o=dv(r);uc(e,t,(function(e,t){pv(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?lc("keys"==t?n.key:"values"==t?n.value:[n.key,n.value],!1):(e.target=void 0,lc(void 0,!0))}),n?"entries":"values",!n,!0),Wr(t)}};wc("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),vv);var gv=ee((function(){us(1)}));or({target:"Object",stat:!0,forced:gv},{keys:function(e){return us(de(e))}});var mv=new Map,yv=new Map,_v=new Map,bv=function(e){A(n,e);var t=I(n);function n(){var e;return b(this,n),E(P(e=t.call(this)),"onabort",void 0),E(P(e),"onerror",void 0),E(P(e),"onload",void 0),E(P(e),"onloadstart",void 0),E(P(e),"onprogress",void 0),E(P(e),"ontimeout",void 0),E(P(e),"onloadend",void 0),E(P(e),"onreadystatechange",void 0),E(P(e),"readyState",void 0),E(P(e),"response",void 0),E(P(e),"responseText",void 0),E(P(e),"_responseType",void 0),E(P(e),"responseXML",void 0),E(P(e),"status",void 0),E(P(e),"statusText",void 0),E(P(e),"upload",void 0),E(P(e),"withCredentials",void 0),E(P(e),"timeout",void 0),E(P(e),"_url",void 0),E(P(e),"_method",void 0),e.onabort=null,e.onerror=null,e.onload=null,e.onloadstart=null,e.onprogress=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null,e.readyState=0,e.response=null,e.responseText=null,e._responseType="text",e.responseXML=null,e.status=0,e.statusText="",e.upload={},e.withCredentials=!1,mv.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),e}return S(n,[{key:"responseType",set:function(e){this._responseType=e}},{key:"abort",value:function(){var e=_v.get("requestTask");e&&e.abort()}},{key:"getAllResponseHeaders",value:function(){var e=yv.get("responseHeader");return Object.keys(e).map((function(t){return"".concat(t,": ").concat(e[t])})).join("\n")}},{key:"getResponseHeader",value:function(e){return yv.get("responseHeader")[e]}},{key:"open",value:function(e,t,n){this._method=e,this._url=t}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(e,t){var n=mv.get("requestHeader");n[e]=t,mv.set("requestHeader",n)}},{key:"addEventListener",value:function(e,t){var n=this;"function"==typeof t&&(this["on"+e]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.target=e.target||n,t.call(n,e)})}},{key:"removeEventListener",value:function(e,t){this["on"+e]===t&&(this["on"+e]=null)}}]),n}(oh);E(bv,"UNSEND",void 0),E(bv,"OPENED",void 0),E(bv,"HEADERS_RECEIVED",void 0),E(bv,"LOADING",void 0),E(bv,"DONE",void 0),bv.UNSEND=0,bv.OPENED=1,bv.HEADERS_RECEIVED=2,bv.LOADING=3,bv.DONE=4;var xv=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"touches",void 0),E(P(r),"targetTouches",void 0),E(P(r),"changedTouches",void 0),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=Th(),r.currentTarget=Th(),r}return S(n)}(Nl);function Sv(e){var t=e||{},n=t.x,r=void 0===n?0:n,i=t.y,o=void 0===i?0:i,a=t.clientX,s=void 0===a?0:a,u=t.clientY,l=void 0===u?0:u;-1!==Object.keys(e).indexOf("x")?(e.pageX=e.clientX=r,e.pageY=e.clientY=o):(e.x=s,e.y=l)}function Ev(e){return function(t){var n=new xv(e);n.changedTouches=t.changedTouches,n.touches=t.touches,n.targetTouches=Array.prototype.slice.call(t.touches),n.timeStamp=t.timeStamp,n.changedTouches.forEach((function(e){return Sv(e)})),n.touches.forEach((function(e){return Sv(e)})),n.targetTouches.forEach((function(e){return Sv(e)})),Lh.dispatchEvent(n)}}var Av,Cv=Ev("touchstart"),Tv=Ev("touchmove"),wv=Ev("touchend"),Mv=(Av="mapCameaParams",function(e){e.type=Av,Lh.dispatchEvent(e)}),kv=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"buttons",void 0),E(P(r),"which",void 0),E(P(r),"pointerId",void 0),E(P(r),"bubbles",void 0),E(P(r),"button",void 0),E(P(r),"width",void 0),E(P(r),"height",void 0),E(P(r),"pressure",void 0),E(P(r),"isPrimary",void 0),E(P(r),"pointerType",void 0),E(P(r),"altKey",void 0),E(P(r),"ctrlKey",void 0),E(P(r),"metaKey",void 0),E(P(r),"shiftKey",void 0),r.target=Th(),r.currentTarget=Th(),r}return S(n)}(Nl),Ov=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Pv=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0];function Lv(e,t,n){for(var r=new kv(e),i=0;i<Ov.length;i++){var o=Ov[i];r[o]=t[o]||Pv[i]}return r.type=e,r.target=Th(),r.currentTarget=Th(),r.buttons=function(e){var t=0;"touchstart"!==e&&"touchmove"!==e&&"pointerdown"!==e&&"pointermove"!==e||(t=1);return t}(e),r.which=r.buttons,r.pointerId=(t.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(t.radiusX||.5),r.height=2*(t.radiusY||.5),r.pressure=t.force||.5,r.isPrimary=function(e){return Iv===e.identifier}(t),r.pointerType="touch",r.altKey=n.altKey,r.ctrlKey=n.ctrlKey,r.metaKey=n.metaKey,r.shiftKey=n.shiftKey,n.preventDefault&&(r.preventDefault=function(){n.preventDefault()}),r}var Iv=null;function Rv(e){null===Iv&&(Iv=e.identifier)}function Nv(e){Iv===e.identifier&&(Iv=null)}function Dv(e){return function(t){for(var n=t.changedTouches,r=0;r<n.length;r++){var i=n[r];0===r&&"pointerdown"===e?Rv(i):"pointerup"!==e&&"pointercancel"!==e||Nv(i);var o=Lv(e,i,t);Lh.dispatchEvent(o)}}}var Fv=Dv("pointerdown"),Bv=Dv("pointermove"),zv=Dv("pointerup");function jv(e){return function(t){t.type=e,Lh.dispatchEvent(t)}}var Uv=jv("mousedown"),Vv=jv("mousemove"),Hv=jv("mouseup"),Gv="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Wv="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Yv=Gv||Wv,Xv={atob:function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Sl("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i="",o=0,a=0;r=t.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?i+=String.fromCharCode(255&n>>(-2*o&6)):0)r=xl.indexOf(r);return i},btoa:El,devicePixelRatio:Tl,Blob:Cl,document:Lh,Element:sh,Event:Nl,EventTarget:oh,HTMLCanvasElement:Dh,HTMLElement:Sh,HTMLMediaElement:Eh,HTMLVideoElement:Ah,Image:wh,ImageData:rv,navigator:uv,Node:ah,requestAnimationFrame:function(e){var t=Th();return t.requestAnimationFrame?t.requestAnimationFrame(e):function(e){var t=Date.now(),n=Math.max(lv+23,t);return setTimeout((function(){e(lv=n)}),n-t)}(e)},cancelAnimationFrame:function(e){var t=Th();return t.cancelAnimationFrame?t.cancelAnimationFrame(e):clearTimeout(e)},screen:hh,XMLHttpRequest:bv,performance:{mark:function(e){return null},clearMeasures:function(e){return null},clearMarks:function(e){return null},measure:function(e,t,n){return{duration:0}},now:function(){}},URL:cv,WebGLRenderingContext:{GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},WebGL2RenderingContext:{},addEventListener:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Lh.addEventListener(e,t,n)},removeEventListener:function(e,t,n){Lh.removeEventListener(e,t)},dispatchEvent:function(e){Lh.dispatchEvent(e)},innerWidth:hh.availWidth,innerHeight:hh.availHeight,setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval},Zv=Yv?Xv:Al,qv=Yv?bv:Al.XMLHttpRequest,Kv=Yv?Mh:Al.location;function Qv(e){var t=e;return"string"==typeof e&&(t=Zv.document.getElementById(e)),t}function $v(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Jv(e){return $v(e).split(/\s+/)}function eg(e,t,n){var r=Zv.document.createElement(e);return t&&(r.className=t||""),n&&n.appendChild(r),r}function tg(e){var t=e.parentNode;t&&t.removeChild(e)}function ng(e,t){if(void 0!==e.classList)for(var n=Jv(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!ig(e,t)){var o=ag(e);og(e,(o?o+" ":"")+t)}}function rg(e,t){void 0!==e.classList?e.classList.remove(t):og(e,$v((" "+ag(e)+" ").replace(" "+t+" "," ")))}function ig(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=ag(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function og(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function ag(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}var sg=function(e){var t,n,r=null==Zv||null===(t=Zv.document)||void 0===t||null===(n=t.documentElement)||void 0===n?void 0:n.style;if(!r)return e[0];for(var i in e)if(e[i]&&e[i]in r)return e[i];return e[0]}(["transform","WebkitTransform"]);function ug(e,t){e.style[sg]=t}function lg(){if("function"==typeof Event)Zv.dispatchEvent(new Event("resize"));else{var e=Zv.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Zv,0),Zv.dispatchEvent(e)}}function cg(){var e,t=Zv.document.querySelector('meta[name="viewport"]');if(!t)return 1;var n=(null===(e=t.content)||void 0===e?void 0:e.split(",")).find((function(e){return"initial-scale"===D(e.split("="),1)[0]}));return n?1*n.split("=")[1]:1}var hg=cg()<1?1:Zv.devicePixelRatio;function fg(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function pg(e){return e.split(";").map((function(e){return e.trim()})).filter((function(e){return e}))}function dg(e){return Object.entries(e).map((function(e){var t=D(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join(";")}function vg(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function gg(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function mg(e){e.innerHTML=""}function yg(e){e.setAttribute("draggable","false")}var _g=Object.freeze({__proto__:null,getContainer:Qv,trim:$v,splitWords:Jv,create:eg,remove:tg,addClass:ng,removeClass:rg,hasClass:ig,setClass:og,getClass:ag,empty:function(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)},setTransform:ug,triggerResize:lg,printCanvas:function(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log("%c\n",t.join(""))},getViewPortScale:cg,DPR:hg,addStyle:fg,getStyleList:pg,removeStyle:function(e,t){var n,r=pg(null!==(n=e.getAttribute("style"))&&void 0!==n?n:""),i=pg(t),o=Xa.apply(void 0,[r].concat(F(i)));e.setAttribute("style",o.join(";"))},css2Style:dg,getDiffRect:vg,setChecked:gg,clearChildren:mg,setUnDraggable:yg}),bg=[],xg=le(bg.sort),Sg=le(bg.push),Eg=ee((function(){bg.sort(void 0)})),Ag=ee((function(){bg.sort(null)})),Cg=Cn("sort"),Tg=!ee((function(){if(Le)return Le<70;if(!(Pd&&Pd>3)){if(Ld)return!0;if(Rd)return Rd<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)bg.push({k:t+r,v:n})}for(bg.sort((function(e,t){return t.v-e.v})),r=0;r<bg.length;r++)t=bg[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));function wg(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t}function Mg(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t}function kg(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}function Og(e){if(0===e.length)throw new Error("mean requires at least one data point");return kg(e)/e.length}function Pg(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>r&&(r=i,n=t),i=1,t=e[o]):i++;return 1*n}or({target:"Array",proto:!0,forced:Eg||!Ag||!Cg||!Tg},{sort:function(e){void 0!==e&&st(e);var t=de(this);if(Tg)return void 0===e?xg(t):xg(t,e);var n,r,i=[],o=un(t);for(r=0;r<o;r++)r in t&&Sg(i,t[r]);for(kd(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Cr(t)>Cr(n)?1:-1}}(e)),n=un(i),r=0;r<n;)t[r]=i[r++];for(;r<o;)Pl(t,r++);return t}});var Lg={min:Mg,max:wg,mean:Og,sum:kg,mode:Pg};function Ig(e,t){return e.map((function(e){return e[t]}))}function Rg(e,t){return Lg[e](t)}var Ng=Object.freeze({__proto__:null,sum:kg,max:wg,min:Mg,mean:Og,mode:Pg,statMap:Lg,getColumn:Ig,getSatByColumn:Rg});function Dg(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}function Fg(){return"function"==typeof importScripts}var Bg=Fg()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===window.location.protocol?window.parent:window).location.href},zg=function(e){A(n,e);var t=I(n);function n(e,r,i,o){var a;return b(this,n),E(P(a=t.call(this,"AJAXError: ".concat(r," (").concat(e,"): ").concat(i))),"status",void 0),E(P(a),"statusText",void 0),E(P(a),"url",void 0),E(P(a),"body",void 0),a.status=e,a.statusText=r,a.url=i,a.body=o,a}return S(n)}(k(Error));function jg(e,t){var n=new qv,r=Array.isArray(e.url)?e.url[0]:e.url;for(var i in n.open(e.method||"GET",r,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)e.headers.hasOwnProperty(i)&&n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});t(new zg(n.status,n.statusText,r.toString(),o))}},n.send(e.body),n}function Ug(e){return new Promise((function(t,n){jg(e,(function(e,r,i,o,a){e?n({err:e,data:null,xhr:a}):t({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function Vg(e,t){return jg(e,t)}var Hg=function(e,t){return Vg(v(v({},e),{},{type:"arrayBuffer"}),t)};var Gg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";var Wg=function(e,t){return Hg(e,(function(e,n){if(e)t(e);else if(n){"function"==typeof createImageBitmap?function(e,t){var n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}(n,t):function(e,t){var n=new Zv.Image,r=Zv.URL||Zv.webkitURL;n.crossOrigin="anonymous",n.onload=function(){t(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=Gg}))},n.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(i):Gg}(n,t)}}))},Yg=le(1..valueOf),Xg=Yn.f,Zg=Nn.f,qg=mt.f,Kg=es.trim,Qg=q.Number,$g=Qg.prototype,Jg=q.TypeError,em=le("".slice),tm=le("".charCodeAt),nm=function(e){var t=ft(e,"number");return"bigint"==typeof t?t:rm(t)},rm=function(e){var t,n,r,i,o,a,s,u,l=ft(e,"number");if(rt(l))throw Jg("Cannot convert a Symbol value to a number");if("string"==typeof l&&l.length>2)if(l=Kg(l),43===(t=tm(l,0))||45===t){if(88===(n=tm(l,2))||120===n)return NaN}else if(48===t){switch(tm(l,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+l}for(a=(o=em(l,2)).length,s=0;s<a;s++)if((u=tm(o,s))<48||u>i)return NaN;return parseInt(o,r)}return+l};if(rr("Number",!Qg(" 0o1")||!Qg("0b1")||Qg("+0x1"))){for(var im,om=function(e){var t=arguments.length<1?0:Qg(nm(e)),n=this;return tt($g,n)&&ee((function(){Yg(n)}))?yu(Object(t),n,om):t},am=Ve?Xg(Qg):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),sm=0;am.length>sm;sm++)ge(Qg,im=am[sm])&&!ge(om,im)&&qg(om,im,Zg(Qg,im));om.prototype=$g,$g.constructor=om,jt(q,"Number",om,{constructor:!0})}var um=RangeError,lm=function(e){var t=Cr(fe(this)),n="",r=on(e);if(r<0||r==1/0)throw um("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},cm=RangeError,hm=String,fm=Math.floor,pm=le(lm),dm=le("".slice),vm=le(1..toFixed),gm=function(e,t,n){return 0===t?n:t%2==1?gm(e,t-1,n*e):gm(e*e,t/2,n)},mm=function(e,t,n){for(var r=-1,i=n;++r<6;)i+=t*e[r],e[r]=i%1e7,i=fm(i/1e7)},ym=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=fm(r/t),r=r%t*1e7},_m=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=hm(e[t]);n=""===n?r:n+pm("0",7-r.length)+r}return n},bm=ee((function(){return"0.000"!==vm(8e-5,3)||"1"!==vm(.9,0)||"1.25"!==vm(1.255,2)||"1000000000000000128"!==vm(0xde0b6b3a7640080,0)}))||!ee((function(){vm({})}));function xm(e){return"number"==typeof e}function Sm(e){var t=[1/0,1/0,-1/0,-1/0];return function e(t,n,r){if(null!==t)for(var i,o,a,s,u,l,c,h,f=0,p=0,d=t.type,v="FeatureCollection"===d,g="Feature"===d,m=v?t.features.length:1,y=0;y<m;y++){u=(h=!!(c=v?t.features[y].geometry:g?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<u;_++){var b=0,x=0;if(null!==(s=h?c.geometries[_]:c)){l=s.coordinates;var S=s.type;switch(f=!r||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===n(l,p,y,b,x))return!1;p++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(!1===n(l[i],p,y,b,x))return!1;p++,"MultiPoint"===S&&b++}"LineString"===S&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(o=0;o<l[i].length-f;o++){if(!1===n(l[i][o],p,y,b,x))return!1;p++}"MultiLineString"===S&&b++,"Polygon"===S&&x++}"Polygon"===S&&b++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for(x=0,o=0;o<l[i].length;o++){for(a=0;a<l[i][o].length-f;a++){if(!1===n(l[i][o][a],p,y,b,x))return!1;p++}x++}b++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===e(s.geometries[i],n,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}or({target:"Number",proto:!0,forced:bm},{toFixed:function(e){var t,n,r,i,o=Yg(this),a=on(e),s=[0,0,0,0,0,0],u="",l="0";if(a<0||a>20)throw cm("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return hm(o);if(o<0&&(u="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*gm(2,69,1))-69)<0?o*gm(2,-t,1):o/gm(2,t,1),n*=4503599627370496,(t=52-t)>0){for(mm(s,0,n),r=a;r>=7;)mm(s,1e7,0),r-=7;for(mm(s,gm(10,r,1),0),r=t-1;r>=23;)ym(s,1<<23),r-=23;ym(s,1<<r),mm(s,1,1),ym(s,2),l=_m(s)}else mm(s,0,n),mm(s,1<<-t,0),l=_m(s)+pm("0",a);return l=a>0?u+((i=l.length)<=a?"0."+pm("0",a-i)+l:dm(l,0,i-a)+"."+dm(l,i-a)):u+l}}),Sm.default=Sm;var Em=2*Math.PI*6378137/2;function Am(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;!function e(t,n){Array.isArray(n[0])?n.forEach((function(n){e(t,n)})):(t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1]));return t}(t,n)})),t}function Cm(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(e=Mm(e,t))[0],i=e[1],o=r*Em/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*Em/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===e.length?[o,a,e[2]]:[o,a]}function Tm(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}function wm(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}function Mm(e,t){if(!1===t)return e;var n=Tm(e[0]),r=wm(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}function km(e){var t=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),n=Math.PI/180,r=e[0]*n,i=t*n;i=Math.log(Math.tan(Math.PI/4+i/2));return r=(256<<20)*(.5/Math.PI*r+.5),i=(256<<20)*(-.5/Math.PI*i+(n=.5)),[Math.floor(r),Math.floor(i)]}function Om(e,t){var n=85.0511287798,r=Math.PI/180;return t=Math.max(Math.min(n,t),-n),t*=r,[6378137*(e*=r),6378137*(t=Math.log(Math.tan(Math.PI/4+t/2)))]}function Pm(e,t){var n=Math.PI/180;return[e/6378137/n,2*(Math.atan(Math.exp(t/6378137))-Math.PI/4)/n]}function Lm(e,t,n){var r=_r(t[1]-e[1]),i=_r(t[0]-e[0]),o=_r(e[1]),a=_r(t[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return function(e,t){void 0===t&&(t="kilometers");var n=pr[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function Im(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function Rm(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Nm(e){return[[e[0],e[1]],[e[2],e[3]]]}function Dm(e){var t=Fm(e,[0,0]);return[e[0]/t,e[1]/t]}function Fm(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Bm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function zm(e,t){return t[0]>0?t[1]>0?90-180*Math.atan(t[1]/t[0])/Math.PI:90+180*Math.atan(-t[1]/t[0])/Math.PI:t[1]<0?90-180*Math.atan(t[1]/t[0])/Math.PI+180:270+180*Math.atan(t[1]/-t[0])/Math.PI}function jm(e){if(xm(e[0]))return e;if(xm(e[0][0]))throw new Error("当前数据不支持标注");if(xm(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("当前数据不支持标注")}function Um(e){for(var t=e[0],n=e[1],r=e[0],i=e[1],o=0,a=0,s=0,u=0;u<e.length;u+=2){var l=e[u],c=e[u+1];l&&c&&(t=Math.max(l,t),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),o+=l,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(t-r,2)+Math.pow(n-i,2))/2}}function Vm(e){return Sm(mr([gr(e)]))}var Hm=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;b(this,e),E(this,"limit",void 0),E(this,"cache",void 0),E(this,"destroy",void 0),E(this,"order",void 0),this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return S(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}]),e}();function Gm(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}var Wm=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;b(this,e),E(this,"duration",16),E(this,"timestamp",(new Date).getTime()),this.duration=t}return S(e,[{key:"run",value:function(e){var t=(new Date).getTime(),n=t-this.timestamp;this.timestamp=t,n>=this.duration&&e()}}]),e}();function Ym(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Xm(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Zm(){}var qm,Km="\\s*([+-]?\\d+)\\s*",Qm="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",$m="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Jm=/^#([0-9a-f]{3,8})$/,ey=new RegExp("^rgb\\("+[Km,Km,Km]+"\\)$"),ty=new RegExp("^rgb\\("+[$m,$m,$m]+"\\)$"),ny=new RegExp("^rgba\\("+[Km,Km,Km,Qm]+"\\)$"),ry=new RegExp("^rgba\\("+[$m,$m,$m,Qm]+"\\)$"),iy=new RegExp("^hsl\\("+[Qm,$m,$m]+"\\)$"),oy=new RegExp("^hsla\\("+[Qm,$m,$m,Qm]+"\\)$"),ay={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function sy(){return this.rgb().formatHex()}function uy(){return this.rgb().formatRgb()}function ly(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Jm.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?cy(t):3===n?new dy(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?hy(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?hy(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ey.exec(e))?new dy(t[1],t[2],t[3],1):(t=ty.exec(e))?new dy(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=ny.exec(e))?hy(t[1],t[2],t[3],t[4]):(t=ry.exec(e))?hy(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=iy.exec(e))?_y(t[1],t[2]/100,t[3]/100,1):(t=oy.exec(e))?_y(t[1],t[2]/100,t[3]/100,t[4]):ay.hasOwnProperty(e)?cy(ay[e]):"transparent"===e?new dy(NaN,NaN,NaN,0):null}function cy(e){return new dy(e>>16&255,e>>8&255,255&e,1)}function hy(e,t,n,r){return r<=0&&(e=t=n=NaN),new dy(e,t,n,r)}function fy(e){return e instanceof Zm||(e=ly(e)),e?new dy((e=e.rgb()).r,e.g,e.b,e.opacity):new dy}function py(e,t,n,r){return 1===arguments.length?fy(e):new dy(e,t,n,null==r?1:r)}function dy(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function vy(){return"#"+yy(this.r)+yy(this.g)+yy(this.b)}function gy(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function yy(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function _y(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new xy(e,t,n,r)}function by(e){if(e instanceof xy)return new xy(e.h,e.s,e.l,e.opacity);if(e instanceof Zm||(e=ly(e)),!e)return new xy;if(e instanceof xy)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new xy(a,s,u,e.opacity)}function xy(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Sy(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Ey(e){return"string"==typeof e&&!!ly(e)}function Ay(e){var t=ly(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function Cy(e){return(e&&e[0])+256*(e&&e[1])+65536*(e&&e[2])-1}function Ty(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function wy(e){var t=Zv.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;var r=null;if(e.weights){var i=0;e.weights.map((function(t,r){var o=e.colors[r]||"rgba(0, 0, 0, 0)",a=i+t;n.fillStyle=o,n.fillRect(256*i,0,256*a,1),i=a}))}else{for(var o=n.createLinearGradient(0,0,256,1),a=e.positions[0],s=e.positions[e.positions.length-1],u=0;u<e.colors.length;++u){var l=(e.positions[u]-a)/(s-a);o.addColorStop(l,e.colors[u])}n.fillStyle=o,n.fillRect(0,0,256,1)}if(Yv)return r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),t=null,n=null,{data:r,width:256,height:1};r=n.getImageData(0,0,256,1).data;for(var c=n.createImageData(256,1),h=0;h<c.data.length;h+=4)c.data[h+0]=r[h+0],c.data[h+1]=r[h+1],c.data[h+2]=r[h+2],c.data[h+3]=r[h+3];return t=null,n=null,c}Ym(Zm,ly,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:sy,formatHex:sy,formatHsl:function(){return by(this).formatHsl()},formatRgb:uy,toString:uy}),Ym(dy,py,Xm(Zm,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new dy(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new dy(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:vy,formatHex:vy,formatRgb:gy,toString:gy})),Ym(xy,(function(e,t,n,r){return 1===arguments.length?by(e):new xy(e,t,n,null==r?1:r)}),Xm(Zm,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new xy(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new xy(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new dy(Sy(e>=240?e-240:e+120,i,r),Sy(e,i,r),Sy(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}})),(qm=e.anchorType||(e.anchorType={})).CENTER="center",qm.TOP="top",qm["TOP-LEFT"]="top-left",qm["TOP-RIGHT"]="top-right",qm.BOTTOM="bottom",qm["BOTTOM-LEFT"]="bottom-left",qm["BOTTOM-RIGHT"]="bottom-right",qm.LEFT="left",qm.RIGHT="right";var My={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ky(e,t,n){var r=e.classList;for(var i in My)My.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}function Oy(e,t){return{enable:e,mask:255,func:{cmp:514,ref:t?1:0,mask:255}}}function Py(e,t){if(!e)throw new Error(t||"web worker helper assertion failed.")}var Ly="undefined"!=typeof window&&void 0!==window.orientation,Iy=function(){function e(e,t){var n=this;this.name=e,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return e.prototype.postMessage=function(e,t){this.workerThread.postMessage({source:"Main thread",type:e,payload:t})},e.prototype.done=function(e){Py(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(e)},e.prototype.error=function(e){Py(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(e)},e}(),Ry=new Map;function Ny(e){Py(e.source&&!e.url||!e.source&&e.url);var t=Ry.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return Dy((t=e,"try {\n  importScripts('"+t+"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}"));var t}(e.url),Ry.set(e.url,t)),e.source&&(t=Dy(e.source),Ry.set(e.source,t))),Py(t),t}function Dy(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Fy(e,t,n){void 0===t&&(t=!0);var r=n||new Set;if(e){if(By(e))r.add(e);else if(By(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(var i in e)Fy(e[i],t,r)}else;return void 0===n?Array.from(r):[]}function By(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}var zy=function(){},jy=function(){function e(e){this.terminated=!1,this.loadableURL="";var t=e.name,n=e.source,r=e.url;Py(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=zy,this.onError=function(e){return console.log(e)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return"undefined"!=typeof Worker},e.prototype.destroy=function(){this.onMessage=zy,this.onError=zy,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(e,t){t=t||Fy(e),this.worker.postMessage(e,t)},e.prototype.getErrorFromErrorEvent=function(e){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",e.message&&(t+=e.message+" in "),e.lineno&&(t+=":"+e.lineno+":"+e.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var e=this;this.loadableURL=Ny({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(t){t.data?e.onMessage(t.data):e.onError(new Error("No data received"))},t.onerror=function(t){e.onError(e.getErrorFromErrorEvent(t)),e.terminated=!0},t.onmessageerror=function(t){return console.error("worker "+e.name+", message error: "+t)},t},e}(),Uy=function(){return(Uy=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Vy=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},Hy=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Gy=function(){function e(e){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=e.source,this.url=e.url,this.setProps(e)}return e.prototype.destroy=function(){this.idleQueue.forEach((function(e){return e.destroy()})),this.isDestroyed=!0},e.prototype.setProps=function(e){this.props=Uy(Uy({},this.props),e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)},e.prototype.startJob=function(e,t,n){return void 0===t&&(t=function(e,t,n){return e.done(n)}),void 0===n&&(n=function(e,t){return e.error(t)}),Vy(this,void 0,void 0,(function(){var r,i=this;return Hy(this,(function(o){switch(o.label){case 0:return r=new Promise((function(r){return i.jobQueue.push({name:e,onMessage:t,onError:n,onStart:r}),i})),this.startQueuedJob(),[4,r];case 1:return[2,o.sent()]}}))}))},e.prototype.startQueuedJob=function(){return Vy(this,void 0,void 0,(function(){var e,t,n;return Hy(this,(function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(!(e=this.getAvailableWorker()))return[2];if(!(t=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:e}),n=new Iy(t.name,e),e.onMessage=function(e){return t.onMessage(n,e.type,e.payload)},e.onError=function(e){return t.onError(n,e)},t.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(e),[7];case 4:return[2]}}))}))},e.prototype.returnWorkerToQueue=function(e){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var e=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new jy({name:e,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Ly?this.maxMobileConcurrency:this.maxConcurrency},e}(),Wy=function(){return(Wy=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Yy=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Xy={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Zy=function(){function e(e){this.workerPools=new Map,this.props=Wy({},Xy),this.setProps(e),this.workerPools=new Map}return e.isSupported=function(){return jy.isSupported()},e.getWorkerFarm=function(t){return void 0===t&&(t={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(t),e.workerFarm},e.prototype.destroy=function(){var e,t;try{for(var n=Yy(this.workerPools.values()),r=n.next();!r.done;r=n.next()){r.value.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setProps=function(e){var t,n;this.props=Wy(Wy({},this.props),e);try{for(var r=Yy(this.workerPools.values()),i=r.next();!i.done;i=r.next()){i.value.setProps(this.getWorkerPoolProps())}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(e){var t=e.name,n=e.source,r=e.url,i=this.workerPools.get(t);return i||((i=new Gy({name:t,source:n,url:r})).setProps(this.getWorkerPoolProps()),this.workerPools.set(t,i)),i},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),qy=new Map,Ky=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(e){self.onmessage=function(t){if(Qy(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(e){var t=qy.get(e);t||(t=function(t){if(Qy(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}),self.addEventListener("message",t)},e.removeEventListener=function(e){var t=qy.get(e);qy.delete(e),self.removeEventListener("message",t)},e.postMessage=function(e,t){if(self){var n={source:"Worker thread",type:e,payload:t},r=Fy(t);self.postMessage(n,r)}},e}();function Qy(e){var t=e.type,n=e.data;return"message"===t&&n&&"string"==typeof n.source&&"Main thread"===n.source}var $y,Jy,e_=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(e){return this.enqueue(e)},e.prototype.enqueue=function(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.push(e)},e.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var e=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(t,n){e._settlers.push({resolve:t,reject:n})}))},e}(),t_=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},n_=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},r_=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}},i_=0;function o_(e,t){return void 0===t&&(t={}),new Promise((function(n,r){var i=i_++,o=function(e,t){if(t.id===i)switch(e){case"done":Ky.removeEventListener(o),n(t.result);break;case"error":Ky.removeEventListener(o),r(t.error)}};Ky.addEventListener(o);var a={id:i,input:e,options:t};Ky.postMessage("process",a)}))}function a_(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}function s_(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}function u_(e){return e.filter?[1]:[0]}function l_(e,t){return[t]}var c_=f_,h_=f_;function f_(e,t,n){n=n||2;var r,i,o,a,s,u,l,c=t&&t.length,h=c?t[0]*n:e.length,f=p_(e,0,h,n,!0),p=[];if(!f||f.next===f.prev)return p;if(c&&(f=function(e,t,n,r){var i,o,a,s,u,l=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(u=p_(e,a,s,r,!1))===u.next&&(u.steiner=!0),l.push(A_(u));for(l.sort(b_),i=0;i<l.length;i++)n=x_(l[i],n);return n}(e,t,f,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var d=n;d<h;d+=n)(s=e[d])<r&&(r=s),(u=e[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-r,a-i))?32767/l:0}return v_(f,p,n,r,i,l,0),p}function p_(e,t,n,r,i){var o,a;if(i===F_(e,t,n,r)>0)for(o=t;o<n;o+=r)a=R_(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=R_(o,e[o],e[o+1],a);return a&&M_(a,a.next)&&(N_(a),a=a.next),a}function d_(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!M_(r,r.next)&&0!==w_(r.prev,r,r.next))r=r.next;else{if(N_(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function v_(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=E_(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(e,r,i,o);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?m_(e,r,i,o):g_(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(u.i/n|0),N_(e),e=u.next,l=u.next;else if((e=u)===l){a?1===a?v_(e=y_(d_(e),t,n),t,n,r,i,o,2):2===a&&__(e,t,n,r,i,o):v_(d_(e),t,n,r,i,o,1);break}}}function g_(e){var t=e.prev,n=e,r=e.next;if(w_(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,a=r.x,s=t.y,u=n.y,l=r.y,c=i<o?i<a?i:a:o<a?o:a,h=s<u?s<l?s:l:u<l?u:l,f=i>o?i>a?i:a:o>a?o:a,p=s>u?s>l?s:l:u>l?u:l,d=r.next;d!==t;){if(d.x>=c&&d.x<=f&&d.y>=h&&d.y<=p&&C_(i,s,o,u,a,l,d.x,d.y)&&w_(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function m_(e,t,n,r){var i=e.prev,o=e,a=e.next;if(w_(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,l=a.x,c=i.y,h=o.y,f=a.y,p=s<u?s<l?s:l:u<l?u:l,d=c<h?c<f?c:f:h<f?h:f,v=s>u?s>l?s:l:u>l?u:l,g=c>h?c>f?c:f:h>f?h:f,m=E_(p,d,t,n,r),y=E_(v,g,t,n,r),_=e.prevZ,b=e.nextZ;_&&_.z>=m&&b&&b.z<=y;){if(_.x>=p&&_.x<=v&&_.y>=d&&_.y<=g&&_!==i&&_!==a&&C_(s,c,u,h,l,f,_.x,_.y)&&w_(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,b.x>=p&&b.x<=v&&b.y>=d&&b.y<=g&&b!==i&&b!==a&&C_(s,c,u,h,l,f,b.x,b.y)&&w_(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;_&&_.z>=m;){if(_.x>=p&&_.x<=v&&_.y>=d&&_.y<=g&&_!==i&&_!==a&&C_(s,c,u,h,l,f,_.x,_.y)&&w_(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=v&&b.y>=d&&b.y<=g&&b!==i&&b!==a&&C_(s,c,u,h,l,f,b.x,b.y)&&w_(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function y_(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!M_(i,o)&&k_(i,r,r.next,o)&&L_(i,o)&&L_(o,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(o.i/n|0),N_(r),N_(r.next),r=e=o),r=r.next}while(r!==e);return d_(r)}function __(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&T_(a,s)){var u=I_(a,s);return a=d_(a,a.next),u=d_(u,u.next),v_(a,t,n,r,i,o,0),void v_(u,t,n,r,i,o,0)}s=s.next}a=a.next}while(a!==e)}function b_(e,t){return e.x-t.x}function x_(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var u,l=n,c=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&C_(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),L_(r,e)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&S_(n,r)))&&(n=r,f=u)),r=r.next}while(r!==l);return n}(e,t);if(!n)return t;var r=I_(n,e);return d_(r,r.next),d_(n,n.next)}function S_(e,t){return w_(e.prev,e,t.prev)<0&&w_(t.next,e,e.next)<0}function E_(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function A_(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function C_(e,t,n,r,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function T_(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&k_(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(L_(e,t)&&L_(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w_(e.prev,e,t.prev)||w_(e,t.prev,t))||M_(e,t)&&w_(e.prev,e,e.next)>0&&w_(t.prev,t,t.next)>0)}function w_(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function M_(e,t){return e.x===t.x&&e.y===t.y}function k_(e,t,n,r){var i=P_(w_(e,t,n)),o=P_(w_(e,t,r)),a=P_(w_(n,r,e)),s=P_(w_(n,r,t));return i!==o&&a!==s||(!(0!==i||!O_(e,n,t))||(!(0!==o||!O_(e,r,t))||(!(0!==a||!O_(n,e,r))||!(0!==s||!O_(n,t,r)))))}function O_(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function P_(e){return e>0?1:e<0?-1:0}function L_(e,t){return w_(e.prev,e,e.next)<0?w_(e,t,e.next)>=0&&w_(e,e.prev,t)>=0:w_(e,t,e.prev)<0||w_(e,e.next,t)<0}function I_(e,t){var n=new D_(e.i,e.x,e.y),r=new D_(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function R_(e,t,n,r){var i=new D_(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function N_(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function D_(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function F_(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}f_.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(F_(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;a-=Math.abs(F_(e,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((e[f]-e[d])*(e[p+1]-e[f+1])-(e[f]-e[p])*(e[d+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},f_.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},c_.default=h_;var B_=/"/g,z_=le("".replace),j_=function(e,t,n,r){var i=Cr(fe(e)),o="<"+t;return""!==n&&(o+=" "+n+'="'+z_(Cr(r),B_,"&quot;")+'"'),o+">"+i+"</"+t+">"},U_=function(e){return ee((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))};or({target:"String",proto:!0,forced:U_("sub")},{sub:function(){return j_(this,"sub","","")}});var V_=1e-6,H_="undefined"!=typeof Float32Array?Float32Array:Array,G_=Math.random;function W_(){var e=new H_(16);return H_!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Y_(e){var t=new H_(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function X_(e,t,n,r,i,o,a,s,u,l,c,h,f,p,d,v){var g=new H_(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=o,g[6]=a,g[7]=s,g[8]=u,g[9]=l,g[10]=c,g[11]=h,g[12]=f,g[13]=p,g[14]=d,g[15]=v,g}function Z_(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function q_(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15],y=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,S=r*l-o*s,E=i*l-o*u,A=c*v-h*d,C=c*g-f*d,T=c*m-p*d,w=h*g-f*v,M=h*m-p*v,k=f*m-p*g,O=y*k-_*M+b*w+x*T-S*C+E*A;return O?(O=1/O,e[0]=(s*k-u*M+l*w)*O,e[1]=(i*M-r*k-o*w)*O,e[2]=(v*E-g*S+m*x)*O,e[3]=(f*S-h*E-p*x)*O,e[4]=(u*T-a*k-l*C)*O,e[5]=(n*k-i*T+o*C)*O,e[6]=(g*b-d*E-m*_)*O,e[7]=(c*E-f*b+p*_)*O,e[8]=(a*M-s*T+l*A)*O,e[9]=(r*T-n*M-o*A)*O,e[10]=(d*S-v*b+m*y)*O,e[11]=(h*b-c*S-p*y)*O,e[12]=(s*C-a*w-u*A)*O,e[13]=(n*w-r*C+i*A)*O,e[14]=(v*_-d*x-g*y)*O,e[15]=(c*x-h*_+f*y)*O,e):null}function K_(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],d=t[11],v=t[12],g=t[13],m=t[14],y=t[15],_=n[0],b=n[1],x=n[2],S=n[3];return e[0]=_*r+b*s+x*h+S*v,e[1]=_*i+b*u+x*f+S*g,e[2]=_*o+b*l+x*p+S*m,e[3]=_*a+b*c+x*d+S*y,_=n[4],b=n[5],x=n[6],S=n[7],e[4]=_*r+b*s+x*h+S*v,e[5]=_*i+b*u+x*f+S*g,e[6]=_*o+b*l+x*p+S*m,e[7]=_*a+b*c+x*d+S*y,_=n[8],b=n[9],x=n[10],S=n[11],e[8]=_*r+b*s+x*h+S*v,e[9]=_*i+b*u+x*f+S*g,e[10]=_*o+b*l+x*p+S*m,e[11]=_*a+b*c+x*d+S*y,_=n[12],b=n[13],x=n[14],S=n[15],e[12]=_*r+b*s+x*h+S*v,e[13]=_*i+b*u+x*f+S*g,e[14]=_*o+b*l+x*p+S*m,e[15]=_*a+b*c+x*d+S*y,e}function Q_(e,t,n){var r,i,o,a,s,u,l,c,h,f,p,d,v=n[0],g=n[1],m=n[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*m+t[12],e[13]=t[1]*v+t[5]*g+t[9]*m+t[13],e[14]=t[2]*v+t[6]*g+t[10]*m+t[14],e[15]=t[3]*v+t[7]*g+t[11]*m+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],d=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=h,e[9]=f,e[10]=p,e[11]=d,e[12]=r*v+s*g+h*m+t[12],e[13]=i*v+u*g+f*m+t[13],e[14]=o*v+l*g+p*m+t[14],e[15]=a*v+c*g+d*m+t[15]),e}function $_(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function J_(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+l*r,e[5]=a*i+c*r,e[6]=s*i+h*r,e[7]=u*i+f*r,e[8]=l*i-o*r,e[9]=c*i-a*r,e[10]=h*i-s*r,e[11]=f*i-u*r,e}function eb(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-l*r,e[1]=a*i-c*r,e[2]=s*i-h*r,e[3]=u*i-f*r,e[8]=o*r+l*i,e[9]=a*r+c*i,e[10]=s*r+h*i,e[11]=u*r+f*i,e}function tb(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+l*r,e[1]=a*i+c*r,e[2]=s*i+h*r,e[3]=u*i+f*r,e[4]=l*i-o*r,e[5]=c*i-a*r,e[6]=h*i-s*r,e[7]=f*i-u*r,e}function nb(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function rb(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,l=o+o,c=r*s,h=r*u,f=r*l,p=i*u,d=i*l,v=o*l,g=a*s,m=a*u,y=a*l;return e[0]=1-(p+v),e[1]=h+y,e[2]=f-m,e[3]=0,e[4]=h-y,e[5]=1-(c+v),e[6]=d+g,e[7]=0,e[8]=f+m,e[9]=d-g,e[10]=1-(c+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function ib(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,l,c),e}function ob(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ab=ob;function sb(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*l,e[15]=1,e}var ub=sb;function lb(e,t,n,r){var i,o,a,s,u,l,c,h,f,p,d=t[0],v=t[1],g=t[2],m=r[0],y=r[1],_=r[2],b=n[0],x=n[1],S=n[2];return Math.abs(d-b)<V_&&Math.abs(v-x)<V_&&Math.abs(g-S)<V_?Z_(e):(c=d-b,h=v-x,f=g-S,i=y*(f*=p=1/Math.hypot(c,h,f))-_*(h*=p),o=_*(c*=p)-m*f,a=m*h-y*c,(p=Math.hypot(i,o,a))?(i*=p=1/p,o*=p,a*=p):(i=0,o=0,a=0),s=h*a-f*o,u=f*i-c*a,l=c*o-h*i,(p=Math.hypot(s,u,l))?(s*=p=1/p,u*=p,l*=p):(s=0,u=0,l=0),e[0]=i,e[1]=s,e[2]=c,e[3]=0,e[4]=o,e[5]=u,e[6]=h,e[7]=0,e[8]=a,e[9]=l,e[10]=f,e[11]=0,e[12]=-(i*d+o*v+a*g),e[13]=-(s*d+u*v+l*g),e[14]=-(c*d+h*v+f*g),e[15]=1,e)}function cb(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function hb(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14],m=e[15],y=t[0],_=t[1],b=t[2],x=t[3],S=t[4],E=t[5],A=t[6],C=t[7],T=t[8],w=t[9],M=t[10],k=t[11],O=t[12],P=t[13],L=t[14],I=t[15];return Math.abs(n-y)<=V_*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=V_*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-b)<=V_*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-x)<=V_*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-S)<=V_*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-E)<=V_*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-A)<=V_*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-C)<=V_*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-T)<=V_*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-w)<=V_*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(f-M)<=V_*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(p-k)<=V_*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(d-O)<=V_*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(v-P)<=V_*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(g-L)<=V_*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(m-I)<=V_*Math.max(1,Math.abs(m),Math.abs(I))}var fb=K_,pb=cb,db=Object.freeze({__proto__:null,create:W_,clone:Y_,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:X_,set:function(e,t,n,r,i,o,a,s,u,l,c,h,f,p,d,v,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=f,e[12]=p,e[13]=d,e[14]=v,e[15]=g,e},identity:Z_,transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:q_,adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15];return e[0]=s*(f*m-p*g)-h*(u*m-l*g)+v*(u*p-l*f),e[1]=-(r*(f*m-p*g)-h*(i*m-o*g)+v*(i*p-o*f)),e[2]=r*(u*m-l*g)-s*(i*m-o*g)+v*(i*l-o*u),e[3]=-(r*(u*p-l*f)-s*(i*p-o*f)+h*(i*l-o*u)),e[4]=-(a*(f*m-p*g)-c*(u*m-l*g)+d*(u*p-l*f)),e[5]=n*(f*m-p*g)-c*(i*m-o*g)+d*(i*p-o*f),e[6]=-(n*(u*m-l*g)-a*(i*m-o*g)+d*(i*l-o*u)),e[7]=n*(u*p-l*f)-a*(i*p-o*f)+c*(i*l-o*u),e[8]=a*(h*m-p*v)-c*(s*m-l*v)+d*(s*p-l*h),e[9]=-(n*(h*m-p*v)-c*(r*m-o*v)+d*(r*p-o*h)),e[10]=n*(s*m-l*v)-a*(r*m-o*v)+d*(r*l-o*s),e[11]=-(n*(s*p-l*h)-a*(r*p-o*h)+c*(r*l-o*s)),e[12]=-(a*(h*g-f*v)-c*(s*g-u*v)+d*(s*f-u*h)),e[13]=n*(h*g-f*v)-c*(r*g-i*v)+d*(r*f-i*h),e[14]=-(n*(s*g-u*v)-a*(r*g-i*v)+d*(r*u-i*s)),e[15]=n*(s*f-u*h)-a*(r*f-i*h)+c*(r*u-i*s),e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11],p=e[12],d=e[13],v=e[14],g=e[15];return(t*a-n*o)*(h*g-f*v)-(t*s-r*o)*(c*g-f*d)+(t*u-i*o)*(c*v-h*d)+(n*s-r*a)*(l*g-f*p)-(n*u-i*a)*(l*v-h*p)+(r*u-i*s)*(l*d-c*p)},multiply:K_,translate:Q_,scale:$_,rotate:function(e,t,n,r){var i,o,a,s,u,l,c,h,f,p,d,v,g,m,y,_,b,x,S,E,A,C,T,w,M=r[0],k=r[1],O=r[2],P=Math.hypot(M,k,O);return P<V_?null:(M*=P=1/P,k*=P,O*=P,i=Math.sin(n),a=1-(o=Math.cos(n)),s=t[0],u=t[1],l=t[2],c=t[3],h=t[4],f=t[5],p=t[6],d=t[7],v=t[8],g=t[9],m=t[10],y=t[11],_=M*M*a+o,b=k*M*a+O*i,x=O*M*a-k*i,S=M*k*a-O*i,E=k*k*a+o,A=O*k*a+M*i,C=M*O*a+k*i,T=k*O*a-M*i,w=O*O*a+o,e[0]=s*_+h*b+v*x,e[1]=u*_+f*b+g*x,e[2]=l*_+p*b+m*x,e[3]=c*_+d*b+y*x,e[4]=s*S+h*E+v*A,e[5]=u*S+f*E+g*A,e[6]=l*S+p*E+m*A,e[7]=c*S+d*E+y*A,e[8]=s*C+h*T+v*w,e[9]=u*C+f*T+g*w,e[10]=l*C+p*T+m*w,e[11]=c*C+d*T+y*w,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:J_,rotateY:eb,rotateZ:tb,fromTranslation:nb,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],l=Math.hypot(a,s,u);return l<V_?null:(a*=l=1/l,s*=l,u*=l,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:rb,fromQuat2:function(e,t){var n=new H_(3),r=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=r*r+i*i+o*o+a*a;return h>0?(n[0]=2*(s*a+c*r+u*o-l*i)/h,n[1]=2*(u*a+c*i+l*r-s*o)/h,n[2]=2*(l*a+c*o+s*i-u*r)/h):(n[0]=2*(s*a+c*r+u*o-l*i),n[1]=2*(u*a+c*i+l*r-s*o),n[2]=2*(l*a+c*o+s*i-u*r)),rb(e,t,n),e},getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling:ib,getRotation:function(e,t){var n=new H_(3);ib(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],a=t[0]*r,s=t[1]*i,u=t[2]*o,l=t[4]*r,c=t[5]*i,h=t[6]*o,f=t[8]*r,p=t[9]*i,d=t[10]*o,v=a+c+d,g=0;return v>0?(g=2*Math.sqrt(v+1),e[3]=.25*g,e[0]=(h-p)/g,e[1]=(f-u)/g,e[2]=(s-l)/g):a>c&&a>d?(g=2*Math.sqrt(1+a-c-d),e[3]=(h-p)/g,e[0]=.25*g,e[1]=(s+l)/g,e[2]=(f+u)/g):c>d?(g=2*Math.sqrt(1+c-a-d),e[3]=(f-u)/g,e[0]=(s+l)/g,e[1]=.25*g,e[2]=(h+p)/g):(g=2*Math.sqrt(1+d-a-c),e[3]=(s-l)/g,e[0]=(f+u)/g,e[1]=(h+p)/g,e[2]=.25*g),e},fromRotationTranslationScale:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,l=o+o,c=a+a,h=i*u,f=i*l,p=i*c,d=o*l,v=o*c,g=a*c,m=s*u,y=s*l,_=s*c,b=r[0],x=r[1],S=r[2];return e[0]=(1-(d+g))*b,e[1]=(f+_)*b,e[2]=(p-y)*b,e[3]=0,e[4]=(f-_)*x,e[5]=(1-(h+g))*x,e[6]=(v+m)*x,e[7]=0,e[8]=(p+y)*S,e[9]=(v-m)*S,e[10]=(1-(h+d))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],l=o+o,c=a+a,h=s+s,f=o*l,p=o*c,d=o*h,v=a*c,g=a*h,m=s*h,y=u*l,_=u*c,b=u*h,x=r[0],S=r[1],E=r[2],A=i[0],C=i[1],T=i[2],w=(1-(v+m))*x,M=(p+b)*x,k=(d-_)*x,O=(p-b)*S,P=(1-(f+m))*S,L=(g+y)*S,I=(d+_)*E,R=(g-y)*E,N=(1-(f+v))*E;return e[0]=w,e[1]=M,e[2]=k,e[3]=0,e[4]=O,e[5]=P,e[6]=L,e[7]=0,e[8]=I,e[9]=R,e[10]=N,e[11]=0,e[12]=n[0]+A-(w*A+O*C+I*T),e[13]=n[1]+C-(M*A+P*C+R*T),e[14]=n[2]+T-(k*A+L*C+N*T),e[15]=1,e},fromQuat:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,f=i*a,p=i*s,d=i*u,v=o*a,g=o*s,m=o*u;return e[0]=1-h-d,e[1]=c+m,e[2]=f-g,e[3]=0,e[4]=c-m,e[5]=1-l-d,e[6]=p+v,e[7]=0,e[8]=f+g,e[9]=p-v,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),l=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*l,e[15]=0,e},perspectiveNO:ob,perspective:ab,perspectiveZO:function(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=i*o,e[14]=i*r*o):(e[10]=-1,e[14]=-r),e},perspectiveFromFieldOfView:function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},orthoNO:sb,ortho:ub,orthoZO:function(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=o*l,e[15]=1,e},lookAt:lb,targetTo:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=o-n[1],f=a-n[2],p=c*c+h*h+f*f;p>0&&(c*=p=1/Math.sqrt(p),h*=p,f*=p);var d=u*f-l*h,v=l*c-s*f,g=s*h-u*c;return(p=d*d+v*v+g*g)>0&&(d*=p=1/Math.sqrt(p),v*=p,g*=p),e[0]=d,e[1]=v,e[2]=g,e[3]=0,e[4]=h*g-f*v,e[5]=f*d-c*g,e[6]=c*v-h*d,e[7]=0,e[8]=c,e[9]=h,e[10]=f,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},subtract:cb,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:hb,mul:fb,sub:pb});function vb(){var e=new H_(3);return H_!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function gb(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function mb(e,t,n){var r=new H_(3);return r[0]=e,r[1]=t,r[2]=n,r}function yb(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function _b(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function bb(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function xb(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Sb(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function Eb(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function Ab(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Cb(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Tb(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function wb(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Mb(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function kb(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function Ob(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),l=u&&wb(e,t)/u;return Math.acos(Math.min(Math.max(l,-1),1))}var Pb,Lb=yb,Ib=_b,Rb=bb,Nb=Sb,Db=Eb,Fb=gb,Bb=Ab,zb=(Pb=vb(),function(e,t,n,r,i,o){var a,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)Pb[0]=e[a],Pb[1]=e[a+1],Pb[2]=e[a+2],i(Pb,Pb,o),e[a]=Pb[0],e[a+1]=Pb[1],e[a+2]=Pb[2];return e}),jb=Object.freeze({__proto__:null,create:vb,clone:function(e){var t=new H_(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:gb,fromValues:mb,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},subtract:yb,multiply:_b,divide:bb,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:xb,scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},distance:Sb,squaredDistance:Eb,squaredLength:Ab,negate:Cb,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:Tb,dot:wb,cross:Mb,lerp:function(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e},hermite:function(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e},bezier:function(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,f=u*o;return e[0]=t[0]*l+n[0]*c+r[0]*h+i[0]*f,e[1]=t[1]*l+n[1]*c+r[1]*h+i[1]*f,e[2]=t[2]*l+n[2]*c+r[2]*h+i[2]*f,e},random:function(e,t){t=t||1;var n=2*G_()*Math.PI,r=2*G_()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},transformMat4:kb,transformMat3:function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},transformQuat:function(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],l=t[2],c=i*l-o*u,h=o*s-r*l,f=r*u-i*s,p=i*f-o*h,d=o*c-r*f,v=r*h-i*c,g=2*a;return c*=g,h*=g,f*=g,p*=2,d*=2,v*=2,e[0]=s+c+p,e[1]=u+h+d,e[2]=l+f+v,e},rotateX:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateY:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateZ:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},angle:Ob,zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(n-o)<=V_*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=V_*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=V_*Math.max(1,Math.abs(i),Math.abs(s))},sub:Lb,mul:Ib,div:Rb,dist:Nb,sqrDist:Db,len:Fb,sqrLen:Bb,forEach:zb});function Ub(){var e=new H_(4);return H_!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Vb(e,t,n,r){var i=new H_(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function Hb(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}!function(){var e=Ub()}();function Gb(){var e=new H_(2);return H_!=Float32Array&&(e[0]=0,e[1]=0),e}function Wb(e,t){var n=new H_(2);return n[0]=e,n[1]=t,n}function Yb(e,t){return e[0]=t[0],e[1]=t[1],e}function Xb(e,t,n){return e[0]=t,e[1]=n,e}function Zb(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function qb(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Kb(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Qb(e,t){return e[0]*t[0]+e[1]*t[1]}function $b(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}var Jb=qb,ex=(function(){var e=Gb()}(),Gb()),tx=(Gb(),Gb()),nx=Gb(),rx=Gb();function ix(e,t,n,r,i){return Zb(e,n,r),Kb(e,e),[i/Qb(t=Wb(-e[1],e[0]),Wb(-n[1],n[0])),t]}function ox(e,t){return Xb(e,-t[1],t[0])}function ax(e,t,n){return Jb(e,t,n),Kb(e,e),e}function sx(e,t){return e[0]===t[0]&&e[1]===t[1]}var ux=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b(this,e),E(this,"complex",void 0),E(this,"join",void 0),E(this,"cap",void 0),E(this,"miterLimit",void 0),E(this,"thickness",void 0),E(this,"normal",void 0),E(this,"lastFlip",-1),E(this,"miter",Wb(0,0)),E(this,"started",!1),E(this,"dash",!1),E(this,"totalDistance",0),E(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return S(e,[{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(F(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,l,h,p,c,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(F(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,l,h,p,c,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,l=e.indices,c=e.positions,h=e.normals,f="square"===this.cap,p="bevel"===this.join,d=km([a[0],a[1]]),v=km([o[0],o[1]]);ax(tx,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=Gb(),ox(this.normal,tx)),!this.started)if(this.started=!0,f){var m=Gb(),y=Gb();Zb(m,this.normal,tx),Zb(y,this.normal,tx),h.push(y[0],y[1],0),h.push(m[0],m[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-g);if(l.push(t+0,t+1,t+2),i){sx(r,i)&&Zb(i,r,Kb(i,qb(i,r,n))),ax(nx,i,r);var _=D(ix(rx,Gb(),tx,nx,this.thickness),2),b=_[0],x=_[1],S=Qb(rx,this.normal)<0?-1:1,E=p;if(!E&&"miter"===this.join)b>this.miterLimit&&(E=!0);E?(h.push(this.normal[0],this.normal[1],0),h.push(x[0],x[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,F(this.lastFlip!==-S?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),ox(ex,nx),Yb(this.normal,ex),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,h,r,x,b,this.totalDistance),l.push.apply(l,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),S=-1,Yb(this.normal,x),u+=2),this.lastFlip=S}else{if(ox(this.normal,tx),f){var A=Gb(),C=Gb();Jb(C,tx,this.normal),Zb(A,tx,this.normal),h.push(C[0],C[1],0),h.push(A[0],A[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"simpleSegment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l=km([r[0],r[1]]),c=km([n[0],n[1]]);ax(tx,l,c);var h=0;if(this.dash&&(h=this.lineSegmentDistance(l,c),this.totalDistance+=h),this.normal||(this.normal=Gb(),ox(this.normal,tx)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(t+0,t+1,t+2),i){var f=km([i[0],i[1]]);sx(l,f)&&Zb(f,l,Kb(f,qb(f,l,c))),ax(nx,f,l);var p=D(ix(rx,Gb(),tx,nx,this.thickness),2),d=p[0],v=p[1];Qb(rx,this.normal);this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,Yb(this.normal,v),o+=2,this.lastFlip=-1}else ox(this.normal,tx),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2;return o}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l="square"===this.cap,c="bevel"===this.join,h=km([r[0],r[1]]),f=km([n[0],n[1]]);ax(tx,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=Gb(),ox(this.normal,tx)),!this.started)if(this.started=!0,l){var d=Gb(),v=Gb();Zb(d,this.normal,tx),Zb(v,this.normal,tx),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(t+0,t+1,t+2),i){var g=km([i[0],i[1]]);sx(h,g)&&Zb(g,h,Kb(g,qb(g,h,f))),ax(nx,g,h);var m=D(ix(rx,Gb(),tx,nx,this.thickness),2),y=m[0],_=m[1],b=Qb(rx,this.normal)<0?-1:1,x=c;if(!x&&"miter"===this.join)y>this.miterLimit&&(x=!0);x?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,F(this.lastFlip!==-b?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),ox(ex,nx),Yb(this.normal,ex),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,y,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),b=-1,Yb(this.normal,_),o+=2),this.lastFlip=b}else{if(ox(this.normal,tx),l){var S=Gb(),E=Gb();Jb(E,tx,this.normal),Zb(S,tx,this.normal),u.push(E[0],E[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function lx(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new ux({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function cx(e){var t=jm(e.coordinates);return{vertices:[].concat(F(t),F(t),F(t),F(t)),indices:[0,1,2,2,3,0],size:t.length}}function hx(e){var t=e.coordinates,n=c_.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:c_(r,o,i),vertices:r,size:i}}var fx=function(){var e=_(g().mark((function e(t){var n,r,i,o,a,s,u,l,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.iconMap,a={a_Color:a_,a_Position:s_,filter:u_,a_vertexId:l_,a_PickingColor:function(e){var t=e.id;return i?Ty(t):[0,0,0]},a_DistanceAndIndex:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]},a_Total_Distance:function(e,t,n){return[n[5]]},a_Size:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]},a_Normal:function(e,t,n,r,i){return i},a_Miter:function(e,t,n){return[n[4]]},a_iconMapUV:function(e){var t=e.texture,n=o[t]||{x:0,y:0};return[n.x,n.y]}},s={sizePerElement:0,elements:[]},u=0,l=[],c=3,r.forEach((function(e,t){var r=lx(e),i=r.indices,o=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(e){l.push(e+u)})),c=f;var d=o.length/f;s.sizePerElement=c,s.elements.push({featureIdx:t,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*f,r*f+f),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,F(a[n.name](e,t,s,r,i,u)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:l});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),px={pointFill:function(){var e=_(g().mark((function e(t){var n,r,i,o,a,s,u,l,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.shape2d,a={a_Color:a_,a_Position:s_,filter:u_,a_vertexId:l_,a_PickingColor:function(e){var t=e.id;return i?Ty(t):[0,0,0]},a_Shape:function(e){var t=e.shape,n=void 0===t?2:t;return[o.indexOf(n)]},a_Extrude:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]},a_Size:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}},s={sizePerElement:0,elements:[]},u=0,l=[],c=3,r.forEach((function(e,t){var r=cx(e),i=r.indices,o=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(e){l.push(e+u)})),c=f;var d=o.length/f;s.sizePerElement=c,s.elements.push({featureIdx:t,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*f,r*f+f),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,F(a[n.name](e,t,s,r,i,u)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:l});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),line:fx,polygonFill:function(){var e=_(g().mark((function e(t){var n,r,i,o,a,s,u,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o={a_Color:a_,a_Position:s_,filter:u_,a_vertexId:l_,a_PickingColor:function(e){var t=e.id;return i?Ty(t):[0,0,0]}},a={sizePerElement:0,elements:[]},s=0,u=[],l=3,r.forEach((function(e,t){var r=hx(e),i=r.indices,c=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(e){u.push(e+s)})),l=f;var d=c.length/f;a.sizePerElement=l,a.elements.push({featureIdx:t,vertices:c,normals:h,offset:s}),s+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],a=c.slice(r*f,r*f+f),s=0;p&&void 0!==p[r]&&(s=p[r]),n.forEach((function(n){var u;n&&o[n.name]&&(u=n.buffer.data).push.apply(u,F(o[n.name](e,t,a,r,i,s)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:a,indices:u});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},dx=v({},px);function vx(){return(vx=_(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.workerType,r=t.data,!dx[n]){e.next=3;break}return e.abrupt("return",dx[n](r));case 3:return e.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e,t){var n=this;if("undefined"!=typeof self){var r={process:o_};Ky.onmessage=function(i,o){return t_(n,void 0,void 0,(function(){var n,a,s,u,l,c,h,f,p,d;return n_(this,(function(v){switch(v.label){case 0:switch(v.trys.push([0,19,,20]),i){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},r)];case 2:return n=v.sent(),Ky.postMessage("done",{result:n}),[3,18];case 3:if(!t)throw new Error("Worker does not support batched processing");$y=new e_,Jy=o.options||{},a=t($y,Jy,r),v.label=4;case 4:v.trys.push([4,9,10,15]),s=r_(a),v.label=5;case 5:return[4,s.next()];case 6:if((u=v.sent()).done)return[3,8];l=u.value,Ky.postMessage("output-batch",{result:l}),v.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return c=v.sent(),p={error:c},[3,15];case 10:return v.trys.push([10,,13,14]),u&&!u.done&&(d=s.return)?[4,d.call(s)]:[3,12];case 11:v.sent(),v.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return Ky.postMessage("done",{}),[3,18];case 16:return $y.push(o.input),[3,18];case 17:return $y.close(),[3,18];case 18:return[3,20];case 19:return h=v.sent(),f=h instanceof Error?h.message:"",Ky.postMessage("error",{error:f}),[3,20];case 20:return[2]}}))}))}}}((function(e){return vx.apply(this,arguments)}));var gx=new Map;function mx(e){!function(e,t){gx.set(e,t)}("l7-worker",e)}function yx(){var e,t=(e="l7-worker",gx.get(e));if(!t)throw new Error("get worker failed by workerName: ".concat("l7-worker","."));return t}function _x(e,t){return bx.apply(this,arguments)}function bx(){return(bx=_(g().mark((function e(t,n){var r,i,o,a,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=yx(),i=Zy.getWorkerFarm({maxConcurrency:3,reuseWorkers:!0}),o=i.getWorkerPool({name:"l7-worker",source:r}),e.next=5,o.startJob("l7-worker",(function(e,t,n){return e.done(n)}));case 5:return(a=e.sent).postMessage("process",{input:{workerType:t,data:n}}),e.next=9,a.result;case 9:return s=e.sent,e.abrupt("return",s.result);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}mx('var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new O(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return T()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=w(a,r);if(u){if(u===l)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=f(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,a),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function p(){}function v(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(S([])));g&&g!==e&&n.call(g,i)&&(d=g);var m=v.prototype=h.prototype=Object.create(d);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=f(t[o],t,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a \'throw\' method")}return l}var n=f(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=v,s(m,"constructor",v),s(v,"constructor",p),p.displayName=s(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s(t,u,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},x(b.prototype),s(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(m),s(m,u,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.call,L=P&&_.bind.bind(M,M),R=function(t){return P?L(t):function(){return M.apply(t,arguments)}},C=R({}.toString),N=R("".slice),D=function(t){return N(C(t),8,-1)},F=function(t){if("Function"===D(t))return R(t)},W=function(t){return null==t},z=TypeError,B=function(t){if(W(t))throw z("Can\'t call method on "+t);return t},U=Object,G=function(t){return U(B(t))},H=F({}.hasOwnProperty),V=Object.hasOwn||function(t,e){return H(G(t),e)},q=0,Z=Math.random(),Y=F(1..toString),$=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Y(++q+Z,36)},K="object"==typeof document&&document.all,Q={all:K,IS_HTMLDDA:void 0===K&&void 0!==K},X=Q.all,J=Q.IS_HTMLDDA?function(t){return"function"==typeof t||t===X}:function(t){return"function"==typeof t},tt=function(t){return J(t)?t:void 0},et=function(t,e){return arguments.length<2?tt(O[t]):O[t]&&O[t][e]},rt=et("navigator","userAgent")||"",nt=O.process,ot=O.Deno,it=nt&&nt.versions||ot&&ot.version,at=it&&it.v8;at&&(E=(w=at.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&rt&&(!(w=rt.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=rt.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var ut=E,st=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ut&&ut<41})),ct=st&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ft=I("wks"),lt=O.Symbol,ht=lt&&lt.for,pt=ct?lt:lt&&lt.withoutSetter||$,vt=function(t){if(!V(ft,t)||!st&&"string"!=typeof ft[t]){var e="Symbol."+t;st&&V(lt,t)?ft[t]=lt[t]:ft[t]=ct&&ht?ht(e):pt(e)}return ft[t]},dt={};dt[vt("toStringTag")]="z";var yt="[object z]"===String(dt),gt=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),mt=Q.all,xt=Q.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:J(t)||t===mt}:function(t){return"object"==typeof t?null!==t:J(t)},bt=O.document,wt=xt(bt)&&xt(bt.createElement),Et=function(t){return wt?bt.createElement(t):{}},At=!gt&&!j((function(){return 7!=Object.defineProperty(Et("div"),"a",{get:function(){return 7}}).a})),Ot=gt&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),St=String,Tt=TypeError,kt=function(t){if(xt(t))return t;throw Tt(St(t)+" is not an object")},It=Function.prototype.call,jt=P?It.bind(It):function(){return It.apply(It,arguments)},Pt=F({}.isPrototypeOf),_t=Object,Mt=ct?function(t){return"symbol"==typeof t}:function(t){var e=et("Symbol");return J(e)&&Pt(e.prototype,_t(t))},Lt=String,Rt=function(t){try{return Lt(t)}catch(t){return"Object"}},Ct=TypeError,Nt=function(t){if(J(t))return t;throw Ct(Rt(t)+" is not a function")},Dt=function(t,e){var r=t[e];return W(r)?void 0:Nt(r)},Ft=TypeError,Wt=TypeError,zt=vt("toPrimitive"),Bt=function(t,e){if(!xt(t)||Mt(t))return t;var r,n=Dt(t,zt);if(n){if(void 0===e&&(e="default"),r=jt(n,t,e),!xt(r)||Mt(r))return r;throw Wt("Can\'t convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;if(J(r=t.valueOf)&&!xt(n=jt(r,t)))return n;if("string"!==e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;throw Ft("Can\'t convert object to primitive value")}(t,e)},Ut=function(t){var e=Bt(t,"string");return Mt(e)?e:e+""},Gt=TypeError,Ht=Object.defineProperty,Vt=Object.getOwnPropertyDescriptor,qt={f:gt?Ot?function(t,e,r){if(kt(t),e=Ut(e),kt(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Vt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Ht(t,e,r)}:Ht:function(t,e,r){if(kt(t),e=Ut(e),kt(r),At)try{return Ht(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Gt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Zt=Function.prototype,Yt=gt&&Object.getOwnPropertyDescriptor,$t=V(Zt,"name"),Kt={EXISTS:$t,PROPER:$t&&"something"===function(){}.name,CONFIGURABLE:$t&&(!gt||gt&&Yt(Zt,"name").configurable)},Qt=F(Function.toString);J(k.inspectSource)||(k.inspectSource=function(t){return Qt(t)});var Xt,Jt,te,ee=k.inspectSource,re=O.WeakMap,ne=J(re)&&/native code/.test(String(re)),oe=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ie=gt?function(t,e,r){return qt.f(t,e,oe(1,r))}:function(t,e,r){return t[e]=r,t},ae=I("keys"),ue=function(t){return ae[t]||(ae[t]=$(t))},se={},ce=O.TypeError,fe=O.WeakMap;if(ne||k.state){var le=k.state||(k.state=new fe);le.get=le.get,le.has=le.has,le.set=le.set,Xt=function(t,e){if(le.has(t))throw ce("Object already initialized");return e.facade=t,le.set(t,e),e},Jt=function(t){return le.get(t)||{}},te=function(t){return le.has(t)}}else{var he=ue("state");se[he]=!0,Xt=function(t,e){if(V(t,he))throw ce("Object already initialized");return e.facade=t,ie(t,he,e),e},Jt=function(t){return V(t,he)?t[he]:{}},te=function(t){return V(t,he)}}var pe={set:Xt,get:Jt,has:te,enforce:function(t){return te(t)?Jt(t):Xt(t,{})},getterFor:function(t){return function(e){var r;if(!xt(e)||(r=Jt(e)).type!==t)throw ce("Incompatible receiver, "+t+" required");return r}}},ve=b((function(t){var e=Kt.CONFIGURABLE,r=pe.enforce,n=pe.get,o=Object.defineProperty,i=gt&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!V(t,"name")||e&&t.name!==n)&&(gt?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&V(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&V(u,"constructor")&&u.constructor?gt&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return V(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return J(this)&&n(this).source||ee(this)}),"toString")})),de=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(J(r)&&ve(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:qt.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},ye=vt("toStringTag"),ge=Object,me="Arguments"==D(function(){return arguments}()),xe=yt?D:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ge(t),ye))?r:me?D(e):"Object"==(n=D(e))&&J(e.callee)?"Arguments":n},be=yt?{}.toString:function(){return"[object "+xe(this)+"]"};yt||de(Object.prototype,"toString",be,{unsafe:!0});var we={}.propertyIsEnumerable,Ee=Object.getOwnPropertyDescriptor,Ae={f:Ee&&!we.call({1:2},1)?function(t){var e=Ee(this,t);return!!e&&e.enumerable}:we},Oe=Object,Se=F("".split),Te=j((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(t){return"String"==D(t)?Se(t,""):Oe(t)}:Oe,ke=function(t){return Te(B(t))},Ie=Object.getOwnPropertyDescriptor,je={f:gt?Ie:function(t,e){if(t=ke(t),e=Ut(e),At)try{return Ie(t,e)}catch(t){}if(V(t,e))return oe(!jt(Ae.f,t,e),t[e])}},Pe=Math.ceil,_e=Math.floor,Me=Math.trunc||function(t){var e=+t;return(e>0?_e:Pe)(e)},Le=function(t){var e=+t;return e!=e||0===e?0:Me(e)},Re=Math.max,Ce=Math.min,Ne=function(t,e){var r=Le(t);return r<0?Re(r+e,0):Ce(r,e)},De=Math.min,Fe=function(t){return t>0?De(Le(t),9007199254740991):0},We=function(t){return Fe(t.length)},ze=function(t){return function(e,r,n){var o,i=ke(e),a=We(i),u=Ne(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},Be={includes:ze(!0),indexOf:ze(!1)},Ue=Be.indexOf,Ge=F([].push),He=function(t,e){var r,n=ke(t),o=0,i=[];for(r in n)!V(se,r)&&V(n,r)&&Ge(i,r);for(;e.length>o;)V(n,r=e[o++])&&(~Ue(i,r)||Ge(i,r));return i},Ve=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qe=Ve.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return He(t,qe)}},Ye={f:Object.getOwnPropertySymbols},$e=F([].concat),Ke=et("Reflect","ownKeys")||function(t){var e=Ze.f(kt(t)),r=Ye.f;return r?$e(e,r(t)):e},Qe=function(t,e,r){for(var n=Ke(e),o=qt.f,i=je.f,a=0;a<n.length;a++){var u=n[a];V(t,u)||r&&V(r,u)||o(t,u,i(e,u))}},Xe=/#|\\.prototype\\./,Je=function(t,e){var r=er[tr(t)];return r==nr||r!=rr&&(J(e)?j(e):!!e)},tr=Je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},er=Je.data={},rr=Je.NATIVE="N",nr=Je.POLYFILL="P",or=Je,ir=je.f,ar=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=ir(r,n))&&a.value:r[n],!or(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qe(i,o)}(t.sham||o&&o.sham)&&ie(i,"sham",!0),de(r,n,i,t)}},ur="process"==D(O.process),sr=String,cr=TypeError,fr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=F(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return kt(r),function(t){if("object"==typeof t||J(t))return t;throw cr("Can\'t set "+sr(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),lr=qt.f,hr=vt("toStringTag"),pr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!V(t,hr)&&lr(t,hr,{configurable:!0,value:e})},vr=vt("species"),dr=function(t){var e=et(t),r=qt.f;gt&&e&&!e[vr]&&r(e,vr,{configurable:!0,get:function(){return this}})},yr=TypeError,gr=function(t,e){if(Pt(e,t))return t;throw yr("Incorrect invocation")},mr=function(){},xr=[],br=et("Reflect","construct"),wr=/^\\s*(?:class|function)\\b/,Er=F(wr.exec),Ar=!wr.exec(mr),Or=function(t){if(!J(t))return!1;try{return br(mr,xr,t),!0}catch(t){return!1}},Sr=function(t){if(!J(t))return!1;switch(xe(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ar||!!Er(wr,ee(t))}catch(t){return!0}};Sr.sham=!0;var Tr,kr,Ir,jr,Pr=!br||j((function(){var t;return Or(Or.call)||!Or(Object)||!Or((function(){t=!0}))||t}))?Sr:Or,_r=TypeError,Mr=function(t){if(Pr(t))return t;throw _r(Rt(t)+" is not a constructor")},Lr=vt("species"),Rr=function(t,e){var r,n=kt(t).constructor;return void 0===n||W(r=kt(n)[Lr])?e:Mr(r)},Cr=Function.prototype,Nr=Cr.apply,Dr=Cr.call,Fr="object"==typeof Reflect&&Reflect.apply||(P?Dr.bind(Nr):function(){return Dr.apply(Nr,arguments)}),Wr=F(F.bind),zr=function(t,e){return Nt(t),void 0===e?t:P?Wr(t,e):function(){return t.apply(e,arguments)}},Br=et("document","documentElement"),Ur=F([].slice),Gr=TypeError,Hr=function(t,e){if(t<e)throw Gr("Not enough arguments");return t},Vr=/(?:ipad|iphone|ipod).*applewebkit/i.test(rt),qr=O.setImmediate,Zr=O.clearImmediate,Yr=O.process,$r=O.Dispatch,Kr=O.Function,Qr=O.MessageChannel,Xr=O.String,Jr=0,tn={};try{Tr=O.location}catch(t){}var en=function(t){if(V(tn,t)){var e=tn[t];delete tn[t],e()}},rn=function(t){return function(){en(t)}},nn=function(t){en(t.data)},on=function(t){O.postMessage(Xr(t),Tr.protocol+"//"+Tr.host)};qr&&Zr||(qr=function(t){Hr(arguments.length,1);var e=J(t)?t:Kr(t),r=Ur(arguments,1);return tn[++Jr]=function(){Fr(e,void 0,r)},kr(Jr),Jr},Zr=function(t){delete tn[t]},ur?kr=function(t){Yr.nextTick(rn(t))}:$r&&$r.now?kr=function(t){$r.now(rn(t))}:Qr&&!Vr?(jr=(Ir=new Qr).port2,Ir.port1.onmessage=nn,kr=zr(jr.postMessage,jr)):O.addEventListener&&J(O.postMessage)&&!O.importScripts&&Tr&&"file:"!==Tr.protocol&&!j(on)?(kr=on,O.addEventListener("message",nn,!1)):kr="onreadystatechange"in Et("script")?function(t){Br.appendChild(Et("script")).onreadystatechange=function(){Br.removeChild(this),en(t)}}:function(t){setTimeout(rn(t),0)});var an,un,sn,cn,fn,ln,hn,pn,vn={set:qr,clear:Zr},dn=/ipad|iphone|ipod/i.test(rt)&&void 0!==O.Pebble,yn=/web0s(?!.*chrome)/i.test(rt),gn=je.f,mn=vn.set,xn=O.MutationObserver||O.WebKitMutationObserver,bn=O.document,wn=O.process,En=O.Promise,An=gn(O,"queueMicrotask"),On=An&&An.value;On||(an=function(){var t,e;for(ur&&(t=wn.domain)&&t.exit();un;){e=un.fn,un=un.next;try{e()}catch(t){throw un?cn():sn=void 0,t}}sn=void 0,t&&t.enter()},Vr||ur||yn||!xn||!bn?!dn&&En&&En.resolve?((hn=En.resolve(void 0)).constructor=En,pn=zr(hn.then,hn),cn=function(){pn(an)}):ur?cn=function(){wn.nextTick(an)}:(mn=zr(mn,O),cn=function(){mn(an)}):(fn=!0,ln=bn.createTextNode(""),new xn(an).observe(ln,{characterData:!0}),cn=function(){ln.data=fn=!fn}));var Sn=On||function(t){var e={fn:t,next:void 0};sn&&(sn.next=e),un||(un=e,cn()),sn=e},Tn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},kn=function(){this.head=null,this.tail=null};kn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var In,jn,Pn,_n=kn,Mn=O.Promise,Ln="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rn=!Ln&&!ur&&"object"==typeof window&&"object"==typeof document,Cn=(Mn&&Mn.prototype,vt("species")),Nn=!1,Dn=J(O.PromiseRejectionEvent),Fn={CONSTRUCTOR:or("Promise",(function(){var t=ee(Mn),e=t!==String(Mn);if(!e&&66===ut)return!0;if(!ut||ut<51||!/native code/.test(t)){var r=new Mn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Nn=r.then((function(){}))instanceof n))return!0}return!e&&(Rn||Ln)&&!Dn})),REJECTION_EVENT:Dn,SUBCLASSING:Nn},Wn=TypeError,zn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Wn("Bad Promise constructor");e=t,r=n})),this.resolve=Nt(e),this.reject=Nt(r)},Bn={f:function(t){return new zn(t)}},Un=vn.set,Gn=Fn.CONSTRUCTOR,Hn=Fn.REJECTION_EVENT,Vn=Fn.SUBCLASSING,qn=pe.getterFor("Promise"),Zn=pe.set,Yn=Mn&&Mn.prototype,$n=Mn,Kn=Yn,Qn=O.TypeError,Xn=O.document,Jn=O.process,to=Bn.f,eo=to,ro=!!(Xn&&Xn.createEvent&&O.dispatchEvent),no=function(t){var e;return!(!xt(t)||!J(e=t.then))&&e},oo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&co(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Qn("Promise-chain cycle")):(n=no(r))?jt(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},io=function(t,e){t.notified||(t.notified=!0,Sn((function(){for(var r,n=t.reactions;r=n.get();)oo(r,t);t.notified=!1,e&&!t.rejection&&uo(t)})))},ao=function(t,e,r){var n,o;ro?((n=Xn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},uo=function(t){jt(Un,O,(function(){var e,r=t.facade,n=t.value;if(so(t)&&(e=Tn((function(){ur?Jn.emit("unhandledRejection",n,r):ao("unhandledrejection",r,n)})),t.rejection=ur||so(t)?2:1,e.error))throw e.value}))},so=function(t){return 1!==t.rejection&&!t.parent},co=function(t){jt(Un,O,(function(){var e=t.facade;ur?Jn.emit("rejectionHandled",e):ao("rejectionhandled",e,t.value)}))},fo=function(t,e,r){return function(n){t(e,n,r)}},lo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,io(t,!0))},ho=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qn("Promise can\'t be resolved itself");var n=no(e);n?Sn((function(){var r={done:!1};try{jt(n,e,fo(ho,r,t),fo(lo,r,t))}catch(e){lo(r,e,t)}})):(t.value=e,t.state=1,io(t,!1))}catch(e){lo({done:!1},e,t)}}};if(Gn&&(Kn=($n=function(t){gr(this,Kn),Nt(t),jt(In,this);var e=qn(this);try{t(fo(ho,e),fo(lo,e))}catch(t){lo(e,t)}}).prototype,(In=function(t){Zn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new _n,rejection:!1,state:0,value:void 0})}).prototype=de(Kn,"then",(function(t,e){var r=qn(this),n=to(Rr(this,$n));return r.parent=!0,n.ok=!J(t)||t,n.fail=J(e)&&e,n.domain=ur?Jn.domain:void 0,0==r.state?r.reactions.add(n):Sn((function(){oo(n,r)})),n.promise})),jn=function(){var t=new In,e=qn(t);this.promise=t,this.resolve=fo(ho,e),this.reject=fo(lo,e)},Bn.f=to=function(t){return t===$n||void 0===t?new jn(t):eo(t)},J(Mn)&&Yn!==Object.prototype)){Pn=Yn.then,Vn||de(Yn,"then",(function(t,e){var r=this;return new $n((function(t,e){jt(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Yn.constructor}catch(t){}fr&&fr(Yn,Kn)}ar({global:!0,constructor:!0,wrap:!0,forced:Gn},{Promise:$n}),pr($n,"Promise",!1),dr("Promise");var po={},vo=vt("iterator"),yo=Array.prototype,go=function(t){return void 0!==t&&(po.Array===t||yo[vo]===t)},mo=vt("iterator"),xo=function(t){if(!W(t))return Dt(t,mo)||Dt(t,"@@iterator")||po[xe(t)]},bo=TypeError,wo=function(t,e){var r=arguments.length<2?xo(t):e;if(Nt(r))return kt(jt(r,t));throw bo(Rt(t)+" is not iterable")},Eo=function(t,e,r){var n,o;kt(t);try{if(!(n=Dt(t,"return"))){if("throw"===e)throw r;return r}n=jt(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return kt(n),r},Ao=TypeError,Oo=function(t,e){this.stopped=t,this.result=e},So=Oo.prototype,To=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=zr(e,f),y=function(t){return n&&Eo(n,"normal",t),new Oo(!0,t)},g=function(t){return l?(kt(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Ao(Rt(t)+" is not iterable");if(go(o)){for(i=0,a=We(t);a>i;i++)if((u=g(t[i]))&&Pt(So,u))return u;return new Oo(!1)}n=wo(t,o)}for(s=h?t.next:n.next;!(c=jt(s,n)).done;){try{u=g(c.value)}catch(t){Eo(n,"throw",t)}if("object"==typeof u&&u&&Pt(So,u))return u}return new Oo(!1)},ko=vt("iterator"),Io=!1;try{var jo=0,Po={next:function(){return{done:!!jo++}},return:function(){Io=!0}};Po[ko]=function(){return this},Array.from(Po,(function(){throw 2}))}catch(t){}var _o=function(t,e){if(!e&&!Io)return!1;var r=!1;try{var n={};n[ko]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Mo=Fn.CONSTRUCTOR||!_o((function(t){Mn.all(t).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Mo},{all:function(t){var e=this,r=Bn.f(e),n=r.resolve,o=r.reject,i=Tn((function(){var r=Nt(e.resolve),i=[],a=0,u=1;To(t,(function(t){var s=a++,c=!1;u++,jt(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Lo=Fn.CONSTRUCTOR,Ro=Mn&&Mn.prototype;if(ar({target:"Promise",proto:!0,forced:Lo,real:!0},{catch:function(t){return this.then(void 0,t)}}),J(Mn)){var Co=et("Promise").prototype.catch;Ro.catch!==Co&&de(Ro,"catch",Co,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Mo},{race:function(t){var e=this,r=Bn.f(e),n=r.reject,o=Tn((function(){var o=Nt(e.resolve);To(t,(function(t){jt(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ar({target:"Promise",stat:!0,forced:Fn.CONSTRUCTOR},{reject:function(t){var e=Bn.f(this);return jt(e.reject,void 0,t),e.promise}});var No=Fn.CONSTRUCTOR;et("Promise");function Do(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ar({target:"Promise",stat:!0,forced:No},{resolve:function(t){return function(t,e){if(kt(t),xt(e)&&e.constructor===t)return e;var r=Bn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Fo="undefined"!=typeof window&&void 0!==window.orientation,Wo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),zo=new Map;function Bo(t){Do(t.source&&!t.url||!t.source&&t.url);var e=zo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Uo((e=t,"try {\\n  importScripts(\'"+e+"\');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),zo.set(t.url,e)),t.source&&(e=Uo(t.source),zo.set(t.source,e))),Do(e),e}function Uo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Go(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Go(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Vo=function(){},qo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Do(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Vo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Vo,this.onError=Vo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Go(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Bo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Zo=self&&self.__assign||function(){return(Zo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Yo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},$o=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Zo(Zo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Yo(this,void 0,void 0,(function(){var n,o=this;return $o(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Yo(this,void 0,void 0,(function(){var t,e,r;return $o(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Wo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new qo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Fo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Qo=self&&self.__assign||function(){return(Qo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Xo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ti=(function(){function t(t){this.workerPools=new Map,this.props=Qo({},Jo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return qo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Xo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Qo(Qo({},this.props),t);try{for(var n=Xo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Ko({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ei=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ti.get(t);e||(e=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ti.get(t);ti.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Go(e);self.postMessage(r,n)}},t}();function ri(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ni,oi,ii=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ai=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ui=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},si=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ci=0;function fi(t,e){var r=this;if("undefined"!=typeof self){var n={process:li};ei.onmessage=function(o,i){return ai(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ui(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ei.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ni=new ii,oi=i.options||{},a=e(ni,oi,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=si(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ei.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ei.postMessage("done",{}),[3,18];case 16:return ni.push(i.input),[3,18];case 17:return ni.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ei.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function li(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ci++,i=function(t,e){if(e.id===o)switch(t){case"done":ei.removeEventListener(i),r(e.result);break;case"error":ei.removeEventListener(i),n(e.error)}};ei.addEventListener(i);var a={id:o,input:t,options:e};ei.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var hi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pi=Et("span").classList,vi=pi&&pi.constructor&&pi.constructor.prototype,di=vi===Object.prototype?void 0:vi,yi=Array.isArray||function(t){return"Array"==D(t)},gi=vt("species"),mi=Array,xi=function(t,e){return new(function(t){var e;return yi(t)&&(e=t.constructor,(Pr(e)&&(e===mi||yi(e.prototype))||xt(e)&&null===(e=e[gi]))&&(e=void 0)),void 0===e?mi:e}(t))(0===e?0:e)},bi=F([].push),wi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=G(s),d=Te(v),y=zr(c,f),g=We(d),m=0,x=l||xi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:bi(b,h)}else switch(t){case 4:return!1;case 7:bi(b,h)}return i?-1:n||o?o:b}},Ei={forEach:wi(0),map:wi(1),filter:wi(2),some:wi(3),every:wi(4),find:wi(5),findIndex:wi(6),filterReject:wi(7)},Ai=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},Oi=Ei.forEach,Si=Ai("forEach")?[].forEach:function(t){return Oi(this,t,arguments.length>1?arguments[1]:void 0)},Ti=function(t){if(t&&t.forEach!==Si)try{ie(t,"forEach",Si)}catch(e){t.forEach=Si}};for(var ki in hi)hi[ki]&&Ti(O[ki]&&O[ki].prototype);Ti(di);var Ii=function(t,e,r){var n=Ut(e);n in t?qt.f(t,n,oe(0,r)):t[n]=r},ji=vt("species"),Pi=function(t){return ut>=51||!j((function(){var e=[];return(e.constructor={})[ji]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},_i=Pi("slice"),Mi=vt("species"),Li=Array,Ri=Math.max;ar({target:"Array",proto:!0,forced:!_i},{slice:function(t,e){var r,n,o,i=ke(this),a=We(i),u=Ne(t,a),s=Ne(void 0===e?a:e,a);if(yi(i)&&(r=i.constructor,(Pr(r)&&(r===Li||yi(r.prototype))||xt(r)&&null===(r=r[Mi]))&&(r=void 0),r===Li||void 0===r))return Ur(i,u,s);for(n=new(void 0===r?Li:r)(Ri(s-u,0)),o=0;u<s;u++,o++)u in i&&Ii(n,o,i[u]);return n.length=o,n}});var Ci=Kt.EXISTS,Ni=qt.f,Di=Function.prototype,Fi=F(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=F(Wi.exec);gt&&!Ci&&Ni(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi=Ei.map,Ui=Pi("map");ar({target:"Array",proto:!0,forced:!Ui},{map:function(t){return Bi(this,t,arguments.length>1?arguments[1]:void 0)}});var Gi,Hi=Object.keys||function(t){return He(t,Ve)},Vi={f:gt&&!Ot?Object.defineProperties:function(t,e){kt(t);for(var r,n=ke(e),o=Hi(e),i=o.length,a=0;i>a;)qt.f(t,r=o[a++],n[r]);return t}},qi=ue("IE_PROTO"),Zi=function(){},Yi=function(t){return"<script>"+t+"<\\/script>"},$i=function(t){t.write(Yi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ki=function(){try{Gi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ki="undefined"!=typeof document?document.domain&&Gi?$i(Gi):((e=Et("iframe")).style.display="none",Br.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Yi("document.F=Object")),t.close(),t.F):$i(Gi);for(var r=Ve.length;r--;)delete Ki.prototype[Ve[r]];return Ki()};se[qi]=!0;var Qi=Object.create||function(t,e){var r;return null!==t?(Zi.prototype=kt(t),r=new Zi,Zi.prototype=null,r[qi]=t):r=Ki(),void 0===e?r:Vi.f(r,e)},Xi=qt.f,Ji=vt("unscopables"),ta=Array.prototype;null==ta[Ji]&&Xi(ta,Ji,{configurable:!0,value:Qi(null)});var ea,ra,na,oa=function(t){ta[Ji][t]=!0},ia=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),aa=ue("IE_PROTO"),ua=Object,sa=ua.prototype,ca=ia?ua.getPrototypeOf:function(t){var e=G(t);if(V(e,aa))return e[aa];var r=e.constructor;return J(r)&&e instanceof r?r.prototype:e instanceof ua?sa:null},fa=vt("iterator"),la=!1;[].keys&&("next"in(na=[].keys())?(ra=ca(ca(na)))!==Object.prototype&&(ea=ra):la=!0),(!xt(ea)||j((function(){var t={};return ea[fa].call(t)!==t})))&&(ea={}),J(ea[fa])||de(ea,fa,(function(){return this}));var ha={IteratorPrototype:ea,BUGGY_SAFARI_ITERATORS:la},pa=ha.IteratorPrototype,va=function(){return this},da=Kt.PROPER,ya=Kt.CONFIGURABLE,ga=ha.IteratorPrototype,ma=ha.BUGGY_SAFARI_ITERATORS,xa=vt("iterator"),ba=function(){return this},wa=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Qi(pa,{next:oe(+!n,r)}),pr(t,o,!1),po[o]=va}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ma&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[xa]||p["@@iterator"]||o&&p[o],d=!ma&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ca(y.call(new t)))!==Object.prototype&&u.next&&(ca(u)!==ga&&(fr?fr(u,ga):J(u[xa])||de(u,xa,ba)),pr(u,l,!0)),da&&"values"==o&&v&&"values"!==v.name&&(ya?ie(p,"name","values"):(h=!0,d=function(){return jt(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ma||h||!(c in p))&&de(p,c,s[c]);else ar({target:e,proto:!0,forced:ma||h},s);return p[xa]!==d&&de(p,xa,d,{name:o}),po[e]=d,s},Ea=function(t,e){return{value:t,done:e}},Aa=qt.f,Oa=pe.set,Sa=pe.getterFor("Array Iterator"),Ta=wa(Array,"Array",(function(t,e){Oa(this,{type:"Array Iterator",target:ke(t),index:0,kind:e})}),(function(){var t=Sa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,Ea(void 0,!0)):Ea("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),ka=po.Arguments=po.Array;if(oa("keys"),oa("values"),oa("entries"),gt&&"values"!==ka.name)try{Aa(ka,"name",{value:"values"})}catch(t){}var Ia,ja,Pa,_a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ma=qt.f,La=pe.enforce,Ra=pe.get,Ca=O.Int8Array,Na=Ca&&Ca.prototype,Da=O.Uint8ClampedArray,Fa=Da&&Da.prototype,Wa=Ca&&ca(Ca),za=Na&&ca(Na),Ba=Object.prototype,Ua=O.TypeError,Ga=vt("toStringTag"),Ha=$("TYPED_ARRAY_TAG"),Va=_a&&!!fr&&"Opera"!==xe(O.opera),qa=!1,Za={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ya={BigInt64Array:8,BigUint64Array:8},$a=function(t){var e=ca(t);if(xt(e)){var r=Ra(e);return r&&V(r,"TypedArrayConstructor")?r.TypedArrayConstructor:$a(e)}},Ka=function(t){if(!xt(t))return!1;var e=xe(t);return V(Za,e)||V(Ya,e)};for(Ia in Za)(Pa=(ja=O[Ia])&&ja.prototype)?La(Pa).TypedArrayConstructor=ja:Va=!1;for(Ia in Ya)(Pa=(ja=O[Ia])&&ja.prototype)&&(La(Pa).TypedArrayConstructor=ja);if((!Va||!J(Wa)||Wa===Function.prototype)&&(Wa=function(){throw Ua("Incorrect invocation")},Va))for(Ia in Za)O[Ia]&&fr(O[Ia],Wa);if((!Va||!za||za===Ba)&&(za=Wa.prototype,Va))for(Ia in Za)O[Ia]&&fr(O[Ia].prototype,za);if(Va&&ca(Fa)!==za&&fr(Fa,za),gt&&!V(za,Ga))for(Ia in qa=!0,Ma(za,Ga,{get:function(){return xt(this)?this[Ha]:void 0}}),Za)O[Ia]&&ie(O[Ia],Ha,Ia);var Qa={NATIVE_ARRAY_BUFFER_VIEWS:Va,TYPED_ARRAY_TAG:qa&&Ha,aTypedArray:function(t){if(Ka(t))return t;throw Ua("Target is not a typed array")},aTypedArrayConstructor:function(t){if(J(t)&&(!fr||Pt(Wa,t)))return t;throw Ua(Rt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(gt){if(r)for(var o in Za){var i=O[o];if(i&&V(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}za[t]&&!r||de(za,t,r?e:Va&&Na[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(gt){if(fr){if(r)for(n in Za)if((o=O[n])&&V(o,t))try{delete o[t]}catch(t){}if(Wa[t]&&!r)return;try{return de(Wa,t,r?e:Va&&Wa[t]||e)}catch(t){}}for(n in Za)!(o=O[n])||o[t]&&!r||de(o,t,e)}},getTypedArrayConstructor:$a,isView:function(t){if(!xt(t))return!1;var e=xe(t);return"DataView"===e||V(Za,e)||V(Ya,e)},isTypedArray:Ka,TypedArray:Wa,TypedArrayPrototype:za},Xa=Qa.NATIVE_ARRAY_BUFFER_VIEWS,Ja=O.ArrayBuffer,tu=O.Int8Array,eu=!Xa||!j((function(){tu(1)}))||!j((function(){new tu(-1)}))||!_o((function(t){new tu,new tu(null),new tu(1.5),new tu(t)}),!0)||j((function(){return 1!==new tu(new Ja(2),1,void 0).length})),ru=function(t,e,r){for(var n in e)de(t,n,e[n],r);return t},nu=RangeError,ou=function(t){if(void 0===t)return 0;var e=Le(t),r=Fe(e);if(e!==r)throw nu("Wrong length or index");return r},iu=Array,au=Math.abs,uu=Math.pow,su=Math.floor,cu=Math.log,fu=Math.LN2,lu=function(t,e,r){var n,o,i,a=iu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?uu(2,-24)-uu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=au(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=su(cu(t)/fu),t*(i=uu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*uu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*uu(2,e),n+=c):(o=t*uu(2,c-1)*uu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},hu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=uu(2,e),f-=a}return(c?-1:1)*r*uu(2,f-e)},pu=function(t){for(var e=G(this),r=We(e),n=arguments.length,o=Ne(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ne(i,r);a>o;)e[o++]=t;return e},vu=Array,du=Math.max,yu=function(t,e,r){for(var n=We(t),o=Ne(e,n),i=Ne(void 0===r?n:r,n),a=vu(du(i-o,0)),u=0;o<i;o++,u++)Ii(a,u,t[o]);return a.length=u,a},gu=Ze.f,mu=qt.f,xu=Kt.PROPER,bu=Kt.CONFIGURABLE,wu=pe.get,Eu=pe.set,Au=O.ArrayBuffer,Ou=Au,Su=Ou&&Ou.prototype,Tu=O.DataView,ku=Tu&&Tu.prototype,Iu=Object.prototype,ju=O.Array,Pu=O.RangeError,_u=F(pu),Mu=F([].reverse),Lu=lu,Ru=hu,Cu=function(t){return[255&t]},Nu=function(t){return[255&t,t>>8&255]},Du=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Fu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Wu=function(t){return Lu(t,23,4)},zu=function(t){return Lu(t,52,8)},Bu=function(t,e){mu(t.prototype,e,{get:function(){return wu(this)[e]}})},Uu=function(t,e,r,n){var o=ou(r),i=wu(t);if(o+e>i.byteLength)throw Pu("Wrong index");var a=wu(i.buffer).bytes,u=o+i.byteOffset,s=yu(a,u,u+e);return n?s:Mu(s)},Gu=function(t,e,r,n,o,i){var a=ou(r),u=wu(t);if(a+e>u.byteLength)throw Pu("Wrong index");for(var s=wu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(_a){var Hu=xu&&"ArrayBuffer"!==Au.name;if(j((function(){Au(1)}))&&j((function(){new Au(-1)}))&&!j((function(){return new Au,new Au(1.5),new Au(NaN),1!=Au.length||Hu&&!bu})))Hu&&bu&&ie(Au,"name","ArrayBuffer");else{(Ou=function(t){return gr(this,Su),new Au(ou(t))}).prototype=Su;for(var Vu,qu=gu(Au),Zu=0;qu.length>Zu;)(Vu=qu[Zu++])in Ou||ie(Ou,Vu,Au[Vu]);Su.constructor=Ou}fr&&ca(ku)!==Iu&&fr(ku,Iu);var Yu=new Tu(new Ou(2)),$u=F(ku.setInt8);Yu.setInt8(0,2147483648),Yu.setInt8(1,2147483649),!Yu.getInt8(0)&&Yu.getInt8(1)||ru(ku,{setInt8:function(t,e){$u(this,t,e<<24>>24)},setUint8:function(t,e){$u(this,t,e<<24>>24)}},{unsafe:!0})}else Su=(Ou=function(t){gr(this,Su);var e=ou(t);Eu(this,{bytes:_u(ju(e),0),byteLength:e}),gt||(this.byteLength=e)}).prototype,ku=(Tu=function(t,e,r){gr(this,ku),gr(t,Su);var n=wu(t).byteLength,o=Le(e);if(o<0||o>n)throw Pu("Wrong offset");if(o+(r=void 0===r?n-o:Fe(r))>n)throw Pu("Wrong length");Eu(this,{buffer:t,byteLength:r,byteOffset:o}),gt||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,gt&&(Bu(Ou,"byteLength"),Bu(Tu,"buffer"),Bu(Tu,"byteLength"),Bu(Tu,"byteOffset")),ru(ku,{getInt8:function(t){return Uu(this,1,t)[0]<<24>>24},getUint8:function(t){return Uu(this,1,t)[0]},getInt16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Ru(Uu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Ru(Uu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Gu(this,1,t,Cu,e)},setUint8:function(t,e){Gu(this,1,t,Cu,e)},setInt16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Gu(this,4,t,Wu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Gu(this,8,t,zu,e,arguments.length>2?arguments[2]:void 0)}});pr(Ou,"ArrayBuffer"),pr(Tu,"DataView");var Ku={ArrayBuffer:Ou,DataView:Tu},Qu=Math.floor,Xu=Number.isInteger||function(t){return!xt(t)&&isFinite(t)&&Qu(t)===t},Ju=RangeError,ts=RangeError,es=function(t,e){var r=function(t){var e=Le(t);if(e<0)throw Ju("The argument can\'t be less than 0");return e}(t);if(r%e)throw ts("Wrong offset");return r},rs=F("".slice),ns=function(t){return"Big"===rs(xe(t),0,3)},os=TypeError,is=function(t){var e=Bt(t,"number");if("number"==typeof e)throw os("Can\'t convert number to bigint");return BigInt(e)},as=Qa.aTypedArrayConstructor,us=function(t){var e,r,n,o,i,a,u,s,c=Mr(this),f=G(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!go(v))for(s=(u=wo(f,v)).next,f=[];!(a=jt(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=zr(h,arguments[2])),r=We(f),n=new(as(c))(r),o=ns(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?is(i):+i;return n},ss=function(t,e,r){var n,o;return fr&&J(n=e.constructor)&&n!==r&&xt(o=n.prototype)&&o!==r.prototype&&fr(t,o),t},cs=b((function(t){var e=Ze.f,r=Ei.forEach,n=pe.get,o=pe.set,i=pe.enforce,a=qt.f,u=je.f,s=Math.round,c=O.RangeError,f=Ku.ArrayBuffer,l=f.prototype,h=Ku.DataView,p=Qa.NATIVE_ARRAY_BUFFER_VIEWS,v=Qa.TYPED_ARRAY_TAG,d=Qa.TypedArray,y=Qa.TypedArrayPrototype,g=Qa.aTypedArrayConstructor,m=Qa.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Pt(l,t)||"ArrayBuffer"==(e=xe(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!Mt(e)&&e in t&&Xu(+e)&&e>=0},A=function(t,e){return e=Ut(e),E(t,e)?oe(2,t[e]):u(t,e)},S=function(t,e,r){return e=Ut(e),!(E(t,e)&&xt(r)&&V(r,"value"))||V(r,"get")||V(r,"set")||r.configurable||V(r,"writable")&&!r.writable||V(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};gt?(p||(je.f=A,qt.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?eu&&(T=u((function(t,e,r,n){return gr(t,k),ss(xt(e)?w(e)?void 0!==n?new S(e,es(r,g),n):void 0!==r?new S(e,es(r,g)):new S(e):m(e)?x(T,e):jt(us,T,e):new S(ou(e)),t,T)})),fr&&fr(T,d),r(e(S),(function(t){t in T||ie(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){gr(t,k);var i,a,u,s=0,l=0;if(xt(e)){if(!w(e))return m(e)?x(T,e):jt(us,T,e);i=e,l=es(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Fe(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=ou(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),fr&&fr(T,d),k=T.prototype=Qi(y)),k.constructor!==T&&ie(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&ie(k,v,b);var P=T!=S;I[b]=T,ar({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||ie(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||ie(k,"BYTES_PER_ELEMENT",g),dr(b)}):t.exports=function(){}}));cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var fs=TypeError,ls=function(t,e){if(!delete t[e])throw fs("Cannot delete property "+Rt(e)+" of "+Rt(t))},hs=Math.min,ps=F([].copyWithin||function(t,e){var r=G(this),n=We(r),o=Ne(t,n),i=Ne(e,n),a=arguments.length>2?arguments[2]:void 0,u=hs((void 0===a?n:Ne(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ls(r,o),o+=s,i+=s;return r}),vs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("copyWithin",(function(t,e){return ps(vs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ds=Ei.every,ys=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("every",(function(t){return ds(ys(this),t,arguments.length>1?arguments[1]:void 0)}));var gs=Qa.aTypedArray,ms=Qa.exportTypedArrayMethod,xs=F("".slice);ms("fill",(function(t){var e=arguments.length;gs(this);var r="Big"===xs(xe(this),0,3)?is(t):+t;return jt(pu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var bs=Qa.aTypedArrayConstructor,ws=Qa.getTypedArrayConstructor,Es=function(t){return bs(Rr(t,ws(t)))},As=function(t,e){return function(t,e){for(var r=0,n=We(e),o=new t(n);n>r;)o[r]=e[r++];return o}(Es(t),e)},Os=Ei.filter,Ss=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("filter",(function(t){var e=Os(Ss(this),t,arguments.length>1?arguments[1]:void 0);return As(this,e)}));var Ts=Ei.find,ks=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("find",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Ei.findIndex,js=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("findIndex",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Ei.forEach,_s=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("forEach",(function(t){Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=Be.includes,Ls=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("includes",(function(t){return Ms(Ls(this),t,arguments.length>1?arguments[1]:void 0)}));var Rs=Be.indexOf,Cs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("indexOf",(function(t){return Rs(Cs(this),t,arguments.length>1?arguments[1]:void 0)}));var Ns=vt("iterator"),Ds=O.Uint8Array,Fs=F(Ta.values),Ws=F(Ta.keys),zs=F(Ta.entries),Bs=Qa.aTypedArray,Us=Qa.exportTypedArrayMethod,Gs=Ds&&Ds.prototype,Hs=!j((function(){Gs[Ns].call([1])})),Vs=!!Gs&&Gs.values&&Gs[Ns]===Gs.values&&"values"===Gs.values.name,qs=function(){return Fs(Bs(this))};Us("entries",(function(){return zs(Bs(this))}),Hs),Us("keys",(function(){return Ws(Bs(this))}),Hs),Us("values",qs,Hs||!Vs,{name:"values"}),Us(Ns,qs,Hs||!Vs,{name:"values"});var Zs=Qa.aTypedArray,Ys=Qa.exportTypedArrayMethod,$s=F([].join);Ys("join",(function(t){return $s(Zs(this),t)}));var Ks=Math.min,Qs=[].lastIndexOf,Xs=!!Qs&&1/[1].lastIndexOf(1,-0)<0,Js=Ai("lastIndexOf"),tc=Xs||!Js?function(t){if(Xs)return Fr(Qs,this,arguments)||0;var e=ke(this),r=We(e),n=r-1;for(arguments.length>1&&(n=Ks(n,Le(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Qs,ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Fr(tc,ec(this),e>1?[t,arguments[1]]:[t])}));var rc=Ei.map,nc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("map",(function(t){return rc(nc(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Es(t))(e)}))}));var oc=TypeError,ic=function(t){return function(e,r,n,o){Nt(r);var i=G(e),a=Te(i),u=We(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw oc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},ac={left:ic(!1),right:ic(!0)},uc=ac.left,sc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return uc(sc(this),t,e,e>1?arguments[1]:void 0)}));var cc=ac.right,fc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return cc(fc(this),t,e,e>1?arguments[1]:void 0)}));var lc=Qa.aTypedArray,hc=Qa.exportTypedArrayMethod,pc=Math.floor;hc("reverse",(function(){for(var t,e=lc(this).length,r=pc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var vc=O.RangeError,dc=O.Int8Array,yc=dc&&dc.prototype,gc=yc&&yc.set,mc=Qa.aTypedArray,xc=Qa.exportTypedArrayMethod,bc=!j((function(){var t=new Uint8ClampedArray(2);return jt(gc,t,{length:1,0:3},1),3!==t[1]})),wc=bc&&Qa.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new dc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));xc("set",(function(t){mc(this);var e=es(arguments.length>1?arguments[1]:void 0,1),r=G(t);if(bc)return jt(gc,this,r,e);var n=this.length,o=We(r),i=0;if(o+e>n)throw vc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!bc||wc);var Ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Ur(Ec(this),t,e),n=Es(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var Ac=Ei.some,Oc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("some",(function(t){return Ac(Oc(this),t,arguments.length>1?arguments[1]:void 0)}));var Sc=Math.floor,Tc=function(t,e){var r=t.length,n=Sc(r/2);return r<8?kc(t,e):Ic(t,Tc(yu(t,0,n),e),Tc(yu(t,n),e),e)},kc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ic=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},jc=Tc,Pc=rt.match(/firefox\\/(\\d+)/i),_c=!!Pc&&+Pc[1],Mc=/MSIE|Trident/.test(rt),Lc=rt.match(/AppleWebKit\\/(\\d+)\\./),Rc=!!Lc&&+Lc[1],Cc=Qa.aTypedArray,Nc=Qa.exportTypedArrayMethod,Dc=O.Uint16Array,Fc=Dc&&F(Dc.prototype.sort),Wc=!(!Fc||j((function(){Fc(new Dc(2),null)}))&&j((function(){Fc(new Dc(2),{})}))),zc=!!Fc&&!j((function(){if(ut)return ut<74;if(_c)return _c<67;if(Mc)return!0;if(Rc)return Rc<602;var t,e,r=new Dc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Fc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Nc("sort",(function(t){return void 0!==t&&Nt(t),zc?Fc(this,t):jc(Cc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!zc||Wc);var Bc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("subarray",(function(t,e){var r=Bc(this),n=r.length,o=Ne(t,n);return new(Es(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Fe((void 0===e?n:Ne(e,n))-o))}));var Uc=O.Int8Array,Gc=Qa.aTypedArray,Hc=Qa.exportTypedArrayMethod,Vc=[].toLocaleString,qc=!!Uc&&j((function(){Vc.call(new Uc(1))}));Hc("toLocaleString",(function(){return Fr(Vc,qc?Ur(Gc(this)):Gc(this),Ur(arguments))}),j((function(){return[1,2].toLocaleString()!=new Uc([1,2]).toLocaleString()}))||!j((function(){Uc.prototype.toLocaleString.call([1,2])})));var Zc=Qa.exportTypedArrayMethod,Yc=O.Uint8Array,$c=Yc&&Yc.prototype||{},Kc=[].toString,Qc=F([].join);j((function(){Kc.call({})}))&&(Kc=function(){return Qc(this)});var Xc=$c.toString!=Kc;Zc("toString",Kc,Xc);var Jc,tf,ef=String,rf=function(t){if("Symbol"===xe(t))throw TypeError("Cannot convert a Symbol value to a string");return ef(t)},nf=function(){var t=kt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},of=O.RegExp,af=j((function(){var t=of("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),uf=af||j((function(){return!of("a","y").sticky})),sf={BROKEN_CARET:af||j((function(){var t=of("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:uf,UNSUPPORTED_Y:af},cf=O.RegExp,ff=j((function(){var t=cf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),lf=O.RegExp,hf=j((function(){var t=lf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),pf=pe.get,vf=I("native-string-replace",String.prototype.replace),df=RegExp.prototype.exec,yf=df,gf=F("".charAt),mf=F("".indexOf),xf=F("".replace),bf=F("".slice),wf=(tf=/b*/g,jt(df,Jc=/a/,"a"),jt(df,tf,"a"),0!==Jc.lastIndex||0!==tf.lastIndex),Ef=sf.BROKEN_CARET,Af=void 0!==/()??/.exec("")[1];(wf||Af||Ef||ff||hf)&&(yf=function(t){var e,r,n,o,i,a,u,s=this,c=pf(s),f=rf(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=jt(yf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=Ef&&s.sticky,v=jt(nf,s),d=s.source,y=0,g=f;if(p&&(v=xf(v,"y",""),-1===mf(v,"g")&&(v+="g"),g=bf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==gf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),Af&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),wf&&(n=s.lastIndex),o=jt(df,p?r:s,g),p?o?(o.input=bf(o.input,y),o[0]=bf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:wf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),Af&&o&&o.length>1&&jt(vf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Qi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var Of=yf;ar({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Sf,Tf=vt("species"),kf=RegExp.prototype,If=function(t,e,r,n){var o=vt(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Tf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=F(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=F(t),s=e.exec;return s===Of||s===kf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));de(String.prototype,t,s[0]),de(kf,o,s[1])}n&&ie(kf[o],"sham",!0)},jf=F("".charAt),Pf=F("".charCodeAt),_f=F("".slice),Mf=function(t){return function(e,r){var n,o,i=rf(B(e)),a=Le(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Pf(i,a))<55296||n>56319||a+1===u||(o=Pf(i,a+1))<56320||o>57343?t?jf(i,a):n:t?_f(i,a,a+2):o-56320+(n-55296<<10)+65536}},Lf={codeAt:Mf(!1),charAt:Mf(!0)},Rf=Lf.charAt,Cf=function(t,e,r){return e+(r?Rf(t,e).length:1)},Nf=Math.floor,Df=F("".charAt),Ff=F("".replace),Wf=F("".slice),zf=/\\$([$&\'`]|\\d{1,2}|<[^>]*>)/g,Bf=/\\$([$&\'`]|\\d{1,2})/g,Uf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Bf;return void 0!==o&&(o=G(o),s=zf),Ff(i,s,(function(i,s){var c;switch(Df(s,0)){case"$":return"$";case"&":return t;case"`":return Wf(e,0,r);case"\'":return Wf(e,a);case"<":c=o[Wf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Nf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Df(s,1):n[l-1]+Df(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Gf=TypeError,Hf=function(t,e){var r=t.exec;if(J(r)){var n=jt(r,t,e);return null!==n&&kt(n),n}if("RegExp"===D(t))return jt(Of,t,e);throw Gf("RegExp#exec called on incompatible receiver")},Vf=vt("replace"),qf=Math.max,Zf=Math.min,Yf=F([].concat),$f=F([].push),Kf=F("".indexOf),Qf=F("".slice),Xf="$0"==="a".replace(/./,"$0"),Jf=!!/./[Vf]&&""===/./[Vf]("a","$0");function tl(t){this.message=t}If("replace",(function(t,e,r){var n=Jf?"$":"$0";return[function(t,r){var n=B(this),o=W(t)?void 0:Dt(t,Vf);return o?jt(o,t,n,r):jt(e,rf(n),t,r)},function(t,o){var i=kt(this),a=rf(t);if("string"==typeof o&&-1===Kf(o,n)&&-1===Kf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=J(o);s||(o=rf(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Hf(i,a);if(null===h)break;if($f(l,h),!c)break;""===rf(h[0])&&(i.lastIndex=Cf(a,Fe(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=rf((h=l[y])[0]),m=qf(Zf(Le(h.index),a.length),0),x=[],b=1;b<h.length;b++)$f(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Yf([g],x,m,a);void 0!==w&&$f(E,w);var A=rf(Fr(o,void 0,E))}else A=Uf(g,a,m,x,w,o);m>=d&&(v+=Qf(a,d,m)+A,d=m+g.length)}return v+Qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Xf||Jf),tl.prototype=new Error,tl.prototype.name="InvalidCharacterError",ar({global:!0,forced:O.globalThis!==O},{globalThis:O}),Sf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Sf.devicePixelRatio;var el=TypeError,rl=Object.getOwnPropertyDescriptor,nl=gt&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(yi(t)&&!rl(t,"length").writable)throw el("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},ol=TypeError,il=function(t){if(t>9007199254740991)throw ol("Maximum allowed index exceeded");return t},al=Pi("splice"),ul=Math.max,sl=Math.min;ar({target:"Array",proto:!0,forced:!al},{splice:function(t,e){var r,n,o,i,a,u,s=G(this),c=We(s),f=Ne(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=sl(ul(Le(e),0),c-f)),il(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&Ii(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ls(s,u);for(i=c;i>c-n+r;i--)ls(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ls(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return nl(s,c-n+r),o}});var cl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),fl=Object.assign,ll=Object.defineProperty,hl=F([].concat),pl=!fl||j((function(){if(gt&&1!==fl({b:1},fl(ll({},"a",{enumerable:!0,get:function(){ll(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=fl({},t)[r]||"abcdefghijklmnopqrst"!=Hi(fl({},e)).join("")}))?function(t,e){for(var r=G(t),n=arguments.length,o=1,i=Ye.f,a=Ae.f;n>o;)for(var u,s=Te(arguments[o++]),c=i?hl(Hi(s),i(s)):Hi(s),f=c.length,l=0;f>l;)u=c[l++],gt&&!jt(a,s,u)||(r[u]=s[u]);return r}:fl;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==pl},{assign:pl});var vl=Ei.findIndex,dl=!0;"findIndex"in[]&&Array(1).findIndex((function(){dl=!1})),ar({target:"Array",proto:!0,forced:dl},{findIndex:function(t){return vl(this,t,arguments.length>1?arguments[1]:void 0)}}),oa("findIndex");var yl=Lf.charAt,gl=pe.set,ml=pe.getterFor("String Iterator");wa(String,"String",(function(t){gl(this,{type:"String Iterator",string:rf(t),index:0})}),(function(){var t,e=ml(this),r=e.string,n=e.index;return n>=r.length?Ea(void 0,!0):(t=yl(r,n),e.index+=t.length,Ea(t,!1))}));var xl=Ze.f,bl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],wl={f:function(t){return bl&&"Window"==D(t)?function(t){try{return xl(t)}catch(t){return yu(bl)}}(t):xl(ke(t))}},El=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Al=Object.isExtensible,Ol=j((function(){Al(1)}))||El?function(t){return!!xt(t)&&((!El||"ArrayBuffer"!=D(t))&&(!Al||Al(t)))}:Al,Sl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),Tl=b((function(t){var e=qt.f,r=!1,n=$("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ze.f,e=F([].splice),o={};o[n]=1,t(o).length&&(Ze.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:wl.f}))},fastKey:function(t,e){if(!xt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!V(t,n)){if(!Ol(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!V(t,n)){if(!Ol(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return Sl&&r&&Ol(t)&&!V(t,n)&&i(t),t}};se[n]=!0})),kl=(Tl.enable,Tl.fastKey,Tl.getWeakData,Tl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=F(u[t]);de(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!xt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(or(t,!J(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),Tl.enable();else if(or(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=_o((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){gr(t,u);var r=ss(new a,t,s);return W(e)||To(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ar({global:!0,constructor:!0,forced:s!=a},c),pr(s,t),o||r.setStrong(s,t,n),s}),Il=Tl.getWeakData,jl=pe.set,Pl=pe.getterFor,_l=Ei.find,Ml=Ei.findIndex,Ll=F([].splice),Rl=0,Cl=function(t){return t.frozen||(t.frozen=new Nl)},Nl=function(){this.entries=[]},Dl=function(t,e){return _l(t.entries,(function(t){return t[0]===e}))};Nl.prototype={get:function(t){var e=Dl(this,t);if(e)return e[1]},has:function(t){return!!Dl(this,t)},set:function(t,e){var r=Dl(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Ml(this.entries,(function(e){return e[0]===t}));return~e&&Ll(this.entries,e,1),!!~e}};var Fl,Wl={getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),jl(t,{type:e,id:Rl++,frozen:void 0}),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Pl(e),u=function(t,e,r){var n=a(t),o=Il(kt(e),!0);return!0===o?Cl(n).set(e,r):o[n.id]=r,t};return ru(i,{delete:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).delete(t):r&&V(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).has(t):r&&V(r,e.id)}}),ru(i,r?{get:function(t){var e=a(this);if(xt(t)){var r=Il(t);return!0===r?Cl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},zl=pe.enforce,Bl=!O.ActiveXObject&&"ActiveXObject"in O,Ul=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Gl=kl("WeakMap",Ul,Wl);if(ne&&Bl){Fl=Wl.getConstructor(Ul,"WeakMap",!0),Tl.enable();var Hl=Gl.prototype,Vl=F(Hl.delete),ql=F(Hl.has),Zl=F(Hl.get),Yl=F(Hl.set);ru(Hl,{delete:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),Vl(this,t)||e.frozen.delete(t)}return Vl(this,t)},has:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)||e.frozen.has(t)}return ql(this,t)},get:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)?Zl(this,t):e.frozen.get(t)}return Zl(this,t)},set:function(t,e){if(xt(t)&&!Ol(t)){var r=zl(this);r.frozen||(r.frozen=new Fl),ql(this,t)?Yl(this,t,e):r.frozen.set(t,e)}else Yl(this,t,e);return this}})}var $l=vt("iterator"),Kl=vt("toStringTag"),Ql=Ta.values,Xl=function(t,e){if(t){if(t[$l]!==Ql)try{ie(t,$l,Ql)}catch(e){t[$l]=Ql}if(t[Kl]||ie(t,Kl,e),hi[e])for(var r in Ta)if(t[r]!==Ta[r])try{ie(t,r,Ta[r])}catch(e){t[r]=Ta[r]}}};for(var Jl in hi)Xl(O[Jl]&&O[Jl].prototype,Jl);Xl(di,"DOMTokenList");var th,eh,rh,nh,oh=new WeakMap,ih=function(){function t(){i(this,t),oh.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=oh.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),oh.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=oh.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=oh.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),ah=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(ih));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var uh=my.getSystemInfoSync();th=uh.screenWidth,eh=uh.screenHeight,rh=uh.windowWidth,nh=uh.windowHeight}else{var sh=Sf.innerWidth,ch=Sf.innerHeight;th=sh,eh=ch,rh=sh,nh=ch}var fh={width:th,height:eh,availWidth:rh,availHeight:nh,availLeft:0,availTop:0},lh=fh.availWidth,hh=fh.availHeight,ph={style:[]};function vh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function dh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:lh+"px",height:hh+"px",margin:"0px",padding:"0px"})}function yh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=lh,t.clientHeight=hh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function gh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=lh,t.offsetHeight=hh)}function mh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=lh,t.scrollHeight=hh)}function xh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function bh(){}var wh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=bh,t.blur=bh,t.insertBefore=bh,t.appendChild=bh,t.removeChild=bh,t.remove=bh,t.innerHTML="",t.tagName=n.toUpperCase(),vh(h(t),o),dh(h(t)),xh(h(t)),yh(h(t)),gh(h(t)),mh(h(t)),t}return u(r)}(ah),Eh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wh)),Ah={};function Oh(){return Ah}var Sh=u((function t(){i(this,t);var e=Oh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),vh(r),xh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),Th={href:"",protocol:"",host:""},kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),Ih=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),jh={},Ph={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Th,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Sh:"video"===t?new Eh:new wh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){jh[t]||(jh[t]=[]),jh[t].push(e)},removeEventListener:function(t,e){var r=jh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=jh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new cl(t)}};Ph.documentElement=new Ih,Ph.head=new wh("head"),Ph.body=new kh,If("match",(function(t,e,r){return[function(e){var r=B(this),n=W(e)?void 0:Dt(e,t);return n?jt(n,e,r):new RegExp(e)[t](rf(r))},function(t){var n=kt(this),o=rf(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Hf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Hf(n,o));){var f=rf(u[0]);s[c]=f,""===f&&(n.lastIndex=Cf(o,Fe(n.lastIndex),a)),c++}return 0===c?null:s}]}));var _h,Mh,Lh=vt("isConcatSpreadable"),Rh=ut>=51||!j((function(){var t=[];return t[Lh]=!1,t.concat()[0]!==t})),Ch=Pi("concat"),Nh=function(t){if(!xt(t))return!1;var e=t[Lh];return void 0!==e?!!e:yi(t)};if(ar({target:"Array",proto:!0,arity:1,forced:!Rh||!Ch},{concat:function(t){var e,r,n,o,i,a=G(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Nh(i=-1===e?a:arguments[e]))for(o=We(i),il(s+o),r=0;r<o;r++,s++)r in i&&Ii(u,s,i[r]);else il(s+1),Ii(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Dh=my.getSystemInfoSync();_h=Dh.system,Dh.platform,Dh.language}else{var Fh={versions:(Mh=Sf.navigator.userAgent,{trident:Mh.indexOf("Trident")>-1,presto:Mh.indexOf("Presto")>-1,webKit:Mh.indexOf("AppleWebKit")>-1,gecko:Mh.indexOf("Gecko")>-1&&-1===Mh.indexOf("KHTML"),mobile:!!Mh.match(/AppleWebKit.*Mobile.*/),ios:!!Mh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Mh.indexOf("Android")>-1||Mh.indexOf("Linux")>-1,iPhone:Mh.indexOf("iPhone")>-1,iPad:Mh.indexOf("iPad")>-1,webApp:-1===Mh.indexOf("Safari"),weixin:Mh.indexOf("MicroMessenger")>-1,qq:" qq"===Mh.match(/\\sQQ/i)}),language:(Sf.navigator.browserLanguage||Sf.navigator.language).toLowerCase()};Fh.versions.android?"android":Fh.versions.trident?"IE":Fh.versions.presto?"Opera":Fh.versions.webKit?"webKit":Fh.versions.gecko?"Firefox":Fh.versions.mobile?"mobile":Fh.versions.ios?"ios":Fh.versions.iPhone?"iPhone":Fh.versions.iPad?"ipad":Fh.versions.webApp?"webApp":Fh.versions.weixin?"weixin":Fh.versions.qq&&"qq",_h=Sf.navigator.userAgent,Fh.language}_h.toLowerCase().indexOf("android");cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Wh=qt.f,zh=Tl.fastKey,Bh=pe.set,Uh=pe.getterFor;kl("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),Bh(t,{type:e,index:Qi(null),first:void 0,last:void 0,size:0}),gt||(t.size=0),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Uh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=zh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),gt?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=zh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return ru(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,gt?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),gt?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=zr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),ru(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),gt&&Wh(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Uh(e),i=Uh(n);wa(t,e,(function(t,e){Bh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?Ea("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,Ea(void 0,!0))}),r?"entries":"values",!r,!0),dr(e)}});var Gh=F([].join),Hh=Te!=Object,Vh=Ai("join",",");ar({target:"Array",proto:!0,forced:Hh||!Vh},{join:function(t){return Gh(ke(this),void 0===t?",":t)}});var qh=j((function(){Hi(1)}));ar({target:"Object",stat:!0,forced:qh},{keys:function(t){return Hi(G(t))}});var Zh=new Map,Yh=new Map,$h=new Map,Kh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Zh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=$h.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Yh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Yh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Zh.get("requestHeader");r[t]=e,Zh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(ih);s(Kh,"UNSEND",void 0),s(Kh,"OPENED",void 0),s(Kh,"HEADERS_RECEIVED",void 0),s(Kh,"LOADING",void 0),s(Kh,"DONE",void 0),Kh.UNSEND=0,Kh.OPENED=1,Kh.HEADERS_RECEIVED=2,Kh.LOADING=3,Kh.DONE=4;var Qh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Xh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Jh=Qh||Xh;Jh||Sf.XMLHttpRequest,Jh||Sf.location;function tp(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ep=Ei.filter,rp=Pi("filter");function np(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function op(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ip(t){return t.filter?[1]:[0]}function ap(t,e){return[e]}ar({target:"Array",proto:!0,forced:!rp},{filter:function(t){return ep(this,t,arguments.length>1?arguments[1]:void 0)}});var up=cp,sp=cp;function cp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=fp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=fp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(wp(s));for(c.sort(gp),o=0;o<c.length;o++)r=mp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return hp(h,p,r,n,o,c,0),p}function fp(t,e,r,n,o){var i,a;if(o===Rp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=_p(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=_p(i,t[i],t[i+1],a);return a&&Sp(a,a.next)&&(Mp(a),a=a.next),a}function lp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Sp(n,n.next)&&0!==Op(n.prev,n,n.next))n=n.next;else{if(Mp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function hp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=bp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?vp(t,n,o,i):pp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Mp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?hp(t=dp(lp(t),e,r),e,r,n,o,i,2):2===a&&yp(t,e,r,n,o,i):hp(lp(t),e,r,n,o,i,1);break}}}function pp(t){var e=t.prev,r=t,n=t.next;if(Op(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&Ep(o,u,i,s,a,c,v.x,v.y)&&Op(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(Op(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=bp(p,v,e,r,n),m=bp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function dp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Sp(o,i)&&Tp(o,n,n.next,i)&&jp(o,i)&&jp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Mp(n),Mp(n.next),n=t=i),n=n.next}while(n!==t);return lp(n)}function yp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ap(a,u)){var s=Pp(a,u);return a=lp(a,a.next),s=lp(s,s.next),hp(a,e,r,n,o,i,0),void hp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function gp(t,e){return t.x-e.x}function mp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&Ep(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),jp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&xp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Pp(r,t);return lp(n,n.next),lp(r,r.next)}function xp(t,e){return Op(t.prev,t,e.prev)<0&&Op(e.next,t,t.next)<0}function bp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ep(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ap(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Tp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(jp(t,e)&&jp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Op(t.prev,t,e.prev)||Op(t,e.prev,e))||Sp(t,e)&&Op(t.prev,t,t.next)>0&&Op(e.prev,e,e.next)>0)}function Op(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sp(t,e){return t.x===e.x&&t.y===e.y}function Tp(t,e,r,n){var o=Ip(Op(t,e,r)),i=Ip(Op(t,e,n)),a=Ip(Op(r,n,t)),u=Ip(Op(r,n,e));return o!==i&&a!==u||(!(0!==o||!kp(t,r,e))||(!(0!==i||!kp(t,n,e))||(!(0!==a||!kp(r,t,n))||!(0!==u||!kp(r,e,n)))))}function kp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ip(t){return t>0?1:t<0?-1:0}function jp(t,e){return Op(t.prev,t,t.next)<0?Op(t,e,t.next)>=0&&Op(t,t.prev,e)>=0:Op(t,e,t.prev)<0||Op(t,t.next,e)<0}function Pp(t,e){var r=new Lp(t.i,t.x,t.y),n=new Lp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function _p(t,e,r,n){var o=new Lp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Mp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}cp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Rp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Rp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},cp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},up.default=sp;var Cp=F(1..valueOf),Np=F("".replace),Dp="[\\t\\n\\v\\f\\r                　\\u2028\\u2029\\ufeff]",Fp=RegExp("^"+Dp+Dp+"*"),Wp=RegExp(Dp+Dp+"*$"),zp=function(t){return function(e){var r=rf(B(e));return 1&t&&(r=Np(r,Fp,"")),2&t&&(r=Np(r,Wp,"")),r}},Bp={start:zp(1),end:zp(2),trim:zp(3)},Up=Ze.f,Gp=je.f,Hp=qt.f,Vp=Bp.trim,qp=O.Number,Zp=qp.prototype,Yp=O.TypeError,$p=F("".slice),Kp=F("".charCodeAt),Qp=function(t){var e=Bt(t,"number");return"bigint"==typeof e?e:Xp(e)},Xp=function(t){var e,r,n,o,i,a,u,s,c=Bt(t,"number");if(Mt(c))throw Yp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Vp(c),43===(e=Kp(c,0))||45===e){if(88===(r=Kp(c,2))||120===r)return NaN}else if(48===e){switch(Kp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=$p(c,2)).length,u=0;u<a;u++)if((s=Kp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(or("Number",!qp(" 0o1")||!qp("0b1")||qp("+0x1"))){for(var Jp,tv=function(t){var e=arguments.length<1?0:qp(Qp(t)),r=this;return Pt(Zp,r)&&j((function(){Cp(r)}))?ss(Object(e),r,tv):e},ev=gt?Up(qp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),rv=0;ev.length>rv;rv++)V(qp,Jp=ev[rv])&&!V(tv,Jp)&&Hp(tv,Jp,Gp(qp,Jp));tv.prototype=Zp,Zp.constructor=tv,de(O,"Number",tv,{constructor:!0})}var nv=RangeError,ov=RangeError,iv=String,av=Math.floor,uv=F((function(t){var e=rf(B(this)),r="",n=Le(t);if(n<0||n==1/0)throw nv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),sv=F("".slice),cv=F(1..toFixed),fv=function(t,e,r){return 0===e?r:e%2==1?fv(t,e-1,r*t):fv(t*t,e/2,r)},lv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=av(o/1e7)},hv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=av(n/e),n=n%e*1e7},pv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=iv(t[e]);r=""===r?n:r+uv("0",7-n.length)+n}return r},vv=j((function(){return"0.000"!==cv(8e-5,3)||"1"!==cv(.9,0)||"1.25"!==cv(1.255,2)||"1000000000000000128"!==cv(0xde0b6b3a7640080,0)}))||!j((function(){cv({})}));function dv(t){return"number"==typeof t}function yv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ar({target:"Number",proto:!0,forced:vv},{toFixed:function(t){var e,r,n,o,i=Cp(this),a=Le(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw ov("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return iv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*fv(2,69,1))-69)<0?i*fv(2,-e,1):i/fv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(lv(u,0,r),n=a;n>=7;)lv(u,1e7,0),n-=7;for(lv(u,fv(10,n,1),0),n=e-1;n>=23;)hv(u,1<<23),n-=23;hv(u,1<<n),lv(u,1,1),hv(u,2),c=pv(u)}else lv(u,0,r),lv(u,1<<-e,0),c=pv(u)+uv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+uv("0",a-o)+c:sv(c,0,o-a)+"."+sv(c,o-a)):s+c}});var gv,mv=/"/g,xv=F("".replace);ar({target:"String",proto:!0,forced:(gv="sub",j((function(){var t=""[gv](\'"\');return t!==t.toLowerCase()||t.split(\'"\').length>3})))},{sub:function(){return t="sub",e="",r="",n=rf(B(this)),o="<"+t,""!==e&&(o+=" "+e+\'="\'+xv(rf(r),mv,"&quot;")+\'"\'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var bv=RegExp.prototype,wv=Kt.PROPER,Ev=RegExp.prototype.toString,Av=j((function(){return"/a/b"!=Ev.call({source:"a",flags:"b"})})),Ov=wv&&"toString"!=Ev.name;(Av||Ov)&&de(RegExp.prototype,"toString",(function(){var t=kt(this);return"/"+rf(t.source)+"/"+rf(function(t){var e=t.flags;return void 0!==e||"flags"in bv||V(t,"flags")||!Pt(bv,t)?e:jt(nf,t)}(t))}),{unsafe:!0});var Sv="undefined"!=typeof Float32Array?Float32Array:Array;function Tv(){var t=new Sv(2);return Sv!=Float32Array&&(t[0]=0,t[1]=0),t}function kv(t,e){var r=new Sv(2);return r[0]=t,r[1]=e,r}function Iv(t,e){return t[0]=e[0],t[1]=e[1],t}function jv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _v(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Mv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lv,Rv=Pv,Cv=(Lv=Tv(),Tv()),Nv=(Tv(),Tv()),Dv=Tv(),Fv=Tv();function Wv(t,e,r,n,o){return jv(t,r,n),_v(t,t),[o/Mv(e=kv(-t[1],t[0]),kv(-r[1],r[0])),e]}function zv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Bv(t,e,r){return Rv(t,e,r),_v(t,t),t}function Uv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Gv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",kv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=yv([a[0],a[1]]),g=yv([i[0],i[1]]);Bv(Nv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,h){var x=Tv(),b=Tv();jv(x,this.normal,Nv),jv(b,this.normal,Nv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Uv(n,o)&&jv(o,n,_v(o,Pv(o,n,r))),Bv(Dv,o,n);var w=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),E=w[0],A=w[1],O=Mv(Fv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Iv(this.normal,A),s+=2),this.lastFlip=O}else{if(zv(this.normal,Nv),h){var T=Tv(),k=Tv();Rv(k,Nv,this.normal),jv(T,Nv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=yv([n[0],n[1]]),f=yv([r[0],r[1]]);Bv(Nv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=yv([o[0],o[1]]);Uv(c,h)&&jv(h,c,_v(h,Pv(h,c,f))),Bv(Dv,h,c);var p=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),v=p[0],g=p[1];Mv(Fv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Iv(this.normal,g),i+=2,this.lastFlip=-1}else zv(this.normal,Nv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=yv([n[0],n[1]]),h=yv([r[0],r[1]]);Bv(Nv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,c){var v=Tv(),g=Tv();jv(v,this.normal,Nv),jv(g,this.normal,Nv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=yv([o[0],o[1]]);Uv(l,m)&&jv(m,l,_v(m,Pv(m,l,h))),Bv(Dv,m,l);var x=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),b=x[0],w=x[1],E=Mv(Fv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Iv(this.normal,w),i+=2),this.lastFlip=E}else{if(zv(this.normal,Nv),c){var O=Tv(),S=Tv();Rv(S,Nv,this.normal),jv(O,Nv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Hv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Gv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Vv(t){var e=function(t){if(dv(t[0]))return t;if(dv(t[0][0]))throw new Error("当前数据不支持标注");if(dv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("当前数据不支持标注")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function qv(t){var e=t.coordinates,r=up.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:up(n,i,o),vertices:n,size:o}}var Zv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Hv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Yv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Vv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Zv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$v=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Yv);function Kv(t){return Qv.apply(this,arguments)}function Qv(){return(Qv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!$v[n]){t.next=3;break}return t.abrupt("return",$v[n](o));case 3:return t.abrupt("return",Promise.reject(new Error(\'Worker with type "\'.concat(n,\'" non-existent.\'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return fi(Kv),t.WorkerSourceMap=Yv,t.createWorker=fi,t.worker=Kv,t}({});\n');var xx,Sx,Ex=1029,Ax=1028;function Cx(e){switch(e){case"GAODE1.x":case"GAODE2.x":return Ex;case"MAPBOX":case"SIMPLE":return Ax;case"GLOBEL":return Ex;case"L7MAP":default:return Ax}}function Tx(e){var t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)t.push(e.replace(n[0],String.fromCharCode(r)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)t.push(e.replace(n[0],s.toString()));return t}return t.push(e),t}function Mx(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var n=t.x,r=t.y,i=t.z,o=Tx(e);return o[Math.abs(n+r)%o.length].replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}(xx=e.UpdateTileStrategy||(e.UpdateTileStrategy={})).Realtime="realtime",xx.Overlap="overlap",xx.Replace="replace",(Sx=e.LoadTileDataStatus||(e.LoadTileDataStatus={})).Loading="Loading",Sx.Loaded="Loaded",Sx.Failure="Failure",Sx.Cancelled="Cancelled";var kx=jn.includes,Ox=ee((function(){return!Array(1).includes()}));or({target:"Array",proto:!0,forced:Ox},{includes:function(e){return kx(this,e,arguments.length>1?arguments[1]:void 0)}}),Zu("includes");var Px=TypeError,Lx=function(e){if(su(e))throw Px("The method doesn't accept regular expressions");return e},Ix=ze("match"),Rx=le("".indexOf);function Nx(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r];return vr([[a,[i,r],[i,o],[n,o],a]],t.properties,{bbox:e,id:t.id})}or({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Ix]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~Rx(Cr(fe(this)),Cr(Lx(e)),arguments.length>1?arguments[1]:void 0)}});var Dx=q.isFinite,Fx=Number.isFinite||function(e){return"number"==typeof e&&Dx(e)};or({target:"Number",stat:!0},{isFinite:Fx});var Bx;function zx(e){for(;e;){if(e.isLoaded)return e.properties.state|=2,!0;e=e.parent}return!1}function jx(e){e.children.forEach((function(e){e.isLoaded?e.properties.state|=2:jx(e)}))}var Ux=[-1/0,-1/0,1/0,1/0],Vx=(E(Bx={},e.UpdateTileStrategy.Realtime,(function(e){e.forEach((function(e){e.isCurrent&&(e.isVisible=e.isLoaded)}))})),E(Bx,e.UpdateTileStrategy.Overlap,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&!zx(e)&&jx(e)})),e.forEach((function(e){e.isVisible=Boolean(2&e.properties.state)}))})),E(Bx,e.UpdateTileStrategy.Replace,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&zx(e)})),e.slice().sort((function(e,t){return e.z-t.z})).forEach((function(e){e.isVisible=Boolean(2&e.properties.state),e.children.length&&(e.isVisible||1&e.properties.state)?e.children.forEach((function(e){e.properties.state=1})):e.isCurrent&&jx(e)}))})),Bx),Hx=function(){};function Gx(e,t,n){return[Math.floor((e+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function Wx(e,t,n){var r=e/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var Yx=function(e,t,n){var r=D(Wx(e,t,n),2),i=r[0],o=r[1],a=D(Wx(e+1,t+1,n),2),s=a[0];return[i,a[1],s,o]};function Xx(e){var t=e.zoom,n=e.latLonBounds,r=e.maxZoom,i=void 0===r?1/0:r,o=e.minZoom,a=void 0===o?0:o,s=e.zoomOffset,u=void 0===s?0:s,l=e.extent,c=void 0===l?Ux:l,h=Math.ceil(t)+u;if(Number.isFinite(a)&&h<a)return[];Number.isFinite(i)&&h>i&&(h=i);for(var f=D(n,4),p=f[0],d=f[1],v=f[2],g=f[3],m=[Math.max(p,c[0]),Math.max(d,c[1]),Math.min(v,c[2]),Math.min(g,c[3])],y=[],_=D(Gx(m[0],m[1],h),2),b=_[0],x=_[1],S=D(Gx(m[2],m[3],h),2),E=S[0],A=S[1],C=b;C<=E;C++)for(var T=A;T<=x;T++)y.push({x:C,y:T,z:h});var w=(E+b)/2,M=(x+A)/2,k=function(e,t){return Math.abs(e-w)+Math.abs(t-M)};return y.sort((function(e,t){return k(e.x,e.y)-k(t.x,t.y)})),y}var Zx=function(e,t,n){var r=Math.pow(2,n),i=e;return i<0?i+=r:i>r-1&&(i%=r),{warpX:i,warpY:t}},qx=W((function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),Kx=qx.EventEmitter,Qx=function(t){A(i,t);var n,r=I(i);function i(e){var t;b(this,i),E(P(t=r.call(this)),"x",void 0),E(P(t),"y",void 0),E(P(t),"z",void 0),E(P(t),"tileSize",256),E(P(t),"isVisible",!1),E(P(t),"isCurrent",!1),E(P(t),"isVisibleChange",!1),E(P(t),"layerIDList",[]),E(P(t),"loadedLayers",0),E(P(t),"parent",null),E(P(t),"children",[]),E(P(t),"loadedChilds",0),E(P(t),"data",null),E(P(t),"properties",{}),E(P(t),"xhrCancel",void 0),E(P(t),"loadStatus",void 0),E(P(t),"abortController",void 0),E(P(t),"loadDataId",0);var n=e.x,o=e.y,a=e.z,s=e.tileSize;return t.x=n,t.y=o,t.z=a,t.tileSize=s,t}return S(i,[{key:"isLoading",get:function(){return this.loadStatus===e.LoadTileDataStatus.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===e.LoadTileDataStatus.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===e.LoadTileDataStatus.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===e.LoadTileDataStatus.Cancelled}},{key:"isDone",get:function(){return[e.LoadTileDataStatus.Loaded,e.LoadTileDataStatus.Cancelled,e.LoadTileDataStatus.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Yx(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var e=D(this.bounds,4),t=e[0],n=e[1],r=[(e[2]-t)/2,(e[3]-n)/2];return Nx(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}})}},{key:"key",get:function(){return"".concat(this.x,",").concat(this.y,",").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(n=_(g().mark((function t(n){var r,i,o,a,s,u,l,c,h,f,p,d,v,m,y,_;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.getData,i=n.onLoad,o=n.onError,this.loadDataId++,a=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=e.LoadTileDataStatus.Loading,s=null,t.prev=7,l=this.x,c=this.y,h=this.z,f=this.bounds,p=this.tileSize,d=Zx(l,c,h),v=d.warpX,m=d.warpY,y=this.abortController.signal,_={x:v,y:m,z:h,bounds:f,tileSize:p,signal:y},t.next=14,r(_,this);case 14:s=t.sent,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),u=t.t0;case 20:if(a===this.loadDataId){t.next=22;break}return t.abrupt("return");case 22:if(!this.isCancelled||s){t.next=24;break}return t.abrupt("return");case 24:if(!u&&s){t.next=28;break}return this.loadStatus=e.LoadTileDataStatus.Failure,o(u,this),t.abrupt("return");case 28:this.loadStatus=e.LoadTileDataStatus.Loaded,this.data=s,i(this);case 31:case"end":return t.stop()}}),t,this,[[7,17]])}))),function(e){return n.apply(this,arguments)})},{key:"reloadData",value:function(e){this.isLoading&&this.abortLoad(),this.loadData(e)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=e.LoadTileDataStatus.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),i}(Kx),$x=function(){return ia.Date.now()},Jx=/\s/;var eS=function(e){for(var t=e.length;t--&&Jx.test(e.charAt(t)););return t},tS=/^\s+/;var nS=function(e){return e?e.slice(0,eS(e)+1).replace(tS,""):e};var rS=function(e){return null!=e&&"object"==typeof e};var iS=function(e){return"symbol"==typeof e||rS(e)&&"[object Symbol]"==da(e)},oS=/^[-+]0x[0-9a-f]+$/i,aS=/^0b[01]+$/i,sS=/^0o[0-7]+$/i,uS=parseInt;var lS=function(e){if("number"==typeof e)return e;if(iS(e))return NaN;if(va(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=va(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=nS(e);var n=aS.test(e);return n||sS.test(e)?uS(e.slice(2),n?2:8):oS.test(e)?NaN:+e},cS=Math.max,hS=Math.min;var fS=function(e,t,n){var r,i,o,a,s,u,l=0,c=!1,h=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,o=i;return r=i=void 0,l=t,a=e.apply(o,n)}function d(e){return l=e,s=setTimeout(g,t),c?p(e):a}function v(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-l>=o}function g(){var e=$x();if(v(e))return m(e);s=setTimeout(g,function(e){var n=t-(e-u);return h?hS(n,o-(e-l)):n}(e))}function m(e){return s=void 0,f&&r?p(e):(r=i=void 0,a)}function y(){var e=$x(),n=v(e);if(r=arguments,i=this,u=e,n){if(void 0===s)return d(u);if(h)return clearTimeout(s),s=setTimeout(g,t),p(u)}return void 0===s&&(s=setTimeout(g,t)),a}return t=lS(t)||0,va(n)&&(c=!!n.leading,o=(h="maxWait"in n)?cS(lS(n.maxWait)||0,t):o,f="trailing"in n?!!n.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=u=i=s=void 0},y.flush=function(){return void 0===s?a:m($x())},y};var pS=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return va(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),fS(e,t,{leading:r,maxWait:t,trailing:i})},dS=function(e,t,n,r){try{return r?t($e(n)[0],n[1]):t(n)}catch(t){Do(e,"throw",t)}},vS=Array,gS=function(e){var t=de(e),n=yn(this),r=arguments.length,i=r>1?arguments[1]:void 0,o=void 0!==i;o&&(i=Qt(i,r>2?arguments[2]:void 0));var a,s,u,l,c,h,f=Io(t),p=0;if(!f||this===vS&&Po(f))for(a=un(t),s=n?new this(a):vS(a);a>p;p++)h=o?i(t[p],p):t[p],uu(s,p,h);else for(c=(l=No(t,f)).next,s=n?new this:[];!(u=et(c,l)).done;p++)h=o?dS(l,i,[u.value,p],!0):u.value,uu(s,p,h);return s.length=p,s},mS=!Wo((function(e){Array.from(e)}));or({target:"Array",stat:!0,forced:mS},{from:gS});var yS,_S=function(t){A(r,t);var n=I(r);function r(t){var i;return b(this,r),E(P(i=n.call(this)),"currentTiles",[]),E(P(i),"options",void 0),E(P(i),"cacheTiles",new Map),E(P(i),"lastViewStates",void 0),E(P(i),"throttleUpdate",pS((function(e,t){i.update(e,t)}),16)),E(P(i),"onTileLoad",(function(e){i.emit("tile-loaded",e),i.updateTileVisible()})),E(P(i),"onTileError",(function(e,t){i.emit("tile-error",{error:e,tile:t}),i.updateTileVisible()})),E(P(i),"onTileUnload",(function(e){i.emit("tile-unload",e)})),i.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Ux,getTileData:Hx,updateStrategy:e.UpdateTileStrategy.Replace},i.updateOptions(t),i}return S(r,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(e){return e.isDone}))}},{key:"tiles",get:function(){return Array.from(this.cacheTiles.values()).sort((function(e,t){return e.z-t.z}))}},{key:"updateOptions",value:function(e){var t=void 0===e.minZoom?this.options.minZoom:Math.ceil(e.minZoom),n=void 0===e.maxZoom?this.options.maxZoom:Math.floor(e.maxZoom);this.options=v(v(v({},this.options),e),{},{minZoom:t,maxZoom:n})}},{key:"update",value:function(e,t){var n=this,r=Math.ceil(e);if(!this.lastViewStates||this.lastViewStates.zoom!==r||!function(e,t){return Rm(Nm(e),Nm(t))}(this.lastViewStates.latLonBoundsBuffer,t)){var i=function(e,t){var n=Im(Nm(e),t);return[Math.max(n[0][0],-900),Math.max(n[0][1],-85.0511287798065),Math.min(n[1][0],900),Math.min(n[1][1],85.0511287798065)]}(t,.2);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:i};var o=!1,a=this.getTileIndices(r,i);this.currentTiles=a.map((function(e){var t,r,i=e.x,a=e.y,s=e.z,u=n.getTile(i,a,s);return u?(((null===(t=u)||void 0===t?void 0:t.isFailure)||(null===(r=u)||void 0===r?void 0:r.isCancelled))&&u.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}),u):(u=n.createTile(i,a,s),o=!0,u)})),o&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var e,t=j(this.cacheTiles);try{for(t.s();!(e=t.n()).done;){var n=D(e.value,2),r=n[0],i=n[1];this.currentTiles.includes(i)||(this.cacheTiles.delete(r),this.onTileUnload(i)),this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(e){t.e(e)}finally{t.f()}}},{key:"pruneRequests",value:function(){var e,t=[],n=j(this.cacheTiles.values());try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isLoading&&(r.isCurrent||r.isVisible||t.push(r))}}catch(e){n.e(e)}finally{n.f()}for(;t.length>0;){t.shift().abortLoad()}}},{key:"getTileByLngLat",value:function(e,t,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=Gx(e,t,i);return this.tiles.filter((function(e){return e.key==="".concat(o[0],",").concat(o[1],",").concat(i)}))[0]}},{key:"destroy",value:function(){var e,t=j(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLoading&&n.abortLoad()}}catch(e){t.e(e)}finally{t.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var e,t=this.options.updateStrategy,n=new Map,r=j(this.cacheTiles.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(e){r.e(e)}finally{r.f()}var o,a=j(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(e){a.e(e)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof t?t(u):Vx[t](u);var l=!1;Array.from(this.cacheTiles.values()).forEach((function(e){e.isVisible!==n.get(e.key)?(e.isVisibleChange=!0,l=!0):e.isVisibleChange=!1})),l&&this.emit("tile-update")}},{key:"getTileIndices",value:function(e,t){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset;return Xx({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:e,latLonBounds:t,extent:i})}},{key:"getTileId",value:function(e,t,n){return"".concat(e,",").concat(t,",").concat(n)}},{key:"getTile",value:function(e,t,n){var r=this.getTileId(e,t,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(e,t,n){var r=this.getTileId(e,t,n),i=new Qx({x:e,y:t,z:n,tileSize:this.options.tileSize});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var e=5*this.currentTiles.length;if(this.cacheTiles.size>e){var t,n=j(this.cacheTiles);try{for(n.s();!(t=n.n()).done;){var r=D(t.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=e)break}}catch(e){n.e(e)}finally{n.f()}}}},{key:"rebuildTileTree",value:function(){var e,t=j(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.parent=null,n.children.length=0}}catch(e){t.e(e)}finally{t.f()}var r,i=j(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getNearestAncestor",value:function(e,t,n){for(;n>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),n-=1;var r=this.getTile(e,t,n);if(r)return r}return null}}]),r}(qx);function bS(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=arguments.length>6?arguments[6]:void 0,s=n;return a&&(s=Math.round(n*(o-1))/(o-1)),ES(e,t,s,r||.314,i)}function xS(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function SS(e,t,n){var r,i,o=[t[0]-e[0],t[1]-e[1]],a=(r=o,i=[0,0],Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2))),s=Math.atan2(o[1],o[0]),u=a/2/Math.cos(n),l=s+n;return[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]]}function ES(e,t,n,r,i){if(i===yS["GAODE2.x"]){var o=Om(e[0],e[1]),a=Om(t[0],t[1]),s=SS(o,a,r),u=[o[0],s[0],a[0]],l=[o[1],s[1],a[1]];return[].concat(F(Pm(xS(u,n),xS(l,n))),[0])}var c=SS(e,t,r),h=[e[0],c[0],t[0]],f=[e[1],c[1],t[1]];return[xS(h,n),xS(f,n),0]}function AS(e,t,n,r,i){var o=arguments.length>6?arguments[6]:void 0,a=n;return o&&(a=Math.round(29*n)/29),TS(e,t,a,i)}function CS(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function TS(e,t,n,r){var i=[_r(e[0]),_r(e[1])],o=[_r(t[0]),_r(t[1])];if("GAODE2.x"===r){var a=function(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=Fm(n,[0,0]),i=Math.atan2(n[1],n[0]),o=r/2/Math.cos(.314),a=i+.314;return[o*Math.cos(a)+e[0],o*Math.sin(a)+e[1]]}(i,o),s=[i[0],a[0],o[0]],u=[i[1],a[1],o[1]];return[CS(s,n),CS(u,n),0]}var l=function(e,t){var n=[e[0]-t[0],e[1]-t[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],i=r[1]*r[1]+Math.cos(e[1])*Math.cos(t[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}(i,o);if(Math.abs(l-Math.PI)<.001)return[(1-n)*i[0]+n*o[0],(1-n)*i[1]+n*o[1]];var c=Math.sin((1-n)*l)/Math.sin(l),h=Math.sin(n*l)/Math.sin(l),f=[Math.sin(i[0]),Math.sin(i[1])],p=[Math.cos(i[0]),Math.cos(i[1])],d=[Math.sin(o[0]),Math.sin(o[1])],v=[Math.cos(o[0]),Math.cos(o[1])],g=c*p[1]*p[0]+h*v[1]*v[0],m=c*p[1]*f[0]+h*v[1]*d[0],y=c*f[1]+h*d[1];return[yr(Math.atan2(m,g)),yr(Math.atan2(y,Math.sqrt(g*g+m*m)))]}function wS(e,t,n){return[e[0]*n+t[0]*(1-n),e[1]*n+t[1]*(1-n)]}function MS(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function kS(e,t){var n=t.featureId,r=e.data.dataArray;return"number"==typeof n&&(r=r.filter((function(e){return e._id===n}))),r.map((function(e){var n=function(e,t){var n=t.offset,r=t.shape,i=t.thetaOffset,o=t.mapVersion,a=t.segmentNumber,s=void 0===a?30:a,u=t.autoFit,l=void 0===u||u,c=e.coordinates;if("line"===r)return function(e,t){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=MS(o,a),u=n;n+=s,r.push({p1:o,p2:a,totalDistance:n,distance:s,lastTotalDistance:u})}for(var l,c,h=n*t,f=0;f<r.length;f++){if(r[f].totalDistance>h){var p=r[f].p1,d=wS(r[f].p2,p,(h-r[f].lastTotalDistance)/r[f].distance);l=d[0],c=d[1];break}}return{_lng:l,_lat:c,_height:0}}(c,n);var h,f,p=c[0],d=c[1];h="string"==typeof i?e[i]||0:i;switch(r){case"arc":f=bS;break;case"greatcircle":f=AS;break;default:f=bS}var v=D(f(p,d,n,h,o,s,l),3),g=v[0],m=v[1],y=v[2];return{_lng:g,_lat:m,_height:y}}(e,t);return v(v({},e),n)}))}function OS(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(t){e instanceof HTMLImageElement||Dg(e)?t([e]):function(e,t){var n=e,r=[];if("string"==typeof n)Wg({url:n},(function(e,n){n&&(r.push(n),t(r))}));else{var i=n.length,o=0;n.forEach((function(e){Wg({url:e},(function(e,n){o++,n&&r.push(n),o===i&&t(r)}))}))}}(e,(function(e){t(e)}))}));return{originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}}!function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"}(yS||(yS={}));var PS=LS;function LS(e,t){this.x=e,this.y=t}LS.prototype={clone:function(){return new LS(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},LS.convert=function(e){return e instanceof LS?e:Array.isArray(e)?new LS(e[0],e[1]):e};var IS=RS;function RS(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(NS,this,t)}function NS(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){var n=e.readVarint()+e.pos;for(;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function DS(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}RS.types=["Unknown","Point","LineString","Polygon"],RS.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,r=1,i=0,o=0,a=0,s=[];e.pos<n;){if(i<=0){var u=e.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)o+=e.readSVarint(),a+=e.readSVarint(),1===r&&(t&&s.push(t),t=[]),t.push(new PS(o,a));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&s.push(t),s},RS.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;e.pos<t;){if(r<=0){var c=e.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=e.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=e.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},RS.prototype.toGeoJSON=function(e,t,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*e,s=this.extent*t,u=this.loadGeometry(),l=RS.types[this.type];function c(e){for(var t=0;t<e.length;t++){var n=e[t],r=180-360*(n.y+s)/o;e[t]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];c(u=h);break;case 2:for(r=0;r<u.length;r++)c(u[r]);break;case 3:for(u=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=DS(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}n&&i.push(n);return i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)c(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var f={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var FS=BS;function BS(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(zS,this,t),this.length=this._features.length}function zS(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){var t=null,n=e.readVarint()+e.pos;for(;e.pos<n;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(n))}function jS(e,t,n){if(3===e){var r=new FS(n,n.readVarint()+n.pos);r.length&&(t[r.name]=r)}}BS.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new IS(this._pbf,t,this.extent,this._keys,this._values)};var US=function(e,t){this.layers=e.readFields(jS,{},t)},VS=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,f=n?-1:1,p=e[t+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=l}return(p?-1:1)*a*Math.pow(2,o-r)},HS=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*u-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[n+p]=255&a,p+=d,a/=256,l-=8);e[n+p-d]|=128*v},GS=WS;
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function WS(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}WS.Varint=0,WS.Fixed64=1,WS.Bytes=2,WS.Fixed32=5;var YS="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function XS(e){return e.type===WS.Bytes?e.readVarint()+e.pos:e.pos+1}function ZS(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function qS(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function KS(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function QS(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function $S(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function JS(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function eE(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function tE(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function nE(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function rE(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function iE(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function oE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function aE(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function sE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}WS.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=oE(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=sE(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=oE(this.buf,this.pos)+4294967296*oE(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=oE(this.buf,this.pos)+4294967296*sE(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=VS(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=VS(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,o=n.buf;if(i=o[n.pos++],r=(112&i)>>4,i<128)return ZS(e,r,t);if(i=o[n.pos++],r|=(127&i)<<3,i<128)return ZS(e,r,t);if(i=o[n.pos++],r|=(127&i)<<10,i<128)return ZS(e,r,t);if(i=o[n.pos++],r|=(127&i)<<17,i<128)return ZS(e,r,t);if(i=o[n.pos++],r|=(127&i)<<24,i<128)return ZS(e,r,t);if(i=o[n.pos++],r|=(1&i)<<31,i<128)return ZS(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&YS?function(e,t,n){return YS.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){var r="",i=t;for(;i<n;){var o,a,s,u=e[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==WS.Bytes)return e.push(this.readVarint(t));var n=XS(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==WS.Bytes)return e.push(this.readSVarint());var t=XS(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==WS.Bytes)return e.push(this.readBoolean());var t=XS(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==WS.Bytes)return e.push(this.readFloat());var t=XS(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==WS.Bytes)return e.push(this.readDouble());var t=XS(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==WS.Bytes)return e.push(this.readFixed32());var t=XS(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==WS.Bytes)return e.push(this.readSFixed32());var t=XS(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==WS.Bytes)return e.push(this.readFixed64());var t=XS(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==WS.Bytes)return e.push(this.readSFixed64());var t=XS(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===WS.Varint)for(;this.buf[this.pos++]>127;);else if(t===WS.Bytes)this.pos=this.readVarint()+this.pos;else if(t===WS.Fixed32)this.pos+=4;else{if(t!==WS.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),aE(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),aE(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),aE(this.buf,-1&e,this.pos),aE(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),aE(this.buf,-1&e,this.pos),aE(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&qS(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),HS(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),HS(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&qS(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,WS.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,KS,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,QS,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,eE,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,$S,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,JS,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,tE,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,nE,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,rE,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,iE,t)},writeBytesField:function(e,t){this.writeTag(e,WS.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,WS.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,WS.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,WS.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,WS.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,WS.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,WS.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,WS.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,WS.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,WS.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var uE={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},lE=function(){var e=_(g().mark((function e(t,n,r){var i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Mx(t,n),e.abrupt("return",new Promise((function(e){var t=Hg({url:i},(function(t,r){if(t||!r)e({layers:{}});else{for(var i=new US(new GS(r)),o=0,a=Object.keys(i.layers);o<a.length;o++){for(var s=a[o],u=[],l=i.layers[s],c=0;c<i.layers[s].length;c++){var h=i.layers[s].feature(c).toGeoJSON(n.x,n.y,n.z);u.push(h)}l.features=u}e(i)}}));r.xhrCancel=function(){return t.abort()}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function cE(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function hE(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)fE(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)fE(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)fE(e,t[r][i])}(i),i}function fE(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function pE(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)dE(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)dE(i[l],s);else if("LineString"===o)vE(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],vE(i[l],s,a,!1),e.push(hE(u,"LineString",s,t.properties));return}gE(i,s,a,!1)}else if("Polygon"===o)gE(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)pE(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];gE(i[l],c,a,!0),s.push(c)}}e.push(hE(u,o,s,t.properties))}}function dE(e,t){t.push(mE(e[0])),t.push(yE(e[1])),t.push(0)}function vE(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=mE(e[s][0]),l=yE(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,function e(t,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,l=t[n],c=t[n+1],h=t[r],f=t[r+1],p=n+3;p<r;p+=3){var d=cE(t[p],t[p+1],l,c,h,f);if(d>a)o=p,a=d;else if(d===a){var v=Math.abs(p-s);v<u&&(o=p,u=v)}}a>i&&(o-n>3&&e(t,n,o,i),t[o+2]=a,r-o>3&&e(t,o,r,i))}(t,0,c,n),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function gE(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];vE(e[i],o,n,r),t.push(o)}}function mE(e){return e/360+.5}function yE(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function _E(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],h=c.geometry,f=c.type,p=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(p>=n&&d<r)u.push(c);else if(!(d<n||p>=r)){var v=[];if("Point"===f||"MultiPoint"===f)bE(h,v,n,r,i);else if("LineString"===f)xE(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===f)EE(h,v,n,r,i,!1);else if("Polygon"===f)EE(h,v,n,r,i,!0);else if("MultiPolygon"===f)for(var g=0;g<h.length;g++){var m=[];EE(h[g],m,n,r,i,!0),m.length&&v.push(m)}if(v.length){if(s.lineMetrics&&"LineString"===f){for(g=0;g<v.length;g++)u.push(hE(c.id,f,v[g],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===v.length?(f="LineString",v=v[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===v.length?"Point":"MultiPoint"),u.push(hE(c.id,f,v,c.tags))}}}return u.length?u:null}function bE(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function xE(e,t,n,r,i,o,a){for(var s,u,l=SE(e),c=0===i?CE:TE,h=e.start,f=0;f<e.length-3;f+=3){var p=e[f],d=e[f+1],v=e[f+2],g=e[f+3],m=e[f+4],y=0===i?p:d,_=0===i?g:m,b=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(d-m,2))),y<n?_>n&&(u=c(l,p,d,g,m,n),a&&(l.start=h+s*u)):y>r?_<r&&(u=c(l,p,d,g,m,r),a&&(l.start=h+s*u)):AE(l,p,d,v),_<n&&y>=n&&(u=c(l,p,d,g,m,n),b=!0),_>r&&y<=r&&(u=c(l,p,d,g,m,r),b=!0),!o&&b&&(a&&(l.end=h+s*u),t.push(l),l=SE(e)),a&&(h+=s)}var x=e.length-3;p=e[x],d=e[x+1],v=e[x+2],(y=0===i?p:d)>=n&&y<=r&&AE(l,p,d,v),x=l.length-3,o&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&AE(l,l[0],l[1],l[2]),l.length&&t.push(l)}function SE(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function EE(e,t,n,r,i,o){for(var a=0;a<e.length;a++)xE(e[a],t,n,r,i,o,!1)}function AE(e,t,n,r){e.push(t),e.push(n),e.push(r)}function CE(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function TE(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function wE(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=ME(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(ME(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(ME(o.geometry[s][l],t));i.push(u)}n.push(hE(o.id,a,i,o.tags))}return n}function ME(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function kE(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(OE(l[r],l[r+1],t,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(OE(l[r][i],l[r][i+1],t,o,a,s));u.geometry.push(h)}}return e.transformed=!0,e}function OE(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function PE(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,LE(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function LE(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)IE(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)IE(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)IE(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(f.id=t.id),e.features.push(f)}}function IE(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function RE(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)pE(n,e.features[r],t,r);else"Feature"===e.type?pE(n,e,t):pE(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var n=t.buffer/t.extent,r=e,i=_E(e,1,-1-n,n,0,-1,2,t),o=_E(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=_E(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=wE(i,1).concat(r)),o&&(r=r.concat(wE(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function NE(e,t,n){return 32*((1<<e)*n+t)+e}RE.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},RE.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=NE(t,n,r),f=this.tiles[h];if(!f&&(l>1&&console.time("creation"),f=this.tiles[h]=PE(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,i){if(t===u.maxZoom||t===i)continue;var d=1<<i-t;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(t===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==e.length){l>1&&console.time("clipping");var v,g,m,y,_,b,x=.5*u.buffer/u.extent,S=.5-x,E=.5+x,A=1+x;v=g=m=y=null,_=_E(e,c,n-x,n+E,0,f.minX,f.maxX,u),b=_E(e,c,n+S,n+A,0,f.minX,f.maxX,u),e=null,_&&(v=_E(_,c,r-x,r+E,1,f.minY,f.maxY,u),g=_E(_,c,r+S,r+A,1,f.minY,f.maxY,u),_=null),b&&(m=_E(b,c,r-x,r+E,1,f.minY,f.maxY,u),y=_E(b,c,r+S,r+A,1,f.minY,f.maxY,u),b=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(m||[],t+1,2*n+1,2*r),s.push(y||[],t+1,2*n+1,2*r+1)}}},RE.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=NE(e,t=(t%a+a)%a,n);if(this.tiles[s])return kE(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[NE(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?kE(this.tiles[s],i):null):null};var DE={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function FE(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}var BE=["Unknown","Point","LineString","Polygon"];function zE(e,t,n,r,i){var o,a,s=i.geometry,u=i.type,l=i.tags,c=i.id,h=e*Math.pow(2,r),f=e*t,p=e*n,d=BE[u];function v(e){for(var t=0;t<e.length;t++){var n=e[t];if(n[3])break;var r=180-360*(n[1]+p)/h,i=360*(n[0]+f)/h-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;e[t]=[i,o,0,1]}}switch(u){case 1:var g=[];for(o=0;o<s.length;o++)g[o]=s[o][0];v(s=g);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(s=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=FE(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:l,id:c,tileOrigin:[0,0],coord:""}}var jE=function(){var e=_(g().mark((function e(t,n,r,i){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var o=n.getTile(t.z,t.x,t.y),a=[];o.features.map((function(e){var t=zE(i,r.x,r.y,r.z,e);a.push(t)})),e({layers:{geojsonvt:{features:a}}})})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();var UE,VE=function(e,t,n,r,i,o,a,s){for(var u,l,c=i,h=0,f=!!a&&Qt(a,s);h<r;)h in n&&(u=f?f(n[h],h,t):n[h],o>0&&ln(u)?(l=un(u),c=VE(e,t,u,l,c,o-1)-1):($u(c+1),e[c]=u),c++),h++;return c},HE=VE;function GE(e,t){for(var n=t[0],r=n.width,i=n.height,o=t.map((function(e){return e.rasterData})),a=r*i,s=[],u=JSON.stringify(e),l=0;l<a;l++){var c=JSON.parse(u),h=WE(c,o,l);if("number"==typeof h)s.push(h);else{var f=YE(c);s.push(f)}}return s}function WE(e,t,n){if(2===e.length&&"band"===e[0]&&"number"==typeof e[1])try{return t[e[1]][n]}catch(e){return console.warn("Raster Data err!"),0}e.map((function(r,i){if(Array.isArray(r)&&r.length>0)switch(r[0]){case"band":try{e[i]=t[r[1]][n]}catch(t){console.warn("Raster Data err!"),e[i]=0}break;default:WE(r,t,n)}}))}function YE(e){var t=function(e){var t=D(e,3),n=t[0],r=t[1],i=void 0===r?-1:r,o=t[2],a=void 0===o?-1:o;return void 0===n?(console.warn("Express err!"),["+",0,0]):[n.replace(/\s+/g,""),i,a]}(e),n=t[0],r=t[1],i=t[2];return Array.isArray(r)&&(r=YE(e[1])),Array.isArray(i)&&(i=YE(e[2])),function(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"^":return Math.pow(t,n);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return-1===n?Math.atan(t):Math.atan2(t,n);default:return console.warn("Calculate symbol err! Return default 0"),0}}(n,r,i)}function XE(e,t,n){return ZE.apply(this,arguments)}function ZE(){return(ZE=_(g().mark((function e(t,n,r){var i,o,a,s,u,l,c,h,f,p,d,v,y,_;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return e.next=4,Promise.all(t.map((function(e){var t=e.data,r=e.bands;return n(t,void 0===r?[0]:r)})));case 4:i=(i=e.sent).flat(),o=i[0],a=o.width,s=o.height,l=void 0,c=void 0,h=void 0,e.t0=m(r),e.next="function"===e.t0?13:"object"===e.t0?15:17;break;case 13:return u=r(i),e.abrupt("break",18);case 15:return Array.isArray(r)?u=GE(r,i):(f=qE(r,i),p=KE(f),d=p.data,v=p.channelRMax,y=p.channelGMax,_=p.channelBMax,u=d,l=v,c=y,h=_),e.abrupt("break",18);case 17:u=i[0].rasterData;case 18:return e.abrupt("return",{rasterData:u,width:a,height:s,channelR:l,channelG:c,channelB:h});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qE(e,t){return void 0===e.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),void 0===e.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),void 0===e.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!"),[GE(e.r||["band",0],t),GE(e.g||["band",0],t),GE(e.b||["band",0],t)]}function KE(e){for(var t=e[0],n=e[1],r=e[2],i=[],o=-1/0,a=-1/0,s=-1/0,u=0;u<t.length;u++)i.push(t[u]),o=Math.max(o,t[u]),i.push(n[u]),a=Math.max(a,t[u]),i.push(r[u]),s=Math.max(s,t[u]);return{data:i,channelRMax:o,channelGMax:a,channelBMax:s}}function QE(e,t,n,r){return $E.apply(this,arguments)}function $E(){return($E=_(g().mark((function e(t,n,r,i){var o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,XE(t,n,r);case 2:o=e.sent,a=o.rasterData,s=o.width,u=o.height,0,8e3,i(null,{data:a,width:s,height:u,min:0,max:8e3});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function JE(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function eA(e,t){return Array.isArray(e)?"string"==typeof e[0]?e.map((function(e){return Mx(e,t)})):e.map((function(e){return{url:Mx(e.url,t),bands:e.bands||[0]}})):Mx(e,t)}function tA(e,t){e.xhrCancel=function(){t.map((function(e){e.abort()}))}}or({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=de(this),n=un(t),r=xn(t,0);return r.length=HE(r,t,t,n,0,void 0===e?1:on(e)),r}}),Zu("flat"),function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb"}(UE||(UE={}));var nA=function(){var e=_(g().mark((function e(t,n,r,i,o){var a,s,u,l,c,h;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=n.url,!((a="string"==typeof f?[{url:f,bands:[0]}]:"string"==typeof f[0]?f.map((function(e){return{url:e,bands:[0]}})):f).length>1)){e.next=15;break}return e.next=4,rA(a,n);case 4:if(s=e.sent,u=s.rasterFiles,l=s.xhrList,c=s.errList,tA(t,l),!(c.length>0)){e.next=12;break}return r(c,null),e.abrupt("return");case 12:QE(u,i,o,r),e.next=17;break;case 15:h=Hg(n,(function(e,t){if(e)r(e);else if(t){QE([{data:t,bands:a[0].bands}],i,o,r)}})),tA(t,[h]);case 17:case"end":return e.stop()}var f}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();function rA(e,t){return iA.apply(this,arguments)}function iA(){return(iA=_(g().mark((function e(t,n){var r,i,o,a,s,u,l,c,h,f,p;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<t.length)){e.next=20;break}return s=t[a],u=v(v({},n),{},{url:s.url}),l=s.bands,e.next=10,Ug(v(v({},u),{},{type:"arrayBuffer"}));case 10:c=e.sent,h=c.err,f=c.data,p=c.xhr,h&&o.push(h),i.push(p),r.push({data:f,bands:l});case 17:a++,e.next=4;break;case 20:return e.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oA=function(){var e=_(g().mark((function e(t,n,r,i,o){var a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:eA(t,n)},e.abrupt("return",new Promise((function(e,t){nA(r,a,(function(n,r){n?t(n):r&&e(r)}),i,o)})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),aA=function(){var e=_(g().mark((function e(t,n,r){var i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Mx(Array.isArray(t)?t[0]:t,n),e.abrupt("return",new Promise((function(e,t){var n=Wg({url:i},(function(n,r){n?t(n):r&&e(r)}));r.xhrCancel=function(){return n.abort()}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),sA=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},uA={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},lA=[UE.ARRAYBUFFER,UE.RGB];var cA={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},hA=function(){var e=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=D(t.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];e({layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,textLng:(r+o)/2,textLat:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var fA=function(){this.__data__=[],this.size=0};var pA=function(e,t){return e===t||e!=e&&t!=t};var dA=function(e,t){for(var n=e.length;n--;)if(pA(e[n][0],t))return n;return-1},vA=Array.prototype.splice;var gA=function(e){var t=this.__data__,n=dA(t,e);return!(n<0)&&(n==t.length-1?t.pop():vA.call(t,n,1),--this.size,!0)};var mA=function(e){var t=this.__data__,n=dA(t,e);return n<0?void 0:t[n][1]};var yA=function(e){return dA(this.__data__,e)>-1};var _A=function(e,t){var n=this.__data__,r=dA(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function bA(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}bA.prototype.clear=fA,bA.prototype.delete=gA,bA.prototype.get=mA,bA.prototype.has=yA,bA.prototype.set=_A;var xA=bA;var SA=function(){this.__data__=new xA,this.size=0};var EA=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var AA=function(e){return this.__data__.get(e)};var CA=function(e){return this.__data__.has(e)},TA=Oa(ia,"Map"),wA=Oa(Object,"create");var MA=function(){this.__data__=wA?wA(null):{},this.size=0};var kA=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},OA=Object.prototype.hasOwnProperty;var PA=function(e){var t=this.__data__;if(wA){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return OA.call(t,e)?t[e]:void 0},LA=Object.prototype.hasOwnProperty;var IA=function(e){var t=this.__data__;return wA?void 0!==t[e]:LA.call(t,e)};var RA=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=wA&&void 0===t?"__lodash_hash_undefined__":t,this};function NA(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}NA.prototype.clear=MA,NA.prototype.delete=kA,NA.prototype.get=PA,NA.prototype.has=IA,NA.prototype.set=RA;var DA=NA;var FA=function(){this.size=0,this.__data__={hash:new DA,map:new(TA||xA),string:new DA}};var BA=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var zA=function(e,t){var n=e.__data__;return BA(t)?n["string"==typeof t?"string":"hash"]:n.map};var jA=function(e){var t=zA(this,e).delete(e);return this.size-=t?1:0,t};var UA=function(e){return zA(this,e).get(e)};var VA=function(e){return zA(this,e).has(e)};var HA=function(e,t){var n=zA(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function GA(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}GA.prototype.clear=FA,GA.prototype.delete=jA,GA.prototype.get=UA,GA.prototype.has=VA,GA.prototype.set=HA;var WA=GA;var YA=function(e,t){var n=this.__data__;if(n instanceof xA){var r=n.__data__;if(!TA||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new WA(r)}return n.set(e,t),this.size=n.size,this};function XA(e){var t=this.__data__=new xA(e);this.size=t.size}XA.prototype.clear=SA,XA.prototype.delete=EA,XA.prototype.get=AA,XA.prototype.has=CA,XA.prototype.set=YA;var ZA=XA;var qA=function(e,t,n){"__proto__"==t&&Pa?Pa(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var KA=function(e,t,n){(void 0!==n&&!pA(e[t],n)||void 0===n&&!(t in e))&&qA(e,t,n)};var QA=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}(),$A=W((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?ia.Buffer:void 0,o=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=o?o(n):new e.constructor(n);return e.copy(r),r}})),JA=ia.Uint8Array;var eC=function(e){var t=new e.constructor(e.byteLength);return new JA(t).set(new JA(e)),t};var tC=function(e,t){var n=t?eC(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},nC=Object.create,rC=function(){function e(){}return function(t){if(!va(t))return{};if(nC)return nC(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var iC=function(e,t){return function(n){return e(t(n))}},oC=iC(Object.getPrototypeOf,Object),aC=Object.prototype;var sC=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||aC)};var uC=function(e){return"function"!=typeof e.constructor||sC(e)?{}:rC(oC(e))};var lC=function(e){return rS(e)&&"[object Arguments]"==da(e)},cC=Object.prototype,hC=cC.hasOwnProperty,fC=cC.propertyIsEnumerable,pC=lC(function(){return arguments}())?lC:function(e){return rS(e)&&hC.call(e,"callee")&&!fC.call(e,"callee")},dC=Array.isArray;var vC=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var gC=function(e){return null!=e&&vC(e.length)&&!ga(e)};var mC=function(e){return rS(e)&&gC(e)};var yC=function(){return!1},_C=W((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?ia.Buffer:void 0,o=(i?i.isBuffer:void 0)||yC;e.exports=o})),bC=Function.prototype,xC=Object.prototype,SC=bC.toString,EC=xC.hasOwnProperty,AC=SC.call(Object);var CC=function(e){if(!rS(e)||"[object Object]"!=da(e))return!1;var t=oC(e);if(null===t)return!0;var n=EC.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&SC.call(n)==AC},TC={};TC["[object Float32Array]"]=TC["[object Float64Array]"]=TC["[object Int8Array]"]=TC["[object Int16Array]"]=TC["[object Int32Array]"]=TC["[object Uint8Array]"]=TC["[object Uint8ClampedArray]"]=TC["[object Uint16Array]"]=TC["[object Uint32Array]"]=!0,TC["[object Arguments]"]=TC["[object Array]"]=TC["[object ArrayBuffer]"]=TC["[object Boolean]"]=TC["[object DataView]"]=TC["[object Date]"]=TC["[object Error]"]=TC["[object Function]"]=TC["[object Map]"]=TC["[object Number]"]=TC["[object Object]"]=TC["[object RegExp]"]=TC["[object Set]"]=TC["[object String]"]=TC["[object WeakMap]"]=!1;var wC=function(e){return rS(e)&&vC(e.length)&&!!TC[da(e)]},MC=W((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&na.process,o=function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o})),kC=MC&&MC.isTypedArray,OC=kC?Va(kC):wC;var PC=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},LC=Object.prototype.hasOwnProperty;var IC=function(e,t,n){var r=e[t];LC.call(e,t)&&pA(r,n)&&(void 0!==n||t in e)||qA(e,t,n)};var RC=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),i?qA(n,s,u):IC(n,s,u)}return n};var NC=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},DC=/^(?:0|[1-9]\d*)$/;var FC=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&DC.test(e))&&e>-1&&e%1==0&&e<t},BC=Object.prototype.hasOwnProperty;var zC=function(e,t){var n=dC(e),r=!n&&pC(e),i=!n&&!r&&_C(e),o=!n&&!r&&!i&&OC(e),a=n||r||i||o,s=a?NC(e.length,String):[],u=s.length;for(var l in e)!t&&!BC.call(e,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||FC(l,u))||s.push(l);return s};var jC=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},UC=Object.prototype.hasOwnProperty;var VC=function(e){if(!va(e))return jC(e);var t=sC(e),n=[];for(var r in e)("constructor"!=r||!t&&UC.call(e,r))&&n.push(r);return n};var HC=function(e){return gC(e)?zC(e,!0):VC(e)};var GC=function(e){return RC(e,HC(e))};var WC=function(e,t,n,r,i,o,a){var s=PC(e,n),u=PC(t,n),l=a.get(u);if(l)KA(e,n,l);else{var c=o?o(s,u,n+"",e,t,a):void 0,h=void 0===c;if(h){var f=dC(u),p=!f&&_C(u),d=!f&&!p&&OC(u);c=u,f||p||d?dC(s)?c=s:mC(s)?c=Ha(s):p?(h=!1,c=$A(u,!0)):d?(h=!1,c=tC(u,!0)):c=[]:CC(u)||pC(u)?(c=s,pC(s)?c=GC(s):va(s)&&!ga(s)||(c=uC(u))):h=!1}h&&(a.set(u,c),i(c,u,r,o,a),a.delete(u)),KA(e,n,c)}};var YC=function e(t,n,r,i,o){t!==n&&QA(n,(function(a,s){if(o||(o=new ZA),va(a))WC(t,n,s,r,e,i,o);else{var u=i?i(PC(t,s),a,s+"",t,n,o):void 0;void 0===u&&(u=a),KA(t,s,u)}}),HC)};var XC=function(e,t,n){if(!va(n))return!1;var r=typeof t;return!!("number"==r?gC(n)&&FC(t,n.length):"string"==r&&t in n)&&pA(n[t],e)};var ZC=function(e){return Na((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&XC(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t}))},qC=ZC((function(e,t,n,r){YC(e,t,n,r)}));var KC=function(e){return"string"==typeof e||!dC(e)&&rS(e)&&"[object String]"==da(e)};var QC=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},$C=iC(Object.keys,Object),JC=Object.prototype.hasOwnProperty;var eT=function(e){if(!sC(e))return $C(e);var t=[];for(var n in Object(e))JC.call(e,n)&&"constructor"!=n&&t.push(n);return t};var tT=function(e){return gC(e)?zC(e):eT(e)};var nT=function(e,t){return e&&RC(t,tT(t),e)};var rT=function(e,t){return e&&RC(t,HC(t),e)};var iT=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o};var oT=function(){return[]},aT=Object.prototype.propertyIsEnumerable,sT=Object.getOwnPropertySymbols,uT=sT?function(e){return null==e?[]:(e=Object(e),iT(sT(e),(function(t){return aT.call(e,t)})))}:oT;var lT=function(e,t){return RC(e,uT(e),t)};var cT=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},hT=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)cT(t,uT(e)),e=oC(e);return t}:oT;var fT=function(e,t){return RC(e,hT(e),t)};var pT=function(e,t,n){var r=t(e);return dC(e)?r:cT(r,n(e))};var dT=function(e){return pT(e,tT,uT)};var vT=function(e){return pT(e,HC,hT)},gT=Oa(ia,"DataView"),mT=Oa(ia,"Promise"),yT=Oa(ia,"Set"),_T=Oa(ia,"WeakMap"),bT=xa(gT),xT=xa(TA),ST=xa(mT),ET=xa(yT),AT=xa(_T),CT=da;(gT&&"[object DataView]"!=CT(new gT(new ArrayBuffer(1)))||TA&&"[object Map]"!=CT(new TA)||mT&&"[object Promise]"!=CT(mT.resolve())||yT&&"[object Set]"!=CT(new yT)||_T&&"[object WeakMap]"!=CT(new _T))&&(CT=function(e){var t=da(e),n="[object Object]"==t?e.constructor:void 0,r=n?xa(n):"";if(r)switch(r){case bT:return"[object DataView]";case xT:return"[object Map]";case ST:return"[object Promise]";case ET:return"[object Set]";case AT:return"[object WeakMap]"}return t});var TT=CT,wT=Object.prototype.hasOwnProperty;var MT=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&wT.call(e,"index")&&(n.index=e.index,n.input=e.input),n};var kT=function(e,t){var n=t?eC(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},OT=/\w*$/;var PT=function(e){var t=new e.constructor(e.source,OT.exec(e));return t.lastIndex=e.lastIndex,t},LT=oa?oa.prototype:void 0,IT=LT?LT.valueOf:void 0;var RT=function(e){return IT?Object(IT.call(e)):{}};var NT=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return eC(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return kT(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return tC(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return PT(e);case"[object Set]":return new r;case"[object Symbol]":return RT(e)}};var DT=function(e){return rS(e)&&"[object Map]"==TT(e)},FT=MC&&MC.isMap,BT=FT?Va(FT):DT;var zT=function(e){return rS(e)&&"[object Set]"==TT(e)},jT=MC&&MC.isSet,UT=jT?Va(jT):zT,VT={};VT["[object Arguments]"]=VT["[object Array]"]=VT["[object ArrayBuffer]"]=VT["[object DataView]"]=VT["[object Boolean]"]=VT["[object Date]"]=VT["[object Float32Array]"]=VT["[object Float64Array]"]=VT["[object Int8Array]"]=VT["[object Int16Array]"]=VT["[object Int32Array]"]=VT["[object Map]"]=VT["[object Number]"]=VT["[object Object]"]=VT["[object RegExp]"]=VT["[object Set]"]=VT["[object String]"]=VT["[object Symbol]"]=VT["[object Uint8Array]"]=VT["[object Uint8ClampedArray]"]=VT["[object Uint16Array]"]=VT["[object Uint32Array]"]=!0,VT["[object Error]"]=VT["[object Function]"]=VT["[object WeakMap]"]=!1;var HT=function e(t,n,r,i,o,a){var s,u=1&n,l=2&n,c=4&n;if(r&&(s=o?r(t,i,o,a):r(t)),void 0!==s)return s;if(!va(t))return t;var h=dC(t);if(h){if(s=MT(t),!u)return Ha(t,s)}else{var f=TT(t),p="[object Function]"==f||"[object GeneratorFunction]"==f;if(_C(t))return $A(t,u);if("[object Object]"==f||"[object Arguments]"==f||p&&!o){if(s=l||p?{}:uC(t),!u)return l?fT(t,rT(s,t)):lT(t,nT(s,t))}else{if(!VT[f])return o?t:{};s=NT(t,f,u)}}a||(a=new ZA);var d=a.get(t);if(d)return d;a.set(t,s),UT(t)?t.forEach((function(i){s.add(e(i,n,r,i,t,a))})):BT(t)&&t.forEach((function(i,o){s.set(o,e(i,n,r,o,t,a))}));var v=h?void 0:(c?l?vT:dT:l?HC:tT)(t);return QC(v||t,(function(i,o){v&&(i=t[o=i]),IC(s,o,e(i,n,r,o,t,a))})),s};var GT=function(e){return HT(e,5)};function WT(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function YT(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function XT(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function ZT(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function qT(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var KT={exports:{}},QT={exports:{}},$T={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}($T,$T.exports);var JT={},ew={exports:{}},tw={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}(tw,tw.exports);var nw={};Object.defineProperty(nw,"__esModule",{value:!0}),nw.fallback=sw,nw.wrap=uw;var rw,iw=nw.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,ow=nw.hasSetImmediate="function"==typeof setImmediate&&setImmediate,aw=nw.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function sw(e){setTimeout(e,0)}function uw(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}rw=iw?queueMicrotask:ow?setImmediate:aw?process.nextTick:sw,nw.default=uw(rw),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,i.isAsync)(e))return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop(),i=e.apply(this,t);return a(i,r)};return(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=o(tw.exports),r=o(nw),i=JT;function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.then((function(e){s(t,null,e)}),(function(e){s(t,e&&e.message?e:new Error(e))}))}function s(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}(ew,ew.exports),Object.defineProperty(JT,"__esModule",{value:!0}),JT.isAsyncIterable=JT.isAsyncGenerator=JT.isAsync=void 0;var lw,cw=(lw=ew.exports)&&lw.__esModule?lw:{default:lw};function hw(e){return"AsyncFunction"===e[Symbol.toStringTag]}JT.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return hw(e)?(0,cw.default)(e):e},JT.isAsync=hw,JT.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},JT.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]};var fw={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=e.length);if(!t)throw new Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,o){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return o(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}},e.exports=t.default}(fw,fw.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o($T.exports),r=o(JT),i=o(fw.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var o=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[t]=r,n(e)}))}),(function(e){return i(e,o)}))}),3),e.exports=t.default}(QT,QT.exports);var pw={exports:{}},dw={exports:{}},vw={exports:{}},gw={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}(gw,gw.exports);var mw={exports:{}},yw={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}(yw,yw.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function i(){var o=t[++n];return"__proto__"===o?i():n<r?{value:e[o],key:o}:null}}(e)};var n=i($T.exports),r=i(yw.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(mw,mw.exports);var _w={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}(_w,_w.exports);var bw={exports:{}},xw={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={},e.exports=t.default}(xw,xw.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var o=!1,a=!1,s=!1,u=0,l=0;function c(){u>=t||s||o||(s=!0,e.next().then((function(e){var t=e.value,n=e.done;if(!a&&!o){if(s=!1,n)return o=!0,void(u<=0&&i(null));u++,r(t,l,h),l++,c()}})).catch(f))}function h(e,t){if(u-=1,!a)return e?f(e):!1===e?(o=!0,void(a=!0)):t===n.default||o&&u<=0?(o=!0,i(null)):void c()}function f(e){a||(s=!1,o=!0,i(e))}c()};var n=function(e){return e&&e.__esModule?e:{default:e}}(xw.exports);e.exports=t.default}(bw,bw.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(gw.exports),r=u(mw.exports),i=u(_w.exports),o=JT,a=u(bw.exports),s=u(xw.exports);function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,u,l){if(l=(0,n.default)(l),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return l(null);if((0,o.isAsyncGenerator)(t))return(0,a.default)(t,e,u,l);if((0,o.isAsyncIterable)(t))return(0,a.default)(t[Symbol.asyncIterator](),e,u,l);var c=(0,r.default)(t),h=!1,f=!1,p=0,d=!1;function v(e,t){if(!f)if(p-=1,e)h=!0,l(e);else if(!1===e)h=!0,f=!0;else{if(t===s.default||h&&p<=0)return h=!0,l(null);d||g()}}function g(){for(d=!0;p<e&&!h;){var t=c();if(null===t)return h=!0,void(p<=0&&l(null));p+=1,u(t.value,t.key,(0,i.default)(v))}d=!1}g()}},e.exports=t.default}(vw,vw.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(vw.exports),r=o(JT),i=o(fw.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,o){return(0,n.default)(t)(e,(0,r.default)(i),o)}),4),e.exports=t.default}(dw,dw.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(dw.exports),r=i(fw.exports);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}(pw,pw.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(QT.exports),r=i(pw.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(KT,KT.exports);var Sw=qT(KT.exports),Ew=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,Sw(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,ZT([],XT(n.args),!1)),r(null,e)}))},e}(),Aw={exports:{}},Cw={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l($T.exports),r=l(xw.exports),i=l(dw.exports),o=l(gw.exports),a=l(_w.exports),s=l(JT),u=l(fw.exports);function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){n=(0,o.default)(n);var i=0,s=0,u=e.length,l=!1;function c(e,t){!1===e&&(l=!0),!0!==l&&(e?n(e):++s!==u&&t!==r.default||n(null))}for(0===u&&n(null);i<u;i++)t(e[i],i,(0,a.default)(c))}function h(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,u.default)((function(e,t,r){return((0,n.default)(e)?c:h)(e,(0,s.default)(t),r)}),3),e.exports=t.default}(Cw,Cw.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(Cw.exports),r=i(QT.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(Aw,Aw.exports);var Tw={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(gw.exports),r=a(_w.exports),i=a(JT),o=a(fw.exports);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var o=0;function a(t){(0,i.default)(e[o++]).apply(void 0,t.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===e.length?t.apply(void 0,[n].concat(r)):void a(r)}a([])})),e.exports=t.default}(Tw,Tw.exports);var ww=qT(Tw.exports),Mw=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return ww(this.tasks)},e.prototype.tap=function(e,t){0===this.tasks.length?this.tasks.push((function(e){var n=t();e(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!t.apply(void 0,ZT([],XT(n),!1))&&null,e)}))},e}(),kw=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Sw(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}(),Ow=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,Sw(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return WT(n,void 0,void 0,(function(){return YT(this,(function(n){switch(n.label){case 0:return[4,t.apply(void 0,ZT([],XT(this.args),!1))];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),Pw=W((function(e,t){e.exports=function(){function e(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;!function e(n,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,l=i-o+1,c=Math.log(u),h=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*h*(u-h)/u)*(l-u/2<0?-1:1),p=Math.max(o,Math.floor(i-l*h/u+f)),d=Math.min(a,Math.floor(i+(u-l)*h/u+f));e(n,r,i,p,d,s)}var v=r[2*i+s],g=o,m=a;for(t(n,r,o,i),r[2*a+s]>v&&t(n,r,o,a);g<m;){for(t(n,r,g,m),g++,m--;r[2*g+s]<v;)g++;for(;r[2*m+s]>v;)m--}r[2*o+s]===v?t(n,r,o,m):(m++,t(n,r,m,a)),m<=i&&(o=m+1),i<=m&&(a=m-1)}}(n,r,u,o,a,s%2),e(n,r,i,o,u-1,s+1),e(n,r,i,u+1,a,s+1)}}function t(e,t,r,i){n(e,r,i),n(t,2*r,2*i),n(t,2*r+1,2*i+1)}function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}var i=function(e){return e[0]},o=function(e){return e[1]},a=function(t,n,r,a,s){void 0===n&&(n=i),void 0===r&&(r=o),void 0===a&&(a=64),void 0===s&&(s=Float64Array),this.nodeSize=a,this.points=t;for(var u=t.length<65536?Uint16Array:Uint32Array,l=this.ids=new u(t.length),c=this.coords=new s(2*t.length),h=0;h<t.length;h++)l[h]=h,c[2*h]=n(t[h]),c[2*h+1]=r(t[h]);e(l,c,a,0,l.length-1,0)};a.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,l=[0,e.length-1,0],c=[];l.length;){var h=l.pop(),f=l.pop(),p=l.pop();if(f-p<=a)for(var d=p;d<=f;d++)s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[d]);else{var v=Math.floor((p+f)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[v]);var g=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(p),l.push(v-1),l.push(g)),(0===h?i>=s:o>=u)&&(l.push(v+1),l.push(f),l.push(g))}}return c}(this.ids,this.coords,e,t,n,r,this.nodeSize)},a.prototype.within=function(e,t,n){return function(e,t,n,i,o,a){for(var s=[0,e.length-1,0],u=[],l=o*o;s.length;){var c=s.pop(),h=s.pop(),f=s.pop();if(h-f<=a)for(var p=f;p<=h;p++)r(t[2*p],t[2*p+1],n,i)<=l&&u.push(e[p]);else{var d=Math.floor((f+h)/2),v=t[2*d],g=t[2*d+1];r(v,g,n,i)<=l&&u.push(e[d]);var m=(c+1)%2;(0===c?n-o<=v:i-o<=g)&&(s.push(f),s.push(d-1),s.push(m)),(0===c?n+o>=v:i+o>=g)&&(s.push(d+1),s.push(h),s.push(m))}}return u}(this.ids,this.coords,e,t,n,this.nodeSize)};var s={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},u=Math.fround||function(e){return function(t){return e[0]=+t,e[0]}}(new Float32Array(1)),l=function(e){this.options=g(Object.create(s),e),this.trees=new Array(this.options.maxZoom+1)};function c(e,t,n,r,i){return{x:u(e),y:u(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function h(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:u(d(r)),y:u(v(i)),zoom:1/0,index:t,parentId:-1}}function f(e){return{type:"Feature",id:e.id,properties:p(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function p(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return g(g({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function d(e){return e/360+.5}function v(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function g(e,t){for(var n in t)e[n]=t[n];return e}function m(e){return e.x}function y(e){return e.y}return l.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var s="prepare "+e.length+" points";n&&console.time(s),this.points=e;for(var u=[],l=0;l<e.length;l++)e[l].geometry&&u.push(h(e[l],l));this.trees[i+1]=new a(u,m,y,o,Float32Array),n&&console.timeEnd(s);for(var c=i;c>=r;c--){var f=+Date.now();u=this._cluster(u,c),this.trees[c]=new a(u,m,y,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,u.length,+Date.now()-f)}return n&&console.timeEnd("total time"),this},l.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return a.concat(s)}for(var u=this.trees[this._limitZoom(t)],l=[],c=0,h=u.range(d(n),v(o),d(i),v(r));c<h.length;c+=1){var p=h[c],g=u.points[p];l.push(g.numPoints?f(g):this.points[g.index])}return l},l.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],h=i.points[c];h.parentId===e&&s.push(h.numPoints?f(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},l.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},l.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((t-s)/i,u,(t+1+s)/i,l),r.points,t,n,i,c),0===t&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),t===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},l.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},l.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},l.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,s=e;a<s.length;a+=1){var u=t[s[a]],l=u.numPoints,c=void 0,h=void 0,f=void 0;if(l)c=p(u),h=u.x,f=u.y;else{var g=this.points[u.index];c=g.properties,h=d(g.geometry.coordinates[0]),f=v(g.geometry.coordinates[1])}var m={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(f*i-r))]],tags:c},y=void 0;l?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(m.id=y),o.features.push(m)}},l.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))},l.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,t)),l=0;l<e.length;l++){var h=e[l];if(!(h.zoom<=t)){h.zoom=t;for(var f=this.trees[t+1],p=f.within(h.x,h.y,u),d=h.numPoints||1,v=d,g=0,m=p;g<m.length;g+=1){var y=m[g],_=f.points[y];_.zoom>t&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var b=h.x*d,x=h.y*d,S=a&&d>1?this._map(h,!0):null,E=(l<<5)+(t+1)+this.points.length,A=0,C=p;A<C.length;A+=1){var T=C[A],w=f.points[T];if(!(w.zoom<=t)){w.zoom=t;var M=w.numPoints||1;b+=w.x*M,x+=w.y*M,w.parentId=E,a&&(S||(S=this._map(h,!0)),a(S,this._map(w)))}}h.parentId=E,n.push(c(b/v,x/v,E,v,S))}else if(n.push(h),v>1)for(var k=0,O=p;k<O.length;k+=1){var P=O[k],L=f.points[P];L.zoom<=t||(L.zoom=t,n.push(L))}}}return n},l.prototype._getOriginId=function(e){return e-this.points.length>>5},l.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},l.prototype._map=function(e,t){if(e.numPoints)return t?g({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?g({},r):r},l}()}));function Lw(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,o=void 0===i?18:i,a=t.minZoom,s=void 0===a?0:a,u=t.zoom,l=void 0===u?2:u;if(e.pointIndex){var c=e.pointIndex.getClusters(e.extent,Math.floor(l));return e.dataArray=c.map((function(e,t){return v({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var h=new Pw({radius:r,minZoom:s,maxZoom:o}),f={type:"FeatureCollection",features:[]};return f.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:v({},e)}})),h.load(f.features),h}function Iw(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var Rw={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return Iw(e)/e.length},sum:Iw};function Nw(e,t){if(Array.isArray(t))return t}var Dw=function(e){A(r,e);var t=I(r);function r(e,n){var i;return b(this,r),E(P(i=t.call(this)),"type","source"),E(P(i),"inited",!1),E(P(i),"data",void 0),E(P(i),"center",void 0),E(P(i),"extent",void 0),E(P(i),"hooks",{init:new Ew}),E(P(i),"parser",{type:"geojson"}),E(P(i),"transforms",[]),E(P(i),"cluster",!1),E(P(i),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),E(P(i),"tileset",void 0),E(P(i),"invalidExtent",!1),E(P(i),"dataArrayChanged",!1),E(P(i),"originData",void 0),E(P(i),"rawData",void 0),E(P(i),"cfg",{}),E(P(i),"clusterIndex",void 0),i.originData=e,i.initCfg(n),i.init(),i}return S(r,[{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,o=void 0===r?"sum":r,a=n.field,s=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,s.forEach((function(e){e.id||(e.properties.point_count=1)})),(a||ga(o))&&(s=s.map((function(e){var n=e.id;if(n){var r,i=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(KC(o)&&a){var s=function(e,t){return e.map((function(e){return 1*e[t]}))}(i,a);r=Rw[o](s)}ga(o)&&(r=o(i)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=i("geojson")({type:"FeatureCollection",features:s}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser,n=t.type,r=void 0===n?"geojson":n,i=t.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(t){return t._id===e})):e<this.data.dataArray.length?this.data.dataArray[e]:"null";var o=e<this.originData.features.length?this.originData.features[e]:"null",a=GT(o);if(null!=a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(t){return t._id===e}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(e,t){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===e?v(v({},n),t):n})),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(n){return n[e]===t}));return null==n?void 0:n._id}},{key:"setData",value:function(e,t){this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init()}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(e=this.tileset)||void 0===e||e.destroy()}},{key:"handleData",value:function(){var e=this;return new Promise((function(t,n){try{e.excuteParser(),e.initCluster(),e.executeTrans(),t({})}catch(e){n(e)}}))}},{key:"initCfg",value:function(e){this.cfg=qC(this.cfg,e,Nw);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=v(v({},this.clusterOptions),t.clusterOptions)))}},{key:"init",value:function(){var e=this;this.inited=!1,this.handleData().then((function(){e.inited=!0,e.emit("update")}))}},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=i(t);this.data=n(this.originData,e),this.tileset=this.initTileset(),e.cancelExtent||(this.extent=Am(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(e)return this.tileset?(this.tileset.updateOptions(e),this.tileset):new _S(v({},e))}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var r=function(e){return n[e]}(t.type)(e.data,t);Object.assign(e.data,r)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=Lw(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=Im(Nm(this.extent),e)),t[0].concat(t[1])}}]),r}(Kx);var Fw=ad.left,Bw=Cn("reduce");or({target:"Array",proto:!0,forced:!Bw||!Fr&&Le>79&&Le<83},{reduce:function(e){var t=arguments.length;return Fw(this,e,t,t>1?arguments[1]:void 0)}});var zw=Math.PI/3,jw=[0,zw,2*zw,3*zw,4*zw,5*zw];function Uw(e){return e[0]}function Vw(e){return e[1]}var Hw;o("rasterTile",(function(e,t){if(n=e,Array.isArray(n)&&0===n.length||!Array.isArray(n)&&"string"!=typeof n)throw new Error("tile server url is error");var n,r=(null==t?void 0:t.dataType)||UE.IMAGE;r===UE.RGB&&(r=UE.ARRAYBUFFER);var i=v(v(v({},uA),t),{},{getTileData:function(n,i){switch(r){case UE.IMAGE:return aA(e,n,i);case UE.ARRAYBUFFER:return oA(e,n,i,(null==t?void 0:t.format)||sA,null==t?void 0:t.operation);default:return aA(e,n,i)}}});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}})),o("mvt",(function(e,t){var n=Array.isArray(e)?e[0]:e,r=v(v(v({},uE),t),{},{getTileData:function(e,t){return lE(n,e,t)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}})),o("geojsonvt",(function(e,t){var n=function(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===e||void 0===e.geojsonvtOptions||(e.geojsonvtOptions.maxZoom&&(t.maxZoom=e.geojsonvtOptions.maxZoom),e.geojsonvtOptions.indexMaxZoom&&(t.indexMaxZoom=e.geojsonvtOptions.indexMaxZoom),e.geojsonvtOptions.indexMaxPoints&&(t.indexMaxPoints=e.geojsonvtOptions.indexMaxPoints),e.geojsonvtOptions.tolerance&&(t.tolerance=e.geojsonvtOptions.tolerance),e.geojsonvtOptions.extent&&(t.extent=e.geojsonvtOptions.extent),e.geojsonvtOptions.buffer&&(t.buffer=e.geojsonvtOptions.buffer),e.geojsonvtOptions.lineMetrics&&(t.lineMetrics=e.geojsonvtOptions.lineMetrics),e.geojsonvtOptions.promoteId&&(t.promoteId=e.geojsonvtOptions.promoteId),e.geojsonvtOptions.generateId&&(t.generateId=e.geojsonvtOptions.generateId),e.geojsonvtOptions.debug&&(t.debug=e.geojsonvtOptions.debug)),t}(t),r=n.extent||4096,i=function(e,t){return new RE(e,t)}(e,n);return{data:e,dataArray:[],tilesetOptions:v(v(v({},DE),t),{},{getTileData:function(e,t){return jE(t,i,e,r)}}),isTile:!0}})),o("testTile",(function(e,t){return{data:e,dataArray:[],tilesetOptions:v(v(v({},cA),t),{},{getTileData:function(e){return hA(e)}}),isTile:!0}})),o("geojson",(function(e,t){var n=[],r={};return e.features?(e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),cr(e,!0),0===e.features.length?{dataArray:[],featureKeys:r}:(br(e,(function(e,r){var i=function(e,t){return void 0===t?null:"id"===t&&e.id?e.id:e[t]?e[t]:e.properties&&e.properties[t]?function(e){for(var t=e.toString(),n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return n>>>0}(e.properties[t]+"")%1000019:null}(e,null==t?void 0:t.featureId);null===i&&(i=r);var o=i,a=xr(e),s=v(v({},e.properties),{},{coordinates:a,_id:o});n.push(s)})),{dataArray:n,featureKeys:r})):(e.features=[],{dataArray:[]})})),o("image",OS),o("csv",(function(e,t){return Er(p(e),t)})),o("json",Er),o("raster",(function(e,t){var n,r,i,o=t.extent,a=t.width,s=t.height,u=t.min,l=t.max,c=t.format,h=t.operation;return void 0===c||JE(e)?(n=Array.from(e),r=a,i=s):n=XE(Array.isArray(e)?e:[e],c,h),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:l,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}})),o("rasterRgb",(function(e,t){var n,r,i,o=t.extent,a=t.width,s=t.height,u=t.min,l=t.max,c=t.format,h=t.operation;return void 0===c||JE(e)?(n=Array.from(e),r=a,i=s):n=XE(Array.isArray(e)?e:[e],c,h),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:l,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}})),a("cluster",Lw),a("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),a("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,o={};return i.forEach((function(e){o[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return v(v({},e),o[t])})),e})),a("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),a("grid",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=i/(2*Math.PI*6378e3)*(256<<20)/2,a=function(e,t){var n,r,i=1/0,o=-1/0,a=j(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;n=s.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(e){a.e(e)}finally{a.f()}var u=function(e,t){var n=(i=e,i/6378e3*(180/Math.PI)),r=function(e,t){return t/6378e3*(180/Math.PI)/Math.cos(e*Math.PI/180)}(t,e);var i;return{yOffset:n,xOffset:r}}(t,(i+o)/2);if(u.xOffset<=0||u.yOffset<=0)return{gridHash:{},gridOffset:u};var l,c={},h=j(e);try{for(h.s();!(l=h.n()).done;){var f=l.value,p=f.coordinates[1],d=f.coordinates[0];if(Number.isFinite(p)&&Number.isFinite(d)){var v=Math.floor((p+90)/u.yOffset),g=Math.floor((d+180)/u.xOffset),m="".concat(v,"-").concat(g);c[m]=c[m]||{count:0,points:[]},c[m].count+=1,c[m].points.push(f)}}}catch(e){h.e(e)}finally{h.f()}return{gridHash:c,gridOffset:u}}(n,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:function(e,t,n){return Object.keys(e).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(n.field&&n.method){var c=Ig(e[i].points,n.field);l[n.method]=Lg[n.method](c)}return Object.assign(l,{_id:o,coordinates:km([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(l),r}),[])}(a.gridHash,a.gridOffset,t)}})),a("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=t.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(e){var t=D(km(e.coordinates),2),n=t[0],r=t[1];return v(v({},e),{},{coordinates:[n,r]})}));return{dataArray:function(){var e,t,n,r=0,i=0,o=1,a=1,s=Uw,u=Vw;function l(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=e[r],r,e))&&!isNaN(h=+u.call(null,l,r,e))){var l,c,h,f=Math.round(h/=n),p=Math.round(c=c/t-(1&f)/2),d=h-f;if(3*Math.abs(d)>1){var v=c-p,g=p+(c<p?-1:1)/2,m=f+(h<f?-1:1),y=c-g,_=h-m;v*v+d*d>y*y+_*_&&(p=g+(1&f?1:-1)/2,f=m)}var b=p+"-"+f,x=i[b];x?x.push(l):(o.push(x=i[b]=[l]),x.x=(p+(1&f)/2)*t,x.y=f*n)}return o}function c(e){var t=0,n=0;return jw.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,s=o-n;return t=i,n=o,[a,s]}))}return l.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/t),c=u*n;c<a+e;c+=n,++u)for(var h=l*t+(1&u)*t/2;h<o+t/2;h+=t)s.push([h,c]);return s},l.mesh=function(){var t=c(e).slice(0,4).join("l");return l.centers().map((function(e){return"M"+e+"m"+t})).join("")},l.x=function(e){return arguments.length?(s=e,l):s},l.y=function(e){return arguments.length?(u=e,l):u},l.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(zw),n=1.5*e,l):e},l.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],l):[o-r,a-i]},l.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],l):[[r,i],[o,a]]},l.radius(1)}().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]}))(u).map((function(e,n){var r;if(t.field&&a){var i=Ig(e,t.field);e[a]=Lg[a](i)}return E(r={},t.method,e[a]),E(r,"count",e.length),E(r,"rawData",e),E(r,"coordinates",[e.x,e.y]),E(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}})),function(e){!function(t){var n="object"==typeof H?H:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=i(e);function i(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===n.Reflect?n.Reflect=e:r=i(n.Reflect,r),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return L(Object.create(null))}:a?function(){return L({__proto__:null})}:function(){return L({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),c="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=c||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,f=c||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,p=new(c||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+a()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function o(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function d(e,t,n){var r=p.get(e);if(b(r)){if(!n)return;r=new h,p.set(e,r)}var i=r.get(t);if(b(i)){if(!n)return;i=new h,r.set(t,i)}return i}function v(e,t,n){var r=d(t,n,!1);return!b(r)&&!!r.has(e)}function g(e,t,n){var r=d(t,n,!1);if(!b(r))return r.get(e)}function m(e,t,n,r){d(n,r,!0).set(e,t)}function y(e,t){var n=[],r=d(e,t,!1);if(b(r))return n;for(var o=function(e){var t=M(e,i);if(!T(t))throw new TypeError;var n=t.call(e);if(!S(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=k(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(e){try{O(o)}finally{throw e}}a++}}function _(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function b(e){return void 0===e}function x(e){return null===e}function S(e){return"object"==typeof e?null!==e:"function"==typeof e}function E(e,t){switch(_(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=M(e,r);if(void 0!==i){var o=i.call(e,n);if(S(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(T(n))if(!S(i=n.call(e)))return i;if(T(r=e.valueOf))if(!S(i=r.call(e)))return i}else{var r;if(T(r=e.valueOf))if(!S(i=r.call(e)))return i;var i,o=e.toString;if(T(o))if(!S(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function A(e){var t=E(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function C(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function T(e){return"function"==typeof e}function w(e){return"function"==typeof e}function M(e,t){var n=e[t];if(null!=n){if(!T(n))throw new TypeError;return n}}function k(e){var t=e.next();return!t.done&&t}function O(e){var t=e.return;t&&t.call(e)}function P(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function L(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(b(n)){if(!C(e))throw new TypeError;if(!w(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!b(r)&&!x(r)){if(!w(r))throw new TypeError;t=r}}return t}(e,t)}if(!C(e))throw new TypeError;if(!S(t))throw new TypeError;if(!S(r)&&!b(r)&&!x(r))throw new TypeError;return x(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!b(o)&&!x(o)){if(!S(o))throw new TypeError;r=o}}return r}(e,t,n=A(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!S(n))throw new TypeError;if(!b(r)&&!function(e){switch(_(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;m(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!S(n))throw new TypeError;return b(r)||(r=A(r)),m(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return!0;var i=P(n);return!x(i)&&e(t,i,r)}(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),v(e,t,n)})),e("getMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return g(t,n,r);var i=P(n);return x(i)?void 0:e(t,i,r)}(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),g(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return b(t)||(t=A(t)),function e(t,n){var r=y(t,n),i=P(t);if(null===i)return r;var o=e(i,n);if(o.length<=0)return r;if(r.length<=0)return o;for(var a=new f,s=[],u=0,l=r;u<l.length;u++){var c=l[u];a.has(c)||(a.add(c),s.push(c))}for(var h=0,p=o;h<p.length;h++){c=p[h];a.has(c)||(a.add(c),s.push(c))}return s}(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return b(t)||(t=A(t)),y(e,t)})),e("deleteMetadata",(function(e,t,n){if(!S(t))throw new TypeError;b(n)||(n=A(n));var r=d(t,n,!1);if(b(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=p.get(t);return i.delete(n),i.size>0||p.delete(t),!0}))}(r)}()}(Hw||(Hw={}));var Gw=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]}));G(Gw);Gw.NON_CUSTOM_TAG_KEYS,Gw.POST_CONSTRUCT,Gw.DESIGN_PARAM_TYPES,Gw.PARAM_TYPES,Gw.TAGGED_PROP,Gw.TAGGED,Gw.MULTI_INJECT_TAG,Gw.INJECT_TAG,Gw.OPTIONAL_TAG,Gw.UNMANAGED_TAG,Gw.NAME_TAG,Gw.NAMED_TAG;var Ww=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0;t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}}));G(Ww);Ww.TargetTypeEnum,Ww.BindingTypeEnum,Ww.BindingScopeEnum;var Yw=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var n=0;t.id=function(){return n++}}));G(Yw);Yw.id;var Xw=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var n=function(){function e(e,t){this.id=Yw.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=Ww.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===Ww.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=n}));G(Xw);Xw.Binding;var Zw=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]};t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"}));G(Zw);Zw.STACK_OVERFLOW,Zw.CIRCULAR_DEPENDENCY_IN_FACTORY,Zw.POST_CONSTRUCT_ERROR,Zw.MULTIPLE_POST_CONSTRUCT_METHODS,Zw.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK,Zw.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE,Zw.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE,Zw.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT,Zw.ARGUMENTS_LENGTH_MISMATCH,Zw.INVALID_DECORATOR_OPERATION,Zw.INVALID_TO_SELF_VALUE,Zw.INVALID_FUNCTION_BINDING,Zw.INVALID_MIDDLEWARE_RETURN,Zw.NO_MORE_SNAPSHOTS_AVAILABLE,Zw.INVALID_BINDING_TYPE,Zw.NOT_IMPLEMENTED,Zw.CIRCULAR_DEPENDENCY,Zw.UNDEFINED_INJECT_ANNOTATION,Zw.MISSING_INJECT_ANNOTATION,Zw.MISSING_INJECTABLE_ANNOTATION,Zw.NOT_REGISTERED,Zw.CANNOT_UNBIND,Zw.AMBIGUOUS_MATCH,Zw.KEY_NOT_FOUND,Zw.NULL_ARGUMENT,Zw.DUPLICATED_METADATA,Zw.DUPLICATED_INJECTABLE_DECORATOR;var qw=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var n=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(Gw.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(Gw.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(Gw.TAGGED_PROP,e)||[]},e}();t.MetadataReader=n}));G(qw);qw.MetadataReader;var Kw=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0;t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}}));G(Kw);Kw.BindingCount;var Qw=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0,t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===Zw.STACK_OVERFLOW}}));G(Qw);Qw.isStackOverflowExeption;var $w=W((function(e,t){function n(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function r(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0,t.getServiceIdentifierAsString=n,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var i="",o=n(e,t);return 0!==o.length&&(i="\nRegistered bindings:",o.forEach((function(e){var t="Object";null!==e.implementationType&&(t=r(e.implementationType)),i=i+"\n "+t,e.constraint.metaData&&(i=i+" - "+e.constraint.metaData)}))),i},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(function e(t,n){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===n||e(t.parentRequest,n))}(t,t.serviceIdentifier)){var r=function(e){return function e(t,r){void 0===r&&(r=[]);var i=n(t.serviceIdentifier);return r.push(i),null!==t.parentRequest?e(t.parentRequest,r):r}(e).reverse().join(" --\x3e ")}(t);throw new Error(Zw.CIRCULAR_DEPENDENCY+" "+r)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=r}));G($w);$w.circularDependencyToException,$w.listMetadataForTarget,$w.listRegisteredBindingsForServiceIdentifier,$w.getServiceIdentifierAsString,$w.getFunctionName;var Jw=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var n=function(){function e(e){this.id=Yw.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=n}));G(Jw);Jw.Context;var eM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===Gw.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=n}));G(eM);eM.Metadata;var tM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;var n=function(e,t){this.parentContext=e,this.rootRequest=t};t.Plan=n}));G(tM);tM.Plan;var nM=W((function(e,t){function n(e,t,n,r,i){var o={},a="number"==typeof i,s=void 0!==i&&a?i.toString():n;if(a&&void 0!==n)throw new Error(Zw.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var u=o[s];if(Array.isArray(u))for(var l=0,c=u;l<c.length;l++){var h=c[l];if(h.key===r.key)throw new Error(Zw.DUPLICATED_METADATA+" "+h.key.toString())}else u=[];u.push(r),o[s]=u,Reflect.defineMetadata(e,o,t)}function r(e,t){Reflect.decorate(e,t)}function i(e,t){return function(n,r){t(n,r,e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0,t.tagParameter=function(e,t,r,i){n(Gw.TAGGED,e,t,i,r)},t.tagProperty=function(e,t,r){n(Gw.TAGGED_PROP,e.constructor,t,r)},t.decorate=function(e,t,n){"number"==typeof n?r([i(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):r([e],t)}}));G(nM);nM.tagProperty,nM.tagParameter,nM.decorate;var rM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var n=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=n,t.inject=function(e){return function(t,n,r){if(void 0===e)throw new Error(Zw.UNDEFINED_INJECT_ANNOTATION(t.name));var i=new eM.Metadata(Gw.INJECT_TAG,e);"number"==typeof r?nM.tagParameter(t,n,r,i):nM.tagProperty(t,n,i)}}}));G(rM);rM.inject,rM.LazyServiceIdentifer;var iM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n}));G(iM);iM.QueryableString;var oM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var n=function(){function e(e,t,n,r){this.id=Yw.id(),this.type=e,this.serviceIdentifier=n,this.name=new iM.QueryableString(t||""),this.metadata=new Array;var i=null;"string"==typeof r?i=new eM.Metadata(Gw.NAMED_TAG,r):r instanceof eM.Metadata&&(i=r),null!==i&&this.metadata.push(i)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(Gw.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(Gw.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(Gw.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return Gw.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(Gw.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===Gw.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return Gw.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(Gw.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=n}));G(oM);oM.Target;var aM=W((function(e,t){var n=H&&H.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function r(e,t,r,a){var s=e.getConstructorMetadata(r),u=s.compilerGeneratedMetadata;if(void 0===u){var l=Zw.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(l)}var c=s.userGeneratedMetadata,h=Object.keys(c),f=0===r.length&&h.length>0,p=h.length>r.length,d=function(e,t,n,r,o){for(var a=[],s=0;s<o;s++){var u=i(s,e,t,n,r);null!==u&&a.push(u)}return a}(a,t,u,c,f||p?h.length:r.length),v=function e(t,r){for(var i=t.getPropertiesMetadata(r),a=[],s=Object.keys(i),u=0,l=s;u<l.length;u++){var c=l[u],h=i[c],f=o(i[c]),p=f.targetName||c,d=f.inject||f.multiInject,v=new oM.Target(Ww.TargetTypeEnum.ClassProperty,p,d);v.metadata=h,a.push(v)}var g=Object.getPrototypeOf(r.prototype).constructor;if(g!==Object){var m=e(t,g);a=n(n([],a),m)}return a}(e,r);return n(n([],d),v)}function i(e,t,n,r,i){var a=i[e.toString()]||[],s=o(a),u=!0!==s.unmanaged,l=r[e],c=s.inject||s.multiInject;if((l=c||l)instanceof rM.LazyServiceIdentifer&&(l=l.unwrap()),u){if(!t&&(l===Object||l===Function||void 0===l)){var h=Zw.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(h)}var f=new oM.Target(Ww.TargetTypeEnum.ConstructorArgument,s.targetName,l);return f.metadata=a,f}return null}function o(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[Gw.INJECT_TAG],multiInject:t[Gw.MULTI_INJECT_TAG],targetName:t[Gw.NAME_TAG],unmanaged:t[Gw.UNMANAGED_TAG]}}Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0,Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return $w.getFunctionName}}),t.getDependencies=function(e,t){return r(e,$w.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var i=Object.getPrototypeOf(n.prototype).constructor;if(i!==Object){var o=r(t,$w.getFunctionName(i),i,!0),a=o.map((function(e){return e.metadata.filter((function(e){return e.key===Gw.UNMANAGED_TAG}))})),s=[].concat.apply([],a).length,u=o.length-s;return u>0?u:e(t,i)}return 0}}));G(aM);aM.getFunctionName,aM.getBaseClassDependencyCount,aM.getDependencies;var sM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var n=function(){function e(e,t,n,r,i){this.id=Yw.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=n}));G(sM);sM.Request;var uM=W((function(e,t){function n(e){return e._bindingDictionary}function r(e,t,n,r,i,o){var a=e?Gw.MULTI_INJECT_TAG:Gw.INJECT_TAG,s=new eM.Metadata(a,n),u=new oM.Target(t,r,n,s);if(void 0!==i){var l=new eM.Metadata(i,o);u.metadata.push(l)}return u}function i(e,t,n,r,i){var a=o(n.container,i.serviceIdentifier),s=[];return a.length===Kw.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),a=o(n.container,i.serviceIdentifier)),s=t?a:a.filter((function(e){var t=new sM.Request(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case Kw.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var i=$w.getServiceIdentifierAsString(e),a=Zw.NOT_REGISTERED;throw a+=$w.listMetadataForTarget(i,n),a+=$w.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a);case Kw.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case Kw.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;i=$w.getServiceIdentifierAsString(e),a=Zw.AMBIGUOUS_MATCH+" "+i;throw a+=$w.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a)}}(i.serviceIdentifier,s,i,n.container),s}function o(e,t){var r=[],i=n(e);return i.hasKey(t)?r=i.get(t):null!==e.parent&&(r=o(e.parent,t)),r}Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0,t.getBindingDictionary=n,t.plan=function(e,t,n,o,a,s,u,l){void 0===l&&(l=!1);var c=new Jw.Context(t),h=r(n,o,a,"",s,u);try{return function e(t,n,r,o,a,s){var u,l;if(null===a){u=i(t,n,o,null,s),l=new sM.Request(r,o,null,u,s);var c=new tM.Plan(o,l);o.addPlan(c)}else u=i(t,n,o,a,s),l=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(n){var r=null;if(s.isArray())r=l.addChildRequest(n.serviceIdentifier,n,s);else{if(n.cache)return;r=l}if(n.type===Ww.BindingTypeEnum.Instance&&null!==n.implementationType){var i=aM.getDependencies(t,n.implementationType);if(!o.container.options.skipBaseClassChecks){var a=aM.getBaseClassDependencyCount(t,n.implementationType);if(i.length<a){var u=Zw.ARGUMENTS_LENGTH_MISMATCH(aM.getFunctionName(n.implementationType));throw new Error(u)}}i.forEach((function(n){e(t,!1,n.serviceIdentifier,o,r,n)}))}}))}(e,l,a,c,null,h),c}catch(e){throw Qw.isStackOverflowExeption(e)&&c.plan&&$w.circularDependencyToException(c.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new oM.Target(Ww.TargetTypeEnum.Variable,"",t,new eM.Metadata(n,r)),o=new Jw.Context(e);return new sM.Request(t,o,null,[],i)}}));G(uM);uM.getBindingDictionary,uM.createMockRequest,uM.plan;var lM=W((function(e,t){var n=H&&H.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0,t.resolveInstance=function(e,t,r){var i,o,a=null;if(t.length>0){var s=t.filter((function(e){return null!==e.target&&e.target.type===Ww.TargetTypeEnum.ConstructorArgument})).map(r);o=s,a=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===Ww.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(a=new((i=e).bind.apply(i,n([void 0],o))),t,r)}else a=new e;return function(e,t){if(Reflect.hasMetadata(Gw.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(Gw.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(Zw.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,a),a}}));G(lM);lM.resolveInstance;var cM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var n=function(e,t,n){try{return n()}catch(n){throw Qw.isStackOverflowExeption(n)?new Error(Zw.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},r=function(e){return function(t){t.parentContext.setCurrentRequest(t);var i=t.bindings,o=t.childRequests,a=t.target&&t.target.isArray(),s=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(a&&s)return o.map((function(t){return r(e)(t)}));var u=null;if(!t.target.isOptional()||0!==i.length){var l=i[0],c=l.scope===Ww.BindingScopeEnum.Singleton,h=l.scope===Ww.BindingScopeEnum.Request;if(c&&l.activated)return l.cache;if(h&&null!==e&&e.has(l.id))return e.get(l.id);if(l.type===Ww.BindingTypeEnum.ConstantValue)u=l.cache,l.activated=!0;else if(l.type===Ww.BindingTypeEnum.Function)u=l.cache,l.activated=!0;else if(l.type===Ww.BindingTypeEnum.Constructor)u=l.implementationType;else if(l.type===Ww.BindingTypeEnum.DynamicValue&&null!==l.dynamicValue)u=n("toDynamicValue",l.serviceIdentifier,(function(){return l.dynamicValue(t.parentContext)}));else if(l.type===Ww.BindingTypeEnum.Factory&&null!==l.factory)u=n("toFactory",l.serviceIdentifier,(function(){return l.factory(t.parentContext)}));else if(l.type===Ww.BindingTypeEnum.Provider&&null!==l.provider)u=n("toProvider",l.serviceIdentifier,(function(){return l.provider(t.parentContext)}));else{if(l.type!==Ww.BindingTypeEnum.Instance||null===l.implementationType){var f=$w.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(Zw.INVALID_BINDING_TYPE+" "+f)}u=lM.resolveInstance(l.implementationType,o,r(e))}return"function"==typeof l.onActivation&&(u=l.onActivation(t.parentContext,u)),c&&(l.cache=u,l.activated=!0),h&&null!==e&&!e.has(l.id)&&e.set(l.id,u),u}}};t.resolve=function(e){return r(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}}));G(cM);cM.resolve;var hM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var n=function(e,t){var r=e.parentRequest;return null!==r&&(!!t(r)||n(r,t))};t.traverseAncerstors=n;var r=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new eM.Metadata(e,t),n}};t.taggedConstraint=r;var i=r(Gw.NAMED_TAG);t.namedConstraint=i;t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}}));G(hM);hM.typeConstraint,hM.namedConstraint,hM.taggedConstraint,hM.traverseAncerstors;var fM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new pM.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=hM.namedConstraint(e),new pM.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new pM.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=hM.taggedConstraint(e)(t),new pM.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return hM.typeConstraint(e)(t.parentRequest)},new pM.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return hM.namedConstraint(e)(t.parentRequest)},new pM.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return hM.taggedConstraint(e)(t)(n.parentRequest)},new pM.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return hM.traverseAncerstors(t,hM.typeConstraint(e))},new pM.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!hM.traverseAncerstors(t,hM.typeConstraint(e))},new pM.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return hM.traverseAncerstors(t,hM.namedConstraint(e))},new pM.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!hM.traverseAncerstors(t,hM.namedConstraint(e))},new pM.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return hM.traverseAncerstors(n,hM.taggedConstraint(e)(t))},new pM.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!hM.traverseAncerstors(n,hM.taggedConstraint(e)(t))},new pM.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return hM.traverseAncerstors(t,e)},new pM.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!hM.traverseAncerstors(t,e)},new pM.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=n}));G(fM);fM.BindingWhenSyntax;var pM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new fM.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=n}));G(pM);pM.BindingOnSyntax;var dM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new fM.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new pM.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=n}));G(dM);dM.BindingWhenOnSyntax;var vM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=Ww.BindingScopeEnum.Request,new dM.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=Ww.BindingScopeEnum.Singleton,new dM.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=Ww.BindingScopeEnum.Transient,new dM.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=n}));G(vM);vM.BindingInSyntax;var gM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new fM.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new pM.BindingOnSyntax(this._binding),this._bindingInSyntax=new vM.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=n}));G(gM);gM.BindingInWhenOnSyntax;var mM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=Ww.BindingTypeEnum.Instance,this._binding.implementationType=e,new gM.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+Zw.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=Ww.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Ww.BindingScopeEnum.Singleton,new dM.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=Ww.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new gM.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=Ww.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=Ww.BindingScopeEnum.Singleton,new dM.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=Ww.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=Ww.BindingScopeEnum.Singleton,new dM.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(Zw.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=Ww.BindingTypeEnum.Function,this._binding.scope=Ww.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=Ww.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=Ww.BindingScopeEnum.Singleton,new dM.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=Ww.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=Ww.BindingScopeEnum.Singleton,new dM.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=n}));G(mM);mM.BindingToSyntax;var yM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n}));G(yM);yM.ContainerSnapshot;var _M=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(Zw.NULL_ARGUMENT);if(null==t)throw new Error(Zw.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(Zw.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(Zw.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(Zw.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(Zw.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(Zw.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=n}));G(_M);_M.Lookup;var bM=W((function(e,t){var n=H&&H.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},r=H&&H.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=H&&H.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var o=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+Zw.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=Ww.BindingScopeEnum.Transient;else if(t.defaultScope!==Ww.BindingScopeEnum.Singleton&&t.defaultScope!==Ww.BindingScopeEnum.Transient&&t.defaultScope!==Ww.BindingScopeEnum.Request)throw new Error(""+Zw.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+Zw.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+Zw.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=Yw.id(),this._bindingDictionary=new _M.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new qw.MetadataReader}return e.merge=function(t,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var a=new e,s=i([t,n],r).map((function(e){return uM.getBindingDictionary(e)})),u=uM.getBindingDictionary(a);function l(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return s.forEach((function(e){l(e,u)})),a},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,i,o,a;return r(this,(function(r){switch(r.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,i=e,r.label=1;case 1:return n<i.length?(o=i[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||Ww.BindingScopeEnum.Transient,n=new Xw.Binding(e,t);return this._bindingDictionary.add(e,n),new mM.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(Zw.CANNOT_UNBIND+" "+$w.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new _M.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,Gw.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=uM.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(yM.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(Zw.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,Ww.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,Ww.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,Gw.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,Ww.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,Ww.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,Gw.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,s={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(s)))throw new Error(Zw.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(s);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=uM.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),cM.resolve(n)}},e}();t.Container=o}));G(bM);bM.Container;var xM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var n=function(e){this.id=Yw.id(),this.registry=e};t.ContainerModule=n;var r=function(e){this.id=Yw.id(),this.registry=e};t.AsyncContainerModule=r}));G(xM);xM.AsyncContainerModule,xM.ContainerModule;var SM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0,t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(Gw.PARAM_TYPES,e))throw new Error(Zw.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(Gw.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(Gw.PARAM_TYPES,t,e),e}}}));G(SM);SM.injectable;var EM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0,t.tagged=function(e,t){return function(n,r,i){var o=new eM.Metadata(e,t);"number"==typeof i?nM.tagParameter(n,r,i,o):nM.tagProperty(n,r,o)}}}));G(EM);EM.tagged;var AM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0,t.named=function(e){return function(t,n,r){var i=new eM.Metadata(Gw.NAMED_TAG,e);"number"==typeof r?nM.tagParameter(t,n,r,i):nM.tagProperty(t,n,i)}}}));G(AM);AM.named;var CM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0,t.optional=function(){return function(e,t,n){var r=new eM.Metadata(Gw.OPTIONAL_TAG,!0);"number"==typeof n?nM.tagParameter(e,t,n,r):nM.tagProperty(e,t,r)}}}));G(CM);CM.optional;var TM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0,t.unmanaged=function(){return function(e,t,n){var r=new eM.Metadata(Gw.UNMANAGED_TAG,!0);nM.tagParameter(e,t,n,r)}}}));G(TM);TM.unmanaged;var wM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0,t.multiInject=function(e){return function(t,n,r){var i=new eM.Metadata(Gw.MULTI_INJECT_TAG,e);"number"==typeof r?nM.tagParameter(t,n,r,i):nM.tagProperty(t,n,i)}}}));G(wM);wM.multiInject;var MM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0,t.targetName=function(e){return function(t,n,r){var i=new eM.Metadata(Gw.NAME_TAG,e);nM.tagParameter(t,n,r,i)}}}));G(MM);MM.targetName;var kM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0,t.postConstruct=function(){return function(e,t,n){var r=new eM.Metadata(Gw.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(Gw.POST_CONSTRUCT,e.constructor))throw new Error(Zw.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(Gw.POST_CONSTRUCT,r,e.constructor)}}}));G(kM);kM.postConstruct;var OM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0;t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}}));G(OM);OM.multiBindToService;var PM=W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=t.getServiceIdentifierAsString=t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=t.decorate=t.id=t.MetadataReader=t.postConstruct=t.targetName=t.multiInject=t.unmanaged=t.optional=t.LazyServiceIdentifer=t.inject=t.named=t.tagged=t.injectable=t.ContainerModule=t.AsyncContainerModule=t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=t.Container=t.METADATA_KEY=void 0,t.METADATA_KEY=Gw,Object.defineProperty(t,"Container",{enumerable:!0,get:function(){return bM.Container}}),Object.defineProperty(t,"BindingScopeEnum",{enumerable:!0,get:function(){return Ww.BindingScopeEnum}}),Object.defineProperty(t,"BindingTypeEnum",{enumerable:!0,get:function(){return Ww.BindingTypeEnum}}),Object.defineProperty(t,"TargetTypeEnum",{enumerable:!0,get:function(){return Ww.TargetTypeEnum}}),Object.defineProperty(t,"AsyncContainerModule",{enumerable:!0,get:function(){return xM.AsyncContainerModule}}),Object.defineProperty(t,"ContainerModule",{enumerable:!0,get:function(){return xM.ContainerModule}}),Object.defineProperty(t,"injectable",{enumerable:!0,get:function(){return SM.injectable}}),Object.defineProperty(t,"tagged",{enumerable:!0,get:function(){return EM.tagged}}),Object.defineProperty(t,"named",{enumerable:!0,get:function(){return AM.named}}),Object.defineProperty(t,"inject",{enumerable:!0,get:function(){return rM.inject}}),Object.defineProperty(t,"LazyServiceIdentifer",{enumerable:!0,get:function(){return rM.LazyServiceIdentifer}}),Object.defineProperty(t,"optional",{enumerable:!0,get:function(){return CM.optional}}),Object.defineProperty(t,"unmanaged",{enumerable:!0,get:function(){return TM.unmanaged}}),Object.defineProperty(t,"multiInject",{enumerable:!0,get:function(){return wM.multiInject}}),Object.defineProperty(t,"targetName",{enumerable:!0,get:function(){return MM.targetName}}),Object.defineProperty(t,"postConstruct",{enumerable:!0,get:function(){return kM.postConstruct}}),Object.defineProperty(t,"MetadataReader",{enumerable:!0,get:function(){return qw.MetadataReader}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return Yw.id}}),Object.defineProperty(t,"decorate",{enumerable:!0,get:function(){return nM.decorate}}),Object.defineProperty(t,"traverseAncerstors",{enumerable:!0,get:function(){return hM.traverseAncerstors}}),Object.defineProperty(t,"taggedConstraint",{enumerable:!0,get:function(){return hM.taggedConstraint}}),Object.defineProperty(t,"namedConstraint",{enumerable:!0,get:function(){return hM.namedConstraint}}),Object.defineProperty(t,"typeConstraint",{enumerable:!0,get:function(){return hM.typeConstraint}}),Object.defineProperty(t,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return $w.getServiceIdentifierAsString}}),Object.defineProperty(t,"multiBindToService",{enumerable:!0,get:function(){return OM.multiBindToService}})}));G(PM);PM.multiBindToService,PM.getServiceIdentifierAsString,PM.typeConstraint,PM.namedConstraint,PM.taggedConstraint,PM.traverseAncerstors;var LM=PM.decorate,IM=(PM.id,PM.MetadataReader,PM.postConstruct),RM=(PM.targetName,PM.multiInject,PM.unmanaged,PM.optional,PM.LazyServiceIdentifer,PM.inject),NM=(PM.named,PM.tagged,PM.injectable),DM=(PM.ContainerModule,PM.AsyncContainerModule,PM.TargetTypeEnum,PM.BindingTypeEnum,PM.BindingScopeEnum,PM.Container),FM=(PM.METADATA_KEY,W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,t)&&Reflect.defineMetadata(n,r(),this,t),Reflect.hasMetadata(n,this,t)?Reflect.getMetadata(n,this,t):r()},set:function(e){Reflect.defineMetadata(n,e,this,t)}})}t.makePropertyInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.get(n)}),t)}}},t.makePropertyInjectNamedDecorator=function(e,t){return function(n,i){return function(o,a){r(o,a,(function(){return e.getNamed(n,i)}),t)}}},t.makePropertyInjectTaggedDecorator=function(e,t){return function(n,i,o){return function(a,s){r(a,s,(function(){return e.getTagged(n,i,o)}),t)}}},t.makePropertyMultiInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.getAll(n)}),t)}}}})));G(FM);FM.makePropertyInjectDecorator,FM.makePropertyInjectNamedDecorator,FM.makePropertyInjectTaggedDecorator,FM.makePropertyMultiInjectDecorator;var BM=G(W((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return void 0===t&&(t=!0),{lazyInject:FM.makePropertyInjectDecorator(e,t),lazyInjectNamed:FM.makePropertyInjectNamedDecorator(e,t),lazyInjectTagged:FM.makePropertyInjectTaggedDecorator(e,t),lazyMultiInject:FM.makePropertyMultiInjectDecorator(e,t)}}}))),zM={f:ze},jM=q,UM=mt.f,VM=An.forEach,HM=Lt("hidden"),GM=Bt.set,WM=Bt.getterFor("Symbol"),YM=Object.prototype,XM=q.Symbol,ZM=XM&&XM.prototype,qM=q.TypeError,KM=q.QObject,QM=Nn.f,$M=mt.f,JM=xc.f,ek=Ln.f,tk=le([].push),nk=J("symbols"),rk=J("op-symbols"),ik=J("wks"),ok=!KM||!KM.prototype||!KM.prototype.findChild,ak=Ve&&ee((function(){return 7!=vs($M({},"a",{get:function(){return $M(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=QM(YM,t);r&&delete YM[t],$M(e,t,n),r&&e!==YM&&$M(YM,t,r)}:$M,sk=function(e,t){var n=nk[e]=vs(ZM);return GM(n,{type:"Symbol",tag:e,description:t}),Ve||(n.description=t),n},uk=function(e,t,n){e===YM&&uk(rk,t,n),$e(e);var r=pt(t);return $e(n),ge(nk,r)?(n.enumerable?(ge(e,HM)&&e[HM][r]&&(e[HM][r]=!1),n=vs(n,{enumerable:kt(0,!1)})):(ge(e,HM)||$M(e,HM,kt(1,{})),e[HM][r]=!0),ak(e,r,n)):$M(e,r,n)},lk=function(e,t){$e(e);var n=In(t),r=us(n).concat(pk(n));return VM(r,(function(t){Ve&&!et(ck,n,t)||uk(e,t,n[t])})),e},ck=function(e){var t=pt(e),n=et(ek,this,t);return!(this===YM&&ge(nk,t)&&!ge(rk,t))&&(!(n||!ge(this,t)||!ge(nk,t)||ge(this,HM)&&this[HM][t])||n)},hk=function(e,t){var n=In(e),r=pt(t);if(n!==YM||!ge(nk,r)||ge(rk,r)){var i=QM(n,r);return!i||!ge(nk,r)||ge(n,HM)&&n[HM][r]||(i.enumerable=!0),i}},fk=function(e){var t=JM(In(e)),n=[];return VM(t,(function(e){ge(nk,e)||ge(It,e)||tk(n,e)})),n},pk=function(e){var t=e===YM,n=JM(t?rk:In(e)),r=[];return VM(n,(function(e){!ge(nk,e)||t&&!ge(YM,e)||tk(r,nk[e])})),r};Ie||(ZM=(XM=function(){if(tt(ZM,this))throw qM("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Cr(arguments[0]):void 0,t=be(e),n=function(e){this===YM&&et(n,rk,e),ge(this,HM)&&ge(this[HM],t)&&(this[HM][t]=!1),ak(this,t,kt(1,e))};return Ve&&ok&&ak(YM,t,{configurable:!0,set:n}),sk(t,e)}).prototype,jt(ZM,"toString",(function(){return WM(this).tag})),jt(XM,"withoutSetter",(function(e){return sk(be(e),e)})),Ln.f=ck,mt.f=uk,ls.f=lk,Nn.f=hk,Yn.f=xc.f=fk,Xn.f=pk,zM.f=function(e){return sk(ze(e),e)},Ve&&($M(ZM,"description",{configurable:!0,get:function(){return WM(this).description}}),jt(YM,"propertyIsEnumerable",ck,{unsafe:!0}))),or({global:!0,constructor:!0,wrap:!0,forced:!Ie,sham:!Ie},{Symbol:XM}),VM(us(ik),(function(e){!function(e){var t=jM.Symbol||(jM.Symbol={});ge(t,e)||UM(t,e,{value:zM.f(e)})}(e)})),or({target:"Symbol",stat:!0,forced:!Ie},{useSetter:function(){ok=!0},useSimple:function(){ok=!1}}),or({target:"Object",stat:!0,forced:!Ie,sham:!Ve},{create:function(e,t){return void 0===t?vs(e):lk(vs(e),t)},defineProperty:uk,defineProperties:lk,getOwnPropertyDescriptor:hk}),or({target:"Object",stat:!0,forced:!Ie},{getOwnPropertyNames:fk}),function(){var e=Te("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=ze("toPrimitive");t&&!t[r]&&jt(t,r,(function(e){return et(n,this)}),{arity:1})}(),Hr(XM,"Symbol"),It[HM]=!0;var dk=Ie&&!!Symbol.for&&!!Symbol.keyFor,vk=J("string-to-symbol-registry"),gk=J("symbol-to-string-registry");or({target:"Symbol",stat:!0,forced:!dk},{for:function(e){var t=Cr(e);if(ge(vk,t))return vk[t];var n=Te("Symbol")(t);return vk[t]=n,gk[n]=t,n}});var mk=J("symbol-to-string-registry");or({target:"Symbol",stat:!0,forced:!dk},{keyFor:function(e){if(!rt(e))throw TypeError(ot(e)+" is not a symbol");if(ge(mk,e))return mk[e]}});var yk=Te("JSON","stringify"),_k=le(/./.exec),bk=le("".charAt),xk=le("".charCodeAt),Sk=le("".replace),Ek=le(1..toString),Ak=/[\uD800-\uDFFF]/g,Ck=/^[\uD800-\uDBFF]$/,Tk=/^[\uDC00-\uDFFF]$/,wk=!Ie||ee((function(){var e=Te("Symbol")();return"[null]"!=yk([e])||"{}"!=yk({a:e})||"{}"!=yk(Object(e))})),Mk=ee((function(){return'"\\udf06\\ud834"'!==yk("\udf06\ud834")||'"\\udead"'!==yk("\udead")})),kk=function(e,t){var n=ri(arguments),r=t;if((Ge(t)||void 0!==e)&&!rt(e))return ln(t)||(t=function(e,t){if(Ae(r)&&(t=et(r,this,e,t)),!rt(t))return t}),n[1]=t,ti(yk,null,n)},Ok=function(e,t,n){var r=bk(n,t-1),i=bk(n,t+1);return _k(Ck,e)&&!_k(Tk,i)||_k(Tk,e)&&!_k(Ck,r)?"\\u"+Ek(xk(e,0),16):e};yk&&or({target:"JSON",stat:!0,arity:3,forced:wk||Mk},{stringify:function(e,t,n){var r=ri(arguments),i=ti(wk?kk:yk,null,r);return Mk&&"string"==typeof i?Sk(i,Ak,Ok):i}});var Pk=!Ie||ee((function(){Xn.f(1)}));or({target:"Object",stat:!0,forced:Pk},{getOwnPropertySymbols:function(e){var t=Xn.f;return t?t(de(e)):[]}});var Lk=mt.f,Ik=q.Symbol,Rk=Ik&&Ik.prototype;if(Ve&&Ae(Ik)&&(!("description"in Rk)||void 0!==Ik().description)){var Nk={},Dk=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:Cr(arguments[0]),t=tt(Rk,this)?new Ik(e):void 0===e?Ik():Ik(e);return""===e&&(Nk[t]=!0),t};Kn(Dk,Ik),Dk.prototype=Rk,Rk.constructor=Dk;var Fk="Symbol(test)"==String(Ik("test")),Bk=le(Rk.valueOf),zk=le(Rk.toString),jk=/^Symbol\((.*)\)[^)]+$/,Uk=le("".replace),Vk=le("".slice);Lk(Rk,"description",{configurable:!0,get:function(){var e=Bk(this);if(ge(Nk,e))return"";var t=zk(e),n=Fk?Vk(t,7,-1):Uk(t,jk,"$1");return""===n?void 0:n}}),or({global:!0,constructor:!0,forced:!0},{Symbol:Dk})}var Hk={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")};wc("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),vv);var Gk=Xk,Wk=Xk,Yk=1e20;function Xk(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer,u="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;u?this.canvas=my.createOffscreenCanvas(a,a,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=u?Math.round(a/2*1):Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Zk(e,t,n,r,i,o){for(var a=0;a<t;a++)qk(e,a,t,n,r,i,o);for(var s=0;s<n;s++)qk(e,s*t,1,t,r,i,o)}function qk(e,t,n,r,i,o,a){var s,u,l,c;for(o[0]=0,a[0]=-Yk,a[1]=Yk,s=0;s<r;s++)i[s]=e[t+s*n];for(s=1,u=0,l=0;s<r;s++){do{c=o[u],l=(i[s]-i[c]+s*s-c*c)/(s-c)/2}while(l<=a[u]&&--u>-1);o[++u]=s,a[u]=l,a[u+1]=Yk}for(s=0,u=0;s<r;s++){for(;a[u+1]<s;)u++;c=o[u],e[t+s*n]=i[c]+(s-c)*(s-c)}}Xk.prototype._draw=function(e,t){var n,r,i,o,a,s,u,l,c,h=this.ctx.measureText(e),f=h.width,p=2*this.buffer;t&&this.useMetrics?(a=Math.floor(h.actualBoundingBoxAscent),l=this.buffer+Math.ceil(h.actualBoundingBoxAscent),s=this.buffer,u=this.buffer,n=(r=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+p,i=(o=Math.min(this.size-s,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+p,this.ctx.textBaseline="alphabetic"):(n=r=this.size,i=o=this.size,a=19*this.fontSize/24,s=u=0,l=this.middle,this.ctx.textBaseline="middle"),r&&o&&(this.ctx.clearRect(u,s,r,o),this.ctx.fillText(e,this.buffer,l),c=this.ctx.getImageData(u,s,r,o));var d=new Uint8ClampedArray(n*i);return function(e,t,n,r,i,o,a){o.fill(Yk,0,t*n),a.fill(0,0,t*n);for(var s=(t-r)/2,u=0;u<i;u++)for(var l=0;l<r;l++){var c=(u+s)*t+l+s,h=e.data[4*(u*r+l)+3]/255;if(1===h)o[c]=0,a[c]=Yk;else if(0===h)o[c]=Yk,a[c]=0;else{var f=Math.max(0,.5-h),p=Math.max(0,h-.5);o[c]=f*f,a[c]=p*p}}}(c,n,i,r,o,this.gridOuter,this.gridInner),Zk(this.gridOuter,n,i,this.f,this.v,this.z),Zk(this.gridInner,n,i,this.f,this.v,this.z),function(e,t,n,r,i,o,a){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}(d,n,i,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:d,metrics:{width:r,height:o,sdfWidth:n,sdfHeight:i,top:a,left:0,advance:f}}},Xk.prototype.draw=function(e){return this._draw(e,!1).data},Xk.prototype.drawWithMetrics=function(e){return this._draw(e,!0)},Gk.default=Wk;var Kk=Math.log,Qk=Math.LN2;or({target:"Math",stat:!0},{log2:function(e){return Kk(e)/Qk}});var $k;function Jk(e,t,n){var r,i=j(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;e[a.id]=v(v({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(e){i.e(e)}finally{i.f()}}function eO(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var tO=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function nO(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function rO(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var iO=NM()($k=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"fontAtlas",void 0),E(P(e),"iconFontMap",void 0),E(P(e),"iconFontGlyphs",{}),E(P(e),"fontOptions",void 0),E(P(e),"key",void 0),E(P(e),"cache",new Hm(3)),e}return S(n,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:tO,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"addIconFont",value:function(e,t){this.iconFontMap.set(e,t)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=v(v({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(e,t){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(e,"';\n            src: url('").concat(t,"') format('woff2'),\n            url('").concat(t,"') format('woff'),\n            url('").concat(t,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(e),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:e})}))}catch(e){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(e)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,l=r.radius,c=r.cutoff,h=r.iconfont,f=n&&n.data;f||((f=Zv.document.createElement("canvas")).width=1024);var p=f.getContext("2d");nO(p,i,a,o);var d=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,u=e.xOffset,l=void 0===u?0:u,c=e.yOffset,h=void 0===c?0:c,f=0,p=l;Array.from(t).forEach((function(e,t){if(!s[e]){var r=n(e,t);p+30>o&&(p=0,f++),s[e]={x:p,y:h+30*f,width:30,height:30,advance:r},p+=30}}));var d=r+2*i;return{mapping:s,xOffset:p,yOffset:h+f*d,canvasHeight:eO(h+(f+1)*d)}}(v({getFontWidth:function(e){return p.measureText(e).width},fontHeight:1*a,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),g=d.mapping,m=d.canvasHeight,y=d.xOffset,_=d.yOffset,b=p.getImageData(0,0,f.width,f.height);if(f.height=m,p.putImageData(b,0,0),nO(p,i,a,o),u){var x,S=new Gk(a,s,l,c,i,o),E=p.getImageData(0,0,S.size,S.size),A=j(t);try{for(A.s();!(x=A.n()).done;){var C=x.value;if(h){var T=String.fromCharCode(parseInt(C.replace("&#x","").replace(";",""),16));rO(S.draw(T),E)}else rO(S.draw(C),E);p.putImageData(E,g[C].x,g[C].y)}}catch(e){A.e(e)}finally{A.f()}}else{var w,M=j(t);try{for(M.s();!(w=M.n()).done;){var k=w.value;p.fillText(k,g[k].x,g[k].y+1*a)}}catch(e){M.e(e)}finally{M.f()}}return{xOffset:y,yOffset:_,mapping:g,data:f,width:f.width,height:f.height}}},{key:"getKey",value:function(){return"key"}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(t).forEach((function(e){o.has(e)||r.push(e)})),r}}]),n}(Kx))||$k,oO=ze("iterator"),aO=!ee((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[oO]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),sO=function(e,t,n){return n.get&&zt(n.get,t,{getter:!0}),n.set&&zt(n.set,t,{setter:!0}),mt.f(e,t,n)},uO=/[^\0-\u007E]/,lO=/[.\u3002\uFF0E\uFF61]/g,cO="Overflow: input needs wider integers to process",hO=RangeError,fO=le(lO.exec),pO=Math.floor,dO=String.fromCharCode,vO=le("".charCodeAt),gO=le([].join),mO=le([].push),yO=le("".replace),_O=le("".split),bO=le("".toLowerCase),xO=function(e){return e+22+75*(e<26)},SO=function(e,t,n){var r=0;for(e=n?pO(e/700):e>>1,e+=pO(e/t);e>455;)e=pO(e/35),r+=36;return pO(r+36*e/(e+38))},EO=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=vO(e,n++);if(i>=55296&&i<=56319&&n<r){var o=vO(e,n++);56320==(64512&o)?mO(t,((1023&i)<<10)+(1023&o)+65536):(mO(t,i),n--)}else mO(t,i)}return t}(e)).length,o=128,a=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&mO(r,dO(n));var u=r.length,l=u;for(u&&mO(r,"-");l<i;){var c=2147483647;for(t=0;t<e.length;t++)(n=e[t])>=o&&n<c&&(c=n);var h=l+1;if(c-o>pO((2147483647-a)/h))throw hO(cO);for(a+=(c-o)*h,o=c,t=0;t<e.length;t++){if((n=e[t])<o&&++a>2147483647)throw hO(cO);if(n==o){for(var f=a,p=36;;){var d=p<=s?1:p>=s+26?26:p-s;if(f<d)break;var v=f-d,g=36-d;mO(r,dO(xO(d+v%g))),f=pO(v/g),p+=36}mO(r,dO(xO(f))),s=SO(a,h,l==u),a=0,l++}}a++,o++}return gO(r,"")},AO=ze("iterator"),CO=Bt.set,TO=Bt.getterFor("URLSearchParams"),wO=Bt.getterFor("URLSearchParamsIterator"),MO=Object.getOwnPropertyDescriptor,kO=function(e){if(!Ve)return q[e];var t=MO(q,e);return t&&t.value},OO=kO("fetch"),PO=kO("Request"),LO=kO("Headers"),IO=PO&&PO.prototype,RO=LO&&LO.prototype,NO=q.RegExp,DO=q.TypeError,FO=q.decodeURIComponent,BO=q.encodeURIComponent,zO=le("".charAt),jO=le([].join),UO=le([].push),VO=le("".replace),HO=le([].shift),GO=le([].splice),WO=le("".split),YO=le("".slice),XO=/\+/g,ZO=Array(4),qO=function(e){return ZO[e-1]||(ZO[e-1]=NO("((?:%[\\da-f]{2}){"+e+"})","gi"))},KO=function(e){try{return FO(e)}catch(t){return e}},QO=function(e){var t=VO(e,XO," "),n=4;try{return FO(t)}catch(e){for(;n;)t=VO(t,qO(n--),KO);return t}},$O=/[!'()~]|%20/g,JO={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},eP=function(e){return JO[e]},tP=function(e){return VO(BO(e),$O,eP)},nP=tc((function(e,t){CO(this,{type:"URLSearchParamsIterator",iterator:No(TO(e).entries),kind:t})}),"Iterator",(function(){var e=wO(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),rP=function(e){this.entries=[],this.url=null,void 0!==e&&(Ge(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===zO(e,0)?YO(e,1):e:Cr(e)))};rP.prototype={type:"URLSearchParams",bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,a,s,u=Io(e);if(u)for(n=(t=No(e,u)).next;!(r=et(n,t)).done;){if(o=(i=No($e(r.value))).next,(a=et(o,i)).done||(s=et(o,i)).done||!et(o,i).done)throw DO("Expected sequence with length 2");UO(this.entries,{key:Cr(a.value),value:Cr(s.value)})}else for(var l in e)ge(e,l)&&UO(this.entries,{key:l,value:Cr(e[l])})},parseQuery:function(e){if(e)for(var t,n,r=WO(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=WO(t,"="),UO(this.entries,{key:QO(HO(n)),value:QO(jO(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],UO(n,tP(e.key)+"="+tP(e.value));return jO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var iP=function(){Xr(this,oP);var e=arguments.length>0?arguments[0]:void 0;CO(this,new rP(e))},oP=iP.prototype;if(yc(oP,{append:function(e,t){oi(arguments.length,2);var n=TO(this);UO(n.entries,{key:Cr(e),value:Cr(t)}),n.updateURL()},delete:function(e){oi(arguments.length,1);for(var t=TO(this),n=t.entries,r=Cr(e),i=0;i<n.length;)n[i].key===r?GO(n,i,1):i++;t.updateURL()},get:function(e){oi(arguments.length,1);for(var t=TO(this).entries,n=Cr(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){oi(arguments.length,1);for(var t=TO(this).entries,n=Cr(e),r=[],i=0;i<t.length;i++)t[i].key===n&&UO(r,t[i].value);return r},has:function(e){oi(arguments.length,1);for(var t=TO(this).entries,n=Cr(e),r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){oi(arguments.length,1);for(var n,r=TO(this),i=r.entries,o=!1,a=Cr(e),s=Cr(t),u=0;u<i.length;u++)(n=i[u]).key===a&&(o?GO(i,u--,1):(o=!0,n.value=s));o||UO(i,{key:a,value:s}),r.updateURL()},sort:function(){var e=TO(this);kd(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=TO(this).entries,r=Qt(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new nP(this,"keys")},values:function(){return new nP(this,"values")},entries:function(){return new nP(this,"entries")}},{enumerable:!0}),jt(oP,AO,oP.entries,{name:"entries"}),jt(oP,"toString",(function(){return TO(this).serialize()}),{enumerable:!0}),Hr(iP,"URLSearchParams"),or({global:!0,constructor:!0,forced:!aO},{URLSearchParams:iP}),!aO&&Ae(LO)){var aP=le(RO.has),sP=le(RO.set),uP=function(e){if(Ge(e)){var t,n=e.body;if("URLSearchParams"===Gt(n))return t=e.headers?new LO(e.headers):new LO,aP(t,"content-type")||sP(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),vs(e,{body:kt(0,Cr(n)),headers:kt(0,t)})}return e};if(Ae(OO)&&or({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return OO(e,arguments.length>1?uP(arguments[1]):{})}}),Ae(PO)){var lP=function(e){return Xr(this,IO),new PO(e,arguments.length>1?uP(arguments[1]):{})};IO.constructor=lP,lP.prototype=IO,or({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:lP})}}var cP={URLSearchParams:iP,getState:TO},hP=zs.codeAt,fP=Bt.set,pP=Bt.getterFor("URL"),dP=cP.URLSearchParams,vP=cP.getState,gP=q.URL,mP=q.TypeError,yP=q.parseInt,_P=Math.floor,bP=Math.pow,xP=le("".charAt),SP=le(/./.exec),EP=le([].join),AP=le(1..toString),CP=le([].pop),TP=le([].push),wP=le("".replace),MP=le([].shift),kP=le("".split),OP=le("".slice),PP=le("".toLowerCase),LP=le([].unshift),IP=/[a-z]/i,RP=/[\d+-.a-z]/i,NP=/\d/,DP=/^0x/i,FP=/^[0-7]+$/,BP=/^\d+$/,zP=/^[\da-f]+$/i,jP=/[\0\t\n\r #%/:<>?@[\\\]^|]/,UP=/[\0\t\n\r #/:<>?@[\\\]^|]/,VP=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,HP=/[\t\n\r]/g,GP=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)LP(t,e%256),e=_P(e/256);return EP(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=AP(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},WP={},YP=zl({},WP,{" ":1,'"':1,"<":1,">":1,"`":1}),XP=zl({},YP,{"#":1,"?":1,"{":1,"}":1}),ZP=zl({},XP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),qP=function(e,t){var n=hP(e,0);return n>32&&n<127&&!ge(t,e)?e:encodeURIComponent(e)},KP={ftp:21,file:null,http:80,https:443,ws:80,wss:443},QP=function(e,t){var n;return 2==e.length&&SP(IP,xP(e,0))&&(":"==(n=xP(e,1))||!t&&"|"==n)},$P=function(e){var t;return e.length>1&&QP(OP(e,0,2))&&(2==e.length||"/"===(t=xP(e,2))||"\\"===t||"?"===t||"#"===t)},JP=function(e){return"."===e||"%2e"===PP(e)},eL={},tL={},nL={},rL={},iL={},oL={},aL={},sL={},uL={},lL={},cL={},hL={},fL={},pL={},dL={},vL={},gL={},mL={},yL={},_L={},bL={},xL=function(e,t,n){var r,i,o,a=Cr(e);if(t){if(i=this.parse(a))throw mP(i);this.searchParams=null}else{if(void 0!==n&&(r=new xL(n,!0)),i=this.parse(a,null,r))throw mP(i);(o=vP(new dP)).bindURL(this),this.searchParams=o}};xL.prototype={type:"URL",parse:function(e,t,n){var r,i,o,a,s,u=this,l=t||eL,c=0,h="",f=!1,p=!1,d=!1;for(e=Cr(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=wP(e,VP,"")),e=wP(e,HP,""),r=gS(e);c<=r.length;){switch(i=r[c],l){case eL:if(!i||!SP(IP,i)){if(t)return"Invalid scheme";l=nL;continue}h+=PP(i),l=tL;break;case tL:if(i&&(SP(RP,i)||"+"==i||"-"==i||"."==i))h+=PP(i);else{if(":"!=i){if(t)return"Invalid scheme";h="",l=nL,c=0;continue}if(t&&(u.isSpecial()!=ge(KP,h)||"file"==h&&(u.includesCredentials()||null!==u.port)||"file"==u.scheme&&!u.host))return;if(u.scheme=h,t)return void(u.isSpecial()&&KP[u.scheme]==u.port&&(u.port=null));h="","file"==u.scheme?l=pL:u.isSpecial()&&n&&n.scheme==u.scheme?l=rL:u.isSpecial()?l=sL:"/"==r[c+1]?(l=iL,c++):(u.cannotBeABaseURL=!0,TP(u.path,""),l=yL)}break;case nL:if(!n||n.cannotBeABaseURL&&"#"!=i)return"Invalid scheme";if(n.cannotBeABaseURL&&"#"==i){u.scheme=n.scheme,u.path=hu(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,l=bL;break}l="file"==n.scheme?pL:oL;continue;case rL:if("/"!=i||"/"!=r[c+1]){l=oL;continue}l=uL,c++;break;case iL:if("/"==i){l=lL;break}l=mL;continue;case oL:if(u.scheme=n.scheme,null==i)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=hu(n.path),u.query=n.query;else if("/"==i||"\\"==i&&u.isSpecial())l=aL;else if("?"==i)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=hu(n.path),u.query="",l=_L;else{if("#"!=i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=hu(n.path),u.path.length--,l=mL;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=hu(n.path),u.query=n.query,u.fragment="",l=bL}break;case aL:if(!u.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,l=mL;continue}l=lL}else l=uL;break;case sL:if(l=uL,"/"!=i||"/"!=xP(h,c+1))continue;c++;break;case uL:if("/"!=i&&"\\"!=i){l=lL;continue}break;case lL:if("@"==i){f&&(h="%40"+h),f=!0,o=gS(h);for(var v=0;v<o.length;v++){var g=o[v];if(":"!=g||d){var m=qP(g,ZP);d?u.password+=m:u.username+=m}else d=!0}h=""}else if(null==i||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(f&&""==h)return"Invalid authority";c-=gS(h).length+1,h="",l=cL}else h+=i;break;case cL:case hL:if(t&&"file"==u.scheme){l=vL;continue}if(":"!=i||p){if(null==i||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(u.isSpecial()&&""==h)return"Invalid host";if(t&&""==h&&(u.includesCredentials()||null!==u.port))return;if(a=u.parseHost(h))return a;if(h="",l=gL,t)return;continue}"["==i?p=!0:"]"==i&&(p=!1),h+=i}else{if(""==h)return"Invalid host";if(a=u.parseHost(h))return a;if(h="",l=fL,t==hL)return}break;case fL:if(!SP(NP,i)){if(null==i||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()||t){if(""!=h){var y=yP(h,10);if(y>65535)return"Invalid port";u.port=u.isSpecial()&&y===KP[u.scheme]?null:y,h=""}if(t)return;l=gL;continue}return"Invalid port"}h+=i;break;case pL:if(u.scheme="file","/"==i||"\\"==i)l=dL;else{if(!n||"file"!=n.scheme){l=mL;continue}if(null==i)u.host=n.host,u.path=hu(n.path),u.query=n.query;else if("?"==i)u.host=n.host,u.path=hu(n.path),u.query="",l=_L;else{if("#"!=i){$P(EP(hu(r,c),""))||(u.host=n.host,u.path=hu(n.path),u.shortenPath()),l=mL;continue}u.host=n.host,u.path=hu(n.path),u.query=n.query,u.fragment="",l=bL}}break;case dL:if("/"==i||"\\"==i){l=vL;break}n&&"file"==n.scheme&&!$P(EP(hu(r,c),""))&&(QP(n.path[0],!0)?TP(u.path,n.path[0]):u.host=n.host),l=mL;continue;case vL:if(null==i||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&QP(h))l=mL;else if(""==h){if(u.host="",t)return;l=gL}else{if(a=u.parseHost(h))return a;if("localhost"==u.host&&(u.host=""),t)return;h="",l=gL}continue}h+=i;break;case gL:if(u.isSpecial()){if(l=mL,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(null!=i&&(l=mL,"/"!=i))continue}else u.fragment="",l=bL;else u.query="",l=_L;break;case mL:if(null==i||"/"==i||"\\"==i&&u.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=PP(s=h))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(u.shortenPath(),"/"==i||"\\"==i&&u.isSpecial()||TP(u.path,"")):JP(h)?"/"==i||"\\"==i&&u.isSpecial()||TP(u.path,""):("file"==u.scheme&&!u.path.length&&QP(h)&&(u.host&&(u.host=""),h=xP(h,0)+":"),TP(u.path,h)),h="","file"==u.scheme&&(null==i||"?"==i||"#"==i))for(;u.path.length>1&&""===u.path[0];)MP(u.path);"?"==i?(u.query="",l=_L):"#"==i&&(u.fragment="",l=bL)}else h+=qP(i,XP);break;case yL:"?"==i?(u.query="",l=_L):"#"==i?(u.fragment="",l=bL):null!=i&&(u.path[0]+=qP(i,WP));break;case _L:t||"#"!=i?null!=i&&("'"==i&&u.isSpecial()?u.query+="%27":u.query+="#"==i?"%23":qP(i,WP)):(u.fragment="",l=bL);break;case bL:null!=i&&(u.fragment+=qP(i,YP))}c++}},parseHost:function(e){var t,n,r;if("["==xP(e,0)){if("]"!=xP(e,e.length-1))return"Invalid host";if(!(t=function(e){var t,n,r,i,o,a,s,u=[0,0,0,0,0,0,0,0],l=0,c=null,h=0,f=function(){return xP(e,h)};if(":"==f()){if(":"!=xP(e,1))return;h+=2,c=++l}for(;f();){if(8==l)return;if(":"!=f()){for(t=n=0;n<4&&SP(zP,f());)t=16*t+yP(f(),16),h++,n++;if("."==f()){if(0==n)return;if(h-=n,l>6)return;for(r=0;f();){if(i=null,r>0){if(!("."==f()&&r<4))return;h++}if(!SP(NP,f()))return;for(;SP(NP,f());){if(o=yP(f(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;h++}u[l]=256*u[l]+i,2!=++r&&4!=r||l++}if(4!=r)return;break}if(":"==f()){if(h++,!f())return}else if(f())return;u[l++]=t}else{if(null!==c)return;h++,c=++l}}if(null!==c)for(a=l-c,l=7;0!=l&&a>0;)s=u[l],u[l--]=u[c+a-1],u[c+--a]=s;else if(8!=l)return;return u}(OP(e,1,-1))))return"Invalid host";this.host=t}else if(this.isSpecial()){if(e=function(e){var t,n,r=[],i=_O(yO(bO(e),lO,"."),".");for(t=0;t<i.length;t++)n=i[t],mO(r,fO(uO,n)?"xn--"+EO(n):n);return gO(r,".")}(e),SP(jP,e))return"Invalid host";if(null===(t=function(e){var t,n,r,i,o,a,s,u=kP(e,".");if(u.length&&""==u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(o=10,i.length>1&&"0"==xP(i,0)&&(o=SP(DP,i)?16:8,i=OP(i,8==o?1:2)),""===i)a=0;else{if(!SP(10==o?BP:8==o?FP:zP,i))return e;a=yP(i,o)}TP(n,a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=bP(256,5-t))return null}else if(a>255)return null;for(s=CP(n),r=0;r<n.length;r++)s+=n[r]*bP(256,3-r);return s}(e)))return"Invalid host";this.host=t}else{if(SP(UP,e))return"Invalid host";for(t="",n=gS(e),r=0;r<n.length;r++)t+=qP(n[r],WP);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return ge(KP,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&QP(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,u=e.fragment,l=t+":";return null!==i?(l+="//",e.includesCredentials()&&(l+=n+(r?":"+r:"")+"@"),l+=GP(i),null!==o&&(l+=":"+o)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+EP(a,"/"):"",null!==s&&(l+="?"+s),null!==u&&(l+="#"+u),l},setHref:function(e){var t=this.parse(e);if(t)throw mP(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new EL(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+GP(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Cr(e)+":",eL)},getUsername:function(){return this.username},setUsername:function(e){var t=gS(Cr(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=qP(t[n],ZP)}},getPassword:function(){return this.password},setPassword:function(e){var t=gS(Cr(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=qP(t[n],ZP)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?GP(e):GP(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,cL)},getHostname:function(){var e=this.host;return null===e?"":GP(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,hL)},getPort:function(){var e=this.port;return null===e?"":Cr(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=Cr(e))?this.port=null:this.parse(e,fL))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+EP(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,gL))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=Cr(e))?this.query=null:("?"==xP(e,0)&&(e=OP(e,1)),this.query="",this.parse(e,_L)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=Cr(e))?("#"==xP(e,0)&&(e=OP(e,1)),this.fragment="",this.parse(e,bL)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var SL,EL=function(e){var t=Xr(this,AL),n=oi(arguments.length,1)>1?arguments[1]:void 0,r=fP(t,new xL(e,!1,n));Ve||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},AL=EL.prototype,CL=function(e,t){return{get:function(){return pP(this)[e]()},set:t&&function(e){return pP(this)[t](e)},configurable:!0,enumerable:!0}};if(Ve&&(sO(AL,"href",CL("serialize","setHref")),sO(AL,"origin",CL("getOrigin")),sO(AL,"protocol",CL("getProtocol","setProtocol")),sO(AL,"username",CL("getUsername","setUsername")),sO(AL,"password",CL("getPassword","setPassword")),sO(AL,"host",CL("getHost","setHost")),sO(AL,"hostname",CL("getHostname","setHostname")),sO(AL,"port",CL("getPort","setPort")),sO(AL,"pathname",CL("getPathname","setPathname")),sO(AL,"search",CL("getSearch","setSearch")),sO(AL,"searchParams",CL("getSearchParams")),sO(AL,"hash",CL("getHash","setHash"))),jt(AL,"toJSON",(function(){return pP(this).serialize()}),{enumerable:!0}),jt(AL,"toString",(function(){return pP(this).serialize()}),{enumerable:!0}),gP){var TL=gP.createObjectURL,wL=gP.revokeObjectURL;TL&&jt(EL,"createObjectURL",Qt(TL,gP)),wL&&jt(EL,"revokeObjectURL",Qt(wL,gP))}Hr(EL,"URL"),or({global:!0,constructor:!0,forced:!aO,sham:!Ve},{URL:EL});var ML,kL,OL,PL=NM()(SL=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"canvasHeight",128),E(P(e),"texture",void 0),E(P(e),"canvas",void 0),E(P(e),"iconData",void 0),E(P(e),"iconMap",void 0),E(P(e),"ctx",void 0),E(P(e),"loadingImageCount",0),e}return S(n,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Zv.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(e,t){var n=this,r=new Image;if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImage(t).then((function(t){r=t;var i=n.iconData.find((function(t){return t.id===e}));i&&(i.image=r,i.width=r.width,i.height=r.height),n.update()}))}},{key:"addImageMini",value:function(e,t,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImageMini(t,i).then((function(t){o=t;var n=r.iconData.find((function(t){return t.id===e}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,h=l/c,f=s/c;o&&e.ctx.drawImage(o,r+(64-f)/2,i+(64-h)/2,f,h)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,o=0,a=0,s=[],u={},l=j(e);try{for(l.s();!(r=l.n()).done;){var c=r.value;if(!u[c.id]){var h=c.size;i+h+t>n&&(Jk(u,s,o),i=0,o=a+o+t,a=0,s=[]),s.push({icon:c,xOffset:i}),i=i+h+t,a=Math.max(a,h)}}}catch(e){l.e(e)}finally{l.f()}return s.length>0&&Jk(u,s,o),{mapping:u,canvasHeight:eO(a+o+t)}}(this.iconData,3,1024),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImageMini",value:function(e,t){return new Promise((function(n,r){var i=t.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+e))},i.src=e}))}}]),n}(Kx))||SL,LL=NM()(ML=function(){function e(){b(this,e),E(this,"viewport",void 0),E(this,"overridedViewProjectionMatrix",void 0),E(this,"jitteredViewProjectionMatrix",void 0),E(this,"jitteredProjectionMatrix",void 0),E(this,"viewMatrixInverse",void 0),E(this,"cameraPosition",void 0)}return S(e,[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=W_(),q_(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=D(this.viewport.getCenter(),2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}},{key:"jitterProjectionMatrix",value:function(e,t){var n=nb(W_(),[e,t,0]);this.jitteredProjectionMatrix=K_(W_(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=K_(W_(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||ML,IL=ll.values;or({target:"Object",stat:!0},{values:function(e){return IL(e)}}),(kL=e.PositionType||(e.PositionType={})).TOPRIGHT="topright",kL.TOPLEFT="topleft",kL.BOTTOMRIGHT="bottomright",kL.BOTTOMLEFT="bottomleft",kL.TOPCENTER="topcenter",kL.BOTTOMCENTER="bottomcenter",kL.LEFTCENTER="leftcenter",kL.RIGHTCENTER="rightcenter",kL.LEFTTOP="lefttop",kL.RIGHTTOP="righttop",kL.LEFTBOTTOM="leftbottom",kL.RIGHTBOTTOM="rightbottom";var RL,NL,DL,FL={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},BL=NM()(OL=function(){function t(){b(this,t),E(this,"container",void 0),E(this,"controlCorners",void 0),E(this,"controlContainer",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"controls",[]),E(this,"unAddControls",[])}return S(t,[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.get(Hk.IMapService),this.initControlPos()}},{key:"addControl",value:function(e,t){t.get(Hk.IMapService).map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=j(this.controls);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",r=this.controlContainer=eg("div","l7-control-container",this.container);Object.values(e.PositionType).forEach((function(e){var i,o;!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=e.map((function(e){return n+e})).join(" ");t[e.filter((function(e){return!["row","column"].includes(e)})).join("")]=eg("div",i,r)}((i=e,o=i.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat(F(o),[FL[i]])))}))}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&tg(this.controlCorners[e]);this.controlContainer&&tg(this.controlContainer)}}]),t}())||OL,zL=NM()(RL=function(){function e(){b(this,e),E(this,"container",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"markers",[]),E(this,"markerLayers",[]),E(this,"unAddMarkers",[]),E(this,"unAddMarkerLayers",[])}return S(e,[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(Hk.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}]),e}())||RL,jL=NM()(NL=function(){function e(){b(this,e),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"popups",[]),E(this,"unAddPopups",[])}return S(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(e){e.isOpen()&&e.remove();var t=this.popups.indexOf(e);t>-1&&this.popups.splice(t,1);var n=this.unAddPopups.indexOf(e);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(e){return e.remove()}))}},{key:"addPopup",value:function(e){var t=this;e&&e.getOptions().autoClose&&[].concat(F(this.popups),F(this.unAddPopups)).forEach((function(e){e.getOptions().autoClose&&t.removePopup(e)})),this.isMarkerReady?(e.addTo(this.scene),this.popups.push(e)):this.unAddPopups.push(e),e.on("close",(function(){t.removePopup(e)}))}},{key:"initPopup",value:function(){var e=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(t){e.addPopup(t),e.unAddPopups=[]}))}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(Hk.IMapService)}}]),e}())||NL,UL=ZC((function(e,t,n){YC(e,t,n)})),VL={MapToken:"您正在使用 Demo测试地图token，如果生产环境中使用去对应地图请注册Token",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},HL={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},GL={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},WL=NM()(DL=function(){function e(){b(this,e),E(this,"sceneConfigCache",{}),E(this,"layerConfigCache",{})}return S(e,[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return VL[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=v(v({},HL),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=v({},UL({},this.sceneConfigCache[e],GL,n))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||DL,YL=Math.sign||function(e){var t=+e;return 0==t||t!=t?t:t<0?-1:1},XL=Math.abs,ZL=Math.pow,qL=ZL(2,-52),KL=ZL(2,-23),QL=ZL(2,127)*(2-KL),$L=ZL(2,-126),JL=Math.fround||function(e){var t,n,r=+e,i=XL(r),o=YL(r);return i<$L?o*function(e){return e+1/qL-1/qL}(i/$L/KL)*$L*KL:(n=(t=(1+KL/qL)*i)-(t-i))>QL||n!=n?o*(1/0):o*n};or({target:"Math",stat:!0},{fround:JL});var eI,tI=Math.PI/180;function nI(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,o=e.scale,a=e.highPrecision,s=void 0!==a&&a,u=e.flipY,l=void 0!==u&&u,c={},h=512*(o=void 0!==o?o:Math.pow(2,i)),f=Math.cos(n*tI),p=h/360,d=p/f,v=h/4003e4/f;if(c.pixelsPerMeter=[v,-v,v],c.metersPerPixel=[1/v,-1/v,1/v],c.pixelsPerDegree=[p,-d,v],c.degreesPerPixel=[1/p,-1/d,1/v],s){var g=tI*Math.tan(n*tI)/f,m=p*g/2,y=h/4003e4*g,_=y/d*v;c.pixelsPerDegree2=[0,-m,y],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}(eI=e.CoordinateSystem||(e.CoordinateSystem={}))[eI.LNGLAT=1]="LNGLAT",eI[eI.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",eI[eI.VECTOR_TILE=3]="VECTOR_TILE",eI[eI.IDENTITY=4]="IDENTITY",eI[eI.P20=5]="P20",eI[eI.P20_OFFSET=6]="P20_OFFSET",eI[eI.METER_OFFSET=7]="METER_OFFSET",eI[eI.P20_2=8]="P20_2";var rI,iI,oI,aI,sI,uI,lI,cI,hI,fI,pI,dI={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},vI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],gI=(rI=NM(),iI=RM(Hk.ICameraService),rI((sI=V((aI=function(){function t(){b(this,t),E(this,"needRefresh",!0),U(this,"cameraService",sI,this),E(this,"coordinateSystem",void 0),E(this,"viewportCenter",void 0),E(this,"viewportCenterProjection",void 0),E(this,"pixelsPerDegree",void 0),E(this,"pixelsPerDegree2",void 0),E(this,"pixelsPerMeter",void 0)}return S(t,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),r=this.cameraService.getZoomScale(),i=t||this.cameraService.getCenter(),o=nI({latitude:i[1],zoom:n}),a=o.pixelsPerMeter,s=o.pixelsPerDegree;this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=a,this.pixelsPerDegree=s,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===e.CoordinateSystem.LNGLAT||this.coordinateSystem===e.CoordinateSystem.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===e.CoordinateSystem.LNGLAT_OFFSET?this.calculateLnglatOffset(i,n):this.coordinateSystem===e.CoordinateSystem.P20_OFFSET&&this.calculateLnglatOffset(i,n,r,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r){var i=nI({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=K_([],l,u),h=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=Hb([],[h[0],h[1],0,1],c),c=K_([],l,u=this.cameraService.getViewMatrixUncentered()||u),c=K_([],c,vI),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),t}()).prototype,"cameraService",[iI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oI=aI))||oI),mI=W((function(e){
/*! Hammer.JS - v2.0.7 - 2016-04-22
   * http://hammerjs.github.io/
   *
   * Copyright (c) 2016 Jorik Tangelder;
   * Licensed under the MIT license */
!function(t,n,r,i){var o,a="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,s="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),u=a||s,l=["","webkit","Moz","MS","ms","o"],c=u?"":n.createElement("div"),h=Math.round,f=Math.abs,p=Date.now;function d(e,t,n){return setTimeout(x(e,n),t)}function v(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function m(e,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,i,r),e.apply(this,arguments)}}o="function"!=typeof Object.assign?function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var y=m((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&void 0===e[r[i]])&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),_=m((function(e,t){return y(e,t,!0)}),"merge","Use `assign`.");function b(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&o(r,n)}function x(e,t){return function(){return e.apply(t,arguments)}}function S(e,t){return"function"==typeof e?e.apply(t&&t[0]||void 0,t):e}function E(e,t){return void 0===e?t:e}function A(e,t,n){g(M(t),(function(t){e.addEventListener(t,n,!1)}))}function C(e,t,n){g(M(t),(function(t){e.removeEventListener(t,n,!1)}))}function T(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function w(e,t){return e.indexOf(t)>-1}function M(e){return e.trim().split(/\s+/g)}function k(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function O(e){return Array.prototype.slice.call(e,0)}function P(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];k(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function L(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<l.length;){if((r=(n=l[o])?n+i:t)in e)return r;o++}}var I=1;function R(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}var N="ontouchstart"in t,D=void 0!==L(t,"PointerEvent"),F=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B=["x","y"],z=["clientX","clientY"];function j(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){S(e.options.enable,[e])&&n.handler(t)},this.init()}function U(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&t&&r-i==0,a=12&t&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=V(t));i>1&&!n.firstMultiple?n.firstMultiple=V(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,u=t.center=H(r);t.timeStamp=p(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=X(s,u),t.distance=Y(s,u),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=W(t.deltaX,t.deltaY);var l=G(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=l.x,t.overallVelocityY=l.y,t.overallVelocity=f(l.x)>f(l.y)?l.x:l.y,t.scale=a?(c=a.pointers,h=r,Y(h[0],h[1],z)/Y(c[0],c[1],z)):1,t.rotation=a?function(e,t){return X(t[1],t[0],z)+X(e[1],e[0],z)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(s>25||void 0===a.velocity)){var u=t.deltaX-a.deltaX,l=t.deltaY-a.deltaY,c=G(s,u,l);r=c.x,i=c.y,n=f(c.x)>f(c.y)?c.x:c.y,o=W(u,l),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var c,h;var d=e.element;T(t.srcEvent.target,d)&&(d=t.srcEvent.target);t.target=d}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function V(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:h(e.pointers[n].clientX),clientY:h(e.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:t,center:H(t),deltaX:e.deltaX,deltaY:e.deltaY}}function H(e){var t=e.length;if(1===t)return{x:h(e[0].clientX),y:h(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:h(n/t),y:h(r/t)}}function G(e,t,n){return{x:t/e||0,y:n/e||0}}function W(e,t){return e===t?1:f(e)>=f(t)?e<0?2:4:t<0?8:16}function Y(e,t,n){n||(n=B);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function X(e,t,n){n||(n=B);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}j.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(R(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(R(this.element),this.evWin,this.domHandler)}};var Z={mousedown:1,mousemove:2,mouseup:4};function q(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,j.apply(this,arguments)}b(q,j,{handler:function(e){var t=Z[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var K={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Q={2:"touch",3:"pen",4:"mouse",5:"kinect"},$="pointerdown",J="pointermove pointerup pointercancel";function ee(){this.evEl=$,this.evWin=J,j.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}u||!t.MSPointerEvent||t.PointerEvent||($="MSPointerDown",J="MSPointerMove MSPointerUp MSPointerCancel"),b(ee,j,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=K[r],o=Q[e.pointerType]||e.pointerType,a="touch"==o,s=k(t,e.pointerId,"pointerId");1&i&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))}});var te={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ne(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,j.apply(this,arguments)}function re(e,t){var n=O(e.touches),r=O(e.changedTouches);return 12&t&&(n=P(n.concat(r),"identifier",!0)),[n,r]}b(ne,j,{handler:function(e){var t=te[e.type];if(1===t&&(this.started=!0),this.started){var n=re.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var ie={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function oe(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},j.apply(this,arguments)}function ae(e,t){var n=O(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=O(e.changedTouches),s=[],u=this.target;if(o=n.filter((function(e){return T(e.target,u)})),1===t)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&t&&delete r[a[i].identifier],i++;return s.length?[P(o.concat(s),"identifier",!0),s]:void 0}b(oe,j,{handler:function(e){var t=ie[e.type],n=ae.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});function se(){j.apply(this,arguments);var e=x(this.handler,this);this.touch=new oe(this.manager,e),this.mouse=new q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function ue(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,le.call(this,t)):12&e&&le.call(this,t)}function le(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function ce(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}b(se,j,{handler:function(e,t,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)ue.call(this,t,n);else if(i&&ce.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var he=u?void 0:L(c.style,"touchAction"),fe=void 0!==he,pe=function(){if(!fe)return!1;var e={};if(u)return e;var n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){e[r]=!n||t.CSS.supports("touch-action",r)})),e}();function de(e,t){this.manager=e,this.set(t)}de.prototype={set:function(e){"compute"==e&&(e=this.compute()),fe&&this.manager.element.style&&pe[e]&&(this.manager.element.style[he]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){S(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(w(e,"none"))return"none";var t=w(e,"pan-x"),n=w(e,"pan-y");if(t&&n)return"none";if(t||n)return t?"pan-x":"pan-y";if(w(e,"manipulation"))return"manipulation";return"auto"}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=w(r,"none")&&!pe.none,o=w(r,"pan-y")&&!pe["pan-y"],a=w(r,"pan-x")&&!pe["pan-x"];if(i){var s=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&6&n||a&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function ve(e){this.options=o({},this.defaults,e||{}),this.id=I++,this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function ge(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function me(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function ye(e,t){var n=t.manager;return n?n.get(e):e}function _e(){ve.apply(this,arguments)}function be(){_e.apply(this,arguments),this.pX=null,this.pY=null}function xe(){_e.apply(this,arguments)}function Se(){ve.apply(this,arguments),this._timer=null,this._input=null}function Ee(){_e.apply(this,arguments)}function Ae(){_e.apply(this,arguments)}function Ce(){ve.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Te(e,t){return(t=t||{}).recognizers=E(t.recognizers,Te.defaults.preset),new we(e,t)}ve.prototype={defaults:{},set:function(e){return o(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(v(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=ye(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return v(e,"dropRecognizeWith",this)||(e=ye(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(v(e,"requireFailure",this))return this;var t=this.requireFail;return-1===k(t,e=ye(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(v(e,"dropRequireFailure",this))return this;e=ye(e,this);var t=k(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+ge(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+ge(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=o({},e);if(!S(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},b(_e,ve,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:32}}),b(be,_e,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push("pan-y"),24&e&&t.push("pan-x"),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(6&t.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return _e.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=me(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),b(xe,_e,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),b(Se,ve,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),b(Ee,_e,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),b(Ae,_e,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return be.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=me(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),b(Ce,ve,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||Y(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return 32},failTimeout:function(){return this._timer=d((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Te.VERSION="2.0.7",Te.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Ee,{enable:!1}],[xe,{enable:!1},["rotate"]],[Ae,{direction:6}],[be,{direction:6},["swipe"]],[Ce],[Ce,{event:"doubletap",taps:2},["tap"]],[Se]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function we(e,t){var n;this.options=o({},Te.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(D?ee:F?oe:N?se:q))(n,U),this.touchAction=new de(this,this.options.touchAction),Me(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Me(e,t){var n,r=e.element;r.style&&(g(e.options.cssProps,(function(i,o){n=L(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}(we.prototype={set:function(e){return o(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof ve)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(v(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(v(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=k(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(void 0!==e&&void 0!==t){var n=this.handlers;return g(M(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(void 0!==e){var n=this.handlers;return g(M(e),(function(e){t?n[e]&&n[e].splice(k(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){if(u)return;var r=n.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](t),i++}},destroy:function(){this.element&&Me(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u)||(o(Te,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:we,Input:j,TouchAction:de,TouchInput:oe,MouseInput:q,PointerEventInput:ee,TouchMouseInput:se,SingleTouchInput:ne,Recognizer:ve,AttrRecognizer:_e,Tap:Ce,Pan:be,Swipe:Ae,Pinch:xe,Rotate:Ee,Press:Se,on:A,off:C,each:g,merge:_,extend:y,assign:o,inherit:b,bindFn:x,prefixed:L}),("undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Hammer=Te,e.exports?e.exports=Te:t.Hammer=Te)}("undefined"!=typeof window?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document)}));(uI=e.InteractionEvent||(e.InteractionEvent={})).Hover="hover",uI.Click="click",uI.Select="select",uI.Active="active",uI.Drag="drag";var yI,_I,bI,xI,SI,EI,AI,CI,TI,wI,MI,kI,OI,PI={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},LI=(lI=NM(),cI=RM(Hk.IMapService),lI((pI=V((fI=function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"indragging",!1),U(P(t),"mapService",pI,P(t)),E(P(t),"hammertime",void 0),E(P(t),"lastClickTime",0),E(P(t),"lastClickXY",[-1,-1]),E(P(t),"clickTimer",void 0),E(P(t),"$containter",void 0),E(P(t),"onDrag",(function(n){var r=t.interactionEvent(n);r.type=PI[r.type],"dragging"===r.type?t.indragging=!0:t.indragging=!1,t.emit(e.InteractionEvent.Drag,r)})),E(P(t),"onHammer",(function(n){n.srcEvent.stopPropagation();var r=t.interactionEvent(n);t.emit(e.InteractionEvent.Hover,r)})),E(P(t),"onTouch",(function(e){var n=e.touches[0];t.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),E(P(t),"onHover",(function(n){var r=n.clientX,i=n.clientY,o=n.type,a=t.mapService.getMapContainer();if(a)if(Yv)r=r-a.left-0,i=i-a.top-0;else{var s=a.getBoundingClientRect(),u=s.top;r=r-s.left-a.clientLeft,i=i-u-a.clientTop}var l=t.mapService.containerToLngLat([r,i]);if("click"!==o)"touch"!==o?"click"!==o&&"dblclick"!==o&&t.emit(e.InteractionEvent.Hover,{x:r,y:i,lngLat:l,type:o,target:n}):t.isDoubleTap(r,i,l);else{if(!Yv&&"ontouchstart"in document.documentElement==!0)return;t.isDoubleTap(r,i,l)}})),t}return S(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(e.InteractionEvent.Hover)}},{key:"triggerHover",value:function(t){var n=t.x,r=t.y;this.emit(e.InteractionEvent.Hover,{x:n,y:r})}},{key:"triggerSelect",value:function(t){this.emit(e.InteractionEvent.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(e.InteractionEvent.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(e){this.onHover({clientX:e.touches[0].pageX,clientY:e.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e)if(Yv)Zv.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=new mI.Manager(e);t.add(new mI.Tap({event:"dblclick",taps:2})),t.add(new mI.Tap({event:"click"})),t.add(new mI.Pan({threshold:0,pointers:0})),t.add(new mI.Press({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t}}},{key:"removeEventListenerOnMap",value:function(){if(Yv)Zv.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;t-=o.left,n-=a}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r,target:e.srcEvent}}},{key:"isDoubleTap",value:function(t,n,r){var i=this,o=(new Date).getTime(),a="click";o-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-n)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),a="dblclick",this.emit(e.InteractionEvent.Hover,{x:t,y:n,lngLat:r,type:a})):(this.lastClickTime=o,this.lastClickXY=[t,n],this.clickTimer=setTimeout((function(){a="click",i.emit(e.InteractionEvent.Hover,{x:t,y:n,lngLat:r,type:a})}),400))}}]),r}(qx)).prototype,"mapService",[cI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hI=fI))||hI),II=0;function RI(e){if(Yv)return null;var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(II++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"}(e.gl||(e.gl={}));var NI,DI,FI,BI,zI,jI,UI,VI=(yI=NM(),_I=RM(Hk.IMapService),bI=RM(Hk.IRendererService),xI=RM(Hk.IGlobalConfigService),SI=RM(Hk.IInteractionService),EI=RM(Hk.ILayerService),yI((TI=V((CI=function(){function t(){var e=this;b(this,t),E(this,"pickedColors",void 0),E(this,"pickedTileLayers",[]),U(this,"mapService",TI,this),U(this,"rendererService",wI,this),U(this,"configService",MI,this),U(this,"interactionService",kI,this),U(this,"layerService",OI,this),E(this,"pickingFBO",void 0),E(this,"width",0),E(this,"height",0),E(this,"alreadyInPicking",!1),E(this,"pickBufferScale",1),E(this,"pickFromPickingFBO",(function(t,n){var r=n.x,i=n.y,o=n.lngLat,a=n.type,s=n.target,u=!1,l=e.rendererService,c=l.readPixels,h=l.getContainer,f=e.getContainerSize(h()),p=f.width,d=f.height;p*=hg,d*=hg;var g=t.getLayerConfig(),m=g.enableHighlight,y=g.enableSelect,_=r*hg,b=i*hg;if(_>p-1*hg||_<0||b>d-1*hg||b<0)return!1;var x=c({x:Math.floor(_/e.pickBufferScale),y:Math.floor((d-(i+1)*hg)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO});if(e.pickedColors=x,0!==x[0]||0!==x[1]||0!==x[2]){var S=Cy(x),E=t.getSource().getFeatureById(S);S!==t.getCurrentPickId()&&"mousemove"===a&&(a="mouseenter");var A={x:r,y:i,type:a,lngLat:o,featureId:S,feature:E,target:s};E&&(u=!0,t.setCurrentPickId(S),e.triggerHoverOnLayer(t,A))}else{var C={x:r,y:i,lngLat:o,type:null!==t.getCurrentPickId()&&"mousemove"===a?"mouseout":"un"+a,featureId:null,target:s,feature:null};e.triggerHoverOnLayer(t,v(v({},C),{},{type:"unpick"})),e.triggerHoverOnLayer(t,C),t.setCurrentPickId(null)}if(m&&e.highlightPickedFeature(t,x),y&&"click"===a&&(null==x?void 0:x.toString())!==[0,0,0,0].toString()){var T=Cy(x);null===t.getCurrentSelectedId()||T!==t.getCurrentSelectedId()?(e.selectFeature(t,x),t.setCurrentSelectedId(T)):(e.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||e.layerService.getLayers().filter((function(e){return e.tileLayer})).map((function(e){e.tileLayer.clearPickState()}))}return u}))}var n,r,i;return S(t,[{key:"init",value:function(t){var n=this.rendererService,r=n.createTexture2D,i=n.createFramebuffer,o=n.getContainer,a=this.getContainerSize(o()),s=a.width,u=a.height;s*=hg,u*=hg,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=i({color:r({width:Math.round(s/this.pickBufferScale),height:Math.round(u/this.pickBufferScale),wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.interactionService.on(e.InteractionEvent.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(i=_(g().mark((function e(t,n,r){var i,o,a,s=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels(),t.hooks.afterPickingEncode.call();var e=s.pickBox(t,n);r(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"pickBox",value:function(e,t){var n=this,r=D(t.map((function(e){var t=e<0?0:e;return Math.floor(t*hg/n.pickBufferScale)})),4),i=r[0],o=r[1],a=r[2],s=r[3],u=this.rendererService,l=u.readPixels,c=u.getContainer,h=this.getContainerSize(c()),f=h.width,p=h.height;if(p*=hg,i>((f*=hg)-1)*hg/this.pickBufferScale||a<0||o>(p-1)*hg/this.pickBufferScale||s<0)return[];for(var d=Math.min(f/this.pickBufferScale,a)-i,g=Math.min(p/this.pickBufferScale,s)-o,m=l({x:i,y:Math.floor(p/this.pickBufferScale-(s+1)),width:d,height:g,data:new Uint8Array(d*g*4),framebuffer:this.pickingFBO}),y=[],_={},b=0;b<m.length/4;b+=1){var x=Cy(m.slice(4*b,4*b+4));if(-1!==x&&!_[x]){var S=e.getSource().getFeatureById(x);y.push(v(v({},S),{},{pickedFeatureIdx:x})),_[x]=!0}}return y}},{key:"handleCursor",value:function(e,t){var n=e.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===t&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===t&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(e){return e.getContext?{width:e.width/hg,height:e.height/hg}:e.getBoundingClientRect()}},{key:"pickingAllLayer",value:(r=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isPickingAllLayer()){e.next=2;break}return e.abrupt("return");case 2:return this.alreadyInPicking=!0,e.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!this.alreadyInPicking&&(!this.layerService.alreadyInRendering&&(!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()))}},{key:"resizePickingFBO",value:function(){var e=this.rendererService.getContainer,t=this.getContainerSize(e()),n=t.width,r=t.height;n*=hg,r*=hg,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(n=_(g().mark((function e(t){var n,r,i,o=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.rendererService,r=n.useFramebuffer,i=n.clear,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getRenderList().filter((function(e){return e.needPick(t.type)})).reverse().some((function(e){if(i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.pickedTileLayers.map((function(e){var n;return null===(n=e.tileLayer)||void 0===n?void 0:n.clearPick(t.type)})),e.tileLayer&&e.tileLayer.pickLayers)return e.tileLayer.pickLayers(t);e.hooks.beforePickingEncode.call(),e.masks.length>0&&e.masks.map((function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.render(),e.hooks.afterRender.call()})),e.renderModels(!0),e.hooks.afterPickingEncode.call();var n=o.pickFromPickingFBO(e,t);return o.layerService.pickedLayerId=n?+e.id:-1,n&&!e.getLayerConfig().enablePropagation}))}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){(function(e){var t,n,r=!0;return null==e||null===(t=e.target)||void 0===t||null===(n=t.path)||void 0===n||n.map((function(e){var t;null!=e&&e.classList&&(null==e||null===(t=e.classList)||void 0===t||t.forEach((function(e){"l7-marker"!==e&&"l7-popup"!==e||(r=!1)})))})),r})(t)&&(this.handleCursor(e,t.type),e.emit(t.type,t))}},{key:"highlightPickedFeature",value:function(e,t){var n=D(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeHighlight.call([r,i,o])}},{key:"selectFeature",value:function(e,t){var n=D(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeSelect.call([r,i,o])}}]),t}()).prototype,"mapService",[_I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wI=V(CI.prototype,"rendererService",[bI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MI=V(CI.prototype,"configService",[xI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kI=V(CI.prototype,"interactionService",[SI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OI=V(CI.prototype,"layerService",[EI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AI=CI))||AI),HI=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];b(this,e),E(this,"autoStart",void 0),E(this,"startTime",0),E(this,"oldTime",0),E(this,"running",!1),E(this,"elapsedTime",0),this.autoStart=t}return S(e,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}(),GI=(NI=NM(),DI=RM(Hk.IRendererService),FI=RM(Hk.IMapService),NI((jI=V((zI=function(e){A(r,e);var t,n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"pickedLayerId",-1),E(P(e),"clock",new HI),E(P(e),"alreadyInRendering",!1),E(P(e),"layers",[]),E(P(e),"layerList",[]),E(P(e),"layerRenderID",void 0),E(P(e),"sceneInited",!1),E(P(e),"animateInstanceCount",0),E(P(e),"shaderPicking",!0),E(P(e),"enableRender",!0),U(P(e),"renderService",jI,P(e)),U(P(e),"mapService",UI,P(e)),E(P(e),"reRender",pS((function(){e.updateLayerRenderList(),e.renderLayers()}),32)),E(P(e),"throttleRenderLayers",pS((function(){e.renderLayers()}),16)),e}return S(r,[{key:"add",value:function(e){this.sceneInited&&e.init(),this.layers.push(e),this.updateLayerRenderList(),this.emit("layerChange",this.layers)}},{key:"addMask",value:function(e){this.sceneInited&&e.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach((function(e){e.inited||e.init()})),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"cleanRemove",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.layers.indexOf(e);n>-1&&this.layers.splice(n,1),t&&this.throttleRenderLayers()}},{key:"remove",value:function(e,t){if(t){var n=t.layerChildren.indexOf(e);n>-1&&t.layerChildren.splice(n,1)}else{var r=this.layers.indexOf(e);r>-1&&this.layers.splice(r,1)}this.updateLayerRenderList(),e.destroy(),this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:(t=_(g().mark((function e(){var t,n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyInRendering&&this.enableRender){e.next=2;break}return e.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),t=j(this.layerList),e.prev=5,t.s();case 7:if((n=t.n()).done){e.next=21;break}if((r=n.value).hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map((function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.render(),e.hooks.afterRender.call()}))),!r.getLayerConfig().enableMultiPassRenderer){e.next=17;break}return e.next=15,r.renderMultiPass();case 15:e.next=18;break;case 17:r.render();case 18:r.hooks.afterRender.call();case 19:e.next=7;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(5),t.e(e.t0);case 26:return e.prev=26,t.f(),e.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return e.stop()}}),e,this,[[5,23,26,29]])}))),function(){return t.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).sort((function(e,t){return e.zIndex-t.zIndex})).forEach((function(t){e.layerList.push(t)}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){e.destroy()})),this.layers=[],this.layerList=[],this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var e=Ay(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Zv.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Zv.cancelAnimationFrame(this.layerRenderID)}}]),r}(Kx)).prototype,"renderService",[DI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI=V(zI.prototype,"mapService",[FI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=zI))||BI);var WI,YI,XI,ZI,qI,KI,QI=function(e){return null==e},$I=function(){function e(t){var n=this;b(this,e),E(this,"name",void 0),E(this,"type",void 0),E(this,"scale",void 0),E(this,"descriptor",void 0),E(this,"featureBufferLayout",[]),E(this,"needRescale",!1),E(this,"needRemapping",!1),E(this,"needRegenerateVertices",!1),E(this,"featureRange",{startIndex:0,endIndex:1/0}),E(this,"vertexAttribute",void 0),E(this,"defaultCallback",(function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[t].func)(e)}))})),this.setProps(t)}return S(e,[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null!==(t=this.scale)&&void 0!==t&&t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,F(e));if(!QI(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),JI=["modelType"],eR=["buffer","update","name"],tR=["buffer","update","name"],nR=["buffer","update","name"],rR=(E(WI={},e.gl.FLOAT,4),E(WI,e.gl.UNSIGNED_BYTE,1),E(WI,e.gl.UNSIGNED_SHORT,2),WI),iR=(YI=NM(),XI=RM(Hk.IRendererService),YI((KI=V((qI=function(){function t(){b(this,t),E(this,"attributesAndIndices",void 0),U(this,"rendererService",KI,this),E(this,"attributes",[]),E(this,"triangulation",void 0),E(this,"featureLayout",{sizePerElement:0,elements:[]})}return S(t,[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new $I(e),this.attributes.push(t)),t}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(v(v({},t),{},{name:e})));var i=t.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=this.attributes.find((function(e){return e.name===t}));if(a&&a.descriptor){var s=a.descriptor,u=s.update,l=s.buffer,c=s.size,h=void 0===c?0:c,f=rR[l.type||e.gl.FLOAT];if(u){var p=this.featureLayout,d=p.elements,v=p.sizePerElement,g=d.slice(r,i);if(!g.length)return;var m=g[0].offset,y=m*h*f,_=g.map((function(e,t){for(var r=e.featureIdx,i=e.vertices,o=e.normals,a=i.length/v,s=[],l=0;l<a;l++){var c=o?o.slice(3*l,3*l+3):[];s.push.apply(s,F(u(n[r],r,i.slice(l*v,l*v+v),t,c)))}return s})).reduce((function(e,t){return e.push.apply(e,F(t)),e}),[]);a.vertexAttribute.updateBuffer({data:_,offset:y}),null==o||o.emit("legend:".concat(t),{type:t,attr:a})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,n,r){var i=this;this.featureLayout={sizePerElement:0,elements:[]};var o=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})).filter((function(e){return e})),a=r.modelType,s=O(r,JI),u=this.rendererService,l=u.createAttribute,c=u.createBuffer,h=u.createElements,f={};return new Promise((function(r,u){_x(a,v({descriptors:i.getDescriptorsWithOutFunc(o),features:t,segmentNumber:n},s)).then((function(t){t.descriptors.forEach((function(e,t){if(e){var n=e.buffer,r=(e.update,e.name,O(e,eR)),o=l(v({buffer:c(n)},r));f[e.name||""]=o,i.attributes[t].vertexAttribute=o}})),i.featureLayout=t.featureLayout;var n=h({data:t.indices,type:e.gl.UNSIGNED_INT,count:t.indices.length});i.attributesAndIndices={attributes:f,elements:n,count:null},r(i.attributesAndIndices)})).catch((function(e){console.warn(e),u(e)}))}))}},{key:"createAttributesAndIndices",value:function(t,n,r){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),a=0,s=0,u=[],l=3;t.forEach((function(e,t){var n=i.triangulation(e,r),c=n.indices,h=n.vertices,f=n.normals,p=n.size,d=n.indexes,v=n.count;"number"==typeof v&&(s+=v),c.forEach((function(e){u.push(e+a)})),l=p;var g=h.length/p;i.featureLayout.sizePerElement=l,i.featureLayout.elements.push({featureIdx:t,vertices:h,normals:f,offset:a}),a+=g;for(var m=function(n){var r=(null==f?void 0:f.slice(3*n,3*n+3))||[],i=h.slice(n*p,n*p+p),a=0;d&&void 0!==d[n]&&(a=d[n]),o.forEach((function(o,s){var u;o&&o.update&&(u=o.buffer.data).push.apply(u,F(o.update(e,t,i,n,r,a)))}))},y=0;y<g;y++)m(y)}));var c=this.rendererService,h=c.createAttribute,f=c.createBuffer,p=c.createElements,d={};o.forEach((function(e,t){if(e){var n=e.buffer,r=(e.update,e.name,O(e,tR)),o=h(v({buffer:f(n)},r));d[e.name||""]=o,i.attributes[t].vertexAttribute=o}}));var g=p({data:u,type:e.gl.UNSIGNED_INT,count:u.length});return this.attributesAndIndices={attributes:d,elements:g,count:s},this.attributesAndIndices}},{key:"createAttributes",value:function(e,t){var n=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var r=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),i=0,o=3;e.forEach((function(e,t){var a=n.triangulation(e),s=a.indices,u=a.vertices,l=a.normals,c=a.size,h=a.indexes;s.forEach((function(e){})),o=c;var f=u.length/c;n.featureLayout.sizePerElement=o,n.featureLayout.elements.push({featureIdx:t,vertices:u,normals:l,offset:i}),i+=f;for(var p=function(n){var i=(null==l?void 0:l.slice(3*n,3*n+3))||[],o=u.slice(n*c,n*c+c),a=0;h&&void 0!==h[n]&&(a=h[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,F(r.update(e,t,o,n,i,a)))}))},d=0;d<f;d++)p(d)}));var a=this.rendererService,s=a.createAttribute,u=a.createBuffer,l={};return r.forEach((function(e,t){if(e){var r=e.buffer,i=(e.update,e.name,O(e,nR)),o=s(v({buffer:u(r)},i));l[e.name||""]=o,n.attributes[t].vertexAttribute=o}})),{attributes:l}}},{key:"clearAllAttributes",value:function(){var e;this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),null===(e=this.attributesAndIndices)||void 0===e||e.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(e){return e.map((function(e){return{buffer:e.buffer,name:e.name,size:e.size}}))}}]),t}()).prototype,"rendererService",[XI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZI=qI))||ZI);function oR(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame((function(){var n=t.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(t){t.call(n,e)}))}))}var aR,sR,uR,lR,cR,hR,fR,pR,dR,vR,gR,mR,yR,_R,bR,xR,SR,ER,AR,CR,TR,wR,MR,kR,OR,PR,LR,IR,RR,NR,DR,FR,BR,zR=function(e,t){var n,r=this.document,i=r.attachEvent;if("undefined"!=typeof navigator&&(n=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],i)e.__resizeTrigger__=e,e.attachEvent("onresize",oR);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var o=e.__resizeTrigger__=r.createElement("object");o.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),o.setAttribute("class","resize-sensor"),o.setAttribute("tabindex","-1"),o.setAttribute("title",""),o.__resizeElement__=e,o.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",oR)},o.type="text/html",n&&e.appendChild(o),o.data="about:blank",n||e.appendChild(o)}e.__resizeListeners__.push(t)},jR="undefined"==typeof window?zR:zR.bind(window),UR=function(e,t){var n=document.attachEvent,r=e.__resizeListeners__||[];if(t){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}else r=e.__resizeListeners__=[];if(!r.length){if(n)e.detachEvent("onresize",oR);else if(e.__resizeTrigger__){var o=e.__resizeTrigger__.contentDocument,a=o&&o.defaultView;a&&(a.removeEventListener("resize",oR),delete a.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}};jR.unbind=UR;var VR=(aR=NM(),sR=RM(Hk.SceneID),uR=RM(Hk.IIconService),lR=RM(Hk.IFontService),cR=RM(Hk.IControlService),hR=RM(Hk.IGlobalConfigService),fR=RM(Hk.IMapService),pR=RM(Hk.ICoordinateSystemService),dR=RM(Hk.IRendererService),vR=RM(Hk.ILayerService),gR=RM(Hk.ICameraService),mR=RM(Hk.IInteractionService),yR=RM(Hk.IPickingService),_R=RM(Hk.IShaderModuleService),bR=RM(Hk.IMarkerService),xR=RM(Hk.IPopupService),aR((AR=V((ER=function(t){A(i,t);var n,r=I(i);function i(){var e;return b(this,i),E(P(e=r.call(this)),"destroyed",!1),E(P(e),"loaded",!1),U(P(e),"id",AR,P(e)),U(P(e),"iconService",CR,P(e)),U(P(e),"fontService",TR,P(e)),U(P(e),"controlService",wR,P(e)),U(P(e),"configService",MR,P(e)),U(P(e),"map",kR,P(e)),U(P(e),"coordinateSystemService",OR,P(e)),U(P(e),"rendererService",PR,P(e)),U(P(e),"layerService",LR,P(e)),U(P(e),"cameraService",IR,P(e)),U(P(e),"interactionService",RR,P(e)),U(P(e),"pickingService",NR,P(e)),U(P(e),"shaderModuleService",DR,P(e)),U(P(e),"markerService",FR,P(e)),U(P(e),"popupService",BR,P(e)),E(P(e),"inited",!1),E(P(e),"initPromise",void 0),E(P(e),"rendering",!1),E(P(e),"$container",void 0),E(P(e),"canvas",void 0),E(P(e),"markerContainer",void 0),E(P(e),"hooks",void 0),E(P(e),"handleWindowResized",(function(){e.emit("resize"),e.$container&&(e.initContainer(),lg(),e.coordinateSystemService.needRefresh=!0,e.render())})),E(P(e),"handleMapCameraChanged",(function(t){e.cameraService.update(t),e.render()})),e.hooks={init:new Ow},e}return S(i,[{key:"init",value:function(t){var n=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return n.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",_(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e){n.map.onCameraChanged((function(t){n.cameraService.init(),n.cameraService.update(t),e()})),n.map.init()}));case 2:n.map.onCameraChanged(n.handleMapCameraChanged),n.map.addMarkerContainer(),n.markerService.addMarkers(),n.markerService.addMarkerLayers(),n.popupService.initPopup(),n.interactionService.init(),n.interactionService.on(e.InteractionEvent.Drag,n.addSceneEvent.bind(n));case 9:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",_(g().mark((function e(){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.map.getOverlayContainer(),n.$container=r||RI(n.configService.getSceneConfig(n.id).id||""),!n.$container){e.next=12;break}return n.canvas=eg("canvas","",n.$container),n.setCanvas(),e.next=7,n.rendererService.init(n.canvas,n.configService.getSceneConfig(n.id),t.gl);case 7:n.initContainer(),jR(n.$container,n.handleWindowResized),Zv.matchMedia&&(null===(i=Zv.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===i||i.addListener(n.handleWindowResized)),e.next=13;break;case 12:console.error("容器 id 不存在");case 13:n.pickingService.init(n.id);case 14:case"end":return e.stop()}}),e)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(t){var n=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return n.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",_(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e){n.map.onCameraChanged((function(t){n.cameraService.init(),n.cameraService.update(t),"GAODE2.x"!==n.map.version&&e()})),n.map.initMiniMap()}));case 2:n.map.onCameraChanged(n.handleMapCameraChanged),n.interactionService.init(),n.interactionService.on(e.InteractionEvent.Drag,n.addSceneEvent.bind(n));case 5:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",_(g().mark((function e(){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.canvas,n.$container=r||null,!n.$container){e.next=7;break}return e.next=5,n.rendererService.init(t.canvas,n.configService.getSceneConfig(n.id),void 0);case 5:e.next=8;break;case 7:console.error("容器 id 不存在");case 8:n.pickingService.init(n.id);case 9:case"end":return e.stop()}}),e)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e)}},{key:"addMask",value:function(e){this.layerService.sceneService=this,this.layerService.addMask(e)}},{key:"render",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=12;break}return e.next=6,this.initPromise;case 6:this.destroyed&&this.destroy(),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 12:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(e,t){this.fontService.addFontFace(e,t)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(e){var t,n=null===(t=this.$container)||void 0===t?void 0:t.getElementsByTagName("canvas")[0];return this.render(),"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;null!==e&&(this.markerContainer=eg("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e,t,n,r=this;this.inited?(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout((function(){var e;null===(e=r.$container)||void 0===e||e.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()})),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),null===(e=this.$container)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,UR(this.$container,this.handleWindowResized),Zv.matchMedia&&(null===(n=Zv.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===n||n.removeListener(this.handleWindowResized))):this.destroyed=!0}},{key:"initContainer",value:function(){var e,t,n=hg,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var e,t,n=hg,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),i}(Kx)).prototype,"id",[sR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CR=V(ER.prototype,"iconService",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TR=V(ER.prototype,"fontService",[lR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=V(ER.prototype,"controlService",[cR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MR=V(ER.prototype,"configService",[hR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kR=V(ER.prototype,"map",[fR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OR=V(ER.prototype,"coordinateSystemService",[pR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PR=V(ER.prototype,"rendererService",[dR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LR=V(ER.prototype,"layerService",[vR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IR=V(ER.prototype,"cameraService",[gR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RR=V(ER.prototype,"interactionService",[mR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NR=V(ER.prototype,"pickingService",[yR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DR=V(ER.prototype,"shaderModuleService",[_R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FR=V(ER.prototype,"markerService",[bR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BR=V(ER.prototype,"popupService",[xR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=ER))||SR);var HR=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var GR=function(e){return this.__data__.has(e)};function WR(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new WA;++t<n;)this.add(e[t])}WR.prototype.add=WR.prototype.push=HR,WR.prototype.has=GR;var YR=WR;var XR=function(e,t){return!!(null==e?0:e.length)&&ja(e,t,0)>-1};var ZR=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1};var qR=function(e,t){return e.has(t)};var KR=function(){};var QR=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},$R=yT&&1/QR(new yT([,-0]))[1]==1/0?function(e){return new yT(e)}:KR;var JR=function(e,t,n){var r=-1,i=XR,o=e.length,a=!0,s=[],u=s;if(n)a=!1,i=ZR;else if(o>=200){var l=t?null:$R(e);if(l)return QR(l);a=!1,i=qR,u=new YR}else u=t?[]:s;e:for(;++r<o;){var c=e[r],h=t?t(c):c;if(c=n||0!==c?c:0,a&&h==h){for(var f=u.length;f--;)if(u[f]===h)continue e;t&&u.push(h),s.push(c)}else i(u,h,n)||(u!==s&&u.push(h),s.push(c))}return s};var eN=function(e){return e&&e.length?JR(e):[]};or({target:"Array",proto:!0},{fill:_f}),Zu("fill");var tN=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function nN(e){var t={};return{content:e=e.replace(tN,(function(e,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(function(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}(n)).fill(0)}return t[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:t}}var rN,iN,oN,aN="#define PI 3.14159265359",sN=/precision\s+(high|low|medium)p\s+float/,uN=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,lN=NM()(rN=function(){function e(){b(this,e),E(this,"moduleCache",{}),E(this,"rawContentCache",{})}return S(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:aN,fs:aN}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\nvec2 unpack_float(float packedValue) {\nint packedIntValue = int(packedValue);\nint v0 = packedIntValue / 256;\nreturn vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(vec2 encodedColor) {\nreturn vec4(\nunpack_float(encodedColor[0]) / 255.0,\nunpack_float(encodedColor[1]) / 255.0\n);\n}",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n#define COORDINATE_SYSTEM_LNGLAT 1.0\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n#define COORDINATE_SYSTEM_P20_2 8.0\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\nvec2 project_mercator(vec2 lnglat) {\nfloat x = lnglat.x;\nreturn vec2(\nradians(x) + PI,\nPI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n);\n}\nfloat project_scale(float meters) {\nreturn meters * u_PixelsPerMeter.z;\n}\nvec4 project_offset(vec4 offset) {\nfloat dy = offset.y;\ndy = clamp(dy, -1., 1.);\nvec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\nreturn vec4(offset.xyz * pixels_per_unit, offset.w);\n}\nvec3 project_normal(vec3 normal) {\nvec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\nreturn normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\nvec3 project_offset_normal(vec3 vector) {\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n|| u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn normalize(vector * u_PixelsPerDegree);\n}\nreturn project_normal(vector);\n}\nvec3 reverse_offset_normal(vec3 vector) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\nreturn vector * vec3(1.0, -1.0, 1.0);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn vector;\n}\nreturn vector;\n}\nvec4 project_mvt_offset_position(vec4 position) {\nfloat a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\nfloat b = COORDINATE_SYSTEM_P20_OFFSET;\nfloat c = COORDINATE_SYSTEM_LNGLAT;\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn project_offset(vec4(0.0, 0.0, position.z, position.w));\n}\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\nreturn vec4(\nproject_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\nproject_scale(position.z),\nposition.w\n);\n}\nreturn position;\n}\nvec4 project_position(vec4 position) {\nfloat a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\nfloat b = COORDINATE_SYSTEM_P20_OFFSET;\nfloat c = COORDINATE_SYSTEM_LNGLAT;\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n|| u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nfloat X = position.x - u_ViewportCenter.x;\nfloat Y = position.y - u_ViewportCenter.y;\nreturn project_offset(vec4(X, Y, position.z, position.w));\n}\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\nreturn vec4(\nproject_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\nproject_scale(position.z),\nposition.w\n);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nreturn vec4(\n(project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\nproject_scale(position.z),\nposition.w\n);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn vec4(\nposition.xy, \nproject_scale(position.z), \nposition.w);\n}\nreturn position;\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\nreturn offset * u_FocalDistance;\n}\nfloat project_pixel_allmap(float pixel) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn pixel * pow(2.0, u_Zoom);\n}\nreturn pixel;\n}\nfloat project_pixel_texture(float pixel) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn pixel * pow(0.5, u_Zoom);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(0.5, u_Zoom);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nreturn pixel * pow(2.0, (20.0 - u_Zoom));\n}\nreturn pixel * 2.0;\n}\nfloat project_float_pixel(float pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel;\n}\nfloat project_pixel(float pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel;\n}\nvec2 project_pixel(vec2 pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel * -1.;\n}\nvec3 project_pixel(vec3 pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel * -1.;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nposition.w *= u_PixelsPerMeter.z;\n}\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(\nposition,\nu_ViewProjectionMatrix,\nu_ViewportCenterProjection\n);\n}\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\nvec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\npos.w = pos.w / u_PixelsPerMeter.z;\n}\nreturn pos;\n}\nbool isEqual( float a,  float b) {\nreturn  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\nfloat maxs=85.0511287798;\nfloat lat=max(min(maxs,lnglat.y),-maxs);\nfloat scale= 268435456.;\nfloat d=PI/180.;\nfloat x=lnglat.x*d;\nfloat y=lat*d;\ny=log(tan((PI/4.)+(y/2.)));\nfloat a=.5/PI,\nb=.5,\nc=-.5/PI;\nd=.5;\nx=scale*(a*x+b);\ny=scale*(c*y+d);\nreturn vec2(x,y);\n}\nvec2 unProjectFlat(vec2 px){\nfloat a=.5/PI;\nfloat b=.5;\nfloat c=-.5/PI;\nfloat d=.5;\nfloat scale = 268435456.;\nfloat x=(px.x/scale-b)/a;\nfloat y=(px.y/scale-d)/c;\ny=(atan(pow(E,y))-(PI/4.))*2.;\nd=PI/180.;\nfloat lat=y/d;\nfloat lng=x/d;\nreturn vec2(lng,lat);\n}\nfloat pixelDistance(vec2 from, vec2 to) {\nvec2 a1 = ProjectFlat(from);\nvec2 b1 = ProjectFlat(to);\nreturn distance(a1, b1);\n}\nvec2 customProject(vec2 lnglat) {\nfloat t = lnglat.x;\nfloat e = lnglat.y;\nfloat Sm = 180.0 / PI;\nfloat Tm = 6378137.0;\nfloat Rm = PI / 180.0;\nfloat r = 85.0511287798;\ne = max(min(r, e), -r);\nt *= Rm;\ne *= Rm;\ne = log(tan(PI / 4.0 + e / 2.0));\nreturn vec2(t * Tm, e * Tm);\n}\nvec2 unProjCustomCoord(vec2 point) {\nfloat Sm = 57.29577951308232;\nfloat Tm = 6378137.0;\nfloat t = point.x;\nfloat e = point.y;\nreturn vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\nfloat customPixelDistance(vec2 from, vec2 to) {\nvec2 a1 = ProjectFlat(from);\nvec2 b1 = ProjectFlat(to);\nreturn distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\nfloat sdCircle(vec2 p, float r) {\nreturn length(p) - r;\n}\nfloat sdEquilateralTriangle(vec2 p) {\nfloat k = sqrt(3.0);\np.x = abs(p.x) - 1.0;\np.y = p.y + 1.0/k;\nif( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\np.x -= clamp( p.x, -2.0, 0.0 );\nreturn -length(p)*sign(p.y);\n}\nfloat sdBox(vec2 p, vec2 b) {\nvec2 d = abs(p)-b;\nreturn length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\nfloat sdPentagon(vec2 p, float r) {\nvec3 k = vec3(0.809016994,0.587785252,0.726542528);\np.x = abs(p.x);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagon(vec2 p, float r) {\nvec3 k = vec3(-0.866025404,0.5,0.577350269);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdOctogon(vec2 p, float r) {\nvec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\np = abs(p);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagram(vec2 p, float r) {\nvec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\np -= vec2(clamp(p.x,r*k.z,r*k.w),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdRhombus(vec2 p, vec2 b) {\nvec2 q = abs(p);\nfloat h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\nfloat d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\nreturn d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\nfloat sdVesica(vec2 p, float r, float d) {\np = abs(p);\nfloat b = sqrt(r*r-d*d);\nreturn ((p.y-b)*d>p.x*b)\n? length(p-vec2(0.0,b))\n: length(p-vec2(-d,0.0))-r;\n}"}),this.registerModule("lighting",{vs:"\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\nstruct DirectionalLight {\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\n};\nstruct SpotLight {\nvec3 position;\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\nfloat constant;\nfloat linear;\nfloat quadratic;\nfloat angle;\nfloat blur;\nfloat exponent;\n};\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\nvec3 lightDir = normalize(light.direction);\nfloat diff = max(dot(normal, lightDir), 0.0);\nvec3 halfwayDir = normalize(lightDir + viewDir);\nfloat spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\nvec3 ambient = light.ambient * u_Ambient;\nvec3 diffuse = light.diffuse * diff * u_Diffuse;\nvec3 specular = light.specular * spec * u_Specular;\nreturn ambient + diffuse + specular;\n}\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\nvec3 weight = vec3(0.0);\nfor (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\nif (i >= u_NumOfDirectionalLights) {\nbreak;\n}\nweight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n}\nreturn weight;\n}",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nfloat calc_lighting(vec4 pos) {\nvec3 worldPos = vec3(pos * u_ModelMatrix);\nvec3 worldNormal = a_Normal;\nvec3 viewDir = normalize(u_CameraPosition - worldPos);\nvec3 lightDir = normalize(vec3(1, -10.5, 12));\nvec3 halfDir = normalize(viewDir+lightDir);\nfloat lambert = dot(worldNormal, lightDir);\nfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\nfloat lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\nreturn lightWeight;\n}",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec3 u_CurrentSelectedId : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\nuniform float u_EnableSelect: 0.0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\nbool isVertexPicked(vec3 vertexColor) {\nreturn\nabs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\nabs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\nabs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\nbool isVertexSelected(vec3 vertexColor) {\nreturn\nabs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&\nabs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&\nabs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;\n}\nvoid setPickingColor(vec3 pickingColor) {\nif(u_shaderPick < 0.5) {\nreturn;\n}\nv_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\nv_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nfloat setPickingSize(float x) {\nreturn u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\nfloat setPickingOrder(float z) {\nbool selected = bool(v_PickingResult.a);\nreturn selected ? z + 1. : 0.;\n}",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\nuniform float u_activeMix: 0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\nvec4 filterHighlightColor(vec4 color, float weight) {\nbool selected = bool(v_PickingResult.a);\nif (selected) {\nvec4 highLightColor = u_HighlightColor * COLOR_SCALE;\nfloat highLightAlpha = highLightColor.a;\nfloat highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\nvec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\nreturn vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n} else {\nreturn color;\n}\n}\nvec4 filterPickingColor(vec4 color) {\nvec3 pickingColor = v_PickingResult.rgb;\nif (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\ndiscard;\n}\nreturn u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\nvec4 filterColor(vec4 color) {\nif(u_shaderPick < 0.5) {\nreturn color;\n} else {\nreturn filterPickingColor(filterHighlightColor(color, 1.0));\n}\n}\nvec4 filterColorAlpha(vec4 color, float alpha) {\nif(u_shaderPick < 0.5) {\nreturn color;\n} else {\nreturn filterPickingColor(filterHighlightColor(color, alpha));\n}\n}"}),this.registerModule("styleMapping",{vs:"attribute float a_vertexId;\nuniform mat4 u_cellTypeLayout;\nuniform sampler2D u_dataTexture;\nbool hasOpacity() {\nreturn u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasStrokeOpacity() {\nreturn u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasStrokeWidth() {\nreturn u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasStroke() {\nreturn u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasOffsets() {\nreturn u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasThetaOffset() {\nreturn u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nfloat pos2value(vec2 pos, float columnWidth, float rowHeight) {\nfloat u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;\nfloat v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);\nreturn texture2D(u_dataTexture, vec2(u, v)).r;\n}\nvec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {\nfloat nextColumn = currentColumn;\nfloat nextRow = currentRow;\nif(currentColumn + nextStep <= columnCount){\nnextColumn = currentColumn + nextStep;\n} else {\nnextColumn = mod(currentColumn + nextStep, columnCount);\nnextRow = currentRow + 1.0;\n}\nreturn vec2(nextColumn, nextRow);\n}\nfloat calCellCount() {\nreturn  u_cellTypeLayout[1][0] +\nu_cellTypeLayout[1][1] +\nu_cellTypeLayout[1][2] +\nu_cellTypeLayout[1][3] * 4.0 +\nu_cellTypeLayout[2][0] * 2.0 +\nu_cellTypeLayout[2][1];\n}",fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:"\nvec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasThetaOffset()) {\nreturn vec2(u_thetaOffset, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureThetaOffset, textureOffset + 1.0);\n}\n}",fs:""}),this.registerModule("styleMappingCalOpacity",{vs:"\nvec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasOpacity()) {\nreturn vec2(u_opacity, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureOpacity = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureOpacity, textureOffset + 1.0);\n}\n}",fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:"\nvec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasStrokeOpacity()) {\nreturn vec2(u_stroke_opacity, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureStrokeOpacity, textureOffset + 1.0);\n}\n}",fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:"\nvec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasStrokeWidth()) {\nreturn vec2(u_stroke_width, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureStrokeWidth, textureOffset + 1.0);\n}\n}",fs:""})}},{key:"registerModule",value:function(e,t){if(!this.rawContentCache[e]){var n=t.vs,r=t.fs,i=t.uniforms,o=nN(n),a=o.content,s=o.uniforms,u=nN(r),l=u.content,c=u.uniforms;this.rawContentCache[e]={fs:l,uniforms:v(v(v({},s),c),i),vs:a}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this;if(this.moduleCache[e])return this.moduleCache[e];var n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,i=this.processModule(n,[],"vs"),o=i.content,a=i.includeList,s=this.processModule(r,[],"fs"),u=s.content,l=s.includeList,c=u,h=eN(a.concat(l).concat(e)).reduce((function(e,n){return v(v({},e),t.rawContentCache[n].uniforms)}),{});return sN.test(u)||(c="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+u),this.moduleCache[e]={fs:c.trim(),uniforms:h,vs:o.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(uN,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a,t,n).content})),includeList:t}}}]),e}())||rN;(iN=e.PassType||(e.PassType={})).Normal="normal",iN.PostProcessing="post-processing";var cN,hN,fN,pN,dN,vN,gN,mN=NM()(oN=function(){function t(){b(this,t),E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"cameraService",void 0),E(this,"mapService",void 0),E(this,"interactionService",void 0),E(this,"layerService",void 0),E(this,"config",void 0)}return S(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return e.PassType.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(Hk.IRendererService),this.cameraService=e.getContainer().get(Hk.ICameraService),this.mapService=e.getContainer().get(Hk.IMapService),this.interactionService=e.getContainer().get(Hk.IInteractionService),this.layerService=e.getContainer().get(Hk.ILayerService),this.shaderModuleService=e.getContainer().get(Hk.IShaderModuleService)}},{key:"render",value:function(e){}}]),t}())||oN,yN=NM()(cN=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,t){N(C(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(mN))||cN,_N=(hN=NM(),fN=RM(Hk.IPostProcessor),hN((vN=V((dN=function(){function t(){b(this,t),E(this,"passes",[]),U(this,"postProcessor",vN,this),E(this,"layer",void 0),E(this,"renderFlag",void 0),E(this,"width",0),E(this,"height",0)}var n;return S(t,[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(n=_(g().mark((function e(){var t,n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=j(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:return e.next=19,this.postProcessor.render(this.layer);case 19:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return n.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.postProcessor.resize(e,t),this.width=e,this.height=t)}},{key:"add",value:function(t,n){t.getType()===e.PassType.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}()).prototype,"postProcessor",[fN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pN=dN))||pN),bN=NM()(gN=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"pickingFBO",void 0),E(P(e),"layer",void 0),E(P(e),"width",0),E(P(e),"height",0),E(P(e),"alreadyInRendering",!1),E(P(e),"pickFromPickingFBO",(function(t){var n=t.x,r=t.y,i=t.lngLat,o=t.type;if(e.layer.isVisible()&&e.layer.needPick(o)){var a,s=e.rendererService,u=s.getViewportSize,l=s.readPixels,c=s.useFramebuffer,h=u(),f=h.width,p=h.height,d=e.layer.getLayerConfig(),g=d.enableHighlight,m=d.enableSelect,y=n*hg,_=r*hg;if(!(y>f||y<0||_>p||_<0))c(e.pickingFBO,(function(){var t;if(0!==(a=l({x:Math.round(y),y:Math.round(p-(r+1)*hg),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=Cy(a),u=e.layer.getSource().getFeatureById(s),c={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(e.layer.setCurrentPickId(s),e.triggerHoverOnLayer(c))}else{var h={x:n,y:r,lngLat:i,type:null===e.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(v(v({},h),{},{type:"unpick"})),e.triggerHoverOnLayer(h),e.layer.setCurrentPickId(null)}g&&e.highlightPickedFeature(a),m&&"click"===o&&(null===(t=a)||void 0===t?void 0:t.toString())!==[0,0,0,0].toString()&&e.selectFeature(a)}))}})),e}return S(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,n){N(C(r.prototype),"init",this).call(this,t,n),this.layer=t;var i=this.rendererService,o=i.createTexture2D,a=i.createFramebuffer,s=(0,i.getViewportSize)(),u=s.width,l=s.height;this.pickingFBO=a({color:o({width:u,height:l,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.interactionService.on(e.InteractionEvent.Hover,this.pickFromPickingFBO),this.interactionService.on(e.InteractionEvent.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(e.InteractionEvent.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=D(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var t=D(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var t=Ty(e.featureId);this.selectFeature(new Uint8Array(t))}},{key:"highlightFeatureHandle",value:function(e){var t=Ty(e.featureId);this.highlightPickedFeature(new Uint8Array(t))}}]),r}(mN))||gN,xN="attribute vec2 a_Position;\nvarying vec2 v_UV;\nvoid main() {\nv_UV = 0.5 * (a_Position + 1.0);\ngl_Position = vec4(a_Position, 0., 1.);\n}";var SN=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o};var EN=function(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:SN(e,t,n)},AN=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var CN=function(e){return AN.test(e)};var TN=function(e){return e.split("")},wN="[\\ud800-\\udfff]",MN="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",kN="\\ud83c[\\udffb-\\udfff]",ON="[^\\ud800-\\udfff]",PN="(?:\\ud83c[\\udde6-\\uddff]){2}",LN="[\\ud800-\\udbff][\\udc00-\\udfff]",IN="(?:"+MN+"|"+kN+")"+"?",RN="[\\ufe0e\\ufe0f]?"+IN+("(?:\\u200d(?:"+[ON,PN,LN].join("|")+")[\\ufe0e\\ufe0f]?"+IN+")*"),NN="(?:"+[ON+MN+"?",MN,PN,LN,wN].join("|")+")",DN=RegExp(kN+"(?="+kN+")|"+NN+RN,"g");var FN=function(e){return e.match(DN)||[]};var BN=function(e){return CN(e)?FN(e):TN(e)},zN=oa?oa.prototype:void 0,jN=zN?zN.toString:void 0;var UN=function e(t){if("string"==typeof t)return t;if(dC(t))return Da(t,e)+"";if(iS(t))return jN?jN.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};var VN=function(e){return null==e?"":UN(e)};var HN=function(e){return function(t){t=VN(t);var n=CN(t)?BN(t):void 0,r=n?n[0]:t.charAt(0),i=n?EN(n,1).join(""):t.slice(1);return r[e]()+i}}("toUpperCase");var GN=function(e){return HN(VN(e).toLowerCase())};var WN=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n};var YN=function(e){return function(t){return null==e?void 0:e[t]}}({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),XN=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ZN=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var qN=function(e){return(e=VN(e))&&e.replace(XN,YN).replace(ZN,"")},KN=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var QN=function(e){return e.match(KN)||[]},$N=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var JN=function(e){return $N.test(e)},eD="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",tD="["+eD+"]",nD="\\d+",rD="[\\u2700-\\u27bf]",iD="[a-z\\xdf-\\xf6\\xf8-\\xff]",oD="[^\\ud800-\\udfff"+eD+nD+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",aD="(?:\\ud83c[\\udde6-\\uddff]){2}",sD="[\\ud800-\\udbff][\\udc00-\\udfff]",uD="[A-Z\\xc0-\\xd6\\xd8-\\xde]",lD="(?:"+iD+"|"+oD+")",cD="(?:"+uD+"|"+oD+")",hD="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",fD="[\\ufe0e\\ufe0f]?"+hD+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",aD,sD].join("|")+")[\\ufe0e\\ufe0f]?"+hD+")*"),pD="(?:"+[rD,aD,sD].join("|")+")"+fD,dD=RegExp([uD+"?"+iD+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[tD,uD,"$"].join("|")+")",cD+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[tD,uD+lD,"$"].join("|")+")",uD+"?"+lD+"+(?:['’](?:d|ll|m|re|s|t|ve))?",uD+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",nD,pD].join("|"),"g");var vD=function(e){return e.match(dD)||[]};var gD=function(e,t,n){return e=VN(e),void 0===(t=n?void 0:t)?JN(e)?vD(e):QN(e):e.match(t)||[]},mD=RegExp("['’]","g");var yD,_D,bD,xD,SD,ED,AD,CD,TD,wD,MD,kD,OD,PD,LD,ID,RD,ND,DD,FD,BD=function(e){return function(t){return WN(gD(qN(t).replace(mD,"")),e,"")}}((function(e,t,n){return t=t.toLowerCase(),e+(n?GN(t):t)})),zD=(yD=NM(),_D=RM(Hk.IShaderModuleService),yD((SD=V((xD=function(){function t(){b(this,t),U(this,"shaderModuleService",SD,this),E(this,"rendererService",void 0),E(this,"config",void 0),E(this,"quad",xN),E(this,"enabled",!0),E(this,"renderToScreen",!1),E(this,"model",void 0),E(this,"name",void 0),E(this,"optionsToUpdate",{})}return S(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return e.PassType.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Hk.IRendererService),this.shaderModuleService=t.getContainer().get(Hk.IShaderModuleService);var r=this.rendererService,i=r.createAttribute,o=r.createBuffer,a=r.createModel,s=this.setupShaders(),u=s.vs,l=s.fs,c=s.uniforms;this.model=a({vs:u,fs:l,attributes:{a_Position:i({buffer:o({data:[-4,-4,4,-4,0,4],type:e.gl.FLOAT}),size:2})},uniforms:v(v({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e,t){var n=this,r=e.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),l=u.width,c=u.height;o(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var e=v({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[l,c]},n.convertOptionsToUniforms(n.optionsToUpdate));t&&(e.u_BloomFinal=1,e.u_Texture2=t),n.model.draw({uniforms:e})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=v(v({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){QI(e[n])||(t["u_".concat(HN(BD(n)))]=e[n])})),t}}]),t}()).prototype,"shaderModuleService",[_D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bD=xD))||bD),jD=NM()(ED=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:xN,fs:"varying vec2 v_UV;\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\nvec4 color = vec4(0.0);\nvec2 off1 = vec2(1.3846153846) * direction;\nvec2 off2 = vec2(3.2307692308) * direction;\ncolor += texture2D(image, uv) * 0.2270270270;\ncolor += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\ncolor += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\nreturn color;\n}\nfloat luminance(vec4 color) {\nreturn  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\nvoid main() {\nfloat r = sqrt(u_radius);\nvec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\nvec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\nvec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\nvec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\nvec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\nif(u_BloomFinal > 0.0) {\nvec4 baseColor = texture2D(u_Texture2, v_UV);\nfloat baselum = luminance(baseColor);\ngl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\nif(baselum <= 0.2) {\ngl_FragColor = inbloomColor * u_intensity;\n}\n} else {\ngl_FragColor = inbloomColor;\n}\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return QI(e.bloomRadius)||(t.u_radius=e.bloomRadius),QI(e.bloomIntensity)||(t.u_intensity=e.bloomIntensity),QI(e.bloomBaseRadio)||(t.u_baseRadio=e.bloomBaseRadio),t}}]),n}(zD))||ED,UD="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\nvec4 color = vec4(0.0);\nvec2 off1 = vec2(1.3846153846) * direction;\nvec2 off2 = vec2(3.2307692308) * direction;\ncolor += texture2D(image, uv) * 0.2270270270;\ncolor += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\ncolor += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\nreturn color;\n}\nvoid main() {\ngl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}",VD=NM()(AD=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:xN,fs:UD});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return QI(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}]),n}(zD))||AD,HD=NM()(CD=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:xN,fs:UD});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return QI(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}]),n}(zD))||CD,GD=NM()(TD=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:xN,fs:'varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n#pragma include "common"\nfloat scale = PI / u_Size;\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\nfloat s = sin(u_Angle), c = cos(u_Angle);\nvec2 tex = texCoord * texSize - u_Center * texSize;\nvec2 point = vec2(\nc * tex.x - s * tex.y,\ns * tex.x + c * tex.y\n) * scale;\nreturn (sin(point.x) * sin(point.y)) * 4.0;\n}\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\nvec3 cmy = 1.0 - color.rgb;\nfloat k = min(cmy.x, min(cmy.y, cmy.z));\ncmy = (cmy - k) / (1.0 - k);\ncmy = clamp(\ncmy * 10.0 - 3.0 + vec3(\npattern(u_Angle + 0.26179, texSize, texCoord),\npattern(u_Angle + 1.30899, texSize, texCoord),\npattern(u_Angle, texSize, texCoord)\n),\n0.0,\n1.0\n);\nk = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\nreturn vec4(1.0 - cmy - k, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(zD))||TD,WD="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",YD=NM()(wD=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:xN,fs:WD}),this.shaderModuleService.getModule("copy-pass")}}]),n}(zD))||wD,XD=NM()(MD=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:xN,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\ntex.y /= 0.866025404;\ntex.x -= tex.y * 0.5;\nvec2 a;\nif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\na = vec2(floor(tex.x), floor(tex.y));\n}\nelse a = vec2(ceil(tex.x), ceil(tex.y));\nvec2 b = vec2(ceil(tex.x), floor(tex.y));\nvec2 c = vec2(floor(tex.x), ceil(tex.y));\nvec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\nvec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\nvec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\nvec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\nfloat alen = length(TEX - A);\nfloat blen = length(TEX - B);\nfloat clen = length(TEX - C);\nvec2 choice;\nif (alen < blen) {\nif (alen < clen) choice = a;\nelse choice = c;\n} else {\nif (blen < clen) choice = b;\nelse choice = c;\n}\nchoice.x += choice.y * 0.5;\nchoice.y *= 0.866025404;\nchoice *= u_Scale / texSize;\nreturn texture2D(texture, choice + u_Center);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(zD))||MD,ZD=NM()(kD=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:xN,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 dx = vec2(1.0 / texSize.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / texSize.y);\nvec4 color = texture2D(texture, texCoord);\nfloat bigTotal = 0.0;\nfloat smallTotal = 0.0;\nvec3 bigAverage = vec3(0.0);\nvec3 smallAverage = vec3(0.0);\nfor (float x = -2.0; x <= 2.0; x += 1.0) {\nfor (float y = -2.0; y <= 2.0; y += 1.0) {\nvec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\nbigAverage += sample;\nbigTotal += 1.0;\nif (abs(x) + abs(y) < 2.0) {\nsmallAverage += sample;\nsmallTotal += 1.0;\n}\n}\n}\nvec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\nfloat power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\nreturn vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(zD))||kD,qD=NM()(OD=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:xN,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nfloat rand(vec2 co) {\nreturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\nfloat diff = (rand(texCoord) - 0.5) * u_Amount;\ncolor.r += diff;\ncolor.g += diff;\ncolor.b += diff;\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}(zD))||OD,KD=NM()(PD=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:xN,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nvec4 sepia_filterColor(vec4 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\ncolor.r =\nmin(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\ncolor.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\ncolor.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(zD))||PD,QD=Nn.f,$D=ee((function(){QD(1)}));or({target:"Object",stat:!0,forced:!Ve||$D,sham:!Ve},{getOwnPropertyDescriptor:function(e,t){return QD(In(e),t)}});var JD,eF,tF,nF,rF,iF,oF=(LD=NM(),ID=RM(Hk.IRendererService),RD=IM(),LD((FD=V((DD=function(){function t(){b(this,t),U(this,"rendererService",FD,this),E(this,"passes",[]),E(this,"readFBO",void 0),E(this,"writeFBO",void 0)}var n,r;return S(t,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var e=this.rendererService,t=e.getViewportSize,n=e.createTexture2D,r=t();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var e=this,t=this.rendererService.useFramebuffer;return new Promise((function(n){t(e.readFBO,_(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e.getCurrentFBOTex());case 1:case"end":return t.stop()}}),t)}))))}))}},{key:"renderBloomPass",value:(r=_(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getReadFBOTex();case 2:r=e.sent,i=0;case 4:if(!(i<4)){e.next=11;break}return e.next=7,n.render(t,r);case 7:this.swap(),i++,e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"render",value:(n=_(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){e.next=9;break}return e.next=7,this.renderBloomPass(t,r);case 7:e.next=12;break;case 9:return e.next=11,r.render(t);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,r=t.createTexture2D;this.readFBO=n({color:r({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.writeFBO=n({color:r({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]),t}()).prototype,"rendererService",[ID],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V(DD.prototype,"init",[RD],Object.getOwnPropertyDescriptor(DD.prototype,"init"),DD.prototype),ND=DD))||ND),aF=NM()(JD=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,t){N(C(r.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear,i=e.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})})),e.multiPassRenderer.setRenderFlag(!0)}))}}]),r}(mN))||JD;function sF(e,t){for(var n=0,r=1/t,i=e;i>0;)n+=r*(i%t),i=Math.floor(i/t),r/=t;return n}var uF=1,lF=(eF=NM(),tF=RM(Hk.IShaderModuleService),eF((iF=V((rF=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return U(P(e=n.call.apply(n,[this].concat(i))),"shaderModuleService",iF,P(e)),E(P(e),"haltonSequence",[]),E(P(e),"accumulatingId",0),E(P(e),"frame",0),E(P(e),"timer",void 0),E(P(e),"sampleRenderTarget",void 0),E(P(e),"prevRenderTarget",void 0),E(P(e),"outputRenderTarget",void 0),E(P(e),"copyRenderTarget",void 0),E(P(e),"blendModel",void 0),E(P(e),"outputModel",void 0),E(P(e),"copyModel",void 0),e}return S(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,n){N(C(r.prototype),"init",this).call(this,t,n);var i=this.rendererService,o=i.createFramebuffer,a=i.createTexture2D;this.sampleRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})});for(var s=0;s<30;s++)this.haltonSequence.push([sF(s,2),sF(s,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\nvarying vec2 v_UV;\nvoid main() {\nvec4 texel1 = texture2D(u_Diffuse1, v_UV);\nvec4 texel2 = texture2D(u_Diffuse2, v_UV);\ngl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}"),this.outputModel=this.createTriangleModel("copy-pass",WD,{blend:{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:e.gl.ONE,dstAlpha:e.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:e.gl.FUNC_ADD,alpha:e.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",WD)}},{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var l=e.multiPassRenderer.getPostProcessor().getReadFBO();o(l,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}));this.accumulatingId=uF++,this.timer=Zv.setTimeout((function(){!function n(r){t.accumulatingId&&r===t.accumulatingId&&(t.isFinished()||(t.doRender(e),Zv.requestAnimationFrame((function(){n(r)}))))}(t.accumulatingId)}),50)}},{key:"doRender",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,l=e.getLayerConfig().jitterScale,c=void 0===l?1:l,h=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*h[0]-1)/s*c,(2*h[1]-1)/u*c),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.sampleRenderTarget}),e.render()})),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var f=e.getLayerConfig();o(this.outputRenderTarget,(function(){t.blendModel.draw({uniforms:{u_opacity:f.opacity||1,u_MixRatio:0===t.frame?1:.9,u_Diffuse1:t.sampleRenderTarget,u_Diffuse2:0===t.frame?e.multiPassRenderer.getPostProcessor().getReadFBO():t.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){t.outputModel.draw({uniforms:{u_Texture:t.outputRenderTarget}})})),o(e.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){t.copyModel.draw({uniforms:{u_Texture:t.copyRenderTarget}})})),e.multiPassRenderer.getPostProcessor().render(e));var p=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=p,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Zv.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,n,r){this.shaderModuleService.registerModule(t,{vs:xN,fs:n});var i=this.shaderModuleService.getModule(t),o=i.vs,a=i.fs,s=i.uniforms,u=this.rendererService,l=u.createAttribute,c=u.createBuffer;return(0,u.createModel)(v({vs:o,fs:a,attributes:{a_Position:l({buffer:c({data:[-4,-4,4,-4,0,4],type:e.gl.FLOAT}),size:2})},uniforms:v({},s),depth:{enable:!1},count:3},r))}}]),r}(mN)).prototype,"shaderModuleService",[tF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nF=rF))||nF),cF=new DM;cF.bind(Hk.IGlobalConfigService).to(WL).inSingletonScope(),LM(NM(),Kx),cF.bind(Hk.IEventEmitter).to(Kx);var hF=BM(cF,!1),fF=function(e){var t=hF.lazyInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},pF=0;function dF(){var e=new DM;return e.parent=cF,e.bind(Hk.SceneID).toConstantValue("".concat(pF++)),e.bind(Hk.IShaderModuleService).to(lN).inSingletonScope(),e.bind(Hk.ILayerService).to(GI).inSingletonScope(),e.bind(Hk.ISceneService).to(VR).inSingletonScope(),e.bind(Hk.ICameraService).to(LL).inSingletonScope(),e.bind(Hk.ICoordinateSystemService).to(gI).inSingletonScope(),e.bind(Hk.IInteractionService).to(LI).inSingletonScope(),e.bind(Hk.IPickingService).to(VI).inSingletonScope(),e.bind(Hk.IControlService).to(BL).inSingletonScope(),e.bind(Hk.IMarkerService).to(zL).inSingletonScope(),e.bind(Hk.IIconService).to(PL).inSingletonScope(),e.bind(Hk.IFontService).to(iO).inSingletonScope(),e.bind(Hk.IPopupService).to(jL).inSingletonScope(),e.bind(Hk.INormalPass).to(yN).whenTargetNamed("clear"),e.bind(Hk.INormalPass).to(bN).whenTargetNamed("pixelPicking"),e.bind(Hk.INormalPass).to(aF).whenTargetNamed("render"),e.bind(Hk.INormalPass).to(lF).whenTargetNamed("taa"),e.bind(Hk.IFactoryNormalPass).toFactory((function(e){return function(t){return e.container.getNamed(Hk.INormalPass,t)}})),e.bind(Hk.IPostProcessingPass).to(YD).whenTargetNamed("copy"),e.bind(Hk.IPostProcessingPass).to(jD).whenTargetNamed("bloom"),e.bind(Hk.IPostProcessingPass).to(VD).whenTargetNamed("blurH"),e.bind(Hk.IPostProcessingPass).to(HD).whenTargetNamed("blurV"),e.bind(Hk.IPostProcessingPass).to(qD).whenTargetNamed("noise"),e.bind(Hk.IPostProcessingPass).to(KD).whenTargetNamed("sepia"),e.bind(Hk.IPostProcessingPass).to(GD).whenTargetNamed("colorHalftone"),e.bind(Hk.IPostProcessingPass).to(XD).whenTargetNamed("hexagonalPixelate"),e.bind(Hk.IPostProcessingPass).to(ZD).whenTargetNamed("ink"),e.bind(Hk.IFactoryPostProcessingPass).toFactory((function(e){return function(t){var n=e.container.getNamed(Hk.IPostProcessingPass,t);return n.setName(t),n}})),e}function vF(e){var t=new DM;return t.parent=e,t.bind(Hk.IStyleAttributeService).to(iR).inSingletonScope(),t.bind(Hk.IMultiPassRenderer).to(_N).inSingletonScope(),t.bind(Hk.IPostProcessor).to(oF).inSingletonScope(),t}var gF=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e};var mF=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=lS(n))==n?n:0),void 0!==t&&(t=(t=lS(t))==t?t:0),gF(lS(e),t,n)},yF=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function _F(e){return yF.indexOf(e)}var bF,xF,SF,EF;function AF(e,t){return 256*(e=mF(Math.floor(e),0,255))+(t=mF(Math.floor(t),0,255))}(bF=e.BlendType||(e.BlendType={})).normal="normal",bF.additive="additive",bF.subtractive="subtractive",bF.min="min",bF.max="max",bF.none="none",(xF=e.ScaleTypes||(e.ScaleTypes={})).LINEAR="linear",xF.SEQUENTIAL="sequential",xF.POWER="power",xF.LOG="log",xF.IDENTITY="identity",xF.TIME="time",xF.QUANTILE="quantile",xF.QUANTIZE="quantize",xF.THRESHOLD="threshold",xF.CAT="cat",xF.DIVERGING="diverging",(SF=e.StyleScaleType||(e.StyleScaleType={})).CONSTANT="constant",SF.VARIABLE="variable",(EF=e.AttributeType||(e.AttributeType={}))[EF.Attribute=0]="Attribute",EF[EF.InstancedAttribute=1]="InstancedAttribute",EF[EF.Uniform=2]="Uniform";var CF=["mapload","mapchange","mapAfterFrameChange"],TF={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},wF=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];or({target:"String",proto:!0,forced:U_("anchor")},{anchor:function(e){return j_(this,"a","name",e)}});var MF=function(t){A(r,t);var n=I(r);function r(e){var t;return b(this,r),E(P(t=n.call(this)),"markerOption",void 0),E(P(t),"defaultMarker",void 0),E(P(t),"popup",void 0),E(P(t),"mapsService",void 0),E(P(t),"sceneSerive",void 0),E(P(t),"lngLat",void 0),E(P(t),"scene",void 0),E(P(t),"added",!1),E(P(t),"eventHandle",(function(e){t.emit(e.type,{target:e,data:t.markerOption.extData,lngLat:t.lngLat})})),t.markerOption=v(v({},t.getDefault()),e),Gm(["update","onMove","onUp","addDragHandler","onMapClick"],P(t)),t.init(),t}return S(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:e.anchorType.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(Hk.IMapService),this.sceneSerive=e.get(Hk.ISceneService);var t=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&tg(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&tg(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),ug(t,"".concat(My[n]))}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(null==e?void 0:e.scrollHeight)||0,containerWidth:(null==e?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;if(Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(a.x>l){var h=this.mapsService.lngLatToContainer([i-360,o]);a.x=h.x}if(a.x<0){var f=this.mapsService.lngLatToContainer([i+360,o]);a.x=f.x}}(a.x>l||a.x<0||a.y>u||a.y<0)&&(t.style.display="none"),t.style.left=a.x+n[0]+"px",t.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){this.defaultMarker=!0,t=eg("div"),this.markerOption.element=t;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),t.appendChild(o)}ng(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=o)})),t.addEventListener("click",(function(t){e.onMapClick(t)})),t.addEventListener("click",this.eventHandle),ky(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(e){throw new Error("Method not implemented.")}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),r}(Kx),kF=function(e){A(n,e);var t=I(n);function n(e){var r,i;return b(this,n),E(P(i=t.call(this)),"markers",[]),E(P(i),"markerLayerOption",void 0),E(P(i),"clusterIndex",void 0),E(P(i),"points",[]),E(P(i),"clusterMarkers",[]),E(P(i),"mapsService",void 0),E(P(i),"scene",void 0),E(P(i),"zoom",void 0),E(P(i),"bbox",void 0),E(P(i),"containerSize",void 0),i.markerLayerOption=UL(i.getDefault(),e),Gm(["update"],P(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return S(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(Hk.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this}},{key:"setContainerSize",value:function(){if(this.mapsService){var e=this.mapsService.getContainer();this.containerSize={containerWidth:(null==e?void 0:e.scrollWidth)||0,containerHeight:(null==e?void 0:e.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(e){var t=this.markerLayerOption.cluster;if(e.getMarkerLayerContainerSize=this.getContainerSize.bind(this),t&&(this.addPoint(e,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=Im(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"hide",value:function(){this.markers.map((function(e){e.getElement().style.opacity="0"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(e){e.getElement().style.opacity="1"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:v(v({},e.getExtData()),{},{marker_id:t})};this.points.push(r),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new Pw({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(null!==(t=e.properties)&&void 0!==t&&t.cluster_id){var a,s=n.getLeaves(null===(a=e.properties)||void 0===a?void 0:a.cluster_id);if(e.properties.clusterData=s,i&&o){var u=Rg(o,Ig(null==s?void 0:s.map((function(e){return E({},i,e.properties[i])})),i)),l="point_"+o;e.properties[l]=u.toFixed(2)}}var c=n.clusterMarker(e);n.clusterMarkers.push(c),c.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption.element,n=void 0===t?this.generateElement.bind(this):t;return new MF({element:n(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]})}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!Rm(this.bbox,t))&&(this.bbox=Im(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(e){var t=eg("div","l7-marker-cluster"),n=eg("div","",t),r=eg("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;e.properties.point_count=e.properties.point_count||1;var s=o&&a?e.properties["point_"+a]||e.properties[o]:e.properties.point_count;return r.textContent=s,t}}]),n}(Kx);function OF(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{var t,n=(t=(t=document.getElementsByTagName("script"))[t.length-1]).getAttribute("data-injectcss");if(!(t=t.getAttribute("data-disable-injectsvg"))){var r,i,o,a,s;if(n&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console&&console.log(t)}}r=function(){var t,n=document.createElement("div");n.innerHTML=e._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",n=n,(t=document.body).firstChild?function(e,t){t.parentNode.insertBefore(e,t)}(n,t.firstChild):t.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=r,a=e.document,s=!1,function e(){try{a.documentElement.doScroll("left")}catch(t){return void setTimeout(e,50)}u()}(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,u())})}function u(){s||(s=!0,o())}}catch(e){}}(window);OF(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 1000;\n  box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 800;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0 6px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  height: 24px;\n  line-height: 24px;\n  display: flex;\n  align-items: center;\n  padding: 0 16px;\n  font-size: 12px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  height: 14px;\n  width: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  padding: 12px 12px 0 12px;\n  width: 474px;\n  height: 320px;\n  overflow: auto;\n  display: flex;\n  flex-wrap: wrap;\n  box-sizing: border-box;\n  align-items: flex-start;\n}\n.l7-select-control--image .l7-select-control-item {\n  margin-right: 12px;\n  border-radius: 2px;\n  overflow: hidden;\n  border: 1px solid #fff;\n  box-sizing: content-box;\n  width: calc((100% - 36px) / 3);\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  margin-bottom: 12px;\n  position: relative;\n  font-size: 12px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 142px;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control--image .l7-select-control-item:nth-child(3n) {\n  margin-right: 0;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.l7-control-zoom .l7-button-control {\n  box-shadow: 0 0 0;\n  border-radius: 0;\n  font-size: 16px;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:first-child {\n  border-bottom: 1px solid #f0f0f0;\n}\n.l7-control-scale {\n  display: flex;\n  flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: flex;\n  align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-flex;\n  display: flex;\n  pointer-events: none;\n  will-change: transform;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  pointer-events: auto;\n  font-size: 14px;\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  font-weight: bold;\n  margin-bottom: 8px;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  line-height: 18px;\n  text-align: center;\n  padding: 0;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  font-size: 14px;\n}\n.l7-popup .l7-popup-tip {\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-flex-direction: column-reverse;\n  flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-flex-direction: column;\n  flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-flex-direction: row;\n  flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-flex-direction: row-reverse;\n  flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n");var PF=function(t){A(r,t);var n=I(r);function r(e){var t;return b(this,r),E(P(t=n.call(this)),"controlOption",void 0),E(P(t),"container",void 0),E(P(t),"isShow",void 0),E(P(t),"sceneContainer",void 0),E(P(t),"scene",void 0),E(P(t),"mapsService",void 0),E(P(t),"renderService",void 0),E(P(t),"layerService",void 0),E(P(t),"controlService",void 0),E(P(t),"configService",void 0),r.controlCount++,t.controlOption=v(v({},t.getDefault(e)),e||{}),t}return S(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var t=this.getDefault(e);Object.entries(e).forEach((function(n){var r=D(n,2),i=r[0];void 0===r[1]&&(e[i]=t[i])})),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=v(v({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.get(Hk.IMapService),this.renderService=e.get(Hk.IRendererService),this.layerService=e.get(Hk.ILayerService),this.controlService=e.get(Hk.IControlService),this.configService=e.get(Hk.IGlobalConfigService),this.scene=e.get(Hk.ISceneService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),ng(this.container,"l7-control");var t=this.controlOption,n=t.className,r=t.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;tg(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return eg("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){rg(this.container,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){ng(this.container,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:e.PositionType.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.PositionType.TOPLEFT,n=this.controlService;return n&&n.removeControl(this),this.controlOption.position=t,n&&n.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var t=this.container,n=this.controlOption.className;n&&rg(t,n),e&&ng(t,e)}},{key:"setStyle",value:function(e){var t=this.container;e?t.setAttribute("style",e):t.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.container,t=this.controlOption.position,n=this.controlService.controlCorners[t];-1!==t.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e)}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),r}(qx);E(PF,"controlCount",0);var LF=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"isDisable",!1),E(P(e),"button",void 0),E(P(e),"buttonText",void 0),E(P(e),"buttonIcon",void 0),e}return S(n,[{key:"setIsDisable",value:function(e){var t,n;(this.isDisable=e,e)?null===(t=this.button)||void 0===t||t.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return eg("button","l7-button-control ".concat(e))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var e=this.controlOption,t=e.title,n=e.btnText,r=e.btnIcon;return this.setBtnTitle(t),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(e){var t=e.title,r=e.btnText,i=e.btnIcon;this.checkUpdateOption(e,["title"])&&this.setBtnTitle(t),this.checkUpdateOption(e,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(e,["btnText"])&&this.setBtnText(r),N(C(n.prototype),"setOptions",this).call(this,e)}},{key:"setBtnTitle",value:function(e){var t;null===(t=this.button)||void 0===t||t.setAttribute("title",null!=e?e:"")}},{key:"setBtnIcon",value:function(e){if(this.buttonIcon&&tg(this.buttonIcon),e){var t,n,r,i=null===(t=this.button)||void 0===t?void 0:t.firstChild;if(i)null===(n=this.button)||void 0===n||n.insertBefore(e,i);else null===(r=this.button)||void 0===r||r.appendChild(e);this.buttonIcon=e}}},{key:"setBtnText",value:function(e){if(this.button)if(rg(this.button,"l7-button-control--row"),rg(this.button,"l7-button-control--column"),e){var t,n=this.buttonText;if(!n)n=eg("div","l7-button-control__text"),null===(t=this.button)||void 0===t||t.appendChild(n),this.buttonText=n;n.innerText=e,ng(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!e&&this.buttonText&&(tg(this.buttonText),this.buttonText=void 0)}}]),n}(PF),IF=function(e){A(n,e);var t=I(n);function n(e,r){var i;return b(this,n),E(P(i=t.call(this)),"popperDOM",void 0),E(P(i),"contentDOM",void 0),E(P(i),"button",void 0),E(P(i),"option",void 0),E(P(i),"isShow",!1),E(P(i),"content",void 0),E(P(i),"timeout",null),E(P(i),"show",(function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),rg(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&n.conflictPopperList.forEach((function(e){e!==P(i)&&e.isShow&&e.hide()})),i.emit("show")),P(i)})),E(P(i),"hide",(function(){return i.isShow?(ng(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide"),P(i)):P(i)})),E(P(i),"setHideTimeout",(function(){i.timeout||(i.timeout=window.setTimeout((function(){i.isShow&&(i.hide(),i.timeout=null)}),300))})),E(P(i),"clearHideTimeout",(function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)})),E(P(i),"onBtnClick",(function(){i.isShow?i.hide():i.show()})),E(P(i),"onBtnMouseLeave",(function(){i.setHideTimeout()})),E(P(i),"onBtnMouseMove",(function(){i.clearHideTimeout(),i.isShow||i.show()})),i.button=e,i.option=r,i.init(),r.unique&&n.conflictPopperList.push(P(i)),i}return S(n,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){"string"==typeof e?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(mg(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),"click"===e?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),tg(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e={},t=this.option,n=t.container,r=t.offset,i=void 0===r?[0,0]:r,o=t.placement,a=D(i,2),s=a[0],u=a[1],l=this.button.getBoundingClientRect(),c=vg(l,n.getBoundingClientRect()),h=c.left,f=c.right,p=c.top,d=c.bottom,v=!1,g=!1;/^(left|right)/.test(o)?(o.includes("left")?e.right="".concat(l.width+f,"px"):o.includes("right")&&(e.left="".concat(l.width+h,"px")),o.includes("start")?e.top="".concat(p,"px"):o.includes("end")?e.bottom="".concat(d,"px"):(e.top="".concat(p+l.height/2,"px"),g=!0,e.transform="translate(".concat(s,"px, calc(").concat(u,"px - 50%))"))):/^(top|bottom)/.test(o)&&(o.includes("top")?e.bottom="".concat(l.height+d,"px"):o.includes("bottom")&&(e.top="".concat(l.height+p,"px")),o.includes("start")?e.left="".concat(h,"px"):o.includes("end")?e.right="".concat(f,"px"):(e.left="".concat(h+l.width/2,"px"),v=!0,e.transform="translate(calc(".concat(s,"px - 50%), ").concat(u,"px)"))),e.transform="translate(calc(".concat(s,"px - ").concat(v?"50%":"0%","), calc(").concat(u,"px - ").concat(g?"50%":"0%",")");var m=o.split("-");m.length&&ng(this.popperDOM,m.map((function(e){return"l7-popper-".concat(e)})).join(" ")),fg(this.popperDOM,dg(e))}},{key:"createPopper",value:function(){var e=this.option,t=e.container,n=e.className,r=void 0===n?"":n,i=e.content,o=eg("div","l7-popper l7-popper-hide ".concat(r)),a=eg("div","l7-popper-content"),s=eg("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),t.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}]),n}(Kx);E(IF,"conflictPopperList",[]);var RF,NF={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},DF=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"popper",void 0),e}return S(n,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),N(C(n.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(e){var t,r=N(C(n.prototype),"getDefault",this).call(this,e),i=null!==(t=null==e?void 0:e.position)&&void 0!==t?t:r.position;return v(v({},N(C(n.prototype),"getDefault",this).call(this,e)),{},{popperPlacement:NF[i],popperTrigger:"click"})}},{key:"onAdd",value:function(){var e=N(C(n.prototype),"onAdd",this).call(this);return this.initPopper(),e}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var e=this,t=this.controlOption,n=t.popperClassName,r=t.popperPlacement,i=t.popperTrigger,o=this.mapsService.getMapContainer();return this.popper=new IF(this.button,{className:n,placement:r,trigger:i,container:o,unique:!0}),this.popper.on("show",(function(){e.emit("popperShow",e)})).on("hide",(function(){e.emit("popperHide",e)})),this.popper}},{key:"setOptions",value:function(e){if(N(C(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["popperPlacement","popperTrigger","popperClassName"])){var t=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(t)}}}]),n}(LF);!function(e){e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index"}(RF||(RF={}));var FF=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"selectValue",[]),E(P(e),"optionDOMList",void 0),E(P(e),"createNormalOption",(function(t){var n=e.selectValue.includes(t.value),r=eg("div","l7-select-control-item ".concat(n?RF.ActiveOptionClassName:""));e.getIsMultiple()&&r.appendChild(e.createCheckbox(n)),t.icon&&r.appendChild(t.icon);var i=eg("span");return i.innerText=t.text,r.appendChild(i),r})),E(P(e),"onItemClick",(function(t){if(e.getIsMultiple()){var n=e.selectValue.findIndex((function(e){return e===t.value}));n>-1?e.selectValue.splice(n,1):e.selectValue=[].concat(F(e.selectValue),[t.value])}else e.selectValue=[t.value];e.setSelectValue(e.selectValue)})),e}return S(n,[{key:"setOptions",value:function(e){N(C(n.prototype),"setOptions",this).call(this,e);var t=e.options;t&&this.popper.setContent(this.getPopperContent(t))}},{key:"onAdd",value:function(){var e=N(C(n.prototype),"onAdd",this).call(this),t=this.controlOption.defaultValue;return t&&(this.selectValue=this.transSelectValue(t)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.transSelectValue(e);this.optionDOMList.forEach((function(e){var n=e.getAttribute(RF.OptionValueAttrKey),i=t.getIsMultiple()?e.querySelector("input[type=checkbox]"):void 0;r.includes(n)?(ng(e,RF.ActiveOptionClassName),i&&gg(i,!0)):(rg(e,RF.ActiveOptionClassName),i&&gg(i,!1))})),this.selectValue=r,n&&this.emit("selectChange",this.getIsMultiple()?r:r[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(e){var t=this,n=this.isImageOptions(),r=eg("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&ng(r,"l7-select-control--multiple");var i=e.map((function(e,r){var i=n?t.createImageOption(e):t.createNormalOption(e);return i.setAttribute(RF.OptionValueAttrKey,e.value),i.setAttribute(RF.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",t.onItemClick.bind(t,e)),i}));return r.append.apply(r,F(i)),this.optionDOMList=i,r}},{key:"createImageOption",value:function(e){var t=this.selectValue.includes(e.value),n=eg("div","l7-select-control-item ".concat(t?RF.ActiveOptionClassName:"")),r=eg("img");r.setAttribute("src",e.img),yg(r),n.appendChild(r);var i=eg("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(t));var o=eg("span");return o.innerText=e.text,i.appendChild(o),n.appendChild(i),n}},{key:"createCheckbox",value:function(e){var t=eg("input");return t.setAttribute("type","checkbox"),e&&gg(t,!0),t}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find((function(e){return e.img}))}},{key:"transSelectValue",value:function(e){return Array.isArray(e)?e:[e]}}]),n}(DF),BF=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getDefault",value:function(){return{position:e.PositionType.BOTTOMLEFT,name:"logo",href:"https://l7.antv.vision/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=eg("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){N(C(r.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(mg(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var t=this.controlOption,n=t.href,r=t.img,i=eg("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),yg(i),n){var o=eg("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),e.appendChild(o)}else e.appendChild(i)}}]),r}(PF),zF=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(e)),t.appendChild(n),t},jF=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],UF=function(){if("undefined"==typeof document)return!1;var e,t=jF[0],n={},r=j(jF);try{for(r.s();!(e=r.n()).done;){var i=e.value;if((null==i?void 0:i[1])in document){var o,a=j(i.entries());try{for(a.s();!(o=a.n()).done;){var s=D(o.value,2),u=s[0],l=s[1];n[t[u]]=l}}catch(e){a.e(e)}finally{a.f()}return n}}}catch(e){r.e(e)}finally{r.f()}return!1}(),VF={change:UF.fullscreenchange,error:UF.fullscreenerror},HF={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function e(){HF.off("change",e),n()};HF.on("change",i);var o=e[UF.requestFullscreen](t);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(e,t){if(HF.isFullscreen){var n=function t(){HF.off("change",t),e()};HF.on("change",n);var r=document[UF.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)}else e()}))},toggle:function(e,t){return HF.isFullscreen?HF.exit():HF.request(e,t)},onchange:function(e){HF.on("change",e)},onerror:function(e){HF.on("error",e)},on:function(e,t){var n=VF[e];n&&document.addEventListener(n,t,!1)},off:function(e,t){var n=VF[e];n&&document.removeEventListener(n,t,!1)},raw:UF};Object.defineProperties(HF,{isFullscreen:{get:function(){return Boolean(document[UF.fullscreenElement])}},element:{enumerable:!0,get:function(){var e;return null!==(e=document[UF.fullscreenElement])&&void 0!==e?e:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[UF.fullscreenEnabled])}}}),UF||(HF={isEnabled:!1});var GF=HF,WF=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"isFullscreen",!1),E(P(r),"mapContainer",void 0),E(P(r),"toggleFullscreen",_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!GF.isEnabled){e.next=3;break}return e.next=3,GF.toggle(r.mapContainer);case 3:case"end":return e.stop()}}),e)})))),E(P(r),"onClick",(function(){r.toggleFullscreen()})),E(P(r),"onFullscreenChange",(function(){r.isFullscreen=!!document.fullscreenElement;var e=r.controlOption,t=e.btnText,n=e.btnIcon,i=e.title,o=e.exitBtnText,a=e.exitBtnIcon,s=e.exitTitle;r.isFullscreen?(r.setBtnTitle(s),r.setBtnText(o),r.setBtnIcon(a)):(r.setBtnTitle(i),r.setBtnText(t),r.setBtnIcon(n)),r.emit("fullscreenChange",r.isFullscreen)})),GF.isEnabled||console.warn("当前浏览器环境不支持对地图全屏化"),r}return S(n,[{key:"setOptions",value:function(e){var t=e.exitBtnText,r=e.exitBtnIcon,i=e.exitTitle;this.isFullscreen&&(this.checkUpdateOption(e,["exitBtnIcon"])&&this.setBtnIcon(r),this.checkUpdateOption(e,["exitBtnText"])&&this.setBtnText(t),this.checkUpdateOption(e,["exitTitle"])&&this.setBtnTitle(i)),N(C(n.prototype),"setOptions",this).call(this,e)}},{key:"onAdd",value:function(){var e=N(C(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),this.mapContainer=Qv(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),e}},{key:"onRemove",value:function(){N(C(n.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(e){return v(v({},N(C(n.prototype),"getDefault",this).call(this,e)),{},{title:"全屏",btnIcon:zF("l7-icon-fullscreen"),exitTitle:"退出全屏",exitBtnIcon:zF("l7-icon-exit-fullscreen")})}}]),n}(LF),YF=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"onClick",_(g().mark((function t(){var n;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(n=e.controlOption.onExport)){t.next=5;break}t.next=10;break;case 5:return t.t0=n,t.next=8,e.getImage();case 8:t.t1=t.sent,(0,t.t0)(t.t1);case 10:case"end":return t.stop()}}),t)})))),E(P(e),"mergeImage",_(g().mark((function t(){var n,r,i,o,a,s,u,l,c,h,f,p,d,v=arguments;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=e.controlOption.imageType,o=null!==(n=null===(r=e.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},a=o.width,s=void 0===a?0:a,u=o.height,l=void 0===u?0:u,(c=document.createElement("canvas")).width=s,c.height=l,h=c.getContext("2d"),f=v.length,p=new Array(f),d=0;d<f;d++)p[d]=v[d];return t.next=9,Promise.all(p.map((function(e){return new Promise((function(t){var n=new Image;n.onload=function(){t(n)},n.src=e}))})));case 9:return t.sent.forEach((function(e){null==h||h.drawImage(e,0,0,s,l)})),t.abrupt("return",c.toDataURL("image/".concat(i)));case 12:case"end":return t.stop()}}),t)})))),e}return S(n,[{key:"onAdd",value:function(){var e=N(C(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}},{key:"getDefault",value:function(e){return v(v({},N(C(n.prototype),"getDefault",this).call(this,e)),{},{title:"导出图片",btnIcon:zF("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var e=this.mapsService.exportMap("png"),t=this.scene.exportPng("png");return this.mergeImage(e,t)}}]),n}(LF);var XF=function(e){return"number"==typeof e||rS(e)&&"[object Number]"==da(e)};var ZF=function(e){return XF(e)&&e!=+e},qF=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"getGeoLocation",(function(){return new Promise((function(e,t){window.navigator.geolocation.getCurrentPosition((function(n){var r=n.coords,i=null!=r?r:{},o=i.longitude,a=i.latitude;ZF(o)||ZF(a)?t():e([o,a])}),(function(e){t(e)}))}))})),E(P(r),"onClick",_(g().mark((function e(){var t,n,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.geolocation){e.next=2;break}return e.abrupt("return");case 2:return t=r.controlOption.transform,e.next=5,r.getGeoLocation();case 5:if(n=e.sent,i=r.mapsService.getZoom(),e.t0=r.mapsService,e.t1=i>15?i:15,!t){e.next=15;break}return e.next=12,t(n);case 12:e.t2=e.sent,e.next=16;break;case 15:e.t2=n;case 16:e.t3=e.t2,e.t0.setZoomAndCenter.call(e.t0,e.t1,e.t3);case 18:case"end":return e.stop()}}),e)})))),window.navigator.geolocation||console.warn("当前浏览器环境不支持获取地理定位"),r}return S(n,[{key:"getDefault",value:function(e){return v(v({},N(C(n.prototype),"getDefault",this).call(this,e)),{},{title:"定位",btnIcon:zF("l7-icon-reposition")})}},{key:"onAdd",value:function(){var e=N(C(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}}]),n}(LF),KF={normal:{text:"标准",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-nqiT6Vu948AAAAAAAAAAAAAARQnAQ"},light:{text:"月光银",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*J_wYQL_PaUEAAAAAAAAAAAAAARQnAQ"},dark:{text:"幻影黑",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*U7M9QI1yat4AAAAAAAAAAAAAARQnAQ"},fresh:{text:"草色青",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*T-oBT4hB5ucAAAAAAAAAAAAAARQnAQ"},grey:{text:"雅士灰",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OREXQ4vgQRIAAAAAAAAAAAAAARQnAQ"},graffiti:{text:"涂鸦",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*4UApTKmeiy4AAAAAAAAAAAAAARQnAQ"},macaron:{text:"马卡龙",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*0GrCQLtDjNcAAAAAAAAAAAAAARQnAQ"},darkblue:{text:"极夜蓝",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*uWxqSZQlPkkAAAAAAAAAAAAAARQnAQ"},wine:{text:"酱籽",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OFPrTbg3an0AAAAAAAAAAAAAARQnAQ"}},QF={normal:{text:"标准",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*AnfJTbIBJOkAAAAAAAAAAAAAARQnAQ"},light:{text:"亮",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gnuiQIok9qIAAAAAAAAAAAAAARQnAQ"},dark:{text:"暗",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*NwG-TbOlBH0AAAAAAAAAAAAAARQnAQ"},satellite:{text:"卫星",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*2X5EQLKul3IAAAAAAAAAAAAAARQnAQ"},outdoors:{text:"户外",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gXFLRIaBUI0AAAAAAAAAAAAAARQnAQ"}},$F=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"onMapThemeChange",(function(){e.mapsService.setMapStyle(e.selectValue[0])})),e}return S(n,[{key:"getDefault",value:function(e){return v(v({},N(C(n.prototype),"getDefault",this).call(this,e)),{},{title:"地图样式",btnIcon:zF("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var e="mapbox"===this.mapsService.getType()?QF:KF;return Object.entries(this.mapsService.getMapStyleConfig()).filter((function(e){var t=D(e,2),n=t[0];return"string"==typeof t[1]&&"blank"!==n})).map((function(t){var n,r=D(t,2),i=r[0],o=r[1],a=null!==(n=e[i])&&void 0!==n?n:{},s=a.text;return{text:null!=s?s:i,value:o,img:a.img,key:i}}))}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var e,t=this;if(null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i,o=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(r=null===(i=this.controlOption.options.find((function(e){return e.key===o})))||void 0===i?void 0:i.value)&&void 0!==r?r:o}else{var a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",(function(){var e=t.mapsService.getMapStyle();t.controlOption.defaultValue=e,t.setSelectValue(e,!1)}))}return this.on("selectChange",this.onMapThemeChange),N(C(n.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),n}(FF),JF=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"onLayerChange",(function(){var t;null!==(t=e.controlOption.layers)&&void 0!==t&&t.length||(e.selectValue=e.getLayerVisible(),e.setOptions({options:e.getLayerOptions()}))})),E(P(e),"onLayerVisibleChane",(function(){e.setSelectValue(e.getLayerVisible())})),E(P(e),"onSelectChange",(function(){e.layers.forEach((function(t){var n=e.selectValue.includes(t.name),r=t.isVisible();n&&!r&&t.show(),!n&&r&&t.hide()}))})),e}return S(n,[{key:"layers",get:function(){var e=this.layerService,t=this.controlOption.layers;if(Array.isArray(t)&&t.length){var n=[];return t.forEach((function(t){if(t instanceof Object&&n.push(t),"string"==typeof t){var r=e.getLayer(t)||e.getLayerByName(t);r&&n.push(r)}})),n}return e.getLayers()||[]}},{key:"getDefault",value:function(e){return v(v({},N(C(n.prototype),"getDefault",this).call(this,e)),{},{title:"图层控制",btnIcon:zF("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter((function(e){return e.isVisible()})).map((function(e){return e.name}))}},{key:"getLayerOptions",value:function(){return this.layers.map((function(e){return{text:e.name,value:e.name}}))}},{key:"setOptions",value:function(e){var t=this.checkUpdateOption(e,["layers"]);N(C(n.prototype),"setOptions",this).call(this,e),t&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var e;return null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),N(C(n.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),n}(FF),eB=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"location",[0,0]),E(P(e),"onMouseMove",(function(t){var n=e.location,r=t.lngLat||t.lnglat,i=e.controlOption.transform;r&&(n=[r.lng,r.lat]),e.location=n,i&&(n=i(n)),e.insertLocation2HTML(n),e.emit("locationChange",n)})),e}return S(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return v(v({},N(C(r.prototype),"getDefault",this).call(this,t)),{},{position:e.PositionType.BOTTOMLEFT,transform:function(e){var t=D(e,2),n=t[0],r=t[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var e=eg("div","l7-control-mouse-location");return e.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),e}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(e){this.container.innerText=e.join(", ")}}]),r}(PF),tB=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"disabled",void 0),E(P(e),"zoomInButton",void 0),E(P(e),"zoomOutButton",void 0),E(P(e),"zoomIn",(function(){!e.disabled&&e.mapsService.getZoom()<e.mapsService.getMaxZoom()&&e.mapsService.zoomIn()})),E(P(e),"zoomOut",(function(){!e.disabled&&e.mapsService.getZoom()>e.mapsService.getMinZoom()&&e.mapsService.zoomOut()})),E(P(e),"updateDisabled",(function(){var t=e.mapsService;e.zoomInButton.removeAttribute("disabled"),e.zoomOutButton.removeAttribute("disabled"),(e.disabled||t.getZoom()<=t.getMinZoom())&&e.zoomOutButton.setAttribute("disabled","true"),(e.disabled||t.getZoom()>=t.getMaxZoom())&&e.zoomInButton.setAttribute("disabled","true")})),e}return S(r,[{key:"getDefault",value:function(t){return v(v({},N(C(r.prototype),"getDefault",this).call(this,t)),{},{position:e.PositionType.BOTTOMRIGHT,name:"zoom",zoomInText:zF("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:zF("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(e){N(C(r.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=eg("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){mg(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,t,n,r,i){var o=eg("button",n,r);return"string"==typeof e?o.innerHTML=e:o.append(e),o.title=t,o.addEventListener("click",i),o}}]),r}(PF),nB=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"mScale",void 0),E(P(e),"iScale",void 0),E(P(e),"update",(function(){var t=e.mapsService,n=e.controlOption.maxWidth,r=t.getSize()[1]/2,i=t.containerToLngLat([0,r]),o=t.containerToLngLat([n,r]),a=Lm([i.lng,i.lat],[o.lng,o.lat]);e.updateScales(a)})),e}return S(r,[{key:"getDefault",value:function(t){return v(v({},N(C(r.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:e.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e=eg("div","l7-control-scale");this.resetScaleLines(e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){N(C(r.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){mg(e);var t=this.controlOption,n=t.metric,r=t.imperial,i=t.maxWidth;t.lockWidth&&fg(e,"width: ".concat(i,"px")),n&&(this.mScale=eg("div","l7-control-scale-line",e)),r&&(this.iScale=eg("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),r}(PF),rB=function(t){A(r,t);var n=I(r);function r(e){var t;b(this,r),E(P(t=n.call(this)),"popupOption",void 0),E(P(t),"mapsService",void 0),E(P(t),"sceneService",void 0),E(P(t),"layerService",void 0),E(P(t),"scene",void 0),E(P(t),"closeButton",void 0),E(P(t),"container",void 0),E(P(t),"content",void 0),E(P(t),"contentTitle",void 0),E(P(t),"contentPanel",void 0),E(P(t),"title",void 0),E(P(t),"tip",void 0),E(P(t),"isShow",!0),E(P(t),"onMouseMove",(function(e){var n,r=t.mapsService.getMapContainer(),i=null!==(n=null==r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},o=i.left,a=void 0===o?0:o,s=i.top,u=void 0===s?0:s;t.setPopupPosition(e.clientX-a,e.clientY-u)})),E(P(t),"updateLngLatPosition",(function(){if(t.mapsService&&!t.popupOption.followCursor){var e=t.lngLat,n=e.lng,r=e.lat,i=t.mapsService.lngLatToContainer([n,r]),o=i.x,a=i.y;t.setPopupPosition(o,a)}})),E(P(t),"onKeyDown",(function(e){27===e.keyCode&&t.remove()})),E(P(t),"onCloseButtonClick",(function(e){e.stopPropagation&&e.stopPropagation(),t.remove()})),E(P(t),"update",(function(){var e=!!t.lngLat,n=t.popupOption,r=n.className,i=n.style,o=n.maxWidth,a=n.anchor,s=n.stopPropagation;if(t.mapsService&&e&&t.content){var u=t.mapsService.getMarkerContainer();!t.container&&u&&(t.container=eg("div","l7-popup ".concat(null!=r?r:""," ").concat(t.isShow?"":"l7-popup-hide"),u),i&&t.container.setAttribute("style",i),t.tip=eg("div","l7-popup-tip",t.container),t.container.appendChild(t.content),s&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){t.container.addEventListener(e,(function(e){e.stopPropagation()}))})),t.container.style.whiteSpace="nowrap"),o&&t.container.style.maxWidth!==o&&(t.container.style.maxWidth=o),t.updateLngLatPosition(),ug(t.container,"".concat(My[a])),ky(t.container,a,"popup")}})),t.popupOption=v(v({},t.getDefault(null!=e?e:{})),e);var i=t.popupOption.lngLat;return i&&(t.lngLat=i),t}return S(r,[{key:"lngLat",get:function(){var e;return null!==(e=this.popupOption.lngLat)&&void 0!==e?e:{lng:0,lat:0}},set:function(e){this.popupOption.lngLat=e}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(e){this.mapsService=e.get(Hk.IMapService),this.sceneService=e.get(Hk.ISceneService),this.layerService=e.get(Hk.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var t=this.popupOption,n=t.html,r=t.text;return n?this.setHTML(n):r&&this.setText(r),this.emit("open"),this}},{key:"remove",value:function(){if(this.isOpen())return this.content&&tg(this.content),this.container&&(tg(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(e){return this.popupOption=v(v({},this.popupOption),e),this.checkUpdateOption(e,["closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets","title"])&&(this.container&&(tg(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text)),this.checkUpdateOption(e,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(e,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(e,["html"])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,["text"])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,["lngLat"])&&e.lngLat&&this.setLnglat(e.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&rg(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&ng(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(e){return this.popupOption.html=e,this.setDOMContent(this.getPopupHTMLFragment(e))}},{key:"setText",value:function(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}},{key:"panToPopup",value:function(){var e=this.lngLat,t=e.lng,n=e.lat;return this.popupOption.autoPan&&this.mapsService.panTo([t,n]),this}},{key:"setLngLat",value:function(e){return this.setLnglat(e)}},{key:"setLnglat",value:function(e){var t=this;return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout((function(){t.panToPopup()}),0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:e.anchorType.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(e){return this.createContent(),this.contentPanel.appendChild(e),this.update(),this}},{key:"updateCloseOnClick",value:function(e){this.mapsService.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&this.mapsService.on("click",this.onCloseButtonClick)}},{key:"updateCloseOnEsc",value:function(e){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(e){var t=this.mapsService.getContainer();t.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!e&&t.addEventListener("mousemove",this.onMouseMove)}},{key:"createContent",value:function(){var e;(this.content&&tg(this.content),this.content=eg("div","l7-popup-content",this.container),this.popupOption.title)?(this.contentTitle=eg("div","l7-popup-content__title",this.content),null===(e=this.contentTitle)||void 0===e||e.append(this.getPopupHTMLFragment(this.popupOption.title))):this.contentTitle=void 0;if(this.popupOption.closeButton){var t=zF("l7-icon-guanbi");ng(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",this.onCloseButtonClick),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=eg("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(e,t){if(this.container){var n=this.popupOption.offsets;this.container.style.left=e+n[0]+"px",this.container.style.top=t-n[1]+"px"}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}},{key:"getPopupHTMLFragment",value:function(e){var t,n=window.document.createDocumentFragment(),r=window.document.createElement("body");for("string"==typeof e?r.innerHTML=e:Array.isArray(e)?r.append.apply(r,F(e)):e instanceof HTMLElement&&r.append(e);t=r.firstChild;)n.appendChild(t);return n}}]),r}(Kx),iB=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,oB=/^\w*$/;var aB=function(e,t){if(dC(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!iS(e))||(oB.test(e)||!iB.test(e)||null!=t&&e in Object(t))};function sB(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(sB.Cache||WA),n}sB.Cache=WA;var uB=sB;var lB=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,cB=/\\(\\)?/g,hB=function(e){var t=uB(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(lB,(function(e,n,r,i){t.push(r?i.replace(cB,"$1"):n||e)})),t}));var fB=function(e,t){return dC(e)?e:aB(e,t)?[e]:hB(VN(e))};var pB=function(e){if("string"==typeof e||iS(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};var dB=function(e,t){for(var n=0,r=(t=fB(t,e)).length;null!=e&&n<r;)e=e[pB(t[n++])];return n&&n==r?e:void 0};var vB=function(e,t,n){var r=null==e?void 0:dB(e,t);return void 0===r?n:r},gB=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"layerConfigMap",new WeakMap),E(P(e),"displayFeatureInfo",void 0),e}return S(n,[{key:"addTo",value:function(e){return N(C(n.prototype),"addTo",this).call(this,e),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return N(C(n.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(e){return this.unbindLayerEvent(),N(C(n.prototype),"setOptions",this).call(this,e),this.bindLayerEvent(),this}},{key:"getDefault",value:function(e){var t="click"===e.trigger;return v(v({},N(C(n.prototype),"getDefault",this).call(this,e)),{},{trigger:"hover",followCursor:!t,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var e=this,t=this.popupOption,n=t.config,r=t.trigger;n.forEach((function(t){var n=e.getLayerByConfig(t);if(n){var i=v({},t);if("hover"===r){var o=e.onLayerMouseMove.bind(e,n),a=e.onLayerMouseOut.bind(e,n);i.onMouseMove=o,i.onMouseOut=a,null==n||n.on("mousemove",o),null==n||n.on("mouseout",a)}else{var s=e.onLayerClick.bind(e,n);i.onClick=s,null==n||n.on("click",s)}var u=n.getSource(),l=e.onSourceUpdate.bind(e,n);null==u||u.on("update",l),i.onSourceUpdate=l,e.layerConfigMap.set(n,i)}}))}},{key:"unbindLayerEvent",value:function(){var e=this;this.popupOption.config.forEach((function(t){var n=e.getLayerByConfig(t),r=n&&e.layerConfigMap.get(n);if(r){var i,o=r.onMouseMove,a=r.onMouseOut,s=r.onClick,u=r.onSourceUpdate;if(o&&n.off("mousemove",o),a&&n.off("mouseout",a),s&&n.off("click",s),u)null==n||null===(i=n.getSource())||void 0===i||i.off("update",u)}}))}},{key:"onLayerMouseMove",value:function(e,t){if(!this.isSameFeature(e,t.featureId)){var n=this.getLayerInfoFrag(e,t);this.setDOMContent(n),this.displayFeatureInfo={layer:e,featureId:t.featureId}}this.isShow||this.show()}},{key:"onLayerMouseOut",value:function(e,t){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(e,t){if(this.isShow&&this.isSameFeature(e,t.featureId))this.hide();else{var n=this.getLayerInfoFrag(e,t);this.setDOMContent(n),this.setLnglat(t.lngLat),this.show(),this.displayFeatureInfo={layer:e,featureId:t.featureId}}}},{key:"onSourceUpdate",value:function(e){var t;(null===(t=this.displayFeatureInfo)||void 0===t?void 0:t.layer)===e&&(this.hide(),this.displayFeatureInfo=void 0)}},{key:"getLayerInfoFrag",value:function(e,t){var n=this.layerConfigMap.get(e),r=document.createDocumentFragment();if(n){var i=t.feature;"Feature"===i.type&&"properties"in i&&"geometry"in i&&(i=i.properties);var o=n.fields;null==o||o.forEach((function(e){var n="string"==typeof e?{field:e}:e,o=n.field,a=n.formatField,s=n.formatValue,u=n.getValue,l=eg("div","l7-layer-popup__row"),c=u?u(t.feature):vB(i,o);l.innerHTML="".concat(a?a(o):o,": ").concat(s?s(c):c),r.appendChild(l)}))}return r}},{key:"getLayerByConfig",value:function(e){var t=e.layer;return t instanceof Object?t:"string"==typeof t?this.layerService.getLayer(t)||this.layerService.getLayerByName(t):void 0}},{key:"isSameFeature",value:function(e,t){var n=this.displayFeatureInfo;return n&&e===n.layer&&t===n.featureId}}]),n}(rB);var mB,yB,_B,bB,xB=function(e){return void 0===e},SB=(E(mB={},e.BlendType.additive,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE,srcAlpha:1,dstAlpha:1}}),E(mB,e.BlendType.none,{enable:!1}),E(mB,e.BlendType.normal,{enable:!0,func:{srcRGB:e.gl.SRC_ALPHA,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),E(mB,e.BlendType.subtractive,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE,srcAlpha:e.gl.ZERO,dstAlpha:e.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:e.gl.FUNC_SUBTRACT,alpha:e.gl.FUNC_SUBTRACT}}),E(mB,e.BlendType.max,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE},equation:{rgb:e.gl.MAX_EXT}}),E(mB,e.BlendType.min,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE},equation:{rgb:e.gl.MIN_EXT}}),mB);function EB(e,t,n,r,i){t.updateStyleAttribute(e,n,r,i)}function AB(e,t){t.tileLayer||t.isTileLayer||(e.opacity&&CB("opacity",t,e.opacity),e.strokeWidth&&CB("strokeWidth",t,e.strokeWidth),e.strokeOpacity&&CB("strokeOpacity",t,e.strokeOpacity),e.stroke&&function(e,t,n){KC(n)?EB(e,t,n,void 0):Array.isArray(n)&&2===n.length&&(KC(n[0])&&ga(n[1])||KC(n[0])&&Array.isArray(n[1])&&n[1].length>0)?EB(e,t,n[0],n[1]):EB(e,t,"#fff",void 0)}("stroke",t,e.stroke),e.offsets&&TB("offsets",t,e.offsets),e.textOffset&&TB("textOffset",t,e.textOffset),e.thetaOffset&&CB("thetaOffset",t,e.thetaOffset))}function CB(e,t,n){KC(n)?EB(e,t,n,(function(e){return e})):XF(n)?EB(e,t,[n],void 0):Array.isArray(n)&&2===n.length&&(KC(n[0])&&ga(n[1])||KC(n[0])&&Array.isArray(n[1])&&XF(n[1][0])&&XF(n[1][1]))?EB(e,t,n[0],n[1]):EB(e,t,[1],void 0)}function TB(e,t,n){KC(n)?EB(e,t,n,(function(e){return e})):Array.isArray(n)&&2===n.length&&KC(n[0])&&ga(n[1])?EB(e,t,n[0],n[1]):Array.isArray(n)&&2===n.length&&XF(n[0])&&XF(n[1])?EB(e,t,n,void 0):EB(e,t,[0,0],void 0)}var wB=(yB=fF(Hk.IGlobalConfigService),bB=V((_B=function(){function e(t){b(this,e),U(this,"configService",bB,this),E(this,"config",void 0),this.config=t}return S(e,[{key:"setContainer",value:function(e,t,n,r){e.bind(Hk.MapConfig).toConstantValue(v(v({},this.config),{},{id:t,canvas:n,hasBaseMap:r})),e.bind(Hk.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}()).prototype,"configService",[yB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_B),MB=W((function(e,t){e.exports=function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(n(e.Loca)),Promise.all(r)}function t(e){return new Promise((function(t,n){var i=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(e.plugins[u])&&i.push(e.plugins[u]);if(a.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=e.version||o.AMapUI.version,u=o.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(e){a.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else a.AMapUI===r.loaded?e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t():e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(e){e?n(e):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t()}))}))}function n(e){return new Promise((function(t,n){if(o.AMap.version.startsWith("2.0"))n("Loca 暂不适配 JSAPI 2.0,请使用 1.4.15");else if(a.Loca===r.failed)n("前次请求 Loca 失败");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=e.version||o.Loca.version;var i=o.Loca.version,u=o.key,l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(e){a.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=r.loaded,t();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}else a.Loca===r.loaded?e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):t():e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(t){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=t.key,l=t.version,c=t.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=l||o.AMap.version,o.AMap.plugins=c||o.AMap.plugins,a.AMap=r.loading,l=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,e(t).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(c=document.createElement("script")).type="text/javascript",c.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),c.onerror=function(e){a.AMap=r.failed,i(e)},l.appendChild(c)):i("请填写key")}else if(a.AMap==r.loaded)if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&s.push(t.plugins[l]);s.length?window.AMap.plugin(s,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}else if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var h=[];if(t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&h.push(t.plugins[l]);!function(e){"function"==typeof e&&(a.AMap===r.loaded?e(window.AMap):u.push(e))}((function(){h.length?window.AMap.plugin(h,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()}));!function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"}(e.Version||(e.Version={}));var kB=function(){function e(t){b(this,e),E(this,"size",1e4),this.size=t||1e4}return S(e,[{key:"setSize",value:function(e){this.size=e}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(e){return(180+e)/360*this.size}},{key:"mercatorYfromLat",value:function(e){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(e){return e/this.size*360-180}},{key:"latFromMercatorY",value:function(e){var t=180-360*(1-e/this.size);return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}},{key:"project",value:function(e){return[this.mercatorXfromLng(e[0]),this.mercatorYfromLat(e[1])]}},{key:"unproject",value:function(e){return[this.lngFromMercatorX(e[0]),this.latFromMercatorY(e[1])]}}]),e}();function OB(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={top:0,right:0,bottom:0,left:0};if("number"==typeof e)return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(4===e.length)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(2===e.length)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return Object.assign({},t,e)}function PB(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LB(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function IB(e,t,n){return t&&LB(e.prototype,t),n&&LB(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function RB(e){return(RB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function NB(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function DB(e,t){if(t&&("object"===RB(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return NB(e)}function FB(e){return(FB=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function BB(e,t){return(BB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function zB(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jB(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return zB(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zB(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function UB(e,t){var n,r,i,o=Hb([],t,e);return n=o,r=o,i=1/o[3],n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,o}function VB(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var HB=Math.PI,GB=HB/4,WB=HB/180,YB=180/HB;function XB(e){return Math.pow(2,e)}function ZB(e,t){var n=jB(e,2),r=n[0],i=n[1];VB(Number.isFinite(r)&&Number.isFinite(t)),VB(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*WB;return[(t*=512)*(r*WB+HB)/(2*HB),t*(HB-Math.log(Math.tan(GB+.5*o)))/(2*HB)]}function qB(e,t){var n=jB(e,2),r=n[0],i=n[1],o=r/(t*=512)*(2*HB)-HB,a=2*(Math.atan(Math.exp(HB-i/t*(2*HB)))-GB);return[o*YB,a*YB]}function KB(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,o=e.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:XB(r),VB(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(t*WB),c=u/360,h=c/l,f=u/4003e4/l;if(s.pixelsPerMeter=[f,-f,f],s.metersPerPixel=[1/f,-1/f,1/f],s.pixelsPerDegree=[c,-h,f],s.degreesPerPixel=[1/c,-1/h,1/f],a){var p=WB*Math.tan(t*WB)/l,d=c*p/2,v=u/4003e4*p,g=v/h*f;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[g,0,g]}return s}function QB(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,o=e.center,a=void 0===o?null:o,s=e.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return Q_(l,l,[0,0,-i]),$_(l,l,[1,1,1/t]),J_(l,l,-n*WB),tb(l,l,r*WB),u&&$_(l,l,[1,-1,1]),a&&Q_(l,l,Cb([],a)),l}function $B(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,o=e.pitch,a=void 0===o?0:o,s=e.nearZMultiplier,u=void 0===s?1:s,l=e.farZMultiplier,c=void 0===l?1:l,h=a*WB,f=Math.atan(.5/i),p=Math.sin(f)*i/Math.sin(Math.PI/2-h-f),d=Math.cos(Math.PI/2-h)*p+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:u,far:d*c}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return ab([],o,a,s,u)}function JB(e,t){var n=jB(e,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return VB(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),UB(t,[r,i,a,1])}function ez(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=jB(e,3),i=r[0],o=r[1],a=r[2];if(VB(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=UB(t,[i,o,a,1]);return s}var u=UB(t,[i,o,0,1]),l=UB(t,[i,o,1,1]),c=u[2],h=l[2],f=c===h?0:((n||0)-c)/(h-c);return $b([],u,l,f)}var tz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function nz(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,o=void 0===i?0:i,a=e.maxZoom,s=void 0===a?24:a,u=e.padding,l=void 0===u?0:u,c=e.offset,h=void 0===c?[0,0]:c,f=jB(r,2),p=jB(f[0],2),d=p[0],v=p[1],g=jB(f[1],2),m=g[0],y=g[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else VB(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var _=new dz({width:t,height:n,longitude:0,latitude:0,zoom:0}),b=_.project([d,y]),x=_.project([m,v]),S=[Math.max(Math.abs(x[0]-b[0]),o),Math.max(Math.abs(x[1]-b[1]),o)],E=[t-l.left-l.right-2*Math.abs(h[0]),n-l.top-l.bottom-2*Math.abs(h[1])];VB(E[0]>0&&E[1]>0);var A=E[0]/S[0],C=E[1]/S[1],T=(l.right-l.left)/2/A,w=(l.bottom-l.top)/2/C,M=[(x[0]+b[0])/2+T,(x[1]+b[1])/2+w],k=_.unproject(M),O=_.zoom+Math.log2(Math.abs(Math.min(A,C)));return{longitude:k[0],latitude:k[1],zoom:Math.min(O,s)}}var rz,iz,oz,az,sz,uz,lz,cz,hz,fz,pz,dz=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,l=n.zoom,c=void 0===l?0:l,h=n.pitch,f=void 0===h?0:h,p=n.bearing,d=void 0===p?0:p,v=n.altitude,g=void 0===v?1.5:v,m=n.nearZMultiplier,y=n.farZMultiplier;PB(this,t),r=r||1,i=i||1;var _=XB(c);g=Math.max(.75,g);var b=ZB([u,a],_);b[2]=0;var x=$B({width:r,height:i,pitch:f,bearing:d,altitude:g,nearZMultiplier:m||1/i,farZMultiplier:y||1.01}),S=QB({height:i,center:b,pitch:f,bearing:d,altitude:g,flipY:!0});return(e=DB(this,FB(t).call(this,{width:r,height:i,viewMatrix:S,projectionMatrix:x}))).latitude=a,e.longitude=u,e.zoom=c,e.pitch=f,e.bearing=d,e.altitude=g,e.scale=_,e.center=b,e.pixelsPerMeter=KB(NB(NB(e))).pixelsPerMeter[2],Object.freeze(NB(NB(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BB(e,t)}(t,e),IB(t,[{key:"projectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return ZB(e,t)}},{key:"unprojectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return qB(e,t)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t,n,r=e.lngLat,i=ez(e.pos,this.pixelUnprojectionMatrix),o=Zb([],ZB(r,this.scale),((t=[])[0]=-(n=i)[0],t[1]=-n[1],t));return qB(Zb([],this.center,o),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=nz(Object.assign({width:r,height:i,bounds:e},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new t({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),t}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,o=void 0===i?tz:i,a=t.projectionMatrix,s=void 0===a?tz:a;PB(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];K_(u,u,this.projectionMatrix),K_(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];$_(l,l,[this.width/2,-this.height/2,1]),Q_(l,l,[1,-1,0]),K_(l,l,this.viewProjectionMatrix);var c=q_([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return IB(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&hb(t.projectionMatrix,this.projectionMatrix)&&hb(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=this.projectPosition(e),o=JB(i,this.pixelProjectionMatrix),a=jB(o,2),s=a[0],u=a[1],l=r?u:this.height-u;return 2===e.length?[s,l]:[s,l,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,o=jB(e,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,h=ez([a,l,u],this.pixelUnprojectionMatrix,c),f=this.unprojectPosition(h),p=jB(f,3),d=p[0],v=p[1],g=p[2];return Number.isFinite(u)?[d,v,g]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(e){var t=jB(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=jB(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}}]),e}()),vz=function(){function e(){b(this,e),E(this,"viewport",void 0)}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new dz(v(v({},s),{},{width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),gz={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},mz=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],yz=0;window.forceWebGL=!0;var _z,bz=!1,xz=[],Sz=(rz=NM(),iz=RM(Hk.IGlobalConfigService),oz=RM(Hk.MapConfig),az=RM(Hk.ICoordinateSystemService),sz=RM(Hk.IEventEmitter),rz((cz=V((lz=function(){function t(){var n=this;b(this,t),E(this,"version",e.Version["GAODE1.x"]),E(this,"simpleMapCoord",new kB),E(this,"map",void 0),E(this,"bgColor","rgba(0, 0, 0, 0)"),U(this,"configService",cz,this),U(this,"config",hz,this),U(this,"coordinateSystemService",fz,this),U(this,"eventEmitter",pz,this),E(this,"markerContainer",void 0),E(this,"$mapContainer",void 0),E(this,"viewport",void 0),E(this,"cameraChangedCallback",void 0),E(this,"handleCameraChanged",(function(t){var r=t.camera,i=r.fov,o=r.near,a=r.far,s=r.height,u=r.pitch,l=r.rotation,c=r.aspect,h=r.position,f=n.getCenter(),p=f.lng,d=f.lat;if(n.emit("mapchange"),n.cameraChangedCallback){n.viewport.syncWithMapCamera({aspect:c,bearing:360-l,far:a,fov:i,cameraHeight:s,near:o,pitch:u,zoom:n.map.getZoom()-1,center:[p,d],offsetOrigin:[h.x,h.y]});var v=n.config.offsetZoom,g=void 0===v?12:v;n.viewport.getZoom()>g?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20),n.cameraChangedCallback(n.viewport)}}))}var n;return S(t,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];this.markerContainer=eg("div","l7-marker-container",t)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==CF.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(e,t)}},{key:"off",value:function(e,t){-1!==CF.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(e){return this.map.setZoom(e+1)}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=OB(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=OB(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().toBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(e,t)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e+1,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyleValue(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"getMapStyleConfig",value:function(){return gz}},{key:"getMapStyleValue",value:function(e){return this.getMapStyleConfig()[e]||e}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(e){var t=this.map.lngLatToGeodeticCoord(e);return[t.x,-t.y]}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=W_();return Q_(o,o,mb(i[0],i[1],t)),$_(o,o,mb(r[0],r[1],r[2])),J_(o,o,n[0]),eb(o,o,n[1]),tb(o,o,n[2]),o}},{key:"init",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,f,p,d,m=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?"15cd8a57710d40c9b7c0e3cc120f1200":l,h=t.mapInstance,f=t.plugin,p=void 0===f?[]:f,d=O(t,mz),e.next=3,new Promise((function(e){var t=function(){if(h)m.map=h,m.$mapContainer=m.map.getContainer(),setTimeout((function(){m.map.on("camerachange",m.handleCameraChanged),e()}),30);else{m.$mapContainer=m.creatMapContainer(n);var t=v({mapStyle:m.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);t.zoom&&(t.zoom+=1);var r=new AMap.Map(m.$mapContainer,t);r.on("camerachange",m.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return m.handleAfterMapChange()}))})),m.map=r,setTimeout((function(){e()}),10)}};bz||h?bz&&window.AMap||h?t():xz.push(t):("15cd8a57710d40c9b7c0e3cc120f1200"===c&&console.warn(m.configService.getSceneWarninfo("MapToken")),bz=!0,p.push("Map3D"),MB.load({key:c,version:"1.4.15",plugins:p}).then((function(){t(),xz.length&&(xz.forEach((function(e){return e()})),xz=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new vz;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(M(AMap.LngLat,F(e)),M(AMap.LngLat,F(t))),r=D(this.lngLatToCoord(e),2),i=r[0],o=r[1],a=D(this.lngLatToCoord(t),2),s=a[0],u=a[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(o-u,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){var e,t;this.map.destroy(),null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id="l7_amap_div"+yz++,t.appendChild(n),n}}]),t}()).prototype,"configService",[iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hz=V(lz.prototype,"config",[oz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fz=V(lz.prototype,"coordinateSystemService",[az],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pz=V(lz.prototype,"eventEmitter",[sz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uz=lz))||uz),Ez=Math.PI/180,Az=function(){function e(){b(this,e),E(this,"projectionMatrix",W_()),E(this,"viewMatrix",W_()),E(this,"viewProjectionMatrix",W_()),E(this,"ViewProjectionMatrixUncentered",W_()),E(this,"viewUncenteredMatrix",W_()),E(this,"zoom",void 0),E(this,"center",void 0)}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.pitch,i=void 0===r?0:r,o=e.bearing,a=void 0===o?0:o,s=e.center,u=void 0===s?[0,0]:s,l=e.offsetOrigin,c=void 0===l?[0,0]:l,h=e.cameraHeight,f=void 0===h?1:h,p=e.aspect,d=void 0===p?1:p,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,_=e.fov,b=void 0===_?0:_;this.zoom=n,this.center=u;var x=i*Ez,S=(360-a)*Ez;ab(this.projectionMatrix,b,d,g,y);var E=mb(f*Math.sin(x)*Math.sin(S),-f*Math.sin(x)*Math.cos(S),f*Math.cos(x)),A=mb(-Math.cos(x)*Math.sin(S),Math.cos(x)*Math.cos(S),Math.sin(x));lb(this.viewMatrix,E,mb(0,0,0),A),this.viewUncenteredMatrix=Y_(this.viewMatrix),Q_(this.viewMatrix,this.viewMatrix,mb(-c[0],c[1],0)),K_(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),K_(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var e=D(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e){var t=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),n=Math.PI/180,r=e[0]*n,i=t*n;i=Math.log(Math.tan(Math.PI/4+i/2));return[r=(256<<20)*(.5/Math.PI*r+.5)-215440491,i=-((256<<20)*(-.5/Math.PI*i+(n=.5))-106744817)]}}]),e}(),Cz=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];window.forceWebGL=!0;var Tz,wz=!1,Mz=[],kz=NM()(_z=function(t){A(i,t);var n,r=I(i);function i(){var t;b(this,i);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return E(P(t=r.call.apply(r,[this].concat(o))),"version",e.Version["GAODE1.x"]),E(P(t),"viewport",void 0),E(P(t),"handleCameraChanged",(function(n){var r=n.camera,i=r.fov,o=r.near,a=r.far,s=r.height,u=r.pitch,l=r.rotation,c=r.aspect,h=r.position,f=t.getCenter(),p=f.lng,d=f.lat;if(t.emit("mapchange"),t.cameraChangedCallback){t.viewport.syncWithMapCamera({aspect:c,bearing:360-l,far:a,fov:i,cameraHeight:s,near:o,pitch:u,zoom:t.map.getZoom()-1,center:[p,d],offsetOrigin:[h.x,h.y]});var v=t.config.offsetZoom,g=void 0===v?12:v;t.viewport.getZoom()>g?t.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_OFFSET):t.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20),t.cameraChangedCallback(t.viewport)}})),t}return S(i,[{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=W_();return Q_(o,o,mb(i[0],i[1],t)),$_(o,o,mb(r[0],r[1],r[2])),J_(o,o,n[0]),eb(o,o,n[1]),tb(o,o,n[2]),o}},{key:"init",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,f,p,d,m=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?"15cd8a57710d40c9b7c0e3cc120f1200":l,h=t.mapInstance,f=t.plugin,p=void 0===f?[]:f,d=O(t,Cz),e.next=3,new Promise((function(e){var t=function(){if(h)m.map=h,m.$mapContainer=m.map.getContainer(),setTimeout((function(){m.map.on("camerachange",m.handleCameraChanged),e()}),30);else{m.$mapContainer=m.creatMapContainer(n);var t=v({mapStyle:m.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);t.zoom&&(t.zoom+=1);var r=new AMap.Map(m.$mapContainer,t);r.on("camerachange",m.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return m.handleAfterMapChange()}))})),m.map=r,setTimeout((function(){e()}),10)}};wz||h?wz&&window.AMap||h?t():Mz.push(t):("15cd8a57710d40c9b7c0e3cc120f1200"===c&&console.warn(m.configService.getSceneWarninfo("MapToken")),wz=!0,p.push("Map3D"),MB.load({key:c,version:"1.4.15",plugins:p}).then((function(e){t(),Mz.length&&(Mz.forEach((function(e){return e()})),Mz=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new Az;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(M(AMap.LngLat,F(e)),M(AMap.LngLat,F(t))),r=D(this.lngLatToCoord(e),2),i=r[0],o=r[1],a=D(this.lngLatToCoord(t),2),s=a[0],u=a[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(o-u,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}}]),i}(Sz))||_z,Oz=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return kz}}]),n}(wB),Pz=function(){function e(){b(this,e),E(this,"projectionMatrix",W_()),E(this,"viewMatrix",W_()),E(this,"viewProjectionMatrix",W_()),E(this,"ViewProjectionMatrixUncentered",W_()),E(this,"viewUncenteredMatrix",W_()),E(this,"zoom",void 0),E(this,"center",void 0)}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.center,i=void 0===r?[0,0]:r,o=e.offsetOrigin,a=void 0===o?[0,0]:o,s=e.cameraPosition,u=void 0===s?[0,0,0]:s,l=e.up,c=void 0===l?[0,1,0]:l,h=e.lookAt,f=void 0===h?[0,0,0]:h,p=e.aspect,d=void 0===p?1:p,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,_=e.fov,b=void 0===_?45:_;this.zoom=n,this.center=i,ab(this.projectionMatrix,b/180*Math.PI,d,g,y);var x=mb.apply(jb,F(u)),S=mb.apply(jb,F(f)),E=mb.apply(jb,F(c));lb(this.viewMatrix,x,S,E),this.viewUncenteredMatrix=Y_(this.viewMatrix),Q_(this.viewMatrix,this.viewMatrix,mb(-a[0],a[1],0)),K_(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),K_(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var e=D(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e){var t=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),n=Math.PI/180,r=e[0]*n,i=t*n;i=Math.log(Math.tan(Math.PI/4+i/2));return[r=(256<<20)*(.5/Math.PI*r+.5)-215440491,i=-((256<<20)*(-.5/Math.PI*i+(n=.5))-106744817)]}}]),e}(),Lz=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];window.forceWebGL=!0;var Iz=!1,Rz=[],Nz=NM()(Tz=function(t){A(i,t);var n,r=I(i);function i(){var t;b(this,i);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return E(P(t=r.call.apply(r,[this].concat(o))),"version",e.Version["GAODE2.x"]),E(P(t),"sceneCenter",void 0),E(P(t),"sceneCenterMKT",void 0),E(P(t),"viewport",void 0),E(P(t),"handleViewChanged",(function(n){var r=t.map.customCoords.getCameraParams(),i=r.fov,o=r.near,a=r.far,s=r.aspect,u=r.position,l=r.lookAt,c=r.up;t.emit("mapchange");var h=t.map.customCoords.getCenter();t.cameraChangedCallback&&(t.viewport.syncWithMapCamera({aspect:s,far:a,fov:i,cameraPosition:u,lookAt:l,up:c,near:o,zoom:t.map.getZoom()-1,center:h,offsetOrigin:[u[0],u[1]]}),t.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_2),t.cameraChangedCallback(t.viewport))})),t}return S(i,[{key:"setCustomCoordCenter",value:function(e){this.sceneCenter=e,this.sceneCenterMKT=Om.apply(void 0,F(e))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoordByLayer",value:function(e,t){var n=t||this.sceneCenter,r=Om.apply(void 0,F(n));return this._sub(Om(e[0],e[1]),r)}},{key:"lngLatToCoordsByLayer",value:function(e,t){var n=this;return e.map((function(e){return"number"==typeof e[0]?n.lngLatToCoordByLayer(e,t):e.map((function(e){return n.lngLatToCoordByLayer(e,t)}))}))}},{key:"setCoordCenter",value:function(e){this.map.customCoords.setCenter(e),this.setCustomCoordCenter(e)}},{key:"lngLatToCoord",value:function(e){return this.sceneCenter||(this.map.customCoords.setCenter(e),this.setCustomCoordCenter(e)),this._sub(Om(e[0],e[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return"number"==typeof e[0]?t.lngLatToCoord(e):e.map((function(e){return t.lngLatToCoord(e)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];t.style.zIndex="auto",this.markerContainer=eg("div","l7-marker-container2",t)}}}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"lngLatToContainer",value:function(e){var t=this.map.lngLatToContainer(e);return{x:t.getX(),y:t.getY()}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(e),o=W_();return Q_(o,o,mb(i[0],i[1],t)),$_(o,o,mb(r[0],r[1],r[2])),J_(o,o,n[0]),eb(o,o,n[1]),tb(o,o,n[2]),o}},{key:"init",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,f,p,d,m=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?"ff533602d57df6f8ab3b0fea226ae52f":l,h=t.mapInstance,f=t.plugin,p=void 0===f?[]:f,t.version,d=O(t,Lz),e.next=3,new Promise((function(e){var t=function(){if(h){var t;m.map=h,m.$mapContainer=m.map.getContainer();var r=m.map.getCenter();null===(t=m.map.customCoords)||void 0===t||t.setCenter([r.lng,r.lat]),m.setCustomCoordCenter([r.lng,r.lat]),setTimeout((function(){m.map.on("viewchange",m.handleViewChanged),e()}),30)}else{m.$mapContainer=m.creatMapContainer(n);var o=v({mapStyle:m.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);o.zoom&&(o.zoom+=1);var s=new AMap.Map(m.$mapContainer,o);m.map=s;var l=s.getCenter();s.customCoords.setCenter([l.lng,l.lat]),m.setCustomCoordCenter([l.lng,l.lat]),s.on("viewchange",m.handleViewChanged),setTimeout((function(){e()}),10)}};m.viewport=new Pz,Iz||h?Iz&&window.AMap||h?t():Rz.push(t):("ff533602d57df6f8ab3b0fea226ae52f"===c&&console.warn(m.configService.getSceneWarninfo("MapToken")),Iz=!0,p.push("Map3D"),MB.load({key:c,version:"2.0.5",plugins:p}).then((function(e){t(),Rz.length&&(Rz.forEach((function(e){return e()})),Rz=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.initViewPort();case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"initViewPort",value:function(){var t,n=null===(t=this.map.customCoords)||void 0===t?void 0:t.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,l=n.up;this.emit("mapchange");var c=this.map.customCoords.getCenter(),h=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,near:i,up:l,zoom:h-1,center:c,offsetOrigin:[s[0],s[1]]}),this.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(e,t){var n=[0,0];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}}]),i}(Sz))||Tz,Dz=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return Nz}}]),n}(wB);or({target:"Math",stat:!0},{sign:YL});var Fz,Bz=zz;function zz(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}function jz(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function Uz(e,t,n){return Math.min(n,Math.max(t,e))}function Vz(e,t,n){return e*(1-n)+t*n}function Hz(e,t,n,r){var i=new Bz(e,t,n,r);return function(e){return i.solve(e)}}zz.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},zz.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},zz.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},zz.prototype.solveCurveX=function(e,t){var n,r,i,o,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?n=i:r=i,i=.5*(r-n)+n}return i},zz.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var Gz=Hz(.25,.1,.25,1);function Wz(){return!(Yv||!Zv.matchMedia)&&(null==Fz&&(Fz=Zv.matchMedia("(prefers-reduced-motion: reduce)")),Fz.matches)}function Yz(e,t){var n,r={},i=j(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in e&&(r[o]=e[o])}}catch(e){i.e(e)}finally{i.f()}return r}var Xz=Yv?Date.now.bind(Date):Zv.performance&&Zv.performance.now?Zv.performance.now.bind(Zv.performance):Date.now.bind(Date),Zz=Zv.requestAnimationFrame||Zv.mozRequestAnimationFrame||Zv.webkitRequestAnimationFrame||Zv.msRequestAnimationFrame,qz=Zv.cancelAnimationFrame||Zv.mozCancelAnimationFrame||Zv.webkitCancelAnimationFrame||Zv.msCancelAnimationFrame;function Kz(e){var t=Zz(e);return{cancel:function(){return qz(t)}}}var Qz=function(){function e(t,n){if(b(this,e),E(this,"lng",void 0),E(this,"lat",void 0),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return S(e,[{key:"wrap",value:function(){return new e(jz(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"===m(t)&&null!==t){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),$z=function(){function e(t,n){b(this,e),E(this,"ne",void 0),E(this,"sw",void 0),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return S(e,[{key:"setNorthEast",value:function(e){return this.ne=e instanceof Qz?new Qz(e.lng,e.lat):Qz.convert(e),this}},{key:"setSouthWest",value:function(e){return this.sw=e instanceof Qz?new Qz(e.lng,e.lat):Qz.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this.sw,o=this.ne;if(t instanceof Qz)n=t,r=t;else{if(!(t instanceof e)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){var a=t;return this.extend(e.convert(a))}var s=t;return this.extend(Qz.convert(s))}return this}if(n=t.sw,r=t.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new Qz(n.lng,n.lat),this.ne=new Qz(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new Qz((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new Qz(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new Qz(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(e){var t=Qz.convert(e),n=t.lng,r=t.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),Jz=function(){function e(t,n){b(this,e),E(this,"x",void 0),E(this,"y",void 0),this.x=t,this.y=n}return S(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"add",value:function(e){return this.clone()._add(e)}},{key:"_sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"sub",value:function(e){return this.clone()._sub(e)}},{key:"_multByPoint",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multByPoint",value:function(e){return this.clone()._multByPoint(e)}},{key:"_divByPoint",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divByPoint",value:function(e){return this.clone()._divByPoint(e)}},{key:"_mult",value:function(e){return this.x*=e,this.y*=e,this}},{key:"mult",value:function(e){return this.clone()._mult(e)}},{key:"_div",value:function(e){return this.x/=e,this.y/=e,this}},{key:"div",value:function(e){return this.clone()._div(e)}},{key:"_rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(e){return this.clone()._rotate(e)}},{key:"_rotateAround",value:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(e,t){return this.clone()._rotateAround(e,t)}},{key:"_matMult",value:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this}},{key:"matMult",value:function(e){return this.clone()._matMult(e)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var e=this.y;return this.y=this.x,this.x=-e,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"dist",value:function(e){return Math.sqrt(this.distSqr(e))}},{key:"distSqr",value:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(e){return Math.atan2(this.y-e.y,this.x-e.x)}},{key:"angleWith",value:function(e){return this.angleWithSep(e.x,e.y)}},{key:"angleWithSep",value:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}();or({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return et(URL.prototype.toString,this)}}),hp("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),hp("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var ej=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(b(this,e),E(this,"top",void 0),E(this,"bottom",void 0),E(this,"left",void 0),E(this,"right",void 0),isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=i}return S(e,[{key:"interpolate",value:function(e,t,n){return null!=t.top&&null!=e.top&&(this.top=Vz(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=Vz(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=Vz(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=Vz(e.right,t.right,n)),this}},{key:"getCenter",value:function(e,t){var n=Uz((this.left+e-this.right)/2,0,e),r=Uz((this.top+t-this.bottom)/2,0,t);return new Jz(n,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),tj=2*Math.PI*6371008.8;function nj(e){return tj*Math.cos(e*Math.PI/180)}function rj(e){return(180+e)/360}function ij(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function oj(e,t){return e/nj(t)}function aj(e){var t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}var sj=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b(this,e),E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),this.x=+t,this.y=+n,this.z=+r}return S(e,[{key:"toLngLat",value:function(){return new Qz(360*this.x-180,aj(this.y))}},{key:"toAltitude",value:function(){return e=this.z,t=this.y,e*nj(aj(t));var e,t}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/tj*(e=aj(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Qz.convert(t);return new e(rj(r.lng),ij(r.lat),oj(n,r.lat))}}]),e}(),uj=function(){function e(t,n,r,i,o){b(this,e),E(this,"tileSize",void 0),E(this,"tileZoom",void 0),E(this,"lngRange",void 0),E(this,"latRange",void 0),E(this,"maxValidLatitude",void 0),E(this,"scale",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"angle",void 0),E(this,"rotationMatrix",void 0),E(this,"pixelsToGLUnits",void 0),E(this,"cameraToCenterDistance",void 0),E(this,"mercatorMatrix",void 0),E(this,"projMatrix",void 0),E(this,"invProjMatrix",void 0),E(this,"alignedProjMatrix",void 0),E(this,"pixelMatrix",void 0),E(this,"pixelMatrixInverse",void 0),E(this,"glCoordMatrix",void 0),E(this,"labelPlaneMatrix",void 0),E(this,"_fov",void 0),E(this,"_pitch",void 0),E(this,"_zoom",void 0),E(this,"_renderWorldCopies",void 0),E(this,"_minZoom",void 0),E(this,"_maxZoom",void 0),E(this,"_minPitch",void 0),E(this,"_maxPitch",void 0),E(this,"_center",void 0),E(this,"zoomFraction",void 0),E(this,"unmodified",void 0),E(this,"edgeInsets",void 0),E(this,"constraining",void 0),E(this,"posMatrixCache",void 0),E(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new Qz(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new ej,this.posMatrixCache={},this.alignedPosMatrixCache={}}return S(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this._pitch=Math.max(this._pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this._pitch=Math.min(this._pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new Jz(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){var t,n=-jz(e,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(t=new H_(4),H_!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t),function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=r*-s+o*u,e[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(e){var t=Uz(e,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==t&&(this.unmodified=!1,this._pitch=t,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this.unmodified=!1,this._fov=e/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this._minZoom),this._maxZoom);this._zoom!==t&&(this.unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this.unmodified=!1,this._center=e,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(e){this.edgeInsets.equals(e)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,e,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(e){return this.edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this.unmodified=!1,this.edgeInsets.interpolate(e,t,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(e){var t=Uz(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new Jz(rj(e.lng)*this.worldSize,ij(t)*this.worldSize)}},{key:"unproject",value:function(e){return new sj(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(e,t){var n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),o=new sj(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(e){var t=new Float64Array([e.x,e.y,0,1]),n=new Float64Array([e.x,e.y,1,1]);Hb(t,t,this.pixelMatrixInverse),Hb(n,n,this.pixelMatrixInverse);var r=t[3],i=n[3],o=t[0]/r,a=n[0]/i,s=t[1]/r,u=n[1]/i,l=t[2]/r,c=n[2]/i,h=l===c?0:(0-l)/(c-l);return new sj(Vz(o,a,h)/this.worldSize,Vz(s,u,h)/this.worldSize)}},{key:"getBounds",value:function(){return(new $z).extend(this.pointLocation(new Jz(0,0))).extend(this.pointLocation(new Jz(this.width,0))).extend(this.pointLocation(new Jz(this.width,this.height))).extend(this.pointLocation(new Jz(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new $z([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new Jz(0,0)),t=new Float32Array([e.x*this.worldSize,e.y*this.worldSize,0,1]);return Hb(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Jz(0,t))}},{key:"getCameraQueryGeometry",value:function(e){var t=this.getCameraPoint();if(1===e.length)return[e[0],t];var n,r=t.x,i=t.y,o=t.x,a=t.y,s=j(e);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(e){s.e(e)}finally{s.f()}return[new Jz(r,i),new Jz(o,i),new Jz(o,a),new Jz(r,a),new Jz(r,i)]}},{key:"coordinatePoint",value:function(e){var t=Vb(e.x*this.worldSize,e.y*this.worldSize,0,1);return Hb(t,t,this.pixelMatrix),new Jz(t[0]/t[3],t[1]/t[3])}},{key:"locationPoint",value:function(e){return this.coordinatePoint(this.locationCoordinate(e))}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"locationCoordinate",value:function(e){return sj.fromLngLat(e)}},{key:"coordinateLocation",value:function(e){return e.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var e,t,n,r,i=-90,o=90,a=-180,s=180,u=this.size,l=this.unmodified;if(this.latRange){var c=this.latRange;i=ij(c[1])*this.worldSize,e=(o=ij(c[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=rj(h[0])*this.worldSize,t=(s=rj(h[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var f=this.point,p=Math.max(t||0,e||0);if(p)return this.center=this.unproject(new Jz(t?(s+a)/2:f.x,e?(o+i)/2:f.y)),Yv?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(p),this.unmodified=l,void(this.constraining=!1);if(this.latRange){var d=f.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var g=f.x,m=u.x/2;g-m<a&&(n=a+m),g+m>s&&(n=s-m)}void 0===n&&void 0===r||(this.center=this.unproject(new Jz(void 0!==n?n:f.x,void 0!==r?r:f.y))),this.unmodified=l,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var e=this._fov/2,t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(e)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(Uz(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);ab(c,this._fov,this.width/this.height,l,u),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,$_(c,c,[1,-1,1]),Q_(c,c,[0,0,-this.cameraToCenterDistance]),J_(c,c,this._pitch),tb(c,c,this.angle),Q_(c,c,[-a,-s,0]),this.mercatorMatrix=$_([],c,[this.worldSize,this.worldSize,this.worldSize]),$_(c,c,[1,1,oj(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=q_([],this.projMatrix);var h=this.width%2/2,f=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+p*h+d*f,g=s-Math.round(s)+p*f+d*h,m=new Float64Array(c);if(Q_(m,m,[v>.5?v-1:v,g>.5?g-1:g,0]),this.alignedProjMatrix=m,$_(c=W_(),c,[this.width/2,-this.height/2,1]),Q_(c,c,[1,-1,0]),this.labelPlaneMatrix=c,$_(c=W_(),c,[1,-1,1]),Q_(c,c,[-1,-1,0]),$_(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=K_(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=q_(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),lj=S((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b(this,e),E(this,"type",void 0),UL(this,n),this.type=t})),cj=function(e){A(n,e);var t=I(n);function n(e){var r;b(this,n),E(P(r=t.call(this)),"transform",void 0),E(P(r),"options",void 0),E(P(r),"moving",void 0),E(P(r),"zooming",void 0),E(P(r),"rotating",void 0),E(P(r),"pitching",void 0),E(P(r),"padding",void 0),E(P(r),"bearingSnap",void 0),E(P(r),"easeEndTimeoutID",void 0),E(P(r),"easeStart",void 0),E(P(r),"easeOptions",void 0),E(P(r),"easeId",void 0),E(P(r),"onEaseFrame",void 0),E(P(r),"onEaseEnd",void 0),E(P(r),"easeFrameId",void 0),E(P(r),"pitchEnabled",void 0),E(P(r),"rotateEnabled",void 0),E(P(r),"renderFrameCallback",(function(){var e=Math.min((Xz()-r.easeStart)/r.easeOptions.duration,1);r.onEaseFrame(r.easeOptions.easing(e)),e<1?r.easeFrameId=r.requestRenderFrame(r.renderFrameCallback):r.stop()})),r.options=e;var i=e.minZoom,o=e.maxZoom,a=e.minPitch,s=e.maxPitch,u=e.renderWorldCopies;return r.moving=!1,r.zooming=!1,r.bearingSnap=e.bearingSnap,r.pitchEnabled=e.pitchEnabled,r.rotateEnabled=e.rotateEnabled,r.transform=new uj(i,o,a,s,u),r}return S(n,[{key:"requestRenderFrame",value:function(e){return 0}},{key:"cancelRenderFrame",value:function(e){}},{key:"getCenter",value:function(){var e=this.transform.center,t=e.lng,n=e.lat;return new Qz(t,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(e,t,n){return this.easeTo(UL({center:e},t),n)}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomTo",value:function(e,t,n){return this.easeTo(UL({zoom:e},t),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(e,t,n){return this.easeTo(UL({bearing:e},t),n)}},{key:"resetNorth",value:function(e,t){return this.rotateTo(0,UL({duration:1e3},e),t),this}},{key:"resetNorthPitch",value:function(e,t){return this.easeTo(UL({bearing:0,pitch:0,duration:1e3},e),t),this}},{key:"fitBounds",value:function(e,t,n){return this.fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"cameraForBounds",value:function(e,t){return e=$z.convert(e),this.cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,t)}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(e,t):this}},{key:"jumpTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return e.zoom&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=Qz.convert(e.center)),e.bearing&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),e.pitch&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.emit("movestart",new lj("movestart",t)),this.emit("move",new lj("move",t)),r&&(this.emit("zoomstart",new lj("zoomstart",t)),this.emit("zoom",new lj("zoom",t)),this.emit("zoomend",new lj("zoomend",t))),i&&(this.emit("rotatestart",new lj("rotatestart",t)),this.emit("rotate",new lj("rotate",t)),this.emit("rotateend",new lj("rotateend",t))),o&&(this.emit("pitchstart",new lj("pitchstart",t)),this.emit("pitch",new lj("pitch",t)),this.emit("pitchend",new lj("pitchend",t))),this.emit("moveend",new lj("moveend",t))}},{key:"easeTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(t=UL({offset:[0,0],duration:500,easing:Gz},t)).animate||!t.essential&&Wz())&&(t.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=t.zoom?+t.zoom:i,l=t.bearing?this.normalizeBearing(t.bearing,o):o,c=t.pitch?+t.pitch:a,h=t.padding?t.padding:r.padding,f=Jz.convert(t.offset),p=r.centerPoint.add(f),d=r.pointLocation(p),v=Qz.convert(t.center||d);this.normalizeCenter(v);var g,m,y=r.project(d),_=r.project(v).sub(y),b=r.zoomScale(u-i);t.around&&(g=Qz.convert(t.around),m=r.locationPoint(g));var x={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==l,this.pitching=this.pitching||c!==a,this.padding=!r.isPaddingEqual(h),this.easeId=t.easeId,this.prepareEase(n,t.noMoveStart,x),clearTimeout(this.easeEndTimeoutID),this.ease((function(t){if(e.zooming&&(r.zoom=Vz(i,u,t)),e.rotating&&e.rotateEnabled&&(r.bearing=Vz(o,l,t)),e.pitching&&e.pitchEnabled&&(r.pitch=Vz(a,c,t)),e.padding&&(r.interpolatePadding(s,h,t),p=r.centerPoint.add(f)),g)r.setLocationAtPoint(g,m);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,b):Math.max(.5,b),x=Math.pow(v,1-t),S=r.unproject(y.add(_.mult(t*x)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?S.wrap():S,p)}e.fireMoveEvents(n)}),(function(t){e.afterEase(n,t)}),t),this}},{key:"flyTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!t.essential&&Wz()){var r=Yz(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),t=UL({offset:[0,0],speed:1.2,curve:1.42,easing:Gz},t);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l=t.zoom?Uz(+t.zoom,i.minZoom,i.maxZoom):o,c=t.bearing?this.normalizeBearing(t.bearing,a):a,h=t.pitch?+t.pitch:s,f="padding"in t?t.padding:i.padding,p=i.zoomScale(l-o),d=Jz.convert(t.offset),v=i.centerPoint.add(d),g=i.pointLocation(v),m=Qz.convert(t.center||g);this.normalizeCenter(m);var y=i.project(g),_=i.project(m).sub(y),b=t.curve,x=Math.max(i.width,i.height),S=x/p,E=_.mag();if("minZoom"in t){var A=Uz(Math.min(t.minZoom,o,l),i.minZoom,i.maxZoom),C=x/i.zoomScale(A-o);b=Math.sqrt(C/E*2)}var T=b*b;function w(e){var t=(S*S-x*x+(e?-1:1)*T*T*E*E)/(2*(e?S:x)*T*E);return Math.log(Math.sqrt(t*t+1)-t)}function M(e){return(Math.exp(e)-Math.exp(-e))/2}function k(e){return(Math.exp(e)+Math.exp(-e))/2}function O(e){return M(e)/k(e)}var P=w(0),L=function(e){return k(P)/k(P+b*e)},I=function(e){return x*((k(P)*O(P+b*e)-M(P))/T)/E},R=(w(1)-P)/b;if(Math.abs(E)<1e-6||!isFinite(R)){if(Math.abs(x-S)<1e-6)return this.easeTo(t,n);var N=S<x?-1:1;R=Math.abs(Math.log(S/x))/b,I=function(){return 0},L=function(e){return Math.exp(N*b*e)}}if("duration"in t)t.duration=+t.duration;else{var D="screenSpeed"in t?+t.screenSpeed/b:+t.speed;t.duration=1e3*R/D}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=a!==c,this.pitching=h!==s,this.padding=!i.isPaddingEqual(f),this.prepareEase(n,!1),this.ease((function(t){var r=t*R,p=1/L(r);i.zoom=1===t?l:o+i.scaleZoom(p),e.rotating&&(i.bearing=Vz(a,c,t)),e.pitching&&(i.pitch=Vz(s,h,t)),e.padding&&(i.interpolatePadding(u,f,t),v=i.centerPoint.add(d));var g=1===t?m:i.unproject(y.add(_.mult(I(r))).mult(p));i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,v),e.fireMoveEvents(n)}),(function(){return e.afterEase(n)}),t),this}},{key:"fitScreenCoordinates",value:function(e,t,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(Jz.convert(e)),this.transform.pointLocation(Jz.convert(t)),n,r),r,i)}},{key:"stop",value:function(e,t){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,t)}return this}},{key:"normalizeBearing",value:function(e,t){e=jz(e,-180,180);var n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}},{key:"normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(e){this.emit("move",new lj("move",e)),this.zooming&&this.emit("zoom",new lj("zoom",e)),this.rotating&&this.emit("rotate",new lj("rotate",e)),this.pitching&&this.emit("rotate",new lj("pitch",e))}},{key:"prepareEase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,t||n.moving||this.emit("movestart",new lj("movestart",e)),this.zooming&&!n.zooming&&this.emit("zoomstart",new lj("zoomstart",e)),this.rotating&&!n.rotating&&this.emit("rotatestart",new lj("rotatestart",e)),this.pitching&&!n.pitching&&this.emit("pitchstart",new lj("pitchstart",e))}},{key:"afterEase",value:function(e,t){if(!this.easeId||!t||this.easeId!==t){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new lj("zoomend",e)),r&&this.emit("rotateend",new lj("rotateend",e)),i&&this.emit("pitchend",new lj("pitchend",e)),this.emit("moveend",new lj("moveend",e))}}},{key:"ease",value:function(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this.easeStart=Xz(),this.easeOptions=n,this.onEaseFrame=e,this.onEaseEnd=t,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(e,t,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=UL({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=UL(i,r.padding);var a=this.transform,s=a.padding,u=a.project(Qz.convert(e)),l=a.project(Qz.convert(t)),c=u.rotate(-n*Math.PI/180),h=l.rotate(-n*Math.PI/180),f=new Jz(Math.max(c.x,h.x),Math.max(c.y,h.y)),p=new Jz(Math.min(c.x,h.x),Math.min(c.y,h.y)),d=f.sub(p),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,g=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(g<0||v<0)){var m=Math.min(a.scaleZoom(a.scale*Math.min(v,g)),r.maxZoom),y=Jz.convert(r.offset),_=(r.padding.left-r.padding.right)/2,b=(r.padding.top-r.padding.bottom)/2,x=new Jz(y.x+_,y.y+b).mult(a.scale/a.zoomScale(m));return{center:a.unproject(u.add(l).div(2).sub(x)),zoom:m,bearing:n}}}},{key:"fitInternal",value:function(e,t,n){return e?(delete(t=UL(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}}]),n}(Kx);OF(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var hj={create:function(e,t,n){var r=Zv.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r},createNS:function(e,t){return Zv.document.createElementNS(e,t)}},fj=Zv.document&&Zv.document.documentElement.style;function pj(e){if(!fj)return e[0];var t,n=j(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r in fj)return r}}catch(e){n.e(e)}finally{n.f()}return e[0]}var dj,vj=pj(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);hj.disableDrag=function(){fj&&vj&&(dj=fj[vj],fj[vj]="none")},hj.enableDrag=function(){fj&&vj&&(fj[vj]=dj)};var gj=pj(["transform","WebkitTransform"]);hj.setTransform=function(e,t){e.style[gj]=t};var mj=!1;try{var yj=Object.defineProperty({},"passive",{get:function(){mj=!0}});Zv.addEventListener("test",yj,yj),Zv.removeEventListener("test",yj,yj)}catch(e){mj=!1}hj.addEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&mj?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)},hj.removeEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&mj?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)};var _j=function e(t){t.preventDefault(),t.stopPropagation(),Zv.removeEventListener("click",e,!0)};hj.suppressClick=function(){Yv||(Zv.addEventListener("click",_j,!0),setTimeout((function(){Zv.removeEventListener("click",_j,!0)}),0))},hj.mousePos=function(e,t){if(Yv)return new Jz(t.clientX-e.left-0,t.clientY-e.top-0);var n=e.getBoundingClientRect();return new Jz(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},hj.touchPos=function(e,t){if(Yv){var n,r=[],i=j(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.push(new Jz(o.clientX-e.left,o.clientY-e.top))}}catch(e){i.e(e)}finally{i.f()}return r}var a,s=e.getBoundingClientRect(),u=[],l=j(t);try{for(l.s();!(a=l.n()).done;){var c=a.value;u.push(new Jz(c.clientX-s.left-e.clientLeft,c.clientY-s.top-e.clientTop))}}catch(e){l.e(e)}finally{l.f()}return u},hj.mouseButton=function(e){return Yv&&void 0!==Zv.InstallTrigger&&2===e.button&&e.ctrlKey&&Zv.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},hj.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var bj=function(e){A(n,e);var t=I(n);function n(e,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};b(this,n);var s=hj.mousePos(r.getCanvasContainer(),i),u=r.unproject(s);return E(P(o=t.call(this,e,UL({point:s,lngLat:u,originalEvent:i},a))),"type",void 0),E(P(o),"target",void 0),E(P(o),"originalEvent",void 0),E(P(o),"point",void 0),E(P(o),"lngLat",void 0),E(P(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o.target=r,o}return S(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(lj),xj=function(e){A(n,e);var t=I(n);function n(e,r,i){var o;b(this,n);var a="touchend"===e?i.changedTouches:i.touches,s=hj.touchPos(r.getCanvasContainer(),a),u=s.map((function(e){return r.unproject(e)})),l=s.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new Jz(0,0)),c=r.unproject(l);return E(P(o=t.call(this,e,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:i})),"type",void 0),E(P(o),"target",void 0),E(P(o),"originalEvent",void 0),E(P(o),"lngLat",void 0),E(P(o),"point",void 0),E(P(o),"points",void 0),E(P(o),"lngLats",void 0),E(P(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o}return S(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(lj),Sj=function(e){A(n,e);var t=I(n);function n(e,r,i){var o;return b(this,n),E(P(o=t.call(this,e,{originalEvent:i})),"type",void 0),E(P(o),"originalEvent",void 0),E(P(o),"defaultPrevented",void 0),E(P(o),"target",void 0),o.defaultPrevented=!1,o}return S(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(lj),Ej=function(){function e(t){b(this,e),E(this,"map",void 0),E(this,"delayContextMenu",void 0),E(this,"contextMenuEvent",void 0),this.map=t}return S(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(e){this.map.emit(e.type,new bj(e.type,this.map,e))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new bj("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(e){this.delayContextMenu?this.contextMenuEvent=e:this.map.emit(e.type,new bj(e.type,this.map,e)),this.map.listeners("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),Aj=function(){function e(t,n){b(this,e),E(this,"map",void 0),E(this,"el",void 0),E(this,"container",void 0),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"startPos",void 0),E(this,"lastPos",void 0),E(this,"box",void 0),E(this,"clickTolerance",void 0),this.map=t,this.el=t.getCanvasContainer(),this.container=t.getContainer(),this.clickTolerance=n.clickTolerance||1}return S(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(hj.disableDrag(),this.startPos=this.lastPos=t,this.active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this.active){var n=t;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=hj.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);hj.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(e,t){var n=this;if(this.active&&0===e.button){var r=this.startPos,i=t;if(this.reset(),hj.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new lj("boxzoomend",{originalEvent:e})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",e)}}},{key:"keydown",value:function(e){this.active&&27===e.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(hj.remove(this.box),this.box=null),hj.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(e,t){return this.map.emit(e,new lj(e,{originalEvent:t}))}}]),e}(),Cj=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),Tj=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","renderFrame"),E(P(e),"timeStamp",void 0),e}return S(n)}(lj),wj={linearity:.3,easing:Hz(0,0,.3,1)},Mj=UL({deceleration:2500,maxSpeed:1400},wj),kj=UL({deceleration:20,maxSpeed:1400},wj),Oj=UL({deceleration:1e3,maxSpeed:360},wj),Pj=UL({deceleration:1e3,maxSpeed:90},wj),Lj=function(){function e(t){b(this,e),E(this,"map",void 0),E(this,"inertiaBuffer",void 0),this.map=t,this.clear()}return S(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(e){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:Xz(),settings:e})}},{key:"drainInertiaBuffer",value:function(){for(var e=this.inertiaBuffer,t=Xz();e.length>0&&t-e[0].time>160;)e.shift()}},{key:"onMoveEnd",value:function(e){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var t,n={zoom:0,bearing:0,pitch:0,pan:new Jz(0,0),pinchAround:void 0,around:void 0},r=j(this.inertiaBuffer);try{for(r.s();!(t=r.n()).done;){var i=t.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(e){r.e(e)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=Rj(n.pan.mag(),o,UL({},Mj,e||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,Ij(a,s)}if(n.zoom){var u=Rj(n.zoom,o,kj);a.zoom=this.map.transform.zoom+u.amount,Ij(a,u)}if(n.bearing){var l=Rj(n.bearing,o,Oj);a.bearing=this.map.transform.bearing+Uz(l.amount,-179,179),Ij(a,l)}if(n.pitch){var c=Rj(n.pitch,o,Pj);a.pitch=this.map.transform.pitch+c.amount,Ij(a,c)}if(a.zoom||a.bearing){var h=void 0===n.pinchAround?n.around:n.pinchAround;a.around=h?this.map.unproject(h):this.map.getCenter()}return this.clear(),UL(a,{noMoveStart:!0})}}}]),e}();function Ij(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Rj(e,t,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=Uz(e*i/(t/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var Nj={panStep:100,bearingStep:15,pitchStep:10},Dj=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"panStep",void 0),E(this,"bearingStep",void 0),E(this,"pitchStep",void 0);var t=Nj;this.panStep=t.panStep,this.bearingStep=t.bearingStep,this.pitchStep=t.pitchStep}return S(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Fj,zoom:n?Math.round(u)+n*(e.shiftKey?2:1):u,bearing:s.getBearing()+r*t.bearingStep,pitch:s.getPitch()+i*t.pitchStep,offset:[-o*t.panStep,-a*t.panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function Fj(e){return e*(2-e)}var Bj,zj=function(){function e(t,n){b(this,e),E(this,"mousedownPos",void 0),E(this,"clickTolerance",void 0),E(this,"map",void 0),this.map=t,this.clickTolerance=n.clickTolerance}return S(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(e){return this.firePreventable(new Sj(e.type,this.map,e))}},{key:"mousedown",value:function(e,t){return this.mousedownPos=t,this.firePreventable(new bj(e.type,this.map,e))}},{key:"mouseup",value:function(e){this.map.emit(e.type,new bj(e.type,this.map,e))}},{key:"click",value:function(e,t){this.mousedownPos&&this.mousedownPos.dist(t)>=this.clickTolerance||this.map.emit(e.type,new bj(e.type,this.map,e))}},{key:"dblclick",value:function(e){return this.firePreventable(new bj(e.type,this.map,e))}},{key:"mouseover",value:function(e){this.map.emit(e.type,new bj(e.type,this.map,e))}},{key:"mouseout",value:function(e){this.map.emit(e.type,new bj(e.type,this.map,e))}},{key:"touchstart",value:function(e){return this.firePreventable(new xj(e.type,this.map,e))}},{key:"touchmove",value:function(e){this.map.emit(e.type,new xj(e.type,this.map,e))}},{key:"touchend",value:function(e){this.map.emit(e.type,new xj(e.type,this.map,e))}},{key:"touchcancel",value:function(e){this.map.emit(e.type,new xj(e.type,this.map,e))}},{key:"firePreventable",value:function(e){if(this.map.emit(e.type,e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),jj=(E(Bj={},0,1),E(Bj,2,2),Bj);var Uj=function(){function e(t){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"lastPoint",void 0),E(this,"eventButton",void 0),E(this,"moved",void 0),E(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=t.clickTolerance||1}return S(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(e,t){if(!this.lastPoint){var n=hj.mouseButton(e);this.correctButton(e,n)&&(this.lastPoint=t,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this.lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=jj[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this.eventButton))this.reset();else if(this.moved||!(t.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=t,this.move(n,t)}},{key:"mouseupWindow",value:function(e){this.lastPoint&&(hj.mouseButton(e)===this.eventButton&&(this.moved&&hj.suppressClick(),this.reset()))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(e,t){return!1}},{key:"move",value:function(e,t){}}]),e}(),Vj=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"mousedown",value:function(e,t){N(C(n.prototype),"mousedown",this).call(this,e,t),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}},{key:"correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}}]),n}(Uj),Hj=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(Uj),Gj=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"contextmenu",value:function(e){e.preventDefault()}},{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this.active=!0,{bearingDelta:n}}}]),n}(Uj),Wj=function(){function e(t,n){var r=this;b(this,e),E(this,"map",void 0),E(this,"el",void 0),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"zooming",void 0),E(this,"aroundCenter",void 0),E(this,"around",void 0),E(this,"aroundPoint",void 0),E(this,"type",void 0),E(this,"lastValue",void 0),E(this,"timeout",void 0),E(this,"finishTimeout",void 0),E(this,"lastWheelEvent",void 0),E(this,"lastWheelEventTime",void 0),E(this,"startZoom",void 0),E(this,"targetZoom",void 0),E(this,"delta",void 0),E(this,"easing",void 0),E(this,"prevEase",void 0),E(this,"frameId",void 0),E(this,"handler",void 0),E(this,"defaultZoomRate",void 0),E(this,"wheelZoomRate",void 0),E(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var e=r.map.transform;if(0!==r.delta){var t="wheel"===r.type&&Math.abs(r.delta)>4.000244140625?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*t)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?e.zoomScale(r.targetZoom):e.scale;r.targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=e.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:e.zoom,s=r.startZoom,u=r.easing,l=!1;if("wheel"===r.type&&s&&u){var c=Math.min((Xz()-r.lastWheelEventTime)/200,1);o=Vz(s,a,u(c)),c<1?r.frameId||(r.frameId=!0):l=!0}else o=a,l=!0;return r.active=!0,l&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:o-e.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=t,this.el=t.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=1/450}return S(e,[{key:"setZoomRate",value:function(e){this.defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this.wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(e){this.isEnabled()||(this.enabled=!0,this.aroundCenter=e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(e){if(this.isEnabled()){var t=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=Xz(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==t&&t%4.000244140625==0?this.type="wheel":0!==t&&Math.abs(t)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=t,this.timeout=setTimeout(this.onTimeout,40,e)):this.type||(this.type=Math.abs(r*t)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,t+=this.lastValue)),e.shiftKey&&t&&(t/=4),this.type&&(this.lastWheelEvent=e,this.delta-=t,this.active||this.start(e)),e.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(e){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(e)}},{key:"start",value:function(e){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var t=hj.mousePos(this.el,e);this.around=Qz.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(t)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(e){var t=Gz;if(this.prevEase){var n=this.prevEase,r=(Xz()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;t=Hz(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:Xz(),duration:e,easing:t},t}}]),e}(),Yj=function(){function e(t,n){b(this,e),E(this,"clickZoom",void 0),E(this,"tapZoom",void 0),this.clickZoom=t,this.tapZoom=n}return S(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),Xj=function(){function e(t,n,r){b(this,e),E(this,"inertiaOptions",void 0),E(this,"el",void 0),E(this,"mousePan",void 0),E(this,"touchPan",void 0),this.el=t,this.mousePan=n,this.touchPan=r}return S(e,[{key:"enable",value:function(e){this.inertiaOptions=e||{},this.mousePan.enable(),this.touchPan.enable(),Yv||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),Yv||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),Zj=function(){function e(t,n,r){b(this,e),E(this,"mouseRotate",void 0),E(this,"mousePitch",void 0),E(this,"pitchWithRotate",void 0),this.pitchWithRotate=t.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return S(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),qj=function(){function e(t,n,r,i){b(this,e),E(this,"el",void 0),E(this,"touchZoom",void 0),E(this,"touchRotate",void 0),E(this,"tapDragZoom",void 0),E(this,"rotationDisabled",void 0),E(this,"enabled",void 0),this.el=t,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return S(e,[{key:"enable",value:function(e){this.touchZoom.enable(e),this.rotationDisabled||this.touchRotate.enable(e),this.tapDragZoom.enable(),Yv||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),Yv||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function Kj(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var Qj=function(){function e(t){b(this,e),E(this,"numTouches",void 0),E(this,"centroid",void 0),E(this,"startTime",void 0),E(this,"aborted",void 0),E(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}return S(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){var t,n=new Jz(0,0),r=j(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n._add(i)}}catch(e){r.e(e)}finally{r.f()}return n.div(e.length)}(t),this.touches=Kj(n,t)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=Kj(n,t);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),e}(),$j=function(){function e(t){b(this,e),E(this,"singleTap",void 0),E(this,"numTaps",void 0),E(this,"lastTime",void 0),E(this,"lastTap",void 0),E(this,"count",void 0),this.singleTap=new Qj(t),this.numTaps=t.numTaps,this.reset()}return S(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),e}(),Jj=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"swipePoint",void 0),E(this,"swipeTouch",void 0),E(this,"tapTime",void 0),E(this,"tap",void 0),this.tap=new $j({numTouches:1,numTaps:1}),this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(e,t,n){this.swipePoint||(this.tapTime&&e.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=t[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=t[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,e.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(e,t,n)&&(this.tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),eU=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"zoomIn",void 0),E(this,"zoomOut",void 0),this.zoomIn=new $j({numTouches:1,numTaps:2}),this.zoomOut=new $j({numTouches:2,numTaps:1}),this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this.zoomIn.touchstart(e,t,n),this.zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.zoomIn.touchmove(e,t,n),this.zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this.zoomIn.touchend(e,t,n),o=this.zoomOut.touchend(e,t,n);return i?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):o?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(o)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),tU=function(){function e(t){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"touches",void 0),E(this,"minTouches",void 0),E(this,"clickTolerance",void 0),E(this,"sum",void 0),this.minTouches=1,this.clickTolerance=t.clickTolerance||1,this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new Jz(0,0)}},{key:"touchstart",value:function(e,t,n){return this.calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this.active)return e.preventDefault(),this.calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this.calculateTransform(e,t,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(e,t,n){n.length>0&&(this.active=!0);var r=Kj(n,t),i=new Jz(0,0),o=new Jz(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],l=this.touches[s];l&&(i._add(u),o._add(u.sub(l)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var c=o.div(a);if(this.sum._add(c),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:c}}}}]),e}(),nU=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"firstTwoTouches",void 0),E(this,"vector",void 0),E(this,"startVector",void 0),E(this,"aroundCenter",void 0),this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(e){}},{key:"move",value:function(e,t,n){}},{key:"touchstart",value:function(e,t,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this.firstTwoTouches){e.preventDefault();var r=D(this.firstTwoTouches,2),i=r[0],o=r[1],a=rU(n,t,i),s=rU(n,t,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this.firstTwoTouches){var r=D(this.firstTwoTouches,2),i=r[0],o=r[1],a=rU(n,t,i),s=rU(n,t,o);a&&s||(this.active&&hj.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this.enabled=!0,this.aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function rU(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function iU(e){return Math.abs(e.y)>Math.abs(e.x)}var oU=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"valid",void 0),E(P(e),"firstMove",void 0),E(P(e),"lastPoints",void 0),e}return S(n,[{key:"reset",value:function(){N(C(n.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(e){this.lastPoints=e,iU(e[0].sub(e[1]))&&(this.valid=!1)}},{key:"move",value:function(e,t,n){var r=e[0].sub(this.lastPoints[0]),i=e[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=e,this.active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this.valid)return this.valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=e.y>0==t.y>0;return iU(e)&&iU(t)&&o}}}]),n}(nU);function aU(e,t){return 180*e.angleWith(t)/Math.PI}var sU=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"minDiameter",void 0),e}return S(n,[{key:"reset",value:function(){N(C(n.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(e){this.startVector=this.vector=e[0].sub(e[1]),this.minDiameter=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.vector;if(this.vector=e[0].sub(e[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:aU(this.vector,n),pinchAround:t}}},{key:"isBelowThreshold",value:function(e){this.minDiameter=Math.min(this.minDiameter,e.mag());var t=25/(Math.PI*this.minDiameter)*360,n=aU(e,this.startVector);return Math.abs(n)<t}}]),n}(nU);function uU(e,t){return Math.log(e/t)/Math.LN2}var lU=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"distance",void 0),E(P(e),"startDistance",void 0),e}return S(n,[{key:"reset",value:function(){N(C(n.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(e){this.startDistance=this.distance=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.distance;if(this.distance=e[0].dist(e[1]),this.active||!(Math.abs(uU(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:uU(this.distance,n),pinchAround:t}}}]),n}(nU),cU=function(e){return e.zoom||e.drag||e.pitch||e.rotate};function hU(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var fU,pU,dU,vU,gU,mU,yU,_U,bU,xU,SU,EU,AU,CU=function(){function e(t,n){var r=this;b(this,e),E(this,"map",void 0),E(this,"el",void 0),E(this,"handlers",void 0),E(this,"eventsInProgress",void 0),E(this,"frameId",void 0),E(this,"inertia",void 0),E(this,"bearingSnap",void 0),E(this,"handlersById",void 0),E(this,"updatingCamera",void 0),E(this,"changes",void 0),E(this,"previousActiveHandlers",void 0),E(this,"bearingChanged",void 0),E(this,"rotateEnabled",void 0),E(this,"pitchEnabled",void 0),E(this,"listeners",void 0),E(this,"handleWindowEvent",(function(e){r.handleEvent(e,"".concat(e.type,"Window"))})),E(this,"handleEvent",(function(e,t){if("blur"!==e.type){r.updatingCamera=!0;var n,i="renderFrame"===e.type?void 0:e,o={needsRenderFrame:!1},a={},s={},u=e.touches?r.getMapTouches(e.touches):void 0,l=u?hj.touchPos(r.el,u):hj.mousePos(r.el,e),c=j(r.handlers);try{for(c.s();!(n=c.n()).done;){var h=n.value,f=h.handlerName,p=h.handler,d=h.allowed;if(p.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,f))p.reset();else{var g=t||e.type;p&&p[g]&&(v=p[g](e,l,u),r.mergeIHandlerResult(o,a,v,f,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||p.isActive())&&(s[f]=p)}}}catch(e){c.e(e)}finally{c.f()}var m={};for(var y in r.previousActiveHandlers)s[y]||(m[y]=i);r.previousActiveHandlers=s,(Object.keys(m).length||hU(o))&&(r.changes.push([o,a,m]),r.triggerRenderFrame()),(Object.keys(s).length||hU(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=t,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new Lj(t),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;if(this.listeners=[],Yv)Zv.document.addEventListener("touchstart",(function(e){r.handleEvent(e)}),{}),Zv.document.addEventListener("touchmove",(function(e){r.handleEvent(e)}),{}),Zv.document.addEventListener("touchend",(function(e){r.handleEvent(e)}),{}),Zv.document.addEventListener("touchcancel",(function(e){r.handleEvent(e)}),{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=j(this.listeners);try{for(a.s();!(o=a.n()).done;){var s=D(o.value,3),u=s[0],l=s[1],c=s[2];hj.addEventListener(u,l,u===window.document?this.handleWindowEvent:this.handleEvent,c)}}catch(e){a.e(e)}finally{a.f()}}}return S(e,[{key:"destroy",value:function(){var e,t=j(this.listeners);try{for(t.s();!(e=t.n()).done;){var n=D(e.value,3),r=n[0],i=n[1],o=n[2];hj.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(e){t.e(e)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var e,t=j(this.handlers);try{for(t.s();!(e=t.n()).done;){e.value.handler.reset()}}catch(e){t.e(e)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var e,t=j(this.handlers);try{for(t.s();!(e=t.n()).done;){if(e.value.handler.isActive())return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(cU(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(e,t,n,r,i){if(n){UL(e,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var e=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(t){delete e.frameId,e.handleEvent(new Tj("renderFrame",{timeStamp:t})),e.applyChanges()})))}},{key:"addDefaultHandlers",value:function(e){var t=this.map,n=t.getCanvasContainer();this.add("mapEvent",new zj(t,e));var r=t.boxZoom=new Aj(t,e);this.add("boxZoom",r);var i=new eU,o=new Cj;t.doubleClickZoom=new Yj(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new Jj;this.add("tapDragZoom",a);var s=t.touchPitch=new oU;this.add("touchPitch",s);var u=new Hj(e),l=new Gj(e);t.dragRotate=new Zj(e,u,l),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",l,["mouseRotate"]);var c=new Vj(e),h=new tU(e);t.dragPan=new Xj(n,c,h),this.add("mousePan",c),this.add("touchPan",h,["touchZoom","touchRotate"]);var f=new sU,p=new lU;t.touchZoomRotate=new qj(n,p,f,a),this.add("touchRotate",f,["touchPan","touchZoom"]),this.add("touchZoom",p,["touchPan","touchRotate"]);var d=t.scrollZoom=new Wj(t,this);this.add("scrollZoom",d,["mousePan"]);var v=t.keyboard=new Dj;this.add("keyboard",v),this.add("blockableMapEvent",new Ej(t));for(var g=0,m=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<m.length;g++){var y=m[g];e.interactive&&e[y]&&t[y].enable(e[y])}}},{key:"add",value:function(e,t,n){this.handlers.push({handlerName:e,handler:t,allowed:n}),this.handlersById[e]=t}},{key:"blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(e){var t,n=[],r=j(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=i.target;(Yv||this.el.contains(o))&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var e,t={},n={},r={},i=j(this.changes);try{for(i.s();!(e=i.n()).done;){var o=D(e.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(t.panDelta=(t.panDelta||new Jz(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),UL(n,s),UL(r,u)}}catch(e){i.e(e)}finally{i.f()}this.updateMapTransform(t,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(e,t,n){var r=this.map,i=r.transform;if(!hU(e))return this.fireEvents(t,n);var o=e.panDelta,a=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,l=e.pinchAround,c=e.around;void 0!==l&&(c=l),r.stop(!0),c=c||r.transform.centerPoint;var h=i.pointLocation(o?c.sub(o):c);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,c),this.map.update(),e.noInertia||this.inertia.record(e),this.fireEvents(t,n)}},{key:"fireEvents",value:function(e,t){var n=this,r=cU(this.eventsInProgress),i=cU(e),o={};for(var a in e)if(e[a]){var s=e[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=e[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var l in e.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),e)if(e[l]){var c=e[l].originalEvent;this.fireEvent(l,c)}var h,f={};for(var p in this.eventsInProgress)if(this.eventsInProgress[p]){var d=this.eventsInProgress[p],v=d.handlerName,g=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[p],h=t[v]||g,f["".concat(p,"end")]=h)}for(var m in f)f[m]&&this.fireEvent(m,f[m]);var y=cU(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),b=function(e){return 0!==e&&-n.bearingSnap<e&&e<n.bearingSnap};_?(b(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new lj("moveend",{originalEvent:h})),b(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(e,t){this.map.emit(e,new lj(e,t?{originalEvent:t}:{}))}}]),e}(),TU=function(){function e(t){var n=this;b(this,e),E(this,"map",void 0),E(this,"updateHash",void 0),E(this,"hashName",void 0),E(this,"onHashChange",(function(){var e=n.getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(+e)}))){var t=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(e[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1})),E(this,"getCurrentHash",(function(){var e,t=window.location.hash.replace("#","");return n.hashName?(t.split("&").map((function(e){return e.split("=")})).forEach((function(t){t[0]===n.hashName&&(e=t)})),(e&&e[1]||"").split("/")):t.split("/")})),E(this,"updateHashUnthrottled",(function(){var e=n.getHashString();try{window.history.replaceState(window.history.state,"",e)}catch(e){}})),this.hashName=t&&encodeURIComponent(t),this.updateHash=pS(this.updateHashUnthrottled,300)}return S(e,[{key:"addTo",value:function(e){return this.map=e,Zv.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return Zv.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(e){var t=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(t.lng*i)/i,a=Math.round(t.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),l="";if(l+=e?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(l+="/".concat(Math.round(10*s)/10)),u&&(l+="/".concat(Math.round(u))),this.hashName){var c=this.hashName,h=!1,f=window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===c?(h=!0,"".concat(t,"=").concat(l)):e})).filter((function(e){return e}));return h||f.push("".concat(c,"=").concat(l)),"#".concat(f.join("&"))}return"#".concat(l)}}]),e}(),wU=null,MU=[],kU=(Zv.performance,function(e){var t=e;if(null!=wU){var n=t-wU;MU.push(n)}wU=t}),OU=function(){function e(){b(this,e),E(this,"queue",void 0),E(this,"id",void 0),E(this,"cleared",void 0),E(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return S(e,[{key:"add",value:function(e){var t=++this.id;return this.queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this.currentlyRunning,r=j(n?this.queue.concat(n):this.queue);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.id===e)return void(i.cancelled=!0)}}catch(e){r.e(e)}finally{r.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.currentlyRunning=this.queue;this.queue=[];var n,r=j(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this.cleared))break}}catch(e){r.e(e)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),PU={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},LU=function(e){A(n,e);var t=I(n);function n(e){var r;if(b(this,n),E(P(r=t.call(this,UL({},PU,e))),"doubleClickZoom",void 0),E(P(r),"dragRotate",void 0),E(P(r),"dragPan",void 0),E(P(r),"touchZoomRotate",void 0),E(P(r),"scrollZoom",void 0),E(P(r),"keyboard",void 0),E(P(r),"touchPitch",void 0),E(P(r),"boxZoom",void 0),E(P(r),"handlers",void 0),E(P(r),"container",void 0),E(P(r),"canvas",void 0),E(P(r),"canvasContainer",void 0),E(P(r),"renderTaskQueue",new OU),E(P(r),"frame",void 0),E(P(r),"trackResize",!0),E(P(r),"hash",void 0),E(P(r),"onWindowOnline",(function(){r.update()})),E(P(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),Yv?r.initMiniContainer():r.initContainer(),r.resize(),r.handlers=new CU(P(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),!Yv){var i="string"==typeof e.hash&&e.hash||void 0;e.hash&&(r.hash=new TU(i).addTo(P(r)))}return r.hash&&r.hash.onHashChange()||(r.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(r.resize(),r.fitBounds(e.bounds,UL({},e.fitBoundsOptions,{duration:0})))),r}return S(n,[{key:"resize",value:function(e){var t=D(this.containerDimensions(),2),n=t[0],r=t[1];if(this.transform.resize(n,r),Yv)return this;var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Zv.Event("movestart",e)),this.emit("move",new Zv.Event("move",e))),this.emit("resize",new Zv.Event("resize",e)),i&&this.emit("moveend",new Zv.Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(Qz.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(Jz.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds($z.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=Kz((function(t){kU(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=Kz((function(n){kU(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=eg("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(Yv?(e=this.container.width/Zv.devicePixelRatio,t=this.container.height/Zv.devicePixelRatio):(e=0===(e=this.container.clientWidth)?400:e,t=0===(t=this.container.clientHeight)?300:t)),[e,t]}}]),n}(cj),IU={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},RU=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,UL({},IU,e))),"doubleClickZoom",void 0),E(P(r),"dragRotate",void 0),E(P(r),"dragPan",void 0),E(P(r),"touchZoomRotate",void 0),E(P(r),"scrollZoom",void 0),E(P(r),"keyboard",void 0),E(P(r),"touchPitch",void 0),E(P(r),"boxZoom",void 0),E(P(r),"handlers",void 0),E(P(r),"container",void 0),E(P(r),"canvas",void 0),E(P(r),"canvasContainer",void 0),E(P(r),"renderTaskQueue",new OU),E(P(r),"frame",void 0),E(P(r),"trackResize",!0),E(P(r),"onWindowOnline",(function(){r.update()})),E(P(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),r.initContainer(),r.resize(),r.handlers=new CU(P(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),r}return S(n,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=t[0],r=t[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",e)),this.emit("move",new Event("move",e))),this.emit("resize",new Event("resize",e)),i&&this.emit("moveend",new Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(Qz.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(Jz.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds($z.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=Kz((function(t){kU(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=Kz((function(n){kU(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=eg("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=this.container.clientWidth||400,t=this.container.clientHeight||300),[e,t]}},{key:"resizeCanvas",value:function(e,t){var n=hg||1;this.canvas.width=n*e,this.canvas.height=n*t,this.canvas.style.width="".concat(e,"px"),this.canvas.style.height="".concat(t,"px")}}]),n}(cj),NU=function(){function e(){b(this,e),E(this,"xzReg",.6*-Math.PI),E(this,"yReg",.2*Math.PI),E(this,"earthCameraRadius",200),E(this,"earthCameraZoom",1),E(this,"cameraPosition",vb()),E(this,"viewport",void 0),E(this,"projectionMatrix",W_()),E(this,"modelMatrix",W_()),E(this,"viewMatrix",W_()),E(this,"viewProjectionMatrix",W_()),E(this,"ViewProjectionMatrixUncentered",W_()),E(this,"viewUncenteredMatrix",W_())}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.viewportHeight,n=void 0===t?1:t,r=e.viewportWidth,i=(void 0===r?1:r)/n;ab(this.projectionMatrix,20,i,.1,1e4);var o=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=mb(o,s,a),Tb(this.cameraPosition,this.cameraPosition),_b(this.cameraPosition,this.cameraPosition,mb(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),xb(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=vb();Mb(u,this.cameraPosition,mb(0,1,0));var l=mb(0,1,0);Mb(l,u,this.cameraPosition);var c=mb(0,0,0);lb(this.viewMatrix,this.cameraPosition,c,l),this.viewUncenteredMatrix=Y_(this.viewMatrix),K_(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),K_(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(e){this.xzReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(e){this.yReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(e){this.earthCameraZoom+=e,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),DU={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},FU={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},BU=(fU=NM(),pU=RM(Hk.MapConfig),dU=RM(Hk.IGlobalConfigService),vU=RM(Hk.ICoordinateSystemService),gU=RM(Hk.IEventEmitter),fU((_U=V((yU=function(){function t(){var n=this;b(this,t),E(this,"version",e.Version.L7MAP),E(this,"map",void 0),E(this,"simpleMapCoord",new kB),E(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),E(this,"viewport",void 0),U(this,"config",_U,this),U(this,"configService",bU,this),U(this,"coordinateSystemService",xU,this),U(this,"eventEmitter",SU,this),E(this,"markerContainer",void 0),E(this,"cameraChangedCallback",void 0),E(this,"$mapContainer",void 0),E(this,"handleCameraChanged",(function(e){var t=n.map.getCenter(),r=t.lat,i=t.lng;n.emit("mapchange"),n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[i,r],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0}),n.updateCoordinateSystemService(),n.cameraChangedCallback(n.viewport)}))}return S(t,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=eg("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(e,t){-1!==CF.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(FU[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(FU[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===e.Version.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.panTo([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyleValue(e))}},{key:"meterToCoord",value:function(e,t){return 1}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"getMapStyle",value:function(){try{var e,t=null!==(e=this.map.getStyle().sprite)&&void 0!==e?e:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(t)?null==t?void 0:t.replace(/\/\w+$/,"").replace(/sprites/,"styles"):t}catch(e){return""}}},{key:"getMapStyleConfig",value:function(){return DU}},{key:"getMapStyleValue",value:function(e){var t;return null!==(t=this.getMapStyleConfig()[e])&&void 0!==t?t:e}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatMapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"updateView",value:function(e){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,n=void 0===t||t;this.viewport.getZoom()>12&&n?this.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT)}}]),t}()).prototype,"config",[pU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bU=V(yU.prototype,"configService",[dU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xU=V(yU.prototype,"coordinateSystemService",[vU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SU=V(yU.prototype,"eventEmitter",[gU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mU=yU))||mU),zU=["id","style","rotation"],jU={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},UU=NM()(EU=function(t){A(i,t);var n,r=I(i);function i(){var t;b(this,i);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return E(P(t=r.call.apply(r,[this].concat(o))),"version",e.Version.GLOBEL),E(P(t),"dragging",!1),E(P(t),"viewport",void 0),E(P(t),"cameraChangedCallback",void 0),E(P(t),"handleCameraChanging",void 0),E(P(t),"handleCameraTimer",void 0),E(P(t),"handleCameraChanged",(function(n){t.emit("mapchange");t.handleCameraChanging=!0,t.handleCameraTimer&&clearTimeout(t.handleCameraTimer),t.handleCameraTimer=setTimeout((function(){t.handleCameraChanging=!1}),2e3);n.type&&n.originalEvent&&("wheel"===n.originalEvent.type&&t.viewport.scaleZoom(.01*Math.sign(n.originalEvent.wheelDelta)*-1),Math.abs(n.originalEvent.movementX)>Math.abs(n.originalEvent.movementY)?n.originalEvent.movementX>0?t.viewport.rotateY(.02):n.originalEvent.movementX<0&&t.viewport.rotateY(-.02):n.originalEvent.movementY>0?t.viewport.rotateX(.02):n.originalEvent.movementY<0&&t.viewport.rotateX(-.02));var r=t.config.offsetCoordinate,i=void 0===r||r;t.viewport.syncWithMapCamera({viewportHeight:t.map.transform.height,viewportWidth:t.map.transform.width}),t.viewport.getZoom()>12&&i?t.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):t.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT),t.cameraChangedCallback(t.viewport)})),t}return S(i,[{key:"lngLatToMercator",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(e,t,n,r,i){throw new Error("Method not implemented.")}},{key:"on",value:function(e,t){-1!==CF.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(jU[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(jU[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=O(t,zU),this.viewport=new NU,this.$mapContainer=this.creatMapContainer(r),this.map=new RU(v({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"rotateY",value:function(e){var t=e||{},n=t.force,r=void 0!==n&&n,i=t.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]),i}(BU))||EU,VU=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return UU}}]),n}(wB),HU=["id","style","rotation","mapInstance","version","mapSize","interactive"],GU=["id","style","rotation","mapInstance","canvas","hasBaseMap"],WU=NM()(AU=function(t){A(o,t);var n,r,i=I(o);function o(){var t;b(this,o);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return E(P(t=i.call.apply(i,[this].concat(r))),"version",e.Version.L7MAP),E(P(t),"viewport",void 0),E(P(t),"handleMiniCameraChanged",(function(n,r,i,o,a){var s=t.config.offsetCoordinate,u=void 0===s||s;t.viewport.syncWithMapCamera({bearing:o,center:[n,r],viewportHeight:t.map.transform.height,pitch:a,viewportWidth:t.map.transform.width,zoom:i,cameraHeight:0}),t.viewport.getZoom()>12&&u?t.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):t.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT),t.cameraChangedCallback(t.viewport)})),t}return S(o,[{key:"lngLatToMercator",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(){throw new Error("Method not implemented.")}},{key:"init",value:(r=_(g().mark((function t(){var n,r,i,o,a,s,u,l,c,h,f,p,d,m,y;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.config,r=n.id,i=void 0===r?"map":r,o=n.style,a=void 0===o?"light":o,s=n.rotation,u=void 0===s?0:s,l=n.mapInstance,c=n.version,h=void 0===c?"L7MAP":c,f=n.mapSize,p=void 0===f?1e4:f,d=n.interactive,m=void 0===d||d,y=O(n,HU),this.viewport=new vz,this.version=h,this.simpleMapCoord.setSize(p),h===e.Version.SIMPLE&&y.center&&(y.center=this.simpleMapCoord.unproject(y.center)),l?(this.map=l,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(i),this.map=new LU(v({container:this.$mapContainer,style:this.getMapStyleValue(a),bearing:u},y))),this.map.on("load",this.handleCameraChanged),m&&this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"initMiniMap",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,f=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=this.config).id,n=t.style,r=void 0===n?"light":n,i=t.rotation,o=void 0===i?0:i,t.mapInstance,a=t.canvas,s=void 0===a?null:a,u=t.hasBaseMap,l=void 0!==u&&u,c=O(t,GU),this.viewport=new vz,this.$mapContainer=s,this.map=new LU(v({container:this.$mapContainer,style:this.getMapStyleValue(r),bearing:o,canvas:s},c)),l?(h=this.map.getCenter(),this.handleMiniCameraChanged(h.lng,h.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),Zv.document.addEventListener("mapCameaParams",(function(e){var t=e.e,n=t.longitude,r=t.latitude,i=t.scale,o=t.bearing,a=t.pitch;f.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}}]),o}(BU))||AU,YU=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return WU}}]),n}(wB);OF(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-moz-box-shadow:0 0 2px rgba(0,0,0,.1);-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;-moz-animation:mapboxgl-spin 2s infinite linear;-o-animation:mapboxgl-spin 2s infinite linear;-ms-animation:mapboxgl-spin 2s infinite linear;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@-moz-keyframes mapboxgl-spin{0%{-moz-transform:rotate(0deg)}to{-moz-transform:rotate(1turn)}}@-o-keyframes mapboxgl-spin{0%{-o-transform:rotate(0deg)}to{-o-transform:rotate(1turn)}}@-ms-keyframes mapboxgl-spin{0%{-ms-transform:rotate(0deg)}to{-ms-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;-moz-animation:mapboxgl-user-location-dot-pulse 2s infinite;-ms-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@-ms-keyframes mapboxgl-user-location-dot-pulse{0%{-ms-transform:scale(1);opacity:1}70%{-ms-transform:scale(3);opacity:0}to{-ms-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{transform:scale(1);opacity:1}70%{transform:scale(3);opacity:0}to{transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}");var XU,ZU=function(){function e(){b(this,e),E(this,"viewport",void 0)}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth;this.viewport=new dz({width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),qU=["id","attributionControl","style","token","rotation","mapInstance"];window.mapboxgl=t;var KU=0,QU="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",$U=NM()(XU=function(n){A(o,n);var r,i=I(o);function o(){var t;b(this,o);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return E(P(t=i.call.apply(i,[this].concat(r))),"version",e.Version.MAPBOX),E(P(t),"viewport",void 0),t}return S(o,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=W_();return Q_(s,s,mb(o.x-i.x,o.y-i.y,o.z||0-i.z)),$_(s,s,mb(a*r[0],-a*r[1],a*r[2])),J_(s,s,n[0]),eb(s,s,n[1]),tb(s,s,n[2]),s}},{key:"init",value:(r=_(g().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,f,p;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,u=t.token,l=void 0===u?QU:u,c=t.rotation,h=void 0===c?0:c,f=t.mapInstance,p=O(t,qU),this.viewport=new ZU,f||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),l!==QU||"blank"===s||window.mapboxgl.accessToken||f||console.warn(this.configService.getSceneWarninfo("MapToken")),f||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),f?(this.map=f,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map(v({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:h},p))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(e,n){var r=new t.LngLat(e[0],e[1]),i=new t.LngLat(n[0],n[1]),o=r.distanceTo(i),a=t.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=t.MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),u=a.x,l=a.y,c=s.x,h=s.y;return 4194304*Math.sqrt(Math.pow(u-c,2)+Math.pow(l-h,2))*2/o}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+KU++,t.appendChild(n),n}}]),o}(BU))||XU,JU=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return $U}}]),n}(wB);function eV(t,n){t.length>0&&n.version===e.Version.SIMPLE&&t.map((function(e){e.simpleCoordinate||(e.coordinates=function(e,t){if("number"==typeof e[0])return t.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),r}(e.coordinates,n),e.simpleCoordinate=!0)}))}function tV(t,n,r,i,o,a){var s=(null==a?void 0:a.getLayerConfig()).arrow,u=void 0===s?{enable:!1}:s,l=n.map((function(e){var n,i,a,s={id:e._id,coordinates:e.coordinates};if(t.filter((function(e){return void 0!==e.scale})).forEach((function(t){var n=function(e,t,n){var r;if(!e.scale)return[];var i=(null==e||null===(r=e.scale)||void 0===r?void 0:r.scalers)||[],o=[];i.forEach((function(n){var r,i=n.field;(t.hasOwnProperty(i)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&o.push(t[i])}));var a=e.mapping?e.mapping(o):[];return"color"!==e.name||Ey(a[0])?a:[n]}(t,e,o);t.needRemapping=!1,"color"===t.name&&(n=n.map((function(e){return Ay(e)}))),s[t.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===t.name&&(s.shape=r.getIconFontKey(s[t.name]))})),"line"===s.shape&&u.enable){var l=s.coordinates,c=(n=l[0],i=l[1],a=Dm([i[0]-n[0],i[1]-n[1]]),[n[0]+1e-4*a[0],n[1]+1e-4*a[1]]);s.coordinates.splice(1,0,c,c)}return s}));return function(t,n,r){if(t.length>0&&n.version===e.Version["GAODE2.x"]){var i=r.coordCenter;"number"==typeof t[0].coordinates[0]?t.filter((function(e){return!e.originCoordinates})).map((function(t){t.version=e.Version["GAODE2.x"],t.originCoordinates=GT(t.coordinates),t.coordinates=n.lngLatToCoordByLayer(t.coordinates,i)})):t.filter((function(e){return!e.originCoordinates})).map((function(t){t.version=e.Version["GAODE2.x"],t.originCoordinates=GT(t.coordinates),t.coordinates=n.lngLatToCoordsByLayer(t.coordinates,i)}))}}(l,i,a),eV(l,i),l}function nV(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}function rV(e,t,n,r){var i=e.multiPassRenderer;return e.getLayerConfig().enableTAA?i.add(r("taa")):i.add(r("render")),nV(t).forEach((function(e){var t=D(e,2),r=t[0],o=t[1];i.add(n(r),o)})),i.add(n("copy")),i}var iV=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];var oV,aV,sV,uV=["passes"],lV=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],cV=0,hV=(oV=fF(Hk.IGlobalConfigService),sV=V((aV=function(t){A(o,t);var n,r,i=I(o);function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,o),E(P(e=i.call(this)),"id","".concat(cV++)),E(P(e),"name","".concat(cV)),E(P(e),"coordCenter",void 0),E(P(e),"type",void 0),E(P(e),"visible",!0),E(P(e),"zIndex",0),E(P(e),"minZoom",void 0),E(P(e),"maxZoom",void 0),E(P(e),"inited",!1),E(P(e),"layerModelNeedUpdate",!1),E(P(e),"pickedFeatureID",null),E(P(e),"selectedFeatureID",null),E(P(e),"styleNeedUpdate",!1),E(P(e),"rendering",void 0),E(P(e),"forceRender",!1),E(P(e),"clusterZoom",0),E(P(e),"layerType",void 0),E(P(e),"triangulation",void 0),E(P(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),E(P(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),E(P(e),"hooks",{init:new kw,afterInit:new kw,beforeRender:new kw,beforeRenderData:new Mw,afterRender:new Ew,beforePickingEncode:new Ew,afterPickingEncode:new Ew,beforeHighlight:new Ew(["pickedColor"]),afterHighlight:new Ew,beforeSelect:new Ew(["pickedColor"]),afterSelect:new Ew,beforeDestroy:new Ew,afterDestroy:new Ew}),E(P(e),"models",[]),E(P(e),"modelLoaded",!1),E(P(e),"multiPassRenderer",void 0),E(P(e),"plugins",void 0),E(P(e),"sourceOption",void 0),E(P(e),"layerModel",void 0),E(P(e),"shapeOption",void 0),E(P(e),"sceneContainer",void 0),E(P(e),"tileLayer",void 0),E(P(e),"layerChildren",[]),E(P(e),"masks",[]),E(P(e),"isVector",!1),U(P(e),"configService",sV,P(e)),E(P(e),"shaderModuleService",void 0),E(P(e),"cameraService",void 0),E(P(e),"coordinateService",void 0),E(P(e),"iconService",void 0),E(P(e),"fontService",void 0),E(P(e),"pickingService",void 0),E(P(e),"rendererService",void 0),E(P(e),"layerService",void 0),E(P(e),"interactionService",void 0),E(P(e),"mapService",void 0),E(P(e),"styleAttributeService",void 0),E(P(e),"layerSource",void 0),E(P(e),"postProcessingPassFactory",void 0),E(P(e),"normalPassFactory",void 0),E(P(e),"animateOptions",{enable:!1}),E(P(e),"container",void 0),E(P(e),"encodedData",void 0),E(P(e),"currentPickId",null),E(P(e),"rawConfig",void 0),E(P(e),"needUpdateConfig",void 0),E(P(e),"pendingStyleAttributes",[]),E(P(e),"scaleOptions",{}),E(P(e),"animateStartTime",void 0),E(P(e),"animateStatus",!1),E(P(e),"bottomColor","rgba(0, 0, 0, 0)"),E(P(e),"isDestroyed",!1),E(P(e),"encodeDataLength",0),E(P(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig();t&&t.autoFit&&e.fitBounds(t.fitBoundsOptions),e.reRender()})),e.name=t.name||e.id,e.zIndex=t.zIndex||0,e.rawConfig=t,e}return S(o,[{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var t=this;if(Object.keys(e).map((function(n){n in t.rawConfig&&(t.rawConfig[n]=e[n])})),this.inited){var n=this.container.get(Hk.SceneID);AB(e,this),this.configService.setLayerConfig(n,this.id,v(v(v({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=v(v({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e,t){this.container=e,this.sceneContainer=t}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(e){this.bottomColor=e}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:function(){var e=this,t=this.container.get(Hk.SceneID);this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Hk.IIconService),this.fontService=this.container.get(Hk.IFontService),this.rendererService=this.container.get(Hk.IRendererService),this.layerService=this.container.get(Hk.ILayerService),this.interactionService=this.container.get(Hk.IInteractionService),this.pickingService=this.container.get(Hk.IPickingService),this.mapService=this.container.get(Hk.IMapService);var n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes;r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){e.renderLayers()})),this.cameraService=this.container.get(Hk.ICameraService),this.coordinateService=this.container.get(Hk.ICoordinateSystemService),this.shaderModuleService=this.container.get(Hk.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Hk.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Hk.IFactoryNormalPass),this.styleAttributeService=this.container.get(Hk.IStyleAttributeService),this.multiPassRenderer=this.container.get(Hk.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach((function(t){var n=t.attributeName,r=t.attributeField,i=t.attributeValues,o=t.updateOptions;e.styleAttributeService.updateStyleAttribute(n,{scale:v({field:r},e.splitValuesAndCallbackInAttribute(i,e.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Hk.ILayerPlugin);var o,a=j(this.plugins);try{for(a.s();!(o=a.n()).done;){o.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(e){a.e(e)}finally{a.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map((function(t){t.updateAttributesAndElements(e.attributes,e.elements)})):console.warn("data error")}},{key:"createModelData",value:function(e,t){var n;if(null!==(n=this.layerModel)&&void 0!==n&&n.createModelData)return this.layerModel.createModelData(t);var r=this.calculateEncodeData(e,t),i=this.triangulation;return r&&i?this.styleAttributeService.createAttributesAndIndices(r,i):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(e,t){return this.inited?function(e,t,n,r,i,o){var a=new Dw(i,o),s=e.getBottomColor(),u=tV(r.getLayerStyleAttributes()||[],a.data.dataArray,t,n,s,e);return a.destroy(),u}(this,this.fontService,this.mapService,this.styleAttributeService,e,t):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(v(v({},this.getDefaultConfig()),this.rawConfig));var e=this.getLayerConfig().animateOption;null!=e&&e.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){return this.updateStyleAttribute("filter",e,t,n),this}},{key:"shape",value:function(e,t,n){var r,i,o,a=null===(r=this.styleAttributeService)||void 0===r||null===(i=r.getLayerStyleAttribute("shape"))||void 0===i||null===(o=i.scale)||void 0===o?void 0:o.field,s=e;return this.shapeOption={field:e,values:t},this.updateStyleAttribute("shape",e,t,n),this.tileLayer||function(e,t,n){if("string"==typeof t&&"string"==typeof n&&t!==n){if("PointLayer"===e.type)return void(e.dataState.dataSourceNeedUpdate=!0);iV.map((function(r){r.includes(t)&&r.includes(n)&&(e.dataState.dataSourceNeedUpdate=!0)}))}}(this,a,s),this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return va(e)?(t.enable=!0,t=v(v({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return"source"===(null==e?void 0:e.type)?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}},{key:"setData",value:function(e,t){var n=this;return this.inited?this.layerSource.setData(e,t):this.on("inited",(function(){n.getSource()?n.layerSource.setData(e,t):(n.source(new Dw(e,t)),n.sourceEvent())})),this}},{key:"style",value:function(e){var t=this,n=this.getLayerConfig(),r=e.passes,i=O(e,uV);return r&&nV(r).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])})),this.rawConfig=v(v({},this.rawConfig),i),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),n&&!0===n.mask&&!1===e.mask&&(this.clearModels(),this.layerModel.buildModels((function(e){t.models=e}))),this}},{key:"scale",value:function(e,t){return va(e)?this.scaleOptions=v(v({},this.scaleOptions),e):this.scaleOptions[e]=t,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):(this.encodeDataLength<=0&&!this.forceRender||this.renderModels(),this)}},{key:"renderMultiPass",value:(r=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){e.next=2;break}return e.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){e.next=7;break}return e.next=5,this.multiPassRenderer.render();case 5:e.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"active",value:function(e){var t={};return t.enableHighlight=!!va(e)||e,va(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(va(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:va(t)?t.color:this.getLayerConfig().highlightColor,activeMix:va(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:va(t)?t.color:this.getLayerConfig().highlightColor,activeMix:va(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ty(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!va(e)||e,va(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(va(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:va(t)?t.color:this.getLayerConfig().selectColor,selectMix:va(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:va(t)?t.color:this.getLayerConfig().selectColor,selectMix:va(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ty(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,o=t.maxZoom;return!!n&&e>=i&&e<=(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=rV(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){var e,t,n,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isDestroyed||(this.layerChildren.map((function(e){return e.destroy(!1)})),this.layerChildren=[],this.masks.map((function(e){return e.destroy(!1)})),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(e=this.multiPassRenderer)||void 0===e||e.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(t=this.layerModel)||void 0===t||t.clearModels(r),null===(n=this.tileLayer)||void 0===n||n.destroy(),this.models=[],this.layerService.cleanRemove(this,r),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach((function(e){return e.destroy()})),null===(e=this.layerModel)||void 0===e||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){var t=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(){if(void 0===t.coordCenter){var e,n=t.layerSource.center;t.coordCenter=n,(null===(e=t.mapService)||void 0===e?void 0:e.setCoordCenter)&&t.mapService.setCoordCenter(n)}t.sourceEvent()}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var t,n,r,i=this.styleAttributeService.getLayerStyleAttribute(e);return{type:null===(n=((null==i||null===(t=i.scale)||void 0===t?void 0:t.scalers)||[])[0].option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.invertExtent?t.range().map((function(n){return E({value:t.invertExtent(n)},e,n)})):t.ticks?t.ticks().map((function(n){return E({value:n},e,t(n))})):null!=t&&t.domain?t.domain().filter((function(e){return!xB(e)})).map((function(n){return E({value:n},e,t(n))})):[]:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:function(t){var n=this,r=t.moduleName,i=t.vertexShader,o=t.fragmentShader,a=t.triangulation,s=t.segmentNumber,u=t.workerEnabled,l=void 0!==u&&u,c=t.workerOptions,h=O(t,lV);this.shaderModuleService.registerModule(r,{vs:i,fs:o});var f=this.shaderModuleService.getModule(r),p=f.vs,d=f.fs,g=f.uniforms,m=this.rendererService.createModel;return new Promise((function(t,r){setTimeout((function(){if(c&&c.modelType in px&&l)n.styleAttributeService.createAttributesAndIndicesAscy(n.encodedData,s,c).then((function(n){var r=n.attributes,i=n.elements,o=m(v({attributes:r,uniforms:g,fs:d,vs:p,elements:i,blend:SB[e.BlendType.normal]},h));t(o)})).catch((function(e){return r(e)}));else{var i=n.styleAttributeService.createAttributesAndIndices(n.encodedData,a,s),o=i.attributes,u=i.elements,f=i.count,y=v({attributes:o,uniforms:g,fs:d,vs:p,elements:u,blend:SB[e.BlendType.normal]},h);f&&(y.count=f);var _=m(y);t(_)}}))}))}},{key:"createAttributes",value:function(e){var t=e.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,t).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){if("basemap"===this.rawConfig.usage)return!1;var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!o||(a=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:(n=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"renderModels",value:function(e){var t=this;return this.encodeDataLength<=0&&!this.forceRender||(this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels((function(e){t.models=e,t.hooks.beforeRender.call(),t.layerModelNeedUpdate=!1})),this.models.forEach((function(n){n.draw({uniforms:t.layerModel.getUninforms()},e)}))),this}},{key:"updateStyleAttribute",value:function(e,t,n,r){this.inited?this.styleAttributeService.updateStyleAttribute(e,{scale:v({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"dispatchModelLoad",value:function(e){var t=this;this.models.forEach((function(e){return e.destroy()})),this.models=[],this.models=e,this.emit("modelLoaded",null),this.modelLoaded=!0,setTimeout((function(){t.layerService.renderLayers()}),32)}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e,t){return{values:ga(e)?void 0:e||t,callback:ga(e)?e:void 0}}}]),o}(Kx)).prototype,"configService",[oV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aV);var fV=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};var pV=function(e,t,n,r,i,o){var a=1&n,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var l=o.get(e),c=o.get(t);if(l&&c)return l==t&&c==e;var h=-1,f=!0,p=2&n?new YR:void 0;for(o.set(e,t),o.set(t,e);++h<s;){var d=e[h],v=t[h];if(r)var g=a?r(v,d,h,t,e,o):r(d,v,h,e,t,o);if(void 0!==g){if(g)continue;f=!1;break}if(p){if(!fV(t,(function(e,t){if(!qR(p,t)&&(d===e||i(d,e,n,r,o)))return p.push(t)}))){f=!1;break}}else if(d!==v&&!i(d,v,n,r,o)){f=!1;break}}return o.delete(e),o.delete(t),f};var dV=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},vV=oa?oa.prototype:void 0,gV=vV?vV.valueOf:void 0;var mV=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new JA(e),new JA(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return pA(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=dV;case"[object Set]":var u=1&r;if(s||(s=QR),e.size!=t.size&&!u)return!1;var l=a.get(e);if(l)return l==t;r|=2,a.set(e,t);var c=pV(s(e),s(t),r,i,o,a);return a.delete(e),c;case"[object Symbol]":if(gV)return gV.call(e)==gV.call(t)}return!1},yV=Object.prototype.hasOwnProperty;var _V=function(e,t,n,r,i,o){var a=1&n,s=dT(e),u=s.length;if(u!=dT(t).length&&!a)return!1;for(var l=u;l--;){var c=s[l];if(!(a?c in t:yV.call(t,c)))return!1}var h=o.get(e),f=o.get(t);if(h&&f)return h==t&&f==e;var p=!0;o.set(e,t),o.set(t,e);for(var d=a;++l<u;){var v=e[c=s[l]],g=t[c];if(r)var m=a?r(g,v,c,t,e,o):r(v,g,c,e,t,o);if(!(void 0===m?v===g||i(v,g,n,r,o):m)){p=!1;break}d||(d="constructor"==c)}if(p&&!d){var y=e.constructor,_=t.constructor;y==_||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _||(p=!1)}return o.delete(e),o.delete(t),p},bV=Object.prototype.hasOwnProperty;var xV=function(e,t,n,r,i,o){var a=dC(e),s=dC(t),u=a?"[object Array]":TT(e),l=s?"[object Array]":TT(t),c="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),h="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l),f=u==l;if(f&&_C(e)){if(!_C(t))return!1;a=!0,c=!1}if(f&&!c)return o||(o=new ZA),a||OC(e)?pV(e,t,n,r,i,o):mV(e,t,u,n,r,i,o);if(!(1&n)){var p=c&&bV.call(e,"__wrapped__"),d=h&&bV.call(t,"__wrapped__");if(p||d){var v=p?e.value():e,g=d?t.value():t;return o||(o=new ZA),i(v,g,n,r,o)}}return!!f&&(o||(o=new ZA),_V(e,t,n,r,i,o))};var SV=function e(t,n,r,i,o){return t===n||(null==t||null==n||!rS(t)&&!rS(n)?t!=t&&n!=n:xV(t,n,r,i,e,o))};var EV,AV,CV,TV,wV,MV,kV,OV=function(e,t){return SV(e,t)},PV=(EV=fF(Hk.IGlobalConfigService),CV=V((AV=function(){function t(n){b(this,t),E(this,"triangulation",void 0),E(this,"createTexture2D",void 0),E(this,"layer",void 0),E(this,"dataTexture",void 0),E(this,"DATA_TEXTURE_WIDTH",void 0),E(this,"rowCount",void 0),E(this,"cacheStyleProperties",void 0),E(this,"cellLength",void 0),E(this,"cellProperties",void 0),E(this,"cellTypeLayout",void 0),E(this,"stylePropertiesExist",void 0),E(this,"dataTextureTest",void 0),U(this,"configService",CV,this),E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"iconService",void 0),E(this,"fontService",void 0),E(this,"styleAttributeService",void 0),E(this,"mapService",void 0),E(this,"cameraService",void 0),E(this,"layerService",void 0),E(this,"pickingService",void 0),this.layer=n,this.rendererService=n.getContainer().get(Hk.IRendererService),this.pickingService=n.getContainer().get(Hk.IPickingService),this.shaderModuleService=n.getContainer().get(Hk.IShaderModuleService),this.styleAttributeService=n.getContainer().get(Hk.IStyleAttributeService),this.mapService=n.getContainer().get(Hk.IMapService),this.iconService=n.getContainer().get(Hk.IIconService),this.fontService=n.getContainer().get(Hk.IFontService),this.cameraService=n.getContainer().get(Hk.ICameraService),this.layerService=n.getContainer().get(Hk.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:e.gl.NEAREST,min:e.gl.NEAREST,width:1,height:1}))}return S(t,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(e){var t=!1;return OV(e.thetaOffset,this.cacheStyleProperties.thetaOffset)||(t=!0,this.cacheStyleProperties.thetaOffset=e.thetaOffset),OV(e.opacity,this.cacheStyleProperties.opacity)||(t=!0,this.cacheStyleProperties.opacity=e.opacity),OV(e.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(t=!0,this.cacheStyleProperties.strokeOpacity=e.strokeOpacity),OV(e.strokeWidth,this.cacheStyleProperties.strokeWidth)||(t=!0,this.cacheStyleProperties.strokeWidth=e.strokeWidth),OV(e.stroke,this.cacheStyleProperties.stroke)||(t=!0,this.cacheStyleProperties.stroke=e.stroke),OV(e.offsets,this.cacheStyleProperties.offsets)||(t=!0,this.cacheStyleProperties.offsets=e.offsets),void 0===this.dataTexture&&(t=!0),t}},{key:"judgeStyleAttributes",value:function(e){this.clearLastCalRes(),void 0===e.opacity||XF(e.opacity)||(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),void 0===e.strokeOpacity||XF(e.strokeOpacity)||(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),void 0===e.strokeWidth||XF(e.strokeWidth)||(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),void 0===e.stroke||this.isStaticColor(e.stroke)||(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),void 0===e.offsets||this.isOffsetStatic(e.offsets)||(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),void 0===e.thetaOffset||XF(e.thetaOffset)||(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(e){return!!KC(e)&&!!ly(e)}},{key:"getStrokeColor",value:function(e){if(this.isStaticColor(e)){var t=Ay(e);return t[0]=t[0]?t[0]:0,t[1]=t[1]?t[1]:0,t[2]=t[2]?t[2]:0,t[3]=t[3]?t[3]:0,t}return[0,0,0,0]}},{key:"isOffsetStatic",value:function(e){return!!(Array.isArray(e)&&2===e.length&&XF(e[0])&&XF(e[1]))}},{key:"patchMod",value:function(e,t){for(var n=0;n<t;n++)e.push(-1)}},{key:"patchData",value:function(e,t,n){var r,i=j(n);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.attr,s=o.count,u=t[a];void 0!==u?"stroke"===a?e.push.apply(e,F(Ay(u))):"offsets"===a?this.isOffsetStatic(u)?e.push(-u[0],u[1]):e.push(0,0):e.push(XF(u)?u:1):this.patchMod(e,s)}}catch(e){i.e(e)}finally{i.f()}}},{key:"calDataFrame",value:function(e,t,n){for(var r=t.length,i=Math.ceil(r*e/this.DATA_TEXTURE_WIDTH),o=i*this.DATA_TEXTURE_WIDTH,a=[],s=0;s<r;s++){var u=t[s];this.patchData(a,u,n)}for(var l=a.length;l<o;l++)a.push(-1);return{data:a,width:this.DATA_TEXTURE_WIDTH,height:i}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig().blend,n=void 0===t?"normal":t;return SB[e.BlendType[n]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(e){throw new Error("Method not implemented.")}},{key:"initModels",value:function(e){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}}]),t}()).prototype,"configService",[EV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AV);(TV=e.lineStyleType||(e.lineStyleType={}))[TV.solid=0]="solid",TV[TV.dash=1]="dash",(wV=e.LinearDir||(e.LinearDir={})).VERTICAL="vertical",wV.HORIZONTAL="horizontal",(MV=e.TextureBlend||(e.TextureBlend={})).NORMAL="normal",MV.REPLACE="replace",(kV=e.CanvasUpdateType||(e.CanvasUpdateType={})).ALWAYS="always",kV.DRAGEND="dragend";var LV={canvas:function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"updateMode",e.CanvasUpdateType.ALWAYS),E(P(t),"canvas",void 0),E(P(t),"ctx",void 0),E(P(t),"prevSize",void 0),E(P(t),"renderUpdate",(function(){var n=t.layer.getLayerConfig(),r=n.zIndex,i=void 0===r?10:r,o=n.update,a=void 0===o?e.CanvasUpdateType.ALWAYS:o,s=n.animateOption,u=void 0===s?{enable:!1,duration:20}:s;+t.canvas.style.zIndex===i&&(t.canvas.style.zIndex=i+""),t.updateMode!==a&&(t.updateMode=a,t.unBindListener(),t.bindListener()),t.updateMode===e.CanvasUpdateType.ALWAYS&&u.enable&&t.renderCanvas()})),E(P(t),"unBindListener",(function(){t.mapService.off("mapchange",t.renderCanvas),t.mapService.off("zoomstart",t.clearCanvas),t.mapService.off("zoomend",t.renderCanvas),t.mapService.off("movestart",t.clearCanvas),t.mapService.off("moveend",t.renderCanvas)})),E(P(t),"bindListener",(function(){t.updateMode===e.CanvasUpdateType.ALWAYS?t.mapService.on("mapchange",t.renderCanvas):(t.mapService.on("zoomstart",t.clearCanvas),t.mapService.on("zoomend",t.renderCanvas),t.mapService.on("movestart",t.clearCanvas),t.mapService.on("moveend",t.renderCanvas))})),E(P(t),"clearCanvas",(function(){if(t.ctx){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;t.ctx.clearRect(0,0,n,r)}})),E(P(t),"renderCanvas",(function(){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;if(t.prevSize[0]!==n||t.prevSize[1]!==r){t.prevSize=[n,r];var i=D(t.mapService.getSize(),2),o=i[0],a=i[1];t.canvas.width=n,t.canvas.height=r,t.canvas.style.width=o+"px",t.canvas.style.height=a+"px"}var s=t.layer.getLayerConfig().drawingOnCanvas;t.ctx&&s({canvas:t.canvas,ctx:t.ctx,mapService:t.mapService,size:[n,r]})})),t}return S(r,[{key:"clearModels",value:function(){var e;this.canvas&&(null===(e=this.mapService.getContainer())||void 0===e||e.removeChild(this.canvas),this.canvas=null);this.unBindListener()}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig().update,n=void 0===t?e.CanvasUpdateType.ALWAYS:t;return this.updateMode=n,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),[]}},{key:"initCanvas",value:function(){var e,t=this.layer.getLayerConfig().zIndex,n=D(this.mapService.getSize(),2),r=n[0],i=n[1],o=this.rendererService.getViewportSize(),a=o.width,s=o.height;this.prevSize=[a,s];var u=document.createElement("canvas");this.canvas=u,u.width=a,u.height=s,u.style.pointerEvents="none",u.style.width=r+"px",u.style.height=i+"px",u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.zIndex=t+"",null===(e=this.mapService.getContainer())||void 0===e||e.appendChild(u);var l=u.getContext("2d");this.ctx=l}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(PV)},IV=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","CanvasLayer"),E(P(e),"forceRender",!0),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new LV[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"hide",value:function(){var e;return this.layerModel.clearCanvas&&(null===(e=this.layerModel)||void 0===e||e.clearCanvas()),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"renderModels",value:function(){var e,t=this;return null!=this&&null!==(e=this.layerModel)&&void 0!==e&&e.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach((function(e){e.draw({uniforms:t.layerModel.getUninforms()},!1)})),this}},{key:"getDefaultConfig",value:function(){return{canvas:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"canvas"}}]),n}(hV);function RV(e){return e/180*Math.acos(-1)}function NV(e){var t=RV(e[0])+Math.PI/2,n=RV(e[1]),r=100+.4*Math.random(),i=r*Math.cos(n)*Math.cos(t);return[r*Math.cos(n)*Math.sin(t),r*Math.sin(n),i]}function DV(e,t){var n=W_(),r=W_(),i=mb(0,1,0),o=mb(0,0,0);e=void 0!==e?e:1;for(var a=2+(void 0!==(t=t||{}).segments?t.segments:32),s=2*a,u=[],l=[],c=[],h=[],f=[],p=[],d=0;d<=a;d++){for(var v=d/a,g=v*Math.PI,m=0;m<=s;m++){var y=m/s,_=y*Math.PI*2;Z_(r),tb(r,r,-g),Z_(n),eb(n,n,_),kb(o,i,r),kb(o,o,n),xb(o,o,-e),c.push(o.slice()),h.push.apply(h,F(o.slice())),Tb(o,o),f.push.apply(f,F(o.slice())),p.push([y,1-v]),h.push(y,1-v)}if(d>0)for(var b=c.length,x=b-2*(s+1);x+s+2<b;x++)u.push([x,x+1,x+s+1]),l.push(x,x+1,x+s+1),u.push([x+s+1,x+1,x+s+2]),l.push(x+s+1,x+1,x+s+2)}return{cells:u,positions:c,uvs:p,positionsArr:h,indicesArr:l,normalArr:f}}var FV=Gb(),BV=(Gb(),Gb()),zV=Gb(),jV=Gb();function UV(e,t,n,r,i){return Zb(e,n,r),Kb(e,e),[i/Qb(t=Wb(-e[1],e[0]),Wb(-n[1],n[0])),t]}function VV(e,t){return Xb(e,-t[1],t[0])}function HV(e,t,n){return Jb(e,t,n),Kb(e,e),e}function GV(e,t){return e[0]===t[0]&&e[1]===t[1]}var WV,YV,XV,ZV=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b(this,e),E(this,"complex",void 0),E(this,"join",void 0),E(this,"cap",void 0),E(this,"miterLimit",void 0),E(this,"thickness",void 0),E(this,"normal",void 0),E(this,"lastFlip",-1),E(this,"miter",Wb(0,0)),E(this,"started",!1),E(this,"dash",!1),E(this,"totalDistance",0),E(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return S(e,[{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(F(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,l,h,p,c,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(F(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,l,h,p,c,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleSegment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l=km([r[0],r[1]]),c=km([n[0],n[1]]);HV(BV,l,c);var h=0;if(this.dash&&(h=this.lineSegmentDistance(l,c),this.totalDistance+=h),this.normal||(this.normal=Gb(),VV(this.normal,BV)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(t+0,t+1,t+2),i){var f=km([i[0],i[1]]);GV(l,f)&&Zb(f,l,Kb(f,qb(f,l,c))),HV(zV,f,l);var p=D(UV(jV,Gb(),BV,zV,this.thickness),2),d=p[0],v=p[1];Qb(jV,this.normal);this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,Yb(this.normal,v),o+=2,this.lastFlip=-1}else VV(this.normal,BV),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2;return o}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,l=e.indices,c=e.positions,h=e.normals,f="square"===this.cap,p="bevel"===this.join,d=km([a[0],a[1]]),v=km([o[0],o[1]]);HV(BV,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=Gb(),VV(this.normal,BV)),!this.started)if(this.started=!0,f){var m=Gb(),y=Gb();Zb(m,this.normal,BV),Zb(y,this.normal,BV),h.push(y[0],y[1],0),h.push(m[0],m[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-g);if(l.push(t+0,t+1,t+2),i){GV(r,i)&&Zb(i,r,Kb(i,qb(i,r,n))),HV(zV,i,r);var _=D(UV(jV,Gb(),BV,zV,this.thickness),2),b=_[0],x=_[1],S=Qb(jV,this.normal)<0?-1:1,E=p;if(!E&&"miter"===this.join)b>this.miterLimit&&(E=!0);E?(h.push(this.normal[0],this.normal[1],0),h.push(x[0],x[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,F(this.lastFlip!==-S?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),VV(FV,zV),Yb(this.normal,FV),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,h,r,x,b,this.totalDistance),l.push.apply(l,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),S=-1,Yb(this.normal,x),u+=2),this.lastFlip=S}else{if(VV(this.normal,BV),f){var A=Gb(),C=Gb();Jb(C,BV,this.normal),Zb(A,BV,this.normal),h.push(C[0],C[1],0),h.push(A[0],A[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l="square"===this.cap,c="bevel"===this.join,h=km([r[0],r[1]]),f=km([n[0],n[1]]);HV(BV,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=Gb(),VV(this.normal,BV)),!this.started)if(this.started=!0,l){var d=Gb(),v=Gb();Zb(d,this.normal,BV),Zb(v,this.normal,BV),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(t+0,t+1,t+2),i){var g=km([i[0],i[1]]);GV(h,g)&&Zb(g,h,Kb(g,qb(g,h,f))),HV(zV,g,h);var m=D(UV(jV,Gb(),BV,zV,this.thickness),2),y=m[0],_=m[1],b=Qb(jV,this.normal)<0?-1:1,x=c;if(!x&&"miter"===this.join)y>this.miterLimit&&(x=!0);x?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,F(this.lastFlip!==-b?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),VV(FV,zV),Yb(this.normal,FV),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,y,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),b=-1,Yb(this.normal,_),o+=2),this.lastFlip=b}else{if(VV(this.normal,BV),l){var S=Gb(),E=Gb();Jb(E,BV,this.normal),Zb(S,BV,this.normal),u.push(E[0],E[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function qV(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=c_.flatten(e),a=o.vertices,s=o.dimensions,u=[],l=[],c=[],h=0;h<a.length/s;h++)2===s?u.push(a[2*h],a[2*h+1],1,-1,-1):u.push(a[3*h],a[3*h+1],1,-1,-1),c.push(0,0,1);var f=c_(o.vertices,o.holes,o.dimensions);l.push.apply(l,F(f));for(var p=function(e){var n=o.vertices.slice(e*s,(e+1)*s),r=o.vertices.slice((e+1)*s,(e+2)*s);0===r.length&&(r=o.vertices.slice(0,s));var i=u.length/5;u.push(n[0],n[1],1,0,0,r[0],r[1],1,.1,0,n[0],n[1],0,0,.8,r[0],r[1],0,.1,.8);var a=KV([r[0],r[1],1],[n[0],n[1],0],[n[0],n[1],1],t);c.push.apply(c,F(a).concat(F(a),F(a),F(a))),l.push.apply(l,F([1,2,0,3,2,1].map((function(e){return e+i}))))},d=0;d<i;d++)p(d);return{positions:u,index:l,normals:c}}function KV(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=vb(),o=vb(),a=vb();r&&(e=Cm(e),t=Cm(t),n=Cm(n));var s=mb.apply(jb,F(e)),u=mb.apply(jb,F(t)),l=mb.apply(jb,F(n));Lb(i,l,u),Lb(o,s,u),Mb(a,i,o);var c=vb();return Tb(c,a),c}function QV(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var o=r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}));return o}function $V(){return QV(30)}function JV(){return QV(4)}function eH(){return QV(3)}function tH(){return QV(6,1)}function nH(){return QV(5)}!function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"}(YV||(YV={})),function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"}(XV||(XV={}));var rH=(E(WV={},XV.CIRCLE,$V),E(WV,XV.HEXAGON,tH),E(WV,XV.TRIANGLE,eH),E(WV,XV.SQUARE,JV),E(WV,XV.PENTAGON,nH),E(WV,YV.CYLINDER,$V),E(WV,YV.HEXAGONCOLUMN,tH),E(WV,YV.TRIANGLECOLUMN,eH),E(WV,YV.SQUARECOLUMN,JV),E(WV,YV.PENTAGONCOLUMN,nH),WV),iH={};function oH(e){var t=jm(e.coordinates);return{vertices:[].concat(F(t),F(t),F(t),F(t)),indices:[0,1,2,2,3,0],size:t.length}}function aH(e){var t=NV(jm(e.coordinates));return{vertices:[].concat(F(t),F(t),F(t),F(t)),indices:[0,1,2,2,3,0],size:t.length}}function sH(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(iH&&iH[e])return iH[e];var n=rH[e]?rH[e]():rH.cylinder(),r=qV([n],t);return iH[e]=r,r}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function uH(e){var t=jm(e.coordinates);return{vertices:F(t),indices:[0],size:t.length}}function lH(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new ZV({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function cH(e){var t=e.coordinates,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=function(e){var t=0;if(e.length<2)return{results:e,totalDistance:0};var n=[],r=pH(e[0],t);n.push(r);for(var i=1;i<e.length-1;i++){var o=fH(e[i-1],e[i]);t+=o;var a=pH(e[i],t);n.push(a),n.push(a)}var s=fH(e[e.length-2],e[e.length-1]);return t+=s,n.push(pH(e[e.length-1],t)),{results:n,totalDistance:t}}(t),i=r.results,o=r.totalDistance;return i.map((function(e){n.push(e[0],e[1],e[2],e[3],0,o)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function hH(e){var t=e.coordinates,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],size:4,count:0};var r=function(e){if(e.length<2)return{results:e};var t=[],n=pH(e[0]);t.push(n);for(var r=1;r<e.length-1;r++){var i=pH(e[r]);t.push(i),t.push(i)}return t.push(pH(e[e.length-1])),{results:t}}(t).results;return r.map((function(e){n.push(e[0],e[1],e[2],e[3])})),{vertices:n,indices:[],size:4,count:r.length}}function fH(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function pH(e,t){return e.length<3&&e.push(0),void 0!==t&&e.push(t),e}function dH(e){var t=e.coordinates,n=c_.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:c_(r,o,i),vertices:r,size:i}}function vH(e){var t=e.coordinates,n=c_.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:c_(r,o,i),vertices:gH(r),size:i+4}}function gH(e){for(var t=[],n=Um(e),r=n.center,i=n.radius,o=0;o<e.length;o+=2){var a=e[o],s=e[o+1];t.push.apply(t,[a,s,0].concat(F(r),[i]))}return t}function mH(e){var t=qV(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function yH(e){var t=function(e){var t=rH[e]?rH[e]():rH.circle();return-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(e)?(n=[t],r=c_.flatten(n),i=c_(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=c_.flatten(e),o=i.vertices,a=i.dimensions,s=[],u=[],l=0;l<o.length/a;l++)2===a?s.push(o[2*l],o[2*l+1],1):s.push(o[3*l],o[3*l+1],1);var c=c_(i.vertices,i.holes,i.dimensions);u.push.apply(u,F(c));for(var h=function(e){var t=i.vertices.slice(e*a,(e+1)*a),n=i.vertices.slice((e+1)*a,(e+2)*a);0===n.length&&(n=i.vertices.slice(0,a));var r=s.length/3;s.push(t[0],t[1],1,n[0],n[1],1,t[0],t[1],0,n[0],n[1],0),u.push.apply(u,F([0,2,1,2,3,1].map((function(e){return e+r}))))},f=0;f<r;f++)h(f);return{positions:s,index:u}}([t]);var n,r,i}(e.shape);return{vertices:t.positions,indices:t.index,size:3}}function _H(e){var t=e.coordinates;return{vertices:[].concat(F(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],F(t[1]),[0,1,0],F(t[0]),[0,0,1],F(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function bH(e,t){for(var n=t||30,r=e.coordinates,i=[],o=[],a=function(e){i.push(e,1,e,r[0][0],r[0][1],r[1][0],r[1][1],e,-1,e,r[0][0],r[0][1],r[1][0],r[1][1]),e!==n-1&&o.push.apply(o,F([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},s=0;s<n;s++)a(s);return{vertices:i,indices:o,size:7}}function xH(e){var t=e.coordinates;2===t.length&&t.push(0);var n=SH(-1,1),r=SH(1,1),i=SH(-1,-1),o=SH(1,-1);return{vertices:[].concat(F(t),F(n),F(t),F(i),F(t),F(o),F(t),F(r)),indices:[0,1,2,3,0,2],size:5}}function SH(e,t){return[(e+1)/2,(t+1)/2]}function EH(){var e=DV(100,{segments:36});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}function AH(){var e=DV(140,{segments:36});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}var CH,TH=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"cityCenter",void 0),E(P(e),"cityMinSize",void 0),e}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=e.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=e.windowColor,u=void 0===s?"rgb(30,60,89)":s,l=e.time,c=void 0===l?0:l,h=e.sweep,f=void 0===h?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:h;return{u_cityCenter:f.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*f.sweepRadius,u_circleSweep:f.enable?1:0,u_circleSweepColor:Ay(f.sweepColor).slice(0,3),u_circleSweepSpeed:f.sweepSpeed,u_opacity:n,u_baseColor:Ay(i),u_brightColor:Ay(a),u_windowColor:Ay(u),u_time:this.layer.getLayerAnimateTime()||c}}},{key:"calCityGeo",value:function(){var e=D(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+t)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([t,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-t,u=i-n;this.cityCenter=[(r+t)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:function(e){this.calCityGeo(),this.startModelAnimate(),this.buildModels(e)}},{key:"buildModels",value:function(t){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\nvarying float v_worldDis;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nv_texCoord = a_Uv;\nif(u_circleSweep > 0.0) {\nvec2 lnglatscale = vec2(0.0);\nif(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\nlnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n}\nv_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\nvarying float v_worldDis;\n#pragma include "picking"\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\nfloat s = step(hot, n);\nvec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\nreturn mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\nreturn fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\nfloat LinearizeDepth()\n{\nfloat z = gl_FragCoord.z * 2.0 - 1.0;\nreturn (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\nvec3 fog(vec3 color, vec3 fogColor, float depth){\nfloat fogFactor=clamp(depth,0.0,1.0);\nvec3 output_color=mix(fogColor,color,fogFactor);\nreturn output_color;\n}\nfloat sdRect(vec2 p, vec2 sz) {\nvec2 d = abs(p) - sz;\nfloat outside = length(max(d, 0.));\nfloat inside = min(max(d.x, d.y), 0.);\nreturn outside + inside;\n}\nvoid main() {\ngl_FragColor = v_Color;\nvec3 baseColor = u_baseColor.xyz;\nvec3 brightColor = u_brightColor.xyz;\nvec3 windowColor = u_windowColor.xyz;\nfloat targetColId = 5.;\nfloat depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\nvec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\nif(v_texCoord.x < 0.) {\nvec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\ngl_FragColor = vec4( foggedColor, v_Color.w);\n}else {\nvec2 st = v_texCoord;\nvec2  UvScale = v_texCoord;\nfloat tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\nfloat tStart = 0.25 * tStep;\nfloat tEnd = 0.75 * tStep;\nfloat u = mod(UvScale.x, tStep);\nfloat v = mod(UvScale.y, tStep);\nfloat ux = floor(UvScale.x/tStep);\nfloat uy = floor(UvScale.y/tStep);\nfloat n = random(vec2(ux,uy));\nfloat lightP = u_time;\nfloat head = 1.0- step(0.005,st.y);\nfloat sU = step(tStart, u) - step(tEnd, u);\nfloat sV = step(tStart, v) - step(tEnd, v);\nvec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\nfloat dist = sdRect(vec2(u,v), windowSize);\nfloat s = sU * sV;\nfloat curColId = floor(UvScale.x / tStep);\nfloat sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\nfloat mLightP = mod(lightP, 2.);\nfloat sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\nif(ux == targetColId){\nn =0.;\n}\nfloat timeP = min(0.75, abs ( sin(u_time/3.0) ) );\nfloat hot = smoothstep(1.0,0.0,timeP);\nvec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\nfloat sFinal = s * sCol * sRow;\ncolor += mix(baseColor, brightColor, sFinal*n);\nif (st.y<0.01){\ncolor = baseColor;\n}\nif(head ==1.0) {\ncolor = brightColor;\n}\ncolor = color * v_Color.rgb;\nvec3 foggedColor = fog(color,fogColor,depth);\ngl_FragColor = vec4(foggedColor,1.0);\n}\nif(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\nfloat r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\ngl_FragColor.rgb += r * r * u_circleSweepColor;\n}\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:mH,depth:{enable:!0},cull:{enable:!0,face:e.gl.BACK}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),r}(PV),wH=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","CityBuildingLayer"),e}return S(n,[{key:"buildModels",value:function(){var e=this;this.layerModel=new TH(this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getModelType",value:function(){return"citybuilding"}}]),n}(hV),MH=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(P(e),"radian",0),E(P(e),"planeGeometryTriangulation",(function(){var t=e.layer.getLayerConfig().center,n=void 0===t?[120,30]:t;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat(F(n),[1,1],F(n),[0,1],F(n),[0,0],F(n),[1,0])}})),e}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.width,r=void 0===n?1:n,i=e.height,o=void 0===i?1:i,a=e.raisingHeight,s=void 0===a?0:a,u=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_opacity:t||1,u_texture:this.texture,u_size:[r,o]}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=n.drawCanvas,u=this.rendererService.createTexture2D;this.texture=u({height:0,width:0}),s&&this.updateTexture(s),this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform float u_raisingHeight: 0.0;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform vec2 u_size: [1.0, 1.0];\nuniform mat2 u_RotateMatrix;\nattribute vec3 a_Extrude;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nv_Color = a_Color;\nv_uv = a_Uv;\nfloat raiseHeight = u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraiseHeight = u_raisingHeight * mapboxZoomScale;\n}\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\nvec2 offsetXY = project_pixel(u_RotateMatrix * vec2(extrude.x * u_size.x, 0.0));\nfloat x = project_pos.x + offsetXY.x;\nfloat y = project_pos.y + offsetXY.y;\nfloat z = project_pixel(extrude.y * u_size.y + raiseHeight);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(x, y, z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(x , y, z , 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform sampler2D u_texture;\nuniform float u_opacity;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:this.planeGeometryTriangulation,primitive:e.gl.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"updateTexture",value:function(t){var n=this.rendererService.createTexture2D,r=this.layer.getLayerConfig(),i=r.canvasWidth,o=void 0===i?1:i,a=r.canvasHeight,s=void 0===a?1:a,u=document.createElement("canvas");u.width=o,u.height=s,u.getContext("2d")&&(t(u),this.texture=n({data:u,width:u.width,height:u.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[2],n[3]]}}})}}]),r}(PV),kH=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(P(e),"terrainImage",void 0),E(P(e),"terrainImageLoaded",!1),E(P(e),"mapTexture",void 0),E(P(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,o=n.height,a=void 0===o?1:o,s=n.widthSegments,u=void 0===s?1:s,l=n.heightSegments,c=void 0===l?1:l,h=n.center,f=void 0===h?[120,30]:h,p=n.terrainTexture,d=(t=e).initPlane.apply(t,[i,a,u,c].concat(F(f))),v=d.indices,g=d.positions;return p&&e.loadTerrainTexture(g,v),{vertices:g,indices:v,size:5}})),e}return S(r,[{key:"initPlane",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,s=t/2,u=n/2,l=Math.floor(r),c=Math.floor(i),h=l+1,f=c+1,p=t/l,d=n/c,v=[],g=[],m=0;m<f;m++)for(var y=m*d-u,_=0;_<h;_++){var b=_*p-s;if(this.mapService.version===e.Version["GAODE2.x"]){var x=this.mapService.lngLatToCoord([b+o,-y+a]),S=D(x,2),E=S[0],A=S[1];g.push(E,A,0)}else g.push(b+o,-y+a,0);g.push(_/l),g.push(1-m/c)}for(var C=0;C<c;C++)for(var T=0;T<l;T++){var w=T+h*C,M=T+h*(C+1),k=T+1+h*(C+1),O=T+1+h*C;v.push(w,M,O),v.push(M,k,O)}return{indices:v,positions:g}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.terrainClipHeight,o=void 0===i?0:i,a=t.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:a?o:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){var e;this.terrainImage=null,null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=n.mapTexture;this.mapTexture=s;var u=this.rendererService.createTexture2D;this.texture=u({height:0,width:0}),this.updateTexture(s),this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_terrainClipHeight;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_Color = a_Color;\nv_uv = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nv_clip = 1.0;\nif(a_Position.z < u_terrainClipHeight) {\nv_clip = 0.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n#pragma include "picking"\nvoid main() {\nif(u_mapFlag > 0.0) {\ngl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\ngl_FragColor.a *= u_opacity;\n} else {\ngl_FragColor = vec4(v_Color, u_opacity);\n}\ngl_FragColor.a *= v_clip;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:this.planeGeometryTriangulation,primitive:e.gl.TRIANGLES,depth:{enable:!0},stencil:Oy(i,a),blend:this.getBlend(),cull:{enable:!0,face:e.gl.BACK}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"createModelData",value:function(e){if(e){var t=this.layer.getLayerConfig(),n=t.widthSegments,r=t.heightSegments,i=t.width,o=t.height,a=e,s=a.widthSegments,u=a.heightSegments,l=a.width,c=a.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==l?l:i,height:void 0!==c?c:o})}var h=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(h,this.planeGeometryTriangulation)}},{key:"updateTexture",value:function(t){var n=this,r=this.rendererService.createTexture2D;if(t){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){n.texture=r({data:i,width:i.width,height:i.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE}),n.layerService.reRender()},i.src=t}else this.texture=r({width:0,height:0})}},{key:"getImageData",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width,i=e.height;return t.width=r,t.height=i,n.drawImage(e,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"translateVertex",value:function(e,t,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,l=Math.floor(r),c=Math.floor(i),h=l+1,f=c+1,p=a/l,d=s/c,v=0;v<f;v++)for(var g=Math.floor(v*d)*a,m=0;m<h;m++){var y=4*(g+Math.floor(m*p)),_=u[y],b=u[y+1],x=u[y+2];e[5*(v*h+m)+2]=o(_,b,x)}var S=this.layer.getEncodedData(),E=this.styleAttributeService.createAttributesAndIndices(S,(function(){return{vertices:e,indices:t,size:5}}));this.layer.updateModelData(E),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(e,t){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,o=void 0===i?1:i,a=r.heightSegments,s=void 0===a?1:a,u=r.terrainTexture,l=r.rgb2height,c=void 0===l?function(e,t,n){return e+t+n}:l;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(e,t,this.terrainImage,o,s,c):this.terrainImage.onload=function(){n.translateVertex(e,t,n.terrainImage,o,s,c)};else{var h=new Image;this.terrainImage=h,h.crossOrigin="anonymous",h.onload=function(){n.terrainImageLoaded=!0,setTimeout((function(){return n.layer.emit("terrainImageLoaded",null)})),n.translateVertex(e,t,h,o,s,c)},h.src=u}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),r}(PV);!function(e){e.UP="up",e.DOWN="down"}(CH||(CH={}));var OH,PH={plane:kH,sprite:function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(P(e),"mapTexture",void 0),E(P(e),"positions",void 0),E(P(e),"indices",void 0),E(P(e),"timer",void 0),E(P(e),"spriteTop",void 0),E(P(e),"spriteUpdate",void 0),E(P(e),"spriteAnimate",void 0),E(P(e),"planeGeometryUpdateTriangulation",(function(){for(var t=e.layer.getLayerConfig().spriteBottom,n=void 0===t?-1e5:t,r=e.spriteUpdate,i=n,o=e.spriteTop,a=0;a<e.positions.length;a+=5)e.spriteAnimate===CH.UP?(e.positions[a+2]+=r,e.positions[a+2]>o&&(e.positions[a+2]=i)):(e.positions[a+2]-=r,e.positions[a+2]<i&&(e.positions[a+2]=o));return{vertices:e.positions,indices:e.indices,size:5}})),E(P(e),"updateModel",(function(){var t=e.layer.createAttributes({triangulation:e.planeGeometryUpdateTriangulation});e.layer.models.map((function(e){e.updateAttributes(t)})),e.layerService.throttleRenderLayers(),e.timer=requestAnimationFrame(e.updateModel)})),E(P(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,o=n.spriteCount,a=void 0===o?100:o,s=n.spriteRadius,u=void 0===s?10:s,l=(t=e).initSprite.apply(t,[u,a].concat(F(i))),c=l.indices,h=l.positions;return e.positions=h,e.indices=c,{vertices:h,indices:c,size:5}})),e}return S(r,[{key:"initSprite",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,o=[],a=[],s=this.mapService,u=this.spriteAnimate===CH.UP?-this.spriteTop:this.spriteTop,l=0;l<n;l++){var c=Math.random()*u;a.push.apply(a,F(f(c)))}for(var h=0;h<n;h++)o.push(h);function f(n){var o=t*Math.random(),a=t*Math.random(),u=-t/2+o,l=-t/2+a;if(s.version===e.Version["GAODE2.x"]){var c=D(s.lngLatToCoord([u+r,-l+i]),2);return[c[0],c[1],n,0,0]}return[u+r,-l+i,n,0,0]}return{indices:o,positions:a}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.spriteScale,o=void 0===i?1:i;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_texture:this.texture,u_Scale:o}}},{key:"clearModels",value:function(){var e;cancelAnimationFrame(this.timer),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:function(t){var n=this,r=this.layer.getLayerConfig(),i=r.mapTexture,o=r.spriteTop,a=void 0===o?5e6:o,s=r.spriteUpdate,u=void 0===s?1e4:s,l=r.spriteAnimate,c=void 0===l?CH.DOWN:l;this.mapTexture=i,this.spriteTop=a,this.spriteUpdate=u,this.spriteAnimate="up"===c?CH.UP:CH.DOWN;var h=this.rendererService.createTexture2D;this.texture=h({height:0,width:0}),this.updateTexture(i),setTimeout((function(){n.updateModel()}),100),this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Color;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_Scale;\nvarying vec3 v_Color;\nvarying float v_d;\n#pragma include "projection"\nvoid main() {\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nv_d = a_Position.z;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n}\ngl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\nvarying vec3 v_Color;\nvarying float v_d;\nvoid main() {\nif(v_d < 0.0) {\ndiscard;\n}\nif(u_mapFlag > 0.0) {\ngl_FragColor = texture2D(u_texture, gl_PointCoord);\ngl_FragColor.a *= u_opacity;\n} else {\ngl_FragColor = vec4(v_Color, u_opacity);\n}\n}",triangulation:this.planeGeometryTriangulation,primitive:e.gl.POINTS,depth:{enable:!1},blend:this.getBlend()}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"updateTexture",value:function(t){var n=this,r=this.rendererService.createTexture2D;if(t){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){n.texture=r({data:i,width:i.width,height:i.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE}),n.layerService.reRender()},i.src=t}else this.texture=r({width:0,height:0})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(PV),billboard:MH},LH=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","GeometryLayer"),E(P(e),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new PH[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"getDefaultConfig",value:function(){return{plane:{},sprite:{},billboard:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),n}(hV),IH='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',RH=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\nuniform vec2 u_SceneCenterMKT;\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\nvoid main() {\r\nv_color = a_Color;\r\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\nvec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\nvec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\nvec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\ngl_Position = u_Mvp * (project_pos);\r\n} else {\r\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\nvec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\ngl_Position = project_common_position_to_clipspace(project_pos);\r\n}\r\nsetPickingColor(a_PickingColor);\r\n}',fragmentShader:IH,triangulation:yH,primitive:e.gl.TRIANGLES,depth:{enable:!1},stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),r}(PV),NH=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||1,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform vec2 u_SceneCenterMKT;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\nvec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\nfloat lightWeight = calc_lighting(project_pos);\nv_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\ngl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n} else {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\nfloat lightWeight = calc_lighting(project_pos);\nv_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\ngl_Position = project_common_position_to_clipspace(project_pos);\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:IH,triangulation:sH,primitive:e.gl.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),r}(PV);var DH=NM()(OH=function(t){A(o,t);var n,r,i=I(o);function o(){var e;b(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(P(e=i.call.apply(i,[this].concat(n))),"texture",void 0),E(P(e),"colorTexture",void 0),E(P(e),"heatmapFramerBuffer",void 0),E(P(e),"intensityModel",void 0),E(P(e),"colorModel",void 0),E(P(e),"shapeType",void 0),e}return S(o,[{key:"render",value:function(){var e=this,t=this.rendererService,n=t.clear;(0,t.useFramebuffer)(this.heatmapFramerBuffer,(function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.heatmapFramerBuffer}),e.drawIntensityMode()})),this.layer.styleNeedUpdate&&this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(r=_(g().mark((function t(n){var r,i,o,a,s,u,l,c,h,f;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.rendererService,o=i.createFramebuffer,a=i.getViewportSize,s=i.createTexture2D,u=this.styleAttributeService.getLayerStyleAttribute("shape"),l=(null==u||null===(r=u.scale)||void 0===r?void 0:r.field)||"heatmap",this.shapeType=l,t.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=t.sent,this.colorModel="heatmap"===l?this.buildHeatmapColor():this.build3dHeatMap(),c=a(),h=c.width,f=c.height,this.heatmapFramerBuffer=o({color:s({width:Math.floor(h/4),height:Math.floor(f/4),wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.LINEAR,mag:e.gl.LINEAR}),depth:!1}),this.updateColorTexture(),n([this.intensityModel,this.colorModel]);case 12:case"end":return t.stop()}}),t,this)}))),function(e){return r.apply(this,arguments)})},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:e.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size;return[void 0===t?1:t]}}})}},{key:"buildHeatMapIntensity",value:(n=_(g().mark((function t(){var n;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.triangulation=xH,t.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#define GAUSS_COEF  0.3989422804014327\n#pragma include "projection"\nvoid main(){\nv_weight = a_Size;\nfloat ZERO = 1.0 / 255.0 / 16.0;\nfloat extrude_x = a_Dir.x * 2.0 -1.0;\nfloat extrude_y = a_Dir.y * 2.0 -1.0;\nvec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\nfloat S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\nv_extrude = extrude_dir * S;\nvec2 offset = project_pixel(v_extrude * u_radius);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n}\n}',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\nfloat d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\nfloat val = v_weight * u_intensity * GAUSS_COEF * exp(d);\ngl_FragColor = vec4(val, 1., 1., 1.);\n}",triangulation:xH,depth:{enable:!1},cull:{enable:!0,face:Cx(this.mapService.version)},blend:{enable:!0,func:{srcRGB:e.gl.ONE,srcAlpha:1,dstRGB:e.gl.ONE,dstAlpha:1}}});case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildHeatmapColor",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i;this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nvoid main() {\nv_texCoord = a_Uv;\ngl_Position = vec4(a_Position.xy, 0, 1.);\n}",fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nuniform vec2 u_ViewportSize;\nfloat getBlurIndusty() {\nfloat vW = 2.0/u_ViewportSize.x;\nfloat vH = 2.0/u_ViewportSize.y;\nvec2 vUv = v_texCoord;\nfloat i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\nfloat i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\nfloat i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\nfloat i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\nfloat i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\nfloat i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\nfloat i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\nfloat i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\nfloat i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\nreturn(\ni11 + \ni12 + \ni13 + \ni21 + \ni21 + \ni22 + \ni23 + \ni31 + \ni32 + \ni33\n)/9.0;\n}\nvoid main(){\nfloat intensity = getBlurIndusty();\nvec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\ngl_FragColor =color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var a=this.shaderModuleService.getModule("heatmapColor"),s=a.vs,u=a.fs,l=a.uniforms,c=this.rendererService,h=c.createAttribute,f=c.createElements,p=c.createBuffer;return(0,c.createModel)({vs:s,fs:u,attributes:{a_Position:h({buffer:p({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:e.gl.FLOAT}),size:3}),a_Uv:h({buffer:p({data:[0,1,1,1,0,0,1,0],type:e.gl.FLOAT}),size:2})},uniforms:v({},l),depth:{enable:!1},blend:this.getBlend(),elements:f({data:[0,2,1,2,3,1],type:e.gl.UNSIGNED_INT,count:6}),stencil:Oy(r,o)})}},{key:"drawIntensityMode",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.intensity,i=void 0===r?10:r,o=t.radius,a=void 0===o?5:o;null===(e=this.intensityModel)||void 0===e||e.draw({uniforms:{u_opacity:n||1,u_radius:a,u_intensity:i}})}},{key:"drawColorMode",value:function(){var e,t=this.layer.getLayerConfig().opacity;null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:t||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var e,t=this.layer.getLayerConfig().opacity,n=W_();q_(n,this.cameraService.getViewProjectionMatrixUncentered()),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:t||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:F(n)}})}},{key:"build3dHeatMap",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=(0,this.rendererService.getViewportSize)(),s=function(e,t){for(var n=[],r=[],i=[],o=e+1,a=t+1,s=e/2,u=t/2,l=0;l<a;l++)for(var c=l-u,h=0;h<o;h++){var f=h-s;r.push(f/s,-c/u,0),i.push(h/e),i.push(1-l/t)}for(var p=0;p<t;p++)for(var d=0;d<e;d++){var v=d+o*p,g=d+o*(p+1),m=d+1+o*(p+1),y=d+1+o*p;n.push(v,g,y),n.push(g,m,y)}return{vertices:r,indices:n,uvs:i}}(a.width/4,a.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\nfloat t2 = t * t;\nfloat one_minus_t = 1.0 - t;\nfloat one_minus_t2 = one_minus_t * one_minus_t;\nreturn (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\nreturn toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec2 pos = a_Uv * vec2(2.0) - vec2(1.0);\nvec4 p1 = vec4(pos, 0.0, 1.0);\nvec4 p2 = vec4(pos, 1.0, 1.0);\nvec4 inverseP1 = u_InverseViewProjectionMatrix * p1;\nvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\ninverseP1 = inverseP1 / inverseP1.w;\ninverseP2 = inverseP2 / inverseP2.w;\nfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z);\nvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\nvec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\nfloat fh;\nv_intensity = texture2D(u_texture, v_texCoord).r;\nfh = toBezier(v_intensity, b).y;\ngl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n}',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main(){\nfloat intensity = texture2D(u_texture, v_texCoord).r;\nvec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\ngl_FragColor = color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var u=this.shaderModuleService.getModule("heatmap3dColor"),l=u.vs,c=u.fs,h=u.uniforms,f=this.rendererService,p=f.createAttribute,d=f.createElements,g=f.createBuffer;return(0,f.createModel)({vs:l,fs:c,attributes:{a_Position:p({buffer:g({data:s.vertices,type:e.gl.FLOAT}),size:3}),a_Uv:p({buffer:g({data:s.uvs,type:e.gl.FLOAT}),size:2})},primitive:e.gl.TRIANGLES,uniforms:v({},h),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:e.gl.SRC_ALPHA,srcAlpha:1,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:d({data:s.indices,type:e.gl.UNSIGNED_INT,count:s.indices.length}),stencil:Oy(r,o)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var n=wy(this.layer.getLayerConfig().rampColors);this.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.NEAREST,mag:e.gl.NEAREST,flipY:!1})}}]),o}(PV))||OH,FH={heatmap:DH,heatmap3d:DH,grid:RH,grid3d:NH,hexagon:function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform vec2 u_SceneCenterMKT;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\nvec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\ngl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:IH,triangulation:yH,depth:{enable:!1},primitive:e.gl.TRIANGLES,blend:this.getBlend(),stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),r}(PV)},BH=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","HeatMapLayer"),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new FH[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"renderModels",value:function(){var e=this;return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels((function(t){return e.models=t})),this.layerModelNeedUpdate=!1),this.models.forEach((function(t){return t.draw({uniforms:e.layerModel.getUninforms()})})),this)}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn("data error")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),n}(hV),zH="precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_texCoord;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nuniform float u_pixelConstant;\nuniform float u_pixelConstantR;\nuniform float u_pixelConstantG;\nuniform float u_pixelConstantB;\nuniform float u_pixelConstantRGB;\nvoid main() {\nvec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));\nfloat r = baseColor.r;\nfloat g = baseColor.g;\nfloat b = baseColor.b;\nfloat value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);\nif (value == u_noDataValue) {\ngl_FragColor = vec4(0.0, 0, 0, 0.0);\n} else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\ngl_FragColor = vec4(0, 0, 0, 0);\n} else {\nfloat normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);\nvec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));\ngl_FragColor = color;\ngl_FragColor.a =  gl_FragColor.a * u_opacity ;\n}\n}",jH='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',UH=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(P(e),"colorTexture",void 0),E(P(e),"rampColors",void 0),e}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.clampLow,r=void 0===n||n,i=e.clampHigh,o=void 0===i||i,a=e.noDataValue,s=void 0===a?-9999999:a,u=e.domain,l=void 0===u?[0,1]:u,c=e.rampColors,h=e.pixelConstant,f=void 0===h?0:h,p=e.pixelConstantR,d=void 0===p?65536:p,v=e.pixelConstantG,g=void 0===v?256:v,m=e.pixelConstantB,y=void 0===m?1:m,_=e.pixelConstantRGB,b=void 0===_?.1:_;return OV(this.rampColors,c)||(this.updateColorTexture(),this.rampColors=c),{u_opacity:t||1,u_texture:this.texture,u_pixelConstant:f,u_pixelConstantR:d,u_pixelConstantG:g,u_pixelConstantB:y,u_pixelConstantRGB:b,u_domain:l,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_noDataValue:s,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(t){var n=this,r=this.layer.getLayerConfig(),i=r.mask,o=void 0!==i&&i,a=r.maskInside,s=void 0===a||a,u=r.rampColorsData,l=r.rampColors,c=this.layer.getSource(),h=this.rendererService.createTexture2D;this.texture=h({height:0,width:0}),c.data.images.then((function(e){n.texture=h({data:e[0],width:e[0].width,height:e[0].height}),n.layerService.reRender()}));var f=u||wy(l);this.colorTexture=h({data:f.data,width:f.width,height:f.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:jH,fragmentShader:zH,triangulation:_H,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(o,s)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D,t=wy(this.layer.getLayerConfig().rampColors);this.colorTexture=e({data:t.data,width:t.width,height:t.height,flipY:!1})}}]),r}(PV),VH={image:function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return S(r,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:function(t){var n=this,r=this.layer.getLayerConfig(),i=r.mask,o=void 0!==i&&i,a=r.maskInside,s=void 0===a||a,u=this.layer.getSource(),l=this.rendererService.createTexture2D;if(this.texture=l({height:0,width:0}),Yv){var c=this.layerService.sceneService.getSceneConfig().canvas.createImage();c.crossOrigin="anonymous",c.src=u.data.originData,c.onload=function(){n.texture=l({data:c,width:c.width,height:c.height}),n.layerService.reRender()}}else u.data.images.then((function(t){n.texture=l({data:t[0],width:t[0].width,height:t[0].height,mag:e.gl.LINEAR,min:e.gl.LINEAR}),n.layerService.reRender()}));this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:jH,fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ngl_FragColor = color;\ngl_FragColor.a *= u_opacity;\n}",triangulation:_H,primitive:e.gl.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:Oy(o,s)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),r}(PV),dataImage:UH,tileDataImage:function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return S(r,[{key:"getUninforms",value:function(){var e=this.rendererService.createTexture2D,t=this.layer.getLayerConfig(),n=t.opacity,r=t.clampLow,i=void 0===r||r,o=t.clampHigh,a=void 0===o||o,s=t.noDataValue,u=void 0===s?-9999999:s,l=t.domain,c=void 0===l?[0,1]:l,h=t.colorTexture,f=void 0===h?e({height:0,width:0}):h,p=t.pixelConstant,d=void 0===p?0:p,v=t.pixelConstantR,g=void 0===v?65536:v,m=t.pixelConstantG,y=void 0===m?256:m,_=t.pixelConstantB,b=void 0===_?1:_,x=t.pixelConstantRGB,S=void 0===x?.1:x;return{u_opacity:n||1,u_texture:this.texture,u_pixelConstant:d,u_pixelConstantR:g,u_pixelConstantG:y,u_pixelConstantB:b,u_pixelConstantRGB:S,u_domain:c,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:f}}},{key:"initModels",value:function(t){var n=this,r=this.layer.getLayerConfig(),i=r.mask,o=void 0!==i&&i,a=r.maskInside,s=void 0===a||a,u=this.layer.getSource(),l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0}),u.data.images.then((function(e){n.texture=l({data:e[0],width:e[0].width,height:e[0].height}),n.layerService.reRender()})),this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:jH,fragmentShader:zH,triangulation:_H,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(o,s)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),r}(PV)},HH=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","ImageLayer"),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new VH[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"getDefaultConfig",value:function(){return{image:{},dataImage:{},tileDataImage:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"dataImage"===n?"dataImage":"image"===n?"image":"tileDataImage"===n?"tileDataImage":"image"}}]),n}(hV);function GH(e,t,n){e.map((function(e){"mask"===t?e.style({mask:n}):e.updateLayerConfig(E({},t,n))}))}function WH(e,t,n,r){if(Array.isArray(r))e[n].apply(e,F(r));else if("string"!=typeof r){var i=function(e,t,n){switch(n){case"size":return 1;case"color":return"#fff";case"shape":return function(e,t){var n,r=t.getAttribute("shape");if(r&&null!==(n=r.scale)&&void 0!==n&&n.field){var i;return"text"===(null===(i=r.scale)||void 0===i?void 0:i.values)?[r.scale.field,r.scale.values]:r.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}(t,e);default:return""}}(e,t.type,n);if(!r)return e[n](i),e;var o=function(e,t){if("shape"===t)return"string"==typeof e?[e]:null!=e&&e.field?[null==e?void 0:e.field]:[];var n=e,r=n.field,i=n.values,o=n.callback;if(r&&i&&Array.isArray(i))return[r,i];if(r&&o)return[r,o];if(r)return[r];return[]}(r,n);0===o.length?e[n](i):e[n].apply(e,F(o))}else e[n](r)}var YH=["mvt","geojsonvt","testTile"];function XH(e){return YH.indexOf(e)>=0}function ZH(e,t){t.map((function(t){var n=vF(e.sceneContainer);t.setContainer(n,e.sceneContainer),t.init()}))}function qH(e,t){var n,r,i=t.getAttribute("shape");if(i&&null!==(n=i.scale)&&void 0!==n&&n.field)return"text"===(null===(r=i.scale)||void 0===r?void 0:r.values)?[i.scale.field,i.scale.values]:i.scale.field;switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function KH(e,t){switch(e){case"PolygonLayer":case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":default:return t}}function QH(e){return e.layerIDList.length===e.loadedLayers}function $H(e,t){var n=window.setInterval((function(){var r=QH(e),i=function(e){var t=e.children;return t.filter((function(e){return QH(e)})).length===t.length}(e),o=function(e){var t=e.parent;return!t||QH(t)}(e);r&&i&&o&&(t(),window.clearInterval(n))}),36)}function JH(e,t,n){if(0!==t.length)return function(e){var t=!0;return e.map((function(e){"PointLayer"!==e.type&&(t=!1)})),t}(t)?(GH(t,"visible",e.isVisible),void n.reRender()):void function(e,t){e.isVisible?t():$H(e,(function(){t()}))}(e,(function(){GH(t,"visible",e.isVisible),n.reRender()}))}var eG='uniform float u_opacity : 1.0;\nvarying vec4 v_color;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',tG="uniform float u_opacity : 1.0;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor = u_color;\ngl_FragColor.a *= u_opacity;\n}",nG=function(t){A(i,t);var n,r=I(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.usage,i=e.color,o=void 0===i?"#fff":i,a=e.size,s=void 0===a?1:a;return{u_opacity:Number(n),u_color:"basemap"===r?Ay(o):[0,0,0,0],u_size:"basemap"===r?s:1}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:(n=_(g().mark((function e(t){var n,r,i,o,a,s,u,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=n.depth,u=void 0!==s&&s,l=n.usage,this.layer.triangulation=lH,this.layer.buildLayerModel({moduleName:"lineTile_"+l,vertexShader:"basemap"===l?'attribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_size;\n#pragma include "projection"\nvoid main() {\nvec3 size = a_Miter * u_size * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n}\n}':'attribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nvoid main() {\nv_color = a_Color;\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:"basemap"===l?tG:eG,triangulation:lH,blend:this.getBlend(),depth:{enable:u},stencil:Oy(i,a),pick:"basemap"!==l}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){"basemap"!==this.layer.getLayerConfig().usage&&this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}})}}]),i}(PV),rG=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.usage,i=e.color,o=void 0===i?"#fff":i;return{u_opacity:XF(n)?n:1,u_color:"basemap"===r?Ay(o):[0,0,0,0]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=n.usage;this.layer.buildLayerModel({moduleName:"lineTileSimpleNormal_"+s,vertexShader:"basemap"===s?'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#pragma include "projection"\nvoid main() {\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n}':'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#pragma include "projection"\nvarying vec4 v_color;\nvoid main() {\nv_color = a_Color; \nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n}',fragmentShader:tG,triangulation:hH,primitive:e.gl.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(i,a),pick:!1}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(PV),iG=function(){function e(t,n,r){b(this,e),E(this,"boxCells",[]),E(this,"xCellCount",void 0),E(this,"yCellCount",void 0),E(this,"boxKeys",void 0),E(this,"bboxes",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"xScale",void 0),E(this,"yScale",void 0),E(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return S(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(e,t,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l){var c,h=this.bboxes,f=j(l);try{for(f.s();!(c=f.n()).done;){var p=c.value;if(!u.box[p]){u.box[p]=!0;var d=4*p;if(e<=h[d+2]&&t<=h[d+3]&&n>=h[d+0]&&r>=h[d+1]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}}catch(e){f.e(e)}finally{f.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(e),l=this.convertToYCellCoord(t),c=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),f=u;f<=c;f++)for(var p=l;p<=h;p++){var d=this.xCellCount*p+f;if(i.call(this,e,t,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}(),oG=function(){function e(t,n){b(this,e),E(this,"width",void 0),E(this,"height",void 0),E(this,"grid",void 0),E(this,"viewportPadding",100),E(this,"screenRightBoundary",void 0),E(this,"screenBottomBoundary",void 0),E(this,"gridRightBoundary",void 0),E(this,"gridBottomBoundary",void 0),this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new iG(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return S(e,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=Vb(t,n,0,1),i=Ub();return Hb(i,r,X_.apply(db,F(e))),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),e}();function aG(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function sG(e,t,n,r,i){if(i){var o=e[r],a=o.glyph;if(a)for(var s=t[a].advance*o.scale,u=(e[r].x+s)*i,l=n;l<=r;l++)e[l].x-=u}}function uG(e,t,n,r,i,o,a){var s,u=(t-n)*i,l=(-r*a+.5)*o,c=j(e);try{for(c.s();!(s=c.n()).done;){var h=s.value;h.x+=u,h.y+=l}}catch(e){c.e(e)}finally{c.f()}}function lG(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=c.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(c.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),c.length!==f){var n=s-a;l=Math.max(n,l),sG(c,t,f,c.length-1,h)}s=0,u-=r+5}));var p=aG(i),d=p.horizontalAlign,v=p.verticalAlign;uG(c,h,d,v,l,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*l,e.right=e.left+l}function cG(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=c.length;n.forEach((function(e){var n=t[e];if(n&&(c.push({glyph:e,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),c.length!==f){var i=s-a;l=Math.max(i,l),sG(c,t,f,c.length-1,h)}s=0,u-=r+5}));var p=aG(i),d=p.horizontalAlign,v=p.verticalAlign;uG(c,h,d,v,l,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*l,e.right=e.left+l}function hG(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),l=[],c={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return s?cG(c,t,u,n,r,i,o):lG(c,t,u,n,r,i,o),!!l.length&&c}function fG(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=void 0===i?[]:i,a=[],s=j(o);try{for(s.s();!(t=s.n()).done;){var u=t.value,l=u.metrics,c=4,h=l.advance*u.scale/2,f=r?[u.x+h,u.y]:[0,0],p=r?[0,0]:[u.x+h+n[0],u.y+n[1]],d=(0-c)*u.scale-h+p[0],v=(0-c)*u.scale+p[1],g=d+l.width*u.scale,m=v+l.height*u.scale,y={x:d,y:v},_={x:g,y:v},b={x:d,y:m},x={x:g,y:m};a.push({tl:y,tr:_,bl:b,br:x,tex:l,glyphOffset:f})}}catch(e){s.e(e)}finally{s.f()}return a}var pG='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n#pragma include "picking"\nvoid main() {\nfloat dist = texture2D(u_sdf_map, v_uv).a;\nlowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\nhighp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\nhighp float gamma_scaled = gamma * v_gamma_scale;\nhighp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));\ngl_FragColor.a= gl_FragColor.a * alpha;\ngl_FragColor = filterColor(gl_FragColor);\n}',dG='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying float v_fontScale;\nuniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nv_uv = a_tex / u_sdf_map_size;\nfloat fontScale = a_Size / FONT_SIZE;\nv_fontScale = fontScale;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nvec4 projected_position;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nprojected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));\n} else {\nprojected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\ngl_Position = vec4(\nprojected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\nv_gamma_scale = gl_Position.w;\nsetPickingColor(a_PickingColor);\n}',vG="#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\nuniform vec4 u_color;\nvoid main() {\nfloat dist = texture2D(u_sdf_map, v_uv).a;\nlowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\nhighp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\nhighp float gamma_scaled = gamma * v_gamma_scale;\nhighp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\ngl_FragColor = mix(vec4(u_color.rgb, u_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));\ngl_FragColor.a= gl_FragColor.a * alpha;\n}",gG='#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_size;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n#pragma include "projection"\nvoid main() {\nv_uv = a_tex / u_sdf_map_size;\nfloat fontScale = u_size / FONT_SIZE;\nv_fontScale = fontScale;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nvec4 projected_position;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nprojected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));\n} else {\nprojected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\ngl_Position = vec4(\nprojected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\nv_gamma_scale = gl_Position.w;\n}';function mG(e){var t=e.id,n=[],r=[];if(!this.glyphInfoMap||!this.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var i=this.glyphInfoMap[t].centroid,o=2===i.length?[i[0],i[1],0]:i;return this.glyphInfoMap[t].glyphQuads.forEach((function(e,t){n.push.apply(n,F(o).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],F(o),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],F(o),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],F(o),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),r.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:n,indices:r,size:7}}var yG=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"glyphInfo",void 0),E(P(e),"glyphInfoMap",{}),E(P(e),"texture",void 0),E(P(e),"currentZoom",-1),E(P(e),"extent",void 0),E(P(e),"textureHeight",0),E(P(e),"textCount",0),E(P(e),"preTextStyle",{}),E(P(e),"buildModels",function(){var t=_(g().mark((function t(n){var r,i;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.mapping(),r=e.layer.getLayerConfig(),i=r.usage,e.layer.buildLayerModel({moduleName:"pointTileText_"+i,vertexShader:"basemap"===i?gG:dG,fragmentShader:"basemap"===i?vG:pG,triangulation:mG.bind(P(e)),depth:{enable:!1},blend:e.getBlend(),pick:"basemap"!==i}).then((function(e){n([e])})).catch((function(e){console.warn(e),n([])}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),E(P(e),"mapping",(function(){e.initGlyph(),e.updateTexture(),e.filterGlyphs(),e.reBuildModel()})),e}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.stroke,i=void 0===r?"#fff":r,o=e.strokeWidth,a=void 0===o?0:o,s=e.textAnchor,u=void 0===s?"center":s,l=e.textAllowOverlap,c=void 0!==l&&l,h=e.halo,f=void 0===h?.5:h,p=e.gamma,d=void 0===p?2:p,v=e.usage,g=e.color,m=void 0===g?"#fff":g,y=e.size,_=void 0===y?1:y,b=this.fontService,x=b.canvas,S=b.mapping;return Object.keys(S).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(S).length),this.preTextStyle={textAnchor:u,textAllowOverlap:c},{u_opacity:XF(n)?n:1,u_stroke_width:XF(a)?a:1,u_stroke_color:this.getStrokeColor(i),u_sdf_map:this.texture,u_halo_blur:f,u_gamma_scale:d,u_sdf_map_size:[x.width,x.height],u_color:"basemap"===v?Ay(m):[0,0,0,0],u_size:"basemap"===v?_:1}}},{key:"initModels",value:function(e){this.extent=this.textExtent();var t=this.layer.getLayerConfig(),n=t.textAnchor,r=void 0===n?"center":n,i=t.textAllowOverlap,o=void 0===i||i;this.preTextStyle={textAnchor:r,textAllowOverlap:o},this.buildModels(e)}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().usage;this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:e.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[5],n[6]]}}}),"basemap"!==t&&this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?12:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:e.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"textExtent",value:function(){return Im(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(e){var t,n=e.shape,r=void 0===n?"":n,i=j(r=r.toString());try{for(i.s();!(t=i.n()).done;){var o=t.value;-1===a.indexOf(o)&&a.push(o)}}catch(e){i.e(e)}finally{i.f()}})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!1})}},{key:"generateGlyphLayout",value:function(){var e=this,t=this.fontService.mapping,n=this.layer.getLayerConfig(),r=n.spacing,i=void 0===r?2:r,o=n.textAnchor,a=void 0===o?"center":o,s=this.layer.getEncodedData();this.glyphInfo=s.map((function(n){var r=n.shape,o=void 0===r?"":r,s=n.id,u=n.size,l=void 0===u?1:u,c=n.textOffset,h=void 0===c?[0,0]:c,f=hG(o.toString(),t,l,a,"left",i,h,!1),p=fG(f,h,!1);return n.shaping=f,n.glyphQuads=p,n.centroid=jm(n.coordinates),n.originCentroid="GAODE2.x"===n.version?jm(n.originCoordinates):n.originCentroid=n.centroid,e.glyphInfoMap[s]={shaping:f,glyphQuads:p,centroid:jm(n.coordinates)},n}))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[4,4]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new oG(a,s);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a="GAODE2.x"===t.version?t.originCentroid:t.centroid,s=t.size/24,l=e.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length)&&(u.insertCollisionBox(c,o),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){this.initTextFont(),this.generateGlyphLayout()}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,n=this.fontService.canvas;this.textureHeight=n.height,this.texture&&this.texture.destroy(),this.texture=t({data:n,mag:e.gl.LINEAR,min:e.gl.LINEAR,width:n.width,height:n.height})}},{key:"reBuildModel",value:function(){var e=this,t=this.layer.getLayerConfig().usage;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText_"+t,vertexShader:"basemap"===t?gG:dG,fragmentShader:"basemap"===t?vG:pG,triangulation:mG.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:"basemap"!==t}).then((function(t){e.layer.models=[t],e.layerService.throttleRenderLayers()})).catch((function(t){console.warn(t),e.layer.models=[]}))}}]),r}(PV),_G=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.strokeOpacity,i=void 0===r?1:r,o=e.strokeWidth,a=void 0===o?0:o,s=e.stroke,u=void 0===s?"rgba(0,0,0,0)":s;return{u_additive:"additive"===e.blend?1:0,u_opacity:Number(n),u_stroke_opacity:Number(i),u_stroke_width:Number(a),u_stroke_color:this.getStrokeColor(u)}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),oH)}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.workerEnabled,r=void 0!==n&&n,i=t.usage;this.layer.triangulation=oH,this.layer.buildLayerModel({moduleName:"pointTile_"+i,vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nfloat shape_type = a_Shape;\nfloat newSize = setPickingSize(a_Size);\nv_color = a_Color;\nv_radius = newSize;\nfloat antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, 0.0);\nvec2 offset = (extrude.xy * (newSize + u_stroke_width));\noffset = project_pixel(offset);\nv_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_additive;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nint shape = int(floor(v_data.w + 0.5));\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius + u_stroke_width);\nfloat outer_df;\nfloat inner_df;\nif (shape == 0) {\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\n} else if (shape == 1) {\nouter_df = sdEquilateralTriangle(1.1 * v_data.xy);\ninner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n} else if (shape == 2) {\nouter_df = sdBox(v_data.xy, vec2(1.));\ninner_df = sdBox(v_data.xy, vec2(r));\n} else if (shape == 3) {\nouter_df = sdPentagon(v_data.xy, 0.8);\ninner_df = sdPentagon(v_data.xy, r * 0.8);\n} else if (shape == 4) {\nouter_df = sdHexagon(v_data.xy, 0.8);\ninner_df = sdHexagon(v_data.xy, r * 0.8);\n} else if (shape == 5) {\nouter_df = sdOctogon(v_data.xy, 1.0);\ninner_df = sdOctogon(v_data.xy, r);\n} else if (shape == 6) {\nouter_df = sdHexagram(v_data.xy, 0.52);\ninner_df = sdHexagram(v_data.xy, r * 0.52);\n} else if (shape == 7) {\nouter_df = sdRhombus(v_data.xy, vec2(1.0));\ninner_df = sdRhombus(v_data.xy, vec2(r));\n} else if (shape == 8) {\nouter_df = sdVesica(v_data.xy, 1.1, 0.8);\ninner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n}\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\nfloat color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiasblur,\n0.0,\ninner_df\n);\nif(u_stroke_width < 0.01) {\ngl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n} else {\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);\n}\nif(u_additive > 0.0) {\ngl_FragColor *= opacity_t;\ngl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n} else {\ngl_FragColor.a *= opacity_t;\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:oH,depth:{enable:!1},cull:{enable:!0,face:Cx(this.mapService.version)},blend:this.getBlend(),workerEnabled:r,workerOptions:{modelType:"pointTile"},pick:"basemap"!==i}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:e.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n;return[t.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),r}(PV),bG=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.usage,i=e.color;return{u_opacity:n,u_color:"basemap"===r?Ay(void 0===i?"#fff":i):[0,0,0,0]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=t.usage;this.layer.triangulation=dH,this.layer.buildLayerModel({moduleName:"polygonTile_"+a,vertexShader:"basemap"===a?'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#pragma include "projection"\nvoid main() {\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n}':'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:"basemap"===a?tG:eG,triangulation:dH,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(r,o),pick:"basemap"!==a}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){}}]),n}(PV),xG=function(t){A(i,t);var n,r=I(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?0:t,r=e.color,i=void 0===r?"#000":r;return{u_opacity:XF(n)?n:0,u_color:Ay(i)}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:(n=_(g().mark((function t(n){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#pragma include "projection"\nvoid main() {\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n}',fragmentShader:tG,triangulation:dH,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:e.gl.ALWAYS,ref:1,mask:255},opFront:{fail:e.gl.REPLACE,zfail:e.gl.REPLACE,zpass:e.gl.REPLACE}},pick:!1}).then((function(e){n([e])})).catch((function(e){console.warn(e),n([])}));case 1:case"end":return t.stop()}}),t,this)}))),function(e){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),i}(PV),SG=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"needListen",!0),E(P(e),"isVector",!0),E(P(e),"isTileLayer",!0),E(P(e),"type",e.layerType||"vectorLayer"),E(P(e),"pickedID",null),E(P(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0,e.reRender()})),e}return S(n,[{key:"init",value:function(){var e=this,t=this.container.get(Hk.SceneID);this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,"PointLayer"===this.type&&(this.iconService=this.container.get(Hk.IIconService),this.fontService=this.container.get(Hk.IFontService)),this.rendererService=this.container.get(Hk.IRendererService),this.layerService=this.container.get(Hk.ILayerService),this.mapService=this.container.get(Hk.IMapService),this.cameraService=this.container.get(Hk.ICameraService),this.coordinateService=this.container.get(Hk.ICoordinateSystemService),this.shaderModuleService=this.container.get(Hk.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Hk.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Hk.IFactoryNormalPass),this.styleAttributeService=this.container.get(Hk.IStyleAttributeService),this.pendingStyleAttributes.forEach((function(t){var n=t.attributeName,r=t.attributeField,i=t.attributeValues,o=t.updateOptions;e.styleAttributeService.updateStyleAttribute(n,{scale:v({field:r},e.splitValuesAndCallbackInAttribute(i,e.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Hk.ILayerPlugin);var n,r=j(this.plugins);try{for(r.s();!(n=r.n()).done;){n.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(e){r.e(e)}finally{r.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"renderModels",value:function(e){var t=this;return this.models.forEach((function(n){n.draw({uniforms:t.layerModel.getUninforms()},e)})),this}},{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new t(this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return bG;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();case"MaskLayer":return xG;default:return _G}}},{key:"getLineModel",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape");switch(null==t||null===(e=t.scale)||void 0===e?void 0:e.field){case"tileline":case"line":return nG;case"simple":return rG;default:return nG}}},{key:"getPointModel",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig().shape2d,n=e.find((function(e){return e.hasOwnProperty("shape")}));if(n){var r=n.shape;return-1!==(null==t?void 0:t.indexOf(r))?_G:yG}return _G}},{key:"getDefaultConfig",value:function(){return{}}}]),n}(hV),EG=W((function(e,t){e.exports=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}
/**
     * splaytree v3.1.0
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */var r=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function i(e,t){return e>t?1:e<t?-1:0}function o(e,t,n){for(var i=new r(null,null),o=i,a=i;;){var s=n(e,t.key);if(s<0){if(null===t.left)break;if(n(e,t.left.key)<0){var u=t.left;if(t.left=u.right,u.right=t,null===(t=u).left)break}a.left=t,a=t,t=t.left}else{if(!(s>0))break;if(null===t.right)break;if(n(e,t.right.key)>0&&(u=t.right,t.right=u.left,u.left=t,null===(t=u).right))break;o.right=t,o=t,t=t.right}}return o.right=t.left,a.left=t.right,t.left=i.right,t.right=i.left,t}function a(e,t,n,i){var a=new r(e,t);if(null===n)return a.left=a.right=null,a;var s=i(e,(n=o(e,n,i)).key);return s<0?(a.left=n.left,a.right=n,n.left=null):s>=0&&(a.right=n.right,a.left=n,n.right=null),a}function s(e,t,n){var r=null,i=null;if(t){var a=n((t=o(e,t,n)).key,e);0===a?(r=t.left,i=t.right):a<0?(i=t.right,t.right=null,r=t):(r=t.left,t.left=null,i=t)}return{left:r,right:i}}var u=function(){function e(e){void 0===e&&(e=i),this._root=null,this._size=0,this._comparator=e}return e.prototype.insert=function(e,t){return this._size++,this._root=a(e,t,this._root,this._comparator)},e.prototype.add=function(e,t){var n=new r(e,t);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,a=o(e,this._root,i),s=i(e,a.key);return 0===s?this._root=a:(s<0?(n.left=a.left,n.right=a,a.left=null):s>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},e.prototype._remove=function(e,t,n){var r;return null===t?null:0===n(e,(t=o(e,t,n)).key)?(null===t.left?r=t.right:(r=o(e,t.left,n)).right=t.right,this._size--,r):t},e.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=o(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},e.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},e.prototype.find=function(e){return this._root&&(this._root=o(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},e.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},e.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},e.prototype.range=function(e,t,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,t)>0)break;if(o(a.key,e)>=0&&n.call(r,a))return this;a=a.right}return this},e.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},e.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},e.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},e.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},e.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},e.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return function(e){for(var t=e,n=[],i=!1,o=new r(null,null),a=o;!i;)t?(n.push(t),t=t.left):n.length>0?t=(t=a=a.next=n.pop()).right:i=!0;return a.next=null,o.next}(this._root)},e.prototype.load=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=!1);var i=e.length,o=this._comparator;if(n&&function e(t,n,r,i,o){if(!(r>=i)){for(var a=t[r+i>>1],s=r-1,u=i+1;;){do{s++}while(o(t[s],a)<0);do{u--}while(o(t[u],a)>0);if(s>=u)break;var l=t[s];t[s]=t[u],t[u]=l,l=n[s],n[s]=n[u],n[u]=l}e(t,n,r,u,o),e(t,n,u+1,i,o)}}(e,t,0,i-1,o),null===this._root)this._root=function e(t,n,i,o){var a=o-i;if(a>0){var s=i+Math.floor(a/2),u=t[s],l=n[s],c=new r(u,l);return c.left=e(t,n,i,s),c.right=e(t,n,s+1,o),c}return null}(e,t,0,i),this._size=i;else{var a=function(e,t,n){for(var i=new r(null,null),o=i,a=e,s=t;null!==a&&null!==s;)n(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}(this.toList(),function(e,t){for(var n=new r(null,null),i=n,o=0;o<e.length;o++)i=i.next=new r(e[o],t[o]);return i.next=null,n.next}(e,t),o);i=this._size+i,this._root=function e(t,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),a=e(t,n,o),s=t.head;return s.left=a,t.head=t.head.next,s.right=e(t,o+1,r),s}return null}({head:a},0,i)}return this},e.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return function e(t,n,r,i,o){if(t){i(n+(r?"└── ":"├── ")+o(t)+"\n");var a=n+(r?"    ":"│   ");t.left&&e(t.left,a,!1,i,o),t.right&&e(t.right,a,!0,i,o)}}(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},e.prototype.update=function(e,t,n){var r=this._comparator,i=s(e,this._root,r),u=i.left,l=i.right;r(e,t)<0?l=a(t,n,l,r):u=a(t,n,u,r),this._root=function(e,t,n){return null===t?e:(null===e||((t=o(e.key,t,n)).left=e),t)}(u,l,r)},e.prototype.split=function(e){return s(e,this._root,this._comparator)},e}(),l=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},c=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},h=Number.EPSILON;void 0===h&&(h=Math.pow(2,-52));var f=h*h,p=function(e,t){if(-h<e&&e<h&&-h<t&&t<h)return 0;var n=e-t;return n*n<f*e*t?0:e<t?-1:1},d=function(){function t(){e(this,t),this.reset()}return n(t,[{key:"reset",value:function(){this.xRounder=new v,this.yRounder=new v}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),t}(),v=function(){function t(){e(this,t),this.tree=new u,this.round(0)}return n(t,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===p(t.key,n.key))return this.tree.remove(e),n.key;var r=this.tree.next(t);return null!==r&&0===p(t.key,r.key)?(this.tree.remove(e),r.key):e}}]),t}(),g=new d,m=function(e,t){return e.x*t.y-e.y*t.x},y=function(e,t){return e.x*t.x+e.y*t.y},_=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},o=m(r,i);return p(o,0)},b=function(e){return Math.sqrt(y(e,e))},x=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return y(i,r)/b(i)/b(r)},S=function(e,t,n){return 0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},E=function(e,t,n){return 0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},A=function(){function t(n,r){e(this,t),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r}return n(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:T.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),n(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,r=t.length;n<r;n++){var i=t[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(void 0===n.segment.consumedBy)for(var r=t+1;r<e;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,r=function(r){var i,o,a,s,u,l=r.otherSE;n.set(r,{sine:(i=t.point,o=e.point,a=l.point,s={x:o.x-i.x,y:o.y-i.y},u={x:a.x-i.x,y:a.y-i.y},m(u,s)/b(u)/b(s)),cosine:x(t.point,e.point,l.point)})};return function(e,t){n.has(e)||r(e),n.has(t)||r(t);var i=n.get(e),o=i.sine,a=i.cosine,s=n.get(t),u=s.sine,l=s.cosine;return o>=0&&u>=0?a<l?1:a>l?-1:0:o<0&&u<0?a<l?-1:a>l?1:0:u<o?-1:u>o?1:0}}}]),t}(),C=0,T=function(){function t(n,r,i,o){e(this,t),this.id=++C,this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.rings=i,this.windings=o}return n(t,null,[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,o=t.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=e.leftSE.point.y,s=t.leftSE.point.y,u=e.rightSE.point.y,l=t.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;var c=e.comparePoint(t.leftSE.point);if(c<0)return 1;if(c>0)return-1;var h=t.comparePoint(e.rightSE.point);return 0!==h?h:-1}if(n>r){if(a<s&&a<l)return-1;if(a>s&&a>l)return 1;var f=t.comparePoint(e.leftSE.point);if(0!==f)return f;var p=e.comparePoint(t.rightSE.point);return p<0?1:p>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var d=t.comparePoint(e.rightSE.point);if(0!==d)return d}if(i>o){var v=e.comparePoint(t.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(i!==o){var g=u-a,m=i-n,y=l-s,_=o-r;if(g>m&&y<_)return 1;if(g<m&&y>_)return-1}return i>o?1:i<o||u<l?-1:u>l?1:e.id<t.id?-1:e.id>t.id?1:0}}]),n(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var i=(e.y-t.y)/r.y,o=t.x+i*r.x;if(e.x===o)return 0;var a=(e.x-t.x)/r.x,s=t.y+a*r.y;return e.y===s?0:e.y<s?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),r=c(t,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,s=e.rightSE.point,u=l(t,a)&&0===this.comparePoint(a),h=l(n,i)&&0===e.comparePoint(i),f=l(t,s)&&0===this.comparePoint(s),p=l(n,o)&&0===e.comparePoint(o);if(h&&u)return p&&!f?o:!p&&f?s:null;if(h)return f&&i.x===s.x&&i.y===s.y?null:i;if(u)return p&&o.x===a.x&&o.y===a.y?null:a;if(p&&f)return null;if(p)return o;if(f)return s;var d=function(e,t,n,r){if(0===t.x)return E(n,r,e.x);if(0===r.x)return E(e,t,n.x);if(0===t.y)return S(n,r,e.y);if(0===r.y)return S(e,t,n.y);var i=m(t,r);if(0==i)return null;var o={x:n.x-e.x,y:n.y-e.y},a=m(o,t)/i,s=m(o,r)/i;return{x:(e.x+s*t.x+(n.x+a*r.x))/2,y:(e.y+s*t.y+(n.y+a*r.y))/2}}(i,this.vector(),a,e.vector());return null===d?null:l(r,d)?g.round(d.x,d.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new A(e,!0),o=new A(e,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new t(i,a,this.rings.slice(),this.windings.slice());return A.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),A.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,u=r.rings.length;s<u;s++){var l=r.rings[s],c=r.windings[s],h=n.rings.indexOf(l);-1===h?(n.rings.push(l),n.windings.push(c)):n.windings[h]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],u=t.indexOf(a);-1===u?(t.push(a),n.push(s)):n[u]+=s}for(var l=[],c=[],h=0,f=t.length;h<f;h++)if(0!==n[h]){var p=t[h],d=p.poly;if(-1===c.indexOf(d))if(p.isExterior)l.push(d);else{-1===c.indexOf(d)&&c.push(d);var v=l.indexOf(p.poly);-1!==v&&l.splice(v,1)}}for(var g=0,m=l.length;g<m;g++){var y=l[g].multiPoly;-1===r.indexOf(y)&&r.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(D.type){case"union":var n=0===e.length,r=0===t.length;this._isInResult=n!==r;break;case"intersection":var i,o;e.length<t.length?(i=e.length,o=t.length):(i=t.length,o=e.length),this._isInResult=o===D.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(e.length-t.length);this._isInResult=a%2==1;break;case"difference":var s=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=s(e)!==s(t);break;default:throw new Error("Unrecognized operation type found ".concat(D.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,a,s=A.comparePoints(e,n);if(s<0)i=e,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,o=e,a=-1}return new t(new A(i,!0),new A(o,!1),[r],[a])}}]),t}(),w=function(){function t(n,r,i){if(e(this,t),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!=typeof n[0][0]||"number"!=typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=g.round(n[0][0],n[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var a=o,s=1,u=n.length;s<u;s++){if("number"!=typeof n[s][0]||"number"!=typeof n[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=g.round(n[s][0],n[s][1]);l.x===a.x&&l.y===a.y||(this.segments.push(T.fromRing(a,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),a=l)}o.x===a.x&&o.y===a.y||this.segments.push(T.fromRing(a,o,this))}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}]),t}(),M=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new w(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,o=n.length;i<o;i++){var a=new w(n[i],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var r=this.interiorRings[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),t}(),k=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof n[0][0][0]&&(n=[n])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,o=n.length;i<o;i++){var a=new M(n[i],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var r=this.polys[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),t}(),O=function(){function t(n){e(this,t),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult()&&!o.ringOut){for(var a=null,s=o.leftSE,u=o.rightSE,l=[s],c=s.point,h=[];a=s,s=u,l.push(s),s.point!==c;)for(;;){var f=s.getAvailableLinkedEvents();if(0===f.length){var p=l[0].point,d=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===f.length){u=f[0].otherSE;break}for(var v=null,g=0,m=h.length;g<m;g++)if(h[g].point===s.point){v=g;break}if(null===v){h.push({index:l.length,point:s.point});var y=s.getLeftmostComparator(a);u=f.sort(y)[0].otherSE;break}var _=h.splice(v)[0],b=l.splice(_.index);b.unshift(b[0].otherSE),n.push(new t(b.reverse()))}n.push(new t(l))}}return n}}]),n(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==_(i,e,o)&&(t.push(i),e=i)}if(1===t.length)return null;var a=t[0],s=t[1];0===_(a,e,s)&&t.shift(),t.push(t[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:t.length-1,c=this.isExteriorRing()?t.length:-1,h=[],f=l;f!=c;f+=u)h.push([t[f].x,t[f].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var r=this.events[t];A.compare(e,r)>0&&(e=r)}for(var i=e.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),P=function(){function t(n){e(this,t),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}]),t}(),L=function(){function t(n){e(this,t),this.rings=n,this.polys=this._composePolys(n)}return n(t,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];if(!i.poly)if(i.isExteriorRing())t.push(new P(i));else{var o=i.enclosingRing();o.poly||t.push(new P(o)),o.poly.addInterior(i)}}return t}}]),t}(),I=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.compare;e(this,t),this.queue=n,this.tree=new u(r),this.segments=[]}return n(t,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var r=e.isLeft?this.tree.insert(t):this.tree.find(t);if(!r)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,a=void 0,s=void 0;void 0===a;)null===(i=this.tree.prev(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(e.isLeft){var u=null;if(a){var l=a.getIntersection(t);if(null!==l&&(t.isAnEndpoint(l)||(u=l),!a.isAnEndpoint(l)))for(var c=this._splitSafely(a,l),h=0,f=c.length;h<f;h++)n.push(c[h])}var p=null;if(s){var d=s.getIntersection(t);if(null!==d&&(t.isAnEndpoint(d)||(p=d),!s.isAnEndpoint(d)))for(var v=this._splitSafely(s,d),g=0,m=v.length;g<m;g++)n.push(v[g])}if(null!==u||null!==p){var y=null;y=null===u?p:null===p||A.comparePoints(u,p)<=0?u:p,this.queue.remove(t.rightSE),n.push(t.rightSE);for(var _=t.split(y),b=0,x=_.length;b<x;b++)n.push(_[b])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&s){var S=a.getIntersection(s);if(null!==S){if(!a.isAnEndpoint(S))for(var E=this._splitSafely(a,S),C=0,T=E.length;C<T;C++)n.push(E[C]);if(!s.isAnEndpoint(S))for(var w=this._splitSafely(s,S),M=0,k=w.length;M<k;M++)n.push(w[M])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.insert(e),r}}]),t}(),R="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,N="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,D=new(function(){function t(){e(this,t)}return n(t,[{key:"run",value:function(e,t,n){D.type=e,g.reset();for(var r=[new k(t,!0)],i=0,o=n.length;i<o;i++)r.push(new k(n[i],!1));if(D.numMultiPolys=r.length,"difference"===D.type)for(var a=r[0],s=1;s<r.length;)null!==c(r[s].bbox,a.bbox)?s++:r.splice(s,1);if("intersection"===D.type)for(var l=0,h=r.length;l<h;l++)for(var f=r[l],p=l+1,d=r.length;p<d;p++)if(null===c(f.bbox,r[p].bbox))return[];for(var v=new u(A.compare),m=0,y=r.length;m<y;m++)for(var _=r[m].getSweepEvents(),b=0,x=_.length;b<x;b++)if(v.insert(_[b]),v.size>R)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var S=new I(v),E=v.size,C=v.pop();C;){var T=C.key;if(v.size===E){var w=T.segment;throw new Error("Unable to pop() ".concat(T.isLeft?"left":"right"," SweepEvent ")+"[".concat(T.point.x,", ").concat(T.point.y,"] from segment #").concat(w.id," ")+"[".concat(w.leftSE.point.x,", ").concat(w.leftSE.point.y,"] -> ")+"[".concat(w.rightSE.point.x,", ").concat(w.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(v.size>R)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(S.segments.length>N)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var M=S.process(T),P=0,F=M.length;P<F;P++){var B=M[P];void 0===B.consumedBy&&v.insert(B)}E=v.size,C=v.pop()}g.reset();var z=O.factory(S.segments);return new L(z).getGeom()}}]),t}());return{union:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return D.run("union",e,n)},intersection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return D.run("intersection",e,n)},xor:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return D.run("xor",e,n)},difference:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return D.run("difference",e,n)}}}()}));function AG(e,t,n){void 0===n&&(n={});var r=Sr(e),i=Sr(t),o=EG.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?vr(o[0],n.properties):function(e,t,n){return void 0===n&&(n={}),dr({type:"MultiPolygon",coordinates:e},t,n)}(o,n.properties)}function CG(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return TG(e);case"FeatureCollection":return function(e){var t={type:"FeatureCollection"};return Object.keys(e).forEach((function(n){switch(n){case"type":case"features":return;default:t[n]=e[n]}})),t.features=e.features.map((function(e){return TG(e)})),t}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return wG(e);default:throw new Error("unknown GeoJSON type")}}function TG(e){var t={type:"Feature"};return Object.keys(e).forEach((function(n){switch(n){case"type":case"properties":case"geometry":return;default:t[n]=e[n]}})),t.properties=function e(t){var n={};if(!t)return n;return Object.keys(t).forEach((function(r){var i=t[r];"object"==typeof i?null===i?n[r]=null:Array.isArray(i)?n[r]=i.map((function(e){return e})):n[r]=e(i):n[r]=i})),n}(e.properties),t.geometry=wG(e.geometry),t}function wG(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map((function(e){return wG(e)})),t):(t.coordinates=function e(t){var n=t;if("object"!=typeof n[0])return n.slice();return n.map((function(t){return e(t)}))}(e.coordinates),t)}function MG(e,t){void 0===t&&(t={});var n=Sr(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),n.type){case"Polygon":return function(e,t){void 0===t&&(t={});var n=Sr(e).coordinates,r=t.properties?t.properties:"Feature"===e.type?e.properties:{};return kG(n,r)}(n,t);case"MultiPolygon":return function(e,t){void 0===t&&(t={});var n=Sr(e).coordinates,r=t.properties?t.properties:"Feature"===e.type?e.properties:{},i=[];return n.forEach((function(e){i.push(kG(e,r))})),mr(i)}(n,t);default:throw new Error("invalid poly")}}function kG(e,t){return e.length>1?function(e,t,n){return void 0===n&&(n={}),dr({type:"MultiLineString",coordinates:e},t,n)}(e,t):gr(e[0],t)}var OG={features:[],featureId:null,vectorTileLayer:null,source:null},PG=function(){function e(t){b(this,e),E(this,"type",void 0),E(this,"parentLayer",void 0),E(this,"mapService",void 0),E(this,"rendererService",void 0),E(this,"outSideEventTimer",null),E(this,"zoomOffset",void 0),E(this,"tilesetManager",void 0),E(this,"layers",void 0),E(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=t.parent,this.mapService=t.mapService,this.rendererService=t.rendererService;var n=this.parentLayer.getSource();this.zoomOffset=n.parser.zoomOffset||0,this.tilesetManager=n.tileset}return S(e,[{key:"createTile",value:function(e,t){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(e,t){var n=t.sourceLayer,r=t.featureId,i=t.transforms,o=void 0===i?[]:i,a=t.layerType,s=t.shape;if(!n)return OG;var u=e.data.layers[n],l=null==u?void 0:u.features;if(Array.isArray(l)&&l.length>0){var c=[];"LineLayer"===a&&"simple"===s?l.map((function(e){var t=CG(e);if("MultiPolygon"===t.geometry.type){var n,r=MG(t).features;(n=c).push.apply(n,F(r))}else"Polygon"===t.geometry.type?(t.geometry.type="MultiLineString",c.push(t)):c.push(t)})):c=l;var h=new Dw({type:"FeatureCollection",features:c},{parser:{type:"geojson",featureId:r,cancelExtent:!0},transforms:o});return{features:c,featureId:r,vectorTileLayer:u,source:h}}return OG}},{key:"createLayer",value:function(e){var t=e.L7Layer,n=e.tile,r=e.initOptions,i=e.vectorTileLayer,o=e.source,a=e.needListen,s=void 0===a||a,u=r.mask,l=r.color,c=r.layerType,h=r.size,f=r.shape,p=r.usage,d=r.basemapColor,g=r.basemapSize,m=new(t||SG)(v({visible:n.isVisible,tileOrigin:null==i?void 0:i.l7TileOrigin,coord:null==i?void 0:i.l7TileCoord,needListen:s},this.getLayerInitOption(r)));if(c&&(m.type=c),m.isTileLayer=!0,m.isVector&&"basemap"!==p&&(this.emitEvent([m]),m.select(!0)),m.source(o),WH(m,this.parentLayer,"shape",f),"basemap"!==p?(!function(e,t){var n=t.tileLayer.scaleField;Object.keys(n).map((function(t){e.scale(t,n[t])}))}(m,this.parentLayer),WH(m,this.parentLayer,"color",l),WH(m,this.parentLayer,"size",h)):m.style({color:d,size:g}),u&&m.isVector){var y=new SG({layerType:"MaskLayer"}).source({type:"FeatureCollection",features:[n.bboxPolygon]},{parser:{type:"geojson",cancelExtent:!0}});ZH(this.parentLayer,[y]),m.addMaskLayer(y)}return this.layers=[m],m}},{key:"updateStyle",value:function(e){return""}},{key:"getTile",value:function(e,t){var n=this.mapService.getZoom();return this.tilesetManager.getTileByLngLat(e,t,n)}},{key:"bindVectorEvent",value:function(e){var t=this;e.on("click",(function(e){t.eventCache.click=1,t.getFeatureAndEmitEvent("subLayerClick",e)})),e.on("mousemove",(function(e){t.eventCache.mousemove=1,t.getFeatureAndEmitEvent("subLayerMouseMove",e)})),e.on("mouseenter",(function(e){t.getFeatureAndEmitEvent("subLayerMouseEnter",e)}))}},{key:"readRasterTile",value:function(e,t){var n=e.lngLat,r=n.lng,i=n.lat,o=this.getTile(r,i);if(o){var a=function(e,t,n,r){var i,o,a,s,u=D((null==e||null===(i=e.bboxPolygon)||void 0===i?void 0:i.bbox)||[0,0,10,-10],4),l=u[0],c=void 0===l?0:l,h=u[1],f=void 0===h?0:h,p=u[2],d=void 0===p?10:p,v=u[3],g=void 0===v?-10:v,m=t.lngLatToContainer([c,f]),y=t.lngLatToContainer([d,g]),_=y.x-m.x,b=m.y-y.y,x=[(n-m.x)/_,(r-y.y)/b],S=(null==e||null===(o=e.data)||void 0===o?void 0:o.width)||1,E=(null==e||null===(a=e.data)||void 0===a?void 0:a.height)||1,A=Math.floor(x[0]*S),C=Math.floor(x[1]*E),T=Math.max(0,C-1)*S+A;return null==e||null===(s=e.data)||void 0===s?void 0:s.data[T]}(o,this.mapService,e.x,e.y);e.value=a,this.parentLayer.emit(t,e)}}},{key:"bindRasterEvent",value:function(e){var t=this;e.on("click",(function(e){t.eventCache.click=1,t.readRasterTile(e,"subLayerClick")})),e.on("mousemove",(function(e){t.eventCache.mousemove=1,t.readRasterTile(e,"subLayerMouseMove")})),e.on("mouseenter",(function(e){t.readRasterTile(e,"subLayerMouseMove")}))}},{key:"bindCommonEvent",value:function(e){var t=this;e.on("mouseup",(function(e){t.eventCache.mouseup=1,t.getFeatureAndEmitEvent("subLayerMouseUp",e)})),e.on("mouseout",(function(e){t.getFeatureAndEmitEvent("subLayerMouseOut",e)})),e.on("mousedown",(function(e){t.eventCache.mousedown=1,t.getFeatureAndEmitEvent("subLayerMouseDown",e)})),e.on("contextmenu",(function(e){t.eventCache.contextmenu=1,t.getFeatureAndEmitEvent("subLayerContextmenu",e)})),e.on("unclick",(function(n){return t.handleOutsideEvent("click","subLayerUnClick",e,n)})),e.on("unmouseup",(function(n){return t.handleOutsideEvent("mouseup","subLayerUnMouseUp",e,n)})),e.on("unmousedown",(function(n){return t.handleOutsideEvent("mousedown","subLayerUnMouseDown",e,n)})),e.on("uncontextmenu",(function(n){return t.handleOutsideEvent("contextmenu","subLayerUnContextmenu",e,n)}))}},{key:"emitEvent",value:function(e){var t=this;e.map((function(e){e.once("modelLoaded",(function(){t.bindVectorEvent(e),t.bindCommonEvent(e)}))}))}},{key:"emitRasterEvent",value:function(e){var t=this;e.map((function(e){e.once("modelLoaded",(function(){t.bindRasterEvent(e),t.bindCommonEvent(e)}))}))}},{key:"getCombineFeature",value:function(e){var t=null,n=e[0];return e.map((function(e){var n=vr(e.coordinates);null===t&&(t=n),t=AG(t,n)})),n&&(t.properties=v({},n)),t}},{key:"getFeatureAndEmitEvent",value:function(e,t){var n=t.featureId,r=this.getAllFeatures(n);try{t.feature=this.getCombineFeature(r)}catch(e){console.warn("Combine Featuer Err! Return First Feature!"),t.feature=r[0]}this.parentLayer.emit(e,t)}},{key:"getAllFeatures",value:function(e){var t=this.parentLayer.tileLayer.children,n=[];return t.map((function(t){t.getSource().data.dataArray.map((function(t){t._id===e&&n.push(t)}))})),n}},{key:"getLayerInitOption",value:function(e){var t=v({},e);return delete t.color,delete t.shape,delete t.size,delete t.coords,delete t.sourceLayer,delete t.coords,t}},{key:"handleOutsideEvent",value:function(e,t,n,r){var i=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout((function(){i.eventCache[e]>0?i.eventCache[e]=0:i.getFeatureAndEmitEvent(t,r)}),64)}}]),e}(),LG=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"parentLayer",void 0),r.parentLayer=e.parent,r}return S(n,[{key:"createTile",value:function(e,t){var n=this.getFeatureData(e,t),r=n.features,i=n.vectorTileLayer,o=n.source;if(0===r.length)return{layers:[],layerIDList:[]};var a=this.createLayer({tile:e,initOptions:t,vectorTileLayer:i,source:o});return{layers:[a],layerIDList:[a.id]}}}]),n}(PG),IG=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"parentLayer",void 0),r.parentLayer=e.parent,r}return S(n,[{key:"createTile",value:function(e,t){var n=this.getFeatureData(e,t),r=n.features,i=n.vectorTileLayer,o=n.source;if(0===r.length)return{layers:[],layerIDList:[]};var a=this.createLayer({tile:e,initOptions:t,vectorTileLayer:i,source:o,needListen:!1});return{layers:[a],layerIDList:[a.id]}}}]),n}(PG),RG=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"parentLayer",void 0),r.parentLayer=e.parent,r}return S(n,[{key:"createTile",value:function(e,t){var n=this.getFeatureData(e,t),r=n.features,i=n.vectorTileLayer,o=n.source;if(0===r.length)return{layers:[],layerIDList:[]};var a=this.createLayer({tile:e,initOptions:t,vectorTileLayer:i,source:o});return{layers:[a],layerIDList:[a.id]}}}]),n}(PG),NG=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"parentLayer",void 0),r.parentLayer=e.parent,r}return S(n,[{key:"createTile",value:function(e,t){var n=this.getFeatureData(e,t),r=n.features,i=n.vectorTileLayer,o=n.source;if(0===r.length)return{layers:[],layerIDList:[]};var a=this.createLayer({tile:e,initOptions:t,vectorTileLayer:i,source:o,needListen:!1});return{layers:[a],layerIDList:[a.id]}}}]),n}(PG),DG=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"parentLayer",void 0),r.parentLayer=e.parent,r}return S(n,[{key:"createTile",value:function(e,t){var n=new Dw(e.data,{parser:{type:"image",extent:e.bounds}}),r=this.createLayer({L7Layer:HH,tile:e,initOptions:t,source:n});return{layers:[r],layerIDList:[r.id]}}}]),n}(PG),FG="precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nvoid main() {\nfloat value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\nif (value == u_noDataValue)\ngl_FragColor = vec4(0.0, 0, 0, 0.0);\nelse if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\ngl_FragColor = vec4(0, 0, 0, 0);\nelse {\nfloat normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\nvec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\ngl_FragColor = color;\ngl_FragColor.a =  gl_FragColor.a * u_opacity ;\n}\n}",BG='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',zG=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return S(r,[{key:"getUninforms",value:function(){var e=this.rendererService.createTexture2D,t=this.layer.getLayerConfig(),n=t.colorTexture,r=void 0===n?e({data:[],width:0,height:0,flipY:!1}):n,i=t.opacity,o=void 0===i?1:i,a=t.clampLow,s=void 0===a||a,u=t.clampHigh,l=void 0===u||u,c=t.noDataValue,h=void 0===c?-9999999:c,f=t.domain,p=void 0===f?[0,1]:f;return{u_opacity:o||1,u_texture:this.texture,u_domain:p,u_clampLow:s,u_clampHigh:void 0!==l?l:s,u_noDataValue:h,u_colorTexture:r}}},{key:"initModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=this.layer.getSource(),u=this.rendererService.createTexture2D,l=s.data.dataArray[0];this.texture=u({data:l.data,width:l.width,height:l.height,format:e.gl.LUMINANCE,type:e.gl.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterTileImageData",vertexShader:BG,fragmentShader:FG,triangulation:_H,depth:{enable:!1},stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),r}(PV),jG=function(t){A(o,t);var n,r,i=I(o);function o(){var e;b(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(P(e=i.call.apply(i,[this].concat(n))),"texture",void 0),E(P(e),"channelRMax",256),E(P(e),"channelGMax",256),E(P(e),"channelBMax",256),e}return S(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.channelRMax,i=e.channelGMax,o=e.channelBMax;return{u_opacity:n||1,u_texture:this.texture,u_channelRMax:void 0!==r?r:this.channelRMax,u_channelGMax:void 0!==i?i:this.channelGMax,u_channelBMax:void 0!==o?o:this.channelBMax}}},{key:"getRasterData",value:(r=_(g().mark((function e(t){var n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return e.abrupt("return",{data:t.data,width:t.width,height:t.height});case 4:return e.next=6,t.data;case 6:return n=e.sent,r=n.rasterData,i=n.width,o=n.height,a=n.channelR,s=n.channelG,u=n.channelB,this.channelRMax=a,this.channelGMax=s,this.channelBMax=u,e.abrupt("return",{data:Array.from(r),width:i,height:o});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=_(g().mark((function t(n){var r,i,o,a,s,u,l,c,h,f,p,d;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.layer.getLayerConfig(),i=r.mask,o=void 0!==i&&i,a=r.maskInside,s=void 0===a||a,u=this.layer.getSource(),l=this.rendererService.createTexture2D,c=u.data.dataArray[0],t.next=6,this.getRasterData(c);case 6:h=t.sent,f=h.data,p=h.width,d=h.height,this.texture=l({data:f,width:p,height:d,format:e.gl.RGB,type:e.gl.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:BG,fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform float u_channelRMax: 256.;\nuniform float u_channelGMax: 256.;\nuniform float u_channelBMax: 256.;\nvarying vec2 v_texCoord;\nvoid main() {\nvec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;\ngl_FragColor = vec4(rgb.r/u_channelRMax, rgb.g/u_channelGMax, rgb.b/u_channelBMax, u_opacity);\n}",triangulation:_H,primitive:e.gl.TRIANGLES,depth:{enable:!1},stencil:Oy(o,s)}).then((function(e){n([e])})).catch((function(e){console.warn(e),n([])}));case 12:case"end":return t.stop()}}),t,this)}))),function(e){return n.apply(this,arguments)})},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(PV),UG=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type",e.layerType),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new t(this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"getModelType",value:function(){return"rasterRgb"===this.layerSource.parser.type?jG:zG}},{key:"getDefaultConfig",value:function(){return{}}}]),n}(hV),VG=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"parentLayer",void 0),r.parentLayer=e.parent,r}return S(n,[{key:"createTile",value:function(e,t){var n,r,i,o=t.colorTexture,a=t.opacity,s=t.domain,u=t.clampHigh,l=t.clampLow,c=t.mask,h=e.data;if(!h.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var f=null===(n=this.parentLayer)||void 0===n||null===(r=n.getSource())||void 0===r||null===(i=r.parser)||void 0===i?void 0:i.dataType,p=new UG({visible:e.isVisible,mask:c}).source(h.data,{parser:{type:"rgb"===f?"rasterRgb":"raster",width:h.width,height:h.height,extent:e.bboxPolygon.bbox}}).style({colorTexture:o,opacity:a,domain:s,clampHigh:u,clampLow:l});return this.emitRasterEvent([p]),{layers:[p],layerIDList:[p.id]}}}]),n}(PG),HG=function(e){A(n,e);var t=I(n);function n(e){var r;return b(this,n),E(P(r=t.call(this,e)),"parentLayer",void 0),r.parentLayer=e.parent,r}return S(n,[{key:"createTile",value:function(e,t){var n=t.sourceLayer;if(!n)return{layers:[],layerIDList:[]};var r=e.data.layers[n],i=null==r?void 0:r.features;if(0===i.length)return{layers:[],layerIDList:[]};var o=i[0].properties,a=new SG({layerType:"PointLayer",usage:"basemap",needListen:!1}).source([o],{parser:{type:"json",x:"textLng",y:"textLat",cancelExtent:!0}}).shape("key","text").style({size:20,color:"#000",stroke:"#fff",strokeWidth:2}),s=new SG({layerType:"LineLayer",usage:"basemap",needListen:!1}).source({type:"FeatureCollection",features:i},{parser:{type:"geojson",cancelExtent:!0}}).shape("simple").style({color:"#000"});return{layers:[s,a],layerIDList:[s.id,a.id]}}}]),n}(PG);var GG=function(){function e(){b(this,e),E(this,"sourceLayer",void 0),E(this,"parent",void 0),E(this,"children",void 0),E(this,"mapService",void 0),E(this,"rendererService",void 0),E(this,"tileFactory",void 0),E(this,"initOptions",void 0),E(this,"tileCache",new Map)}return S(e,[{key:"hasTile",value:function(e){return!!this.tileCache.has(e.key)}},{key:"addTile",value:function(e){var t;if(this.hasTile(e))return{layers:[],layerIDList:[]};this.tileCache.set(e.key,e);var n=this.tileFactory.createTile(e,this.initOptions);return ZH(this.parent,n.layers),(t=e.layerIDList).push.apply(t,F(n.layerIDList)),this.addChildren(n.layers),n.layers.map((function(t){t.once("modelLoaded",(function(){e.layerLoad()}))})),n}},{key:"removeTile",value:function(e){this.tileCache.delete(e.key),this.removeChildren(e.layerIDList,!1)}},{key:"addChild",value:function(e){this.children.push(e)}},{key:"addChildren",value:function(e){var t;(t=this.children).push.apply(t,F(e))}},{key:"removeChildren",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=[];this.children.filter((function(t){e.includes(t.id)?n.push(t):r.push(t)})),n.map((function(e){return e.destroy(t)})),this.children=r}},{key:"removeChild",value:function(e){var t=this.children.indexOf(e);t>-1&&this.children.splice(t,1),e.destroy()}},{key:"getChildren",value:function(e){return this.children.filter((function(t){return e.includes(t.id)}))}},{key:"getChild",value:function(e){return this.children.filter((function(t){return t.id===e}))[0]}},{key:"clearChild",value:function(){this.children.forEach((function(e){e.destroy()})),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(e){return this.children.includes(e)}},{key:"initTileFactory",value:function(){var e=this.parent.getSource(),t=function(e,t){switch(e){case"PolygonLayer":return RG;case"LineLayer":return LG;case"PointLayer":return IG;case"MaskLayer":return NG;case"TileDebugLayer":return HG;case"RasterLayer":return lA.includes(t.dataType)?VG:DG;default:return console.warn("Current Tile Not Exist!"),DG}}(this.parent.type,e.parser);this.tileFactory=new t({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}},{key:"getSourceLayer",value:function(e,t){return"geojsonvt"===e?"geojsonvt":"testTile"===e?"testTile":t}},{key:"destroy",value:function(){}}]),e}(),WG=function(e){A(n,e);var t=I(n);function n(){var e;return b(this,n),E(P(e=t.call(this)),"cacheConfig",void 0),E(P(e),"checkConfigList",[]),e.cacheConfig=new Map,e}return S(n,[{key:"setConfig",value:function(e,t){this.checkConfigList.includes(e)||this.checkConfigList.push(e),this.cacheConfig.set(e,t)}},{key:"removeConfig",value:function(e){var t=this.checkConfigList.indexOf(e);t>-1&&(this.cacheConfig.delete(e),this.checkConfigList.splice(t,1))}},{key:"checkConfig",value:function(e){var t=this;if(e.inited){var n=e.getLayerConfig(),r=[];this.checkConfigList.map((function(i){var o,a=t.cacheConfig.get(i);if(["color","size","shape"].includes(i)){var s;o=null===(s=e.getAttribute(i))||void 0===s?void 0:s.scale}else{if(!(i in n))return;o=n[i]}OV(a,o)||(r.push(i),t.setConfig(i,o))})),r.length>0&&(console.warn("tile config cache update!",r),this.emit("updateConfig",r))}}},{key:"getAttributeScale",value:function(e,t){var n=e.getAttribute(t),r={field:void 0,values:void 0,callback:void 0};if(n&&n.scale){var i=n.scale,o=i.field,a=i.values,s=i.callback;r.field=o,r.values=a,r.callback=s}return r}}]),n}(qx),YG=function(e){A(n,e);var t=I(n);function n(e,r,i,o,a){var s;return b(this,n),E(P(s=t.call(this)),"isLastPicked",!1),E(P(s),"rendererService",void 0),E(P(s),"pickingService",void 0),E(P(s),"children",void 0),E(P(s),"parent",void 0),E(P(s),"tileRenderService",void 0),s.parent=e,s.rendererService=r,s.pickingService=i,s.children=o,s.tileRenderService=a,s}return S(n,[{key:"pick",value:function(e,t){var n=this;this.tileRenderService.renderMask(this.parent);var r=e.filter((function(e){return n.parent.needPick(t.type)&&e.inited&&e.isVisible()})).some((function(e){e.hooks.beforePickingEncode.call(),e.masks.length>0&&(n.rendererService.clear({stencil:0,depth:1,framebuffer:null}),e.masks.map((function(e){e.hooks.beforeRender.call(),e.render(),e.hooks.afterRender.call()}))),e.renderModels(!0),e.hooks.afterPickingEncode.call();var r=n.pickingService.pickFromPickingFBO(e,t);return r&&"RasterLayer"!==n.parent.type&&(n.emit("pick",{type:t.type,pickedColors:n.pickingService.pickedColors,layer:e}),n.pickingService.pickedTileLayers=[n.parent]),r}));return"RasterLayer"!==this.parent.type&&!r&&this.isLastPicked&&"click"!==t.type&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=r,r}},{key:"clearPick",value:function(){this.children.filter((function(e){return e.inited&&e.isVisible()})).map((function(e){e.hooks.beforeSelect.call([0,0,0])})),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(e){this.children.filter((function(e){return e.inited&&e.isVisible()})).map((function(t){t.hooks.beforeHighlight.call(e)}))}},{key:"beforeSelect",value:function(e){this.children.filter((function(e){return e.inited&&e.isVisible()})).map((function(t){t.hooks.beforeSelect.call(e)}))}},{key:"destroy",value:function(){this.removeAllListeners()}}]),n}(Kx),XG=function(){function e(t){b(this,e),E(this,"rendererService",void 0),this.rendererService=t}return S(e,[{key:"render",value:function(e){var t=this;e.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).map((function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.masks.length>0&&(t.rendererService.clear({stencil:0,depth:1,framebuffer:null}),e.masks.map((function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.render(),e.hooks.afterRender.call()}))),e.render(),e.hooks.afterRender.call()}))}},{key:"renderMask",value:function(e){e.inited&&e.isVisible()&&e.masks.length>0&&(e.hooks.beforeRender.call(),this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),e.masks.map((function(e){e.hooks.beforeRender.call(),e.render(),e.hooks.afterRender.call()})),e.hooks.afterRender.call())}}]),e}(),ZG=["size","color","shape"],qG=["opacity","zIndex"],KG=["mask","rampColors","domain","clampHigh","clampLow","pixelConstant","pixelConstantR","pixelConstantG","pixelConstantB","pixelConstantRGB"].concat(qG),QG={PointLayer:["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(qG),LineLayer:["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(qG),PolygonLayer:["color","shape"].concat(qG),RasterLayer:KG,MaskLayer:[],TileDebugLayer:[]},$G=function(e){A(n,e);var t=I(n);function n(e,r,i,o,a){var s;return b(this,n),E(P(s=t.call(this)),"tilePickService",void 0),E(P(s),"tileStyleService",void 0),E(P(s),"tileRenderService",void 0),E(P(s),"transforms",void 0),s.parent=e,s.children=e.layerChildren,s.mapService=r,s.rendererService=i,s.transforms=a,s.tileRenderService=new XG(i),s.tilePickService=new YG(e,i,o,s.children,s.tileRenderService),s.tileStyleService=new WG,s.setSubLayerInitOption(),s.setConfigListener(),s.initTileFactory(),s}return S(n,[{key:"render",value:function(){this.tileStyleService.checkConfig(this.parent),this.tileRenderService.render(this.children)}},{key:"pickLayers",value:function(e){return this.tilePickService.pick(this.children,e)}},{key:"setSubLayerInitOption",value:function(){var e,t=this.parent.getLayerConfig(),n=t.zIndex,r=void 0===n?0:n,i=t.opacity,o=void 0===i?1:i,a=t.mask,s=void 0!==a&&a,u=t.stroke,l=void 0===u?"#fff":u,c=t.strokeWidth,h=void 0===c?0:c,f=t.strokeOpacity,p=void 0===f?1:f,d=t.clampLow,v=void 0===d||d,g=t.clampHigh,m=void 0===g||g,y=t.domain,_=void 0===y?[0,1]:y,b=t.rampColors,x=void 0===b?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:b,S=t.featureId,E=void 0===S?"id":S,A=t.workerEnabled,C=void 0!==A&&A,T=t.sourceLayer,w=t.pixelConstant,M=void 0===w?0:w,k=t.pixelConstantR,O=void 0===k?65536:k,P=t.pixelConstantG,L=void 0===P?256:P,I=t.pixelConstantB,R=void 0===I?1:I,N=t.pixelConstantRGB,D=void 0===N?.1:N,F=this.tileStyleService.getAttributeScale(this.parent,"color"),B=this.tileStyleService.getAttributeScale(this.parent,"size"),z=this.parent.getSource(),j=((null==z||null===(e=z.data)||void 0===e?void 0:e.tilesetOptions)||{}).coords,U=z.getParserType(),V=qH(this.parent.type,this.parent);if(this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:V,zIndex:r,opacity:o,sourceLayer:this.getSourceLayer(U,T),coords:j,featureId:E,color:F,size:B,mask:KH(this.parent.type,s),stroke:l,strokeWidth:h,strokeOpacity:p,clampLow:v,clampHigh:m,domain:_,rampColors:x,workerEnabled:C,pixelConstant:M,pixelConstantR:O,pixelConstantG:L,pixelConstantB:R,pixelConstantRGB:D},x){var H=this.rendererService.createTexture2D,G=wy(x),W=H({data:G.data,width:G.width,height:G.height,flipY:!1});this.initOptions.colorTexture=W}}},{key:"getInitOptionValue",value:function(e){var t,n,r;switch(e){case"color":return null===(t=this.parent.getAttribute("color"))||void 0===t?void 0:t.scale;case"shape":return null===(n=this.parent.getAttribute("shape"))||void 0===n?void 0:n.scale;case"size":return null===(r=this.parent.getAttribute("size"))||void 0===r?void 0:r.scale;default:return this.initOptions[e]}}},{key:"setInitOptionValue",value:function(e,t){this.initOptions[e]=t}},{key:"setConfigListener",value:function(){var e=this;(QG[this.parent.type]||[]).map((function(t){e.tileStyleService.setConfig(t,e.getInitOptionValue(t))})),this.tileStyleService.on("updateConfig",(function(t){t.map((function(t){return e.updateStyle(t)}))}))}},{key:"updateAttribute",value:function(e){var t=this;if(ZG.includes(e)){var n,r=null===(n=this.parent.getAttribute(e))||void 0===n?void 0:n.scale;if(!r)return;this.children.map((function(n){return WH(n,t.parent,e,r)}))}}},{key:"updateStyle",value:function(e){var t=null;if(ZG.includes(e))this.updateAttribute(e);else{var n=this.parent.getLayerConfig();if(!(e in n))return;var r=n[e];switch(t=r,e){case"rampColors":var i=function(e,t,n){var r=n.createTexture2D,i=wy(e),o=r({data:i.data,width:i.width,height:i.height,flipY:!1});return t.map((function(e){e.updateLayerConfig({colorTexture:o})})),o}(r,this.children,this.rendererService);this.initOptions.colorTexture=i;break;default:GH(this.children,e,r)}}this.setInitOptionValue(e,t)}},{key:"destroy",value:function(){this.tilePickService.destroy()}}]),n}(GG),JG=function(){function e(){b(this,e),E(this,"tileLayerManager",void 0),E(this,"sourceLayer",void 0),E(this,"parent",void 0),E(this,"initedTileset",!1),E(this,"tilesetManager",void 0),E(this,"scaleField",void 0),E(this,"mapService",void 0),E(this,"layerService",void 0),E(this,"lastViewStates",void 0),E(this,"viewchange",fS(this.mapchange,200))}return S(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"mapchange",value:function(){var e,t=this.getCurrentView(),n=t.latLonBounds,r=t.zoom;if("GAODE1.x"===this.mapService.version){var i=this.parent.getLayerConfig().visible;r<3&&i?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):r>=3&&!i&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===r&&this.lastViewStates.latLonBounds.toString()===n.toString()||(this.lastViewStates={zoom:r,latLonBounds:n},null===(e=this.tilesetManager)||void 0===e||e.throttleUpdate(r,n))}},{key:"getCurrentView",value:function(){var e=this.mapService.getBounds();return{latLonBounds:[e[0][0],e[0][1],e[1][0],e[1][1]],zoom:this.mapService.getZoom()}}},{key:"initTileSetManager",value:function(){var e,t=this.parent.getSource();this.tilesetManager=t.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(i,r)}},{key:"bindTilesetEvent",value:function(){var e=this;this.tilesetManager&&(this.tilesetManager.on("tile-loaded",(function(e){})),this.tilesetManager.on("tile-unload",(function(t){e.tileUnLoad(t)})),this.tilesetManager.on("tile-error",(function(t,n){e.tileError(t)})),this.tilesetManager.on("tile-update",(function(){e.tileUpdate()})),this.mapService.on("zoomend",(function(){return e.viewchange()})),this.mapService.on("moveend",(function(){return e.viewchange()})))}},{key:"render",value:function(){this.tileLayerManager.render()}},{key:"tileLoaded",value:function(e){}},{key:"tileError",value:function(e){console.warn("error:",e)}},{key:"destroy",value:function(){var e;null===(e=this.tilesetManager)||void 0===e||e.destroy(),this.tileLayerManager.destroy()}},{key:"tileUnLoad",value:function(e){this.tileLayerManager.removeTile(e)}},{key:"tileUpdate",value:function(){var e=this;this.tilesetManager&&(this.tilesetManager.tiles.filter((function(e){return e.isLoaded})).map((function(t){if(e.isTileReady(t))if(e.tileLayerManager.hasTile(t)){if(!t.isVisibleChange)return;var n=e.tileLayerManager.getChildren(t.layerIDList);JH(t,n,e.layerService),e.setPickState(n)}else{var r=e.tileLayerManager.addTile(t).layers;e.setPickState(r)}})),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"isTileReady",value:function(e){var t;if(null!==(t=e.data)&&void 0!==t&&t.layers&&this.sourceLayer){var n=e.data.layers[this.sourceLayer],r=null==n?void 0:n.features;if(!(Array.isArray(r)&&r.length>0))return!1}return!0}},{key:"setPickState",value:function(e){}}]),e}();function eW(e,t){var n=D(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeSelect.call([r,i,o])}var tW=function(e){A(n,e);var t=I(n);function n(e){var r,i,o=e.parent,a=e.rendererService,s=e.mapService,u=e.layerService,l=e.pickingService,c=e.transforms;b(this,n),E(P(i=t.call(this)),"tileLayerManager",void 0),E(P(i),"pickColors",{select:null,active:null});var h=o.getSource(),f=((null==h||null===(r=h.data)||void 0===r?void 0:r.tilesetOptions)||{}).sourceLayer;return i.sourceLayer=f,i.parent=o,i.mapService=s,i.layerService=u,i.tileLayerManager=new $G(o,s,a,l,c),i.initTileSetManager(),i.bindSubLayerEvent(),i.bindSubLayerPick(),i.scaleField=i.parent.getScaleOptions(),i}return S(n,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"clearPick",value:function(e){"mousemove"===e&&this.tileLayerManager.tilePickService.clearPick()}},{key:"clearPickState",value:function(){this.children.filter((function(e){return e.inited&&e.isVisible()})).filter((function(e){return null!==e.getCurrentSelectedId()})).map((function(e){eW(e,new Uint8Array([0,0,0,0])),e.setCurrentSelectedId(null)}))}},{key:"pickLayers",value:function(e){return this.tileLayerManager.pickLayers(e)}},{key:"setPickState",value:function(e){!function(e,t){t.select&&e.map((function(e){eW(e,t.select)})),t.active&&e.filter((function(e){return e.inited&&e.isVisible()})).map((function(e){e.hooks.beforeHighlight.call(t.active)}))}(e,this.pickColors)}},{key:"bindSubLayerPick",value:function(){var e=this;this.tileLayerManager.tilePickService.on("pick",(function(t){var n,r,i,o=D(t.pickedColors,3),a=o[0],s=o[1],u=o[2];if("click"===t.type){var l=function(e,t,n){var r,i=Cy(t);return e.map((function(e){null===e.getCurrentSelectedId()||i!==e.getCurrentSelectedId()?(eW(e,t),e.setCurrentSelectedId(i),r=t):(eW(e,new Uint8Array([0,0,0,0])),e.setCurrentSelectedId(null),r=null)})),n.filter((function(e){return e.inited&&!e.isVector&&e.isVisible()&&e.needPick("click")})).filter((function(e){return null!==e.getCurrentSelectedId()})).map((function(e){eW(e,new Uint8Array([0,0,0,0])),e.setCurrentSelectedId(null)})),r}(e.children.filter((function(e){return e.inited&&e.isVisible()&&e.isVector})).filter((function(e){return e!==t.layer})),[a,s,u],e.layerService.getRenderList());e.pickColors.select=l}else n=e.children,i=Cy(r=[a,s,u]),n.filter((function(e){return e.inited&&e.isVisible()&&e.isVector})).filter((function(e){return e.getPickID()!==i})).map((function(e){e.setPickID(i),e.hooks.beforeHighlight.call(r)})),e.pickColors.active=[a,s,u]})),this.tileLayerManager.tilePickService.on("unpick",(function(){e.pickColors.active=null}))}},{key:"bindSubLayerEvent",value:function(){var e=this;this.parent.on("subLayerClick",(function(t){e.parent.emit("click",v({},t))})),this.parent.on("subLayerMouseMove",(function(t){return e.parent.emit("mousemove",v({},t))})),this.parent.on("subLayerMouseUp",(function(t){return e.parent.emit("mouseup",v({},t))})),this.parent.on("subLayerMouseEnter",(function(t){return e.parent.emit("mouseenter",v({},t))})),this.parent.on("subLayerMouseOut",(function(t){return e.parent.emit("mouseout",v({},t))})),this.parent.on("subLayerMouseDown",(function(t){return e.parent.emit("mousedown",v({},t))})),this.parent.on("subLayerContextmenu",(function(t){return e.parent.emit("contextmenu",v({},t))})),this.parent.on("subLayerUnClick",(function(t){return e.parent.emit("unclick",v({},t))})),this.parent.on("subLayerUnMouseMove",(function(t){return e.parent.emit("unmousemove",v({},t))})),this.parent.on("subLayerUnMouseUp",(function(t){return e.parent.emit("unmouseup",v({},t))})),this.parent.on("subLayerUnMouseDown",(function(t){return e.parent.emit("unmousedown",v({},t))})),this.parent.on("subLayerUnContextmenu",(function(t){return e.parent.emit("uncontextmenu",v({},t))}))}}]),n}(JG),nW=function(e){A(n,e);var t=I(n);function n(e,r,i){var o;return b(this,n),(o=t.call(this)).parent=e,o.children=e.layerChildren,o.mapService=r,o.rendererService=i,o.setSubLayerInitOption(),o.initTileFactory(),o}return S(n,[{key:"render",value:function(){var e=this;this.children.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).map((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.masks.length>0&&(e.rendererService.clear({stencil:0,depth:1,framebuffer:null}),t.masks.map((function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.render(),e.hooks.afterRender.call()}))),t.render(),t.hooks.afterRender.call()}))}},{key:"setSubLayerInitOption",value:function(){var e,t,n=this.parent.getLayerConfig(),r=n.zIndex,i=void 0===r?0:r,o=n.opacity,a=void 0===o?1:o,s=n.mask,u=void 0!==s&&s,l=n.stroke,c=void 0===l?"#fff":l,h=n.strokeWidth,f=void 0===h?0:h,p=n.strokeOpacity,d=void 0===p?1:p,v=n.workerEnabled,g=void 0!==v&&v,m=n.sourceLayer,y=this.parent.getSource().getParserType(),_=this.parent.getAttribute("color"),b=(null==_||null===(e=_.scale)||void 0===e?void 0:e.field)||"#fff",x=this.parent.getAttribute("size"),S=(null==x||null===(t=x.scale)||void 0===t?void 0:t.field)||1,E=qH(this.parent.type,this.parent);this.initOptions={usage:"basemap",layerType:this.parent.type,shape:E,zIndex:i,opacity:a,sourceLayer:this.getSourceLayer(y,m),basemapColor:b,basemapSize:S,mask:KH(this.parent.type,u),stroke:c,strokeWidth:f,strokeOpacity:d,workerEnabled:g}}}]),n}(GG),rW=function(e){A(n,e);var t=I(n);function n(e){var r,i,o=e.parent,a=e.rendererService,s=e.mapService,u=e.layerService;b(this,n),E(P(i=t.call(this)),"tileLayerManager",void 0);var l=o.getSource(),c=((null==l||null===(r=l.data)||void 0===r?void 0:r.tilesetOptions)||{}).sourceLayer;return i.sourceLayer=c,i.parent=o,i.mapService=s,i.layerService=u,i.tileLayerManager=new nW(o,s,a),i.initTileSetManager(),i}return S(n)}(JG),iW=function(e){A(n,e);var t=I(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getUninforms",value:function(){return{}}},{key:"getTileLayer",value:function(e){switch(e){case"basemap":return rW;default:return tW}}},{key:"initModels",value:function(){var e=this.layer.getSource(),t=this.layer.getLayerConfig().usage;if(null!=e&&e.data.isTile&&!this.layer.tileLayer){var n=this.getTileLayer(t);this.layer.tileLayer=new n({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:e.transforms})}return this.buildModels()}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),n}(PV),oW={solid:0,dash:1},aW=function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"texture",void 0),E(P(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5]:c,f=t.forward,p=void 0===f||f,d=t.lineTexture,v=void 0!==d&&d,g=t.iconStep,m=void 0===g?100:g,y=t.segmentNumber,_=void 0===y?30:y,b=t.thetaOffset,x=void 0===b?.314:b;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,thetaOffset:x})){this.judgeStyleAttributes({opacity:r,thetaOffset:x});var S=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,S,this.cellProperties),A=E.data,C=E.width,T=E.height;this.rowCount=T,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:C,height:T}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}2===h.length&&h.push(0,0);var w=0,M=[0,0,0,0],k=[0,0,0,0];return i&&o&&(M=Ay(i),k=Ay(o),w=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:XF(x)?x:0,u_opacity:XF(r)?r:1,u_textureBlend:"normal"===s?0:1,segmentNumber:_,u_line_type:oW[l||"solid"],u_dash_array:h,u_blur:.9,u_lineDir:p?1:-1,u_texture:this.texture,u_line_texture:v?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:w,u_sourceColor:M,u_targetColor:k}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'uniform float u_opacity;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nuniform float segmentNumber;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_distance_ratio = styleMappingMat[3].b;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nfloat flag = 0.;\nfloat dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n};\ngl_FragColor.a *=flag;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nuniform float u_thetaOffset: 0.314;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = arcThetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\nvec2 mid = midPoint(source, target, arcThetaOffset);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = thetaOffsetAndOffset.r;\ntextureOffset = thetaOffsetAndOffset.g;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\nstyleMappingMat[3].b = segmentIndex / segmentNumber;\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\ngl_PointSize = 5.0;\nsetPickingColor(a_PickingColor);\n}',type:"Dash"}:t&&n?{frag:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying mat4 styleMappingMat;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_segmentIndex = styleMappingMat[3].r;\ngl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nuniform float u_lineDir: 1.0;\nuniform float u_thetaOffset: 0.314;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = arcThetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\nvec2 mid = midPoint(source, target, arcThetaOffset);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = thetaOffsetAndOffset.r;\ntextureOffset = thetaOffsetAndOffset.g;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nfloat d_distance_ratio;\nstyleMappingMat[3].b = d_distance_ratio;\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nfloat d_segmentIndex = a_Position.x + 1.0;\nstyleMappingMat[3].r = d_segmentIndex;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"Linear"}:{frag:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_segmentIndex = styleMappingMat[3].r;\nfloat d_distance_ratio = styleMappingMat[3].b;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nif(u_animate.x == Animate && u_line_texture != LineTexture) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture) {\nfloat arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));\nfloat count = styleMappingMat[3].g;\nfloat time = 0.0;\nif(u_animate.x == Animate) {\ntime = u_time / u_animate.y;\n}\nfloat redioCount = arcRadio * count;\nfloat u = fract(redioCount - time);\nfloat v = styleMappingMat[3].a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_animate.x == Animate) {\nfloat currentPlane = floor(redioCount - time);\nfloat textureStep = floor(count * u_animate.z);\nfloat a = mod(currentPlane, textureStep);\nif(a < textureStep - 1.0) {\npattern = vec4(0.0);\n}\n}\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nuniform float u_lineDir: 1.0;\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = arcThetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\nvec2 mid = midPoint(source, target, arcThetaOffset);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = thetaOffsetAndOffset.r;\ntextureOffset = thetaOffsetAndOffset.g;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nfloat d_distance_ratio;\nif(u_animate.x == Animate) {\nd_distance_ratio = segmentIndex / segmentNumber;\nif(u_lineDir != 1.0) {\nd_distance_ratio = 1.0 - d_distance_ratio;\n}\n}\nstyleMappingMat[3].b = d_distance_ratio;\nfloat arcThetaOffset = styleMappingMat[0][1];\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nfloat d_segmentIndex = a_Position.x + 1.0;\nstyleMappingMat[3].r = d_segmentIndex;\nif(LineTexture == u_line_texture) {\nfloat arcDistrance = length(source - target);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\narcDistrance *= 1000000.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\narcDistrance = project_pixel_allmap(arcDistrance);\n}\nv_iconMapUV = a_iconMapUV;\nfloat pixelLen = project_pixel_texture(u_icon_step);\nfloat texCount = floor(arcDistrance/pixelLen);\nstyleMappingMat[3].g = texCount;\nfloat lineOffsetWidth = length(offset + offset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nstyleMappingMat[3].a = lineOffsetWidth/linePixelSize;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:""}}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=t.mask,o=void 0!==i&&i,a=t.maskInside,s=void 0===a||a,u=this.getShaders(),l=u.frag,c=u.vert,h=u.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+h,vertexShader:c,fragmentShader:l,triangulation:bH,depth:{enable:!1},blend:this.getBlend(),segmentNumber:r,stencil:Oy(o,s)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),r}(PV),sW='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = styleMappingMat[3].g;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\nif(u_animate.x == Animate && u_line_texture != LineTexture) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture && u_line_type != LineTypeDash) {\nfloat arcRadio = v_segmentIndex / (segmentNumber - 1.0);\nfloat count = styleMappingMat[3].b;\nfloat time = 0.0;\nif(u_animate.x == Animate) {\ntime = u_time / u_animate.y;\n}\nfloat redioCount = arcRadio * count;\nfloat u = fract(redioCount - time);\nfloat v = styleMappingMat[3].a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_animate.x == Animate) {\nfloat currentPlane = floor(redioCount - time);\nfloat textureStep = floor(count * u_animate.z);\nfloat a = mod(currentPlane, textureStep);\nif(a < textureStep - 1.0) {\npattern = vec4(0.0);\n}\n}\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\ndiscard;\n} else {\ngl_FragColor = filterColor(pattern);\n}\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',uW='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat torad(float deg) {\nreturn (deg / 180.0) * acos(-1.0);\n}\nvec3 lglt2xyz(vec2 lnglat) {\nfloat pi = 3.1415926;\nfloat lng = torad(lnglat.x) + pi / 2.0;\nfloat lat = torad(lnglat.y);\nfloat radius = u_globel_radius;\nfloat z = radius * cos(lat) * cos(lng);\nfloat x = radius * cos(lat) * sin(lng);\nfloat y = radius * sin(lat);\nreturn vec3(x, y, z);\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\nvec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat d_distance_ratio;\nif(u_line_type == LineTypeDash) {\nd_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_animate.x == Animate) {\nd_distance_ratio = segmentIndex / segmentNumber;\n}\nstyleMappingMat[3].g = d_distance_ratio;\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec3 curr = getPos(source, target, segmentRatio);\nvec3 next = getPos(source, target, nextSegmentRatio);\nvec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\nv_segmentIndex = a_Position.x;\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) {\nfloat arcDistrance = length(source - target);\nfloat pixelLen =  project_pixel_texture(u_icon_step);\nstyleMappingMat[3].b = floor(arcDistrance/pixelLen);\nvec2 projectOffset = project_pixel(offset);\nfloat lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nstyleMappingMat[3].a = lineOffsetWidth/linePixelSize;\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n}\nif(u_globel > 0.0) {\nvec3 startLngLat = lglt2xyz(a_Instance.rg);\nvec3 endLngLat = lglt2xyz(a_Instance.ba);\nfloat globalRadius = length(startLngLat);\nvec3 lineDir = normalize(endLngLat - startLngLat);\nvec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\nvec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\nfloat lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\nfloat lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\nvec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\ngl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n}\nsetPickingColor(a_PickingColor);\n}',lW='#define Animate 0.0\nuniform float u_opacity;\nuniform float u_blur : 0.9;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = styleMappingMat[3].g;\ngl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);\ngl_FragColor.a *= opacity;\nif(u_animate.x == Animate) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',cW='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nuniform float u_opacity: 1.0;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\nvarying vec2 v_iconMapUV;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat torad(float deg) {\nreturn (deg / 180.0) * acos(-1.0);\n}\nvec3 lglt2xyz(vec2 lnglat) {\nfloat pi = 3.1415926;\nfloat lng = torad(lnglat.x) + pi / 2.0;\nfloat lat = torad(lnglat.y);\nfloat radius = u_globel_radius;\nfloat z = radius * cos(lat) * cos(lng);\nfloat x = radius * cos(lat) * sin(lng);\nfloat y = radius * sin(lat);\nreturn vec3(x, y, z);\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\nvec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat d_distance_ratio;\nif(u_line_type == LineTypeDash) {\nd_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_animate.x == Animate) {\nd_distance_ratio = segmentIndex / segmentNumber;\n}\nstyleMappingMat[3].g = d_distance_ratio;\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec3 curr = getPos(source, target, segmentRatio);\nvec3 next = getPos(source, target, nextSegmentRatio);\nvec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\nv_segmentIndex = a_Position.x;\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) {\nfloat arcDistrance = length(source - target);\nfloat pixelLen =  project_pixel_texture(u_icon_step);\nstyleMappingMat[3].b = floor(arcDistrance/pixelLen);\nvec2 projectOffset = project_pixel(offset);\nfloat lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nstyleMappingMat[3].a = lineOffsetWidth/linePixelSize;\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n}\nif(u_globel > 0.0) {\nvec3 startLngLat = lglt2xyz(a_Instance.rg);\nvec3 endLngLat = lglt2xyz(a_Instance.ba);\nfloat globalRadius = length(startLngLat);\nvec3 lineDir = normalize(endLngLat - startLngLat);\nvec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\nvec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\nfloat lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\nfloat lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\nvec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\ngl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n}\nsetPickingColor(a_PickingColor);\n}',hW={solid:0,dash:1},fW=function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"texture",void 0),E(P(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5]:c,f=t.lineTexture,p=void 0!==f&&f,d=t.iconStep,v=void 0===d?100:d,g=t.segmentNumber,m=void 0===g?30:g,y=t.globalArcHeight,_=void 0===y?10:y;2===h.length&&h.push(0,0);var b=0,x=[0,0,0,0],S=[0,0,0,0];if(i&&o&&(x=Ay(i),S=Ay(o),b=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var E=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,E,this.cellProperties),C=A.data,T=A.width,w=A.height;this.rowCount=w,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:T,height:w}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:100,u_global_height:_,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(r)?r:1,u_textureBlend:"normal"===s?0:1,segmentNumber:m,u_line_type:hW[l]||0,u_dash_array:h,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:b,u_sourceColor:x,u_targetColor:S}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:lW,vert:cW,type:"Linear"}:{frag:sW,vert:uW,type:""}}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=t.mask,o=void 0!==i&&i,a=t.maskInside,s=void 0===a||a,u=this.getShaders(),l=u.frag,c=u.vert,h=u.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+h,vertexShader:c,fragmentShader:l,triangulation:bH,blend:this.getBlend(),segmentNumber:r,stencil:Oy(o,s)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),r}(PV),pW={solid:0,dash:1},dW=function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"texture",void 0),E(P(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5]:c,f=t.lineTexture,p=void 0!==f&&f,d=t.iconStep,v=void 0===d?100:d,g=t.segmentNumber,m=void 0===g?30:g,y=t.globalArcHeight,_=void 0===y?10:y;2===h.length&&h.push(0,0);var b=0,x=[0,0,0,0],S=[0,0,0,0];if(i&&o&&(x=Ay(i),S=Ay(o),b=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var E=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,E,this.cellProperties),C=A.data,T=A.width,w=A.height;this.rowCount=w,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:T,height:w}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:100,u_global_height:_,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(r)?r:1,u_textureBlend:"normal"===s?0:1,segmentNumber:m,u_line_type:pW[l]||0,u_dash_array:h,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:b,u_sourceColor:x,u_targetColor:S}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:lW,vert:cW,type:"Linear"}:{frag:sW,vert:uW,type:""}}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=t.mask,o=void 0!==i&&i,a=t.maskInside,s=void 0===a||a,u=this.getShaders(),l=u.frag,c=u.vert,h=u.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+h,vertexShader:c,fragmentShader:l,triangulation:bH,depth:{enable:!0},blend:this.getBlend(),segmentNumber:r,stencil:Oy(o,s)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),r}(PV),vW={solid:0,dash:1},gW=function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"texture",void 0),E(P(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5]:c,f=t.lineTexture,p=void 0!==f&&f,d=t.iconStep,v=void 0===d?100:d,g=t.segmentNumber,m=void 0===g?30:g;2===h.length&&h.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var y=0,_=[0,0,0,0],b=[0,0,0,0];if(i&&o&&(_=Ay(i),b=Ay(o),y=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var x=this.layer.getEncodedData(),S=this.calDataFrame(this.cellLength,x,this.cellProperties),E=S.data,A=S.width,C=S.height;this.rowCount=C,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:A,height:C}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(r)?r:1,u_textureBlend:"normal"===s?0:1,segmentNumber:m,u_line_type:vW[l]||0,u_dash_array:h,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:y,u_sourceColor:_,u_targetColor:b}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn index / (segmentNumber - 1.);\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\nvec2 delta = source - target;\nvec2 sin_half_delta = sin(delta / 2.0);\nfloat a =\nsin_half_delta.y * sin_half_delta.y +\ncos(source.y) * cos(target.y) *\nsin_half_delta.x * sin_half_delta.x;\nreturn 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\nvec2 midPoint(vec2 source, vec2 target) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = 0.314;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nreturn mid;\n}\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 mid = midPoint(source, target);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}else {\nif(abs(angularDist - PI) < 0.001) {\nreturn (1.0 - t) * source + t * target;\n}\nfloat a = sin((1.0 - t) * angularDist) / sin(angularDist);\nfloat b = sin(t * angularDist) / sin(angularDist);\nvec2 sin_source = sin(source);\nvec2 cos_source = cos(source);\nvec2 sin_target = sin(target);\nvec2 cos_target = cos(target);\nfloat x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\nfloat y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\nfloat z = a * sin_source.y + b * sin_target.y;\nreturn vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec2 source = radians(a_Instance.rg);\nvec2 target = radians(a_Instance.ba);\nfloat angularDist = getAngularDist(source, target);\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\ntotal_Distance = total_Distance*16.0;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n}\nif(u_animate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\n}\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nv_distance_ratio = segmentIndex / segmentNumber;\nvec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\nvec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nstyleMappingMat[3].g = a_Position.x;\nif(LineTexture == u_line_texture) {\nfloat d_arcDistrance = length(source - target);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nd_arcDistrance = d_arcDistrance * 1000000.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nd_arcDistrance = project_pixel_allmap(d_arcDistrance);\n}\nfloat d_pixelLen = project_pixel(u_icon_step)/8.0;\nstyleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen);\nfloat lineOffsetWidth = length(offset + offset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nstyleMappingMat[3].a = lineOffsetWidth/linePixelSize;\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_segmentIndex = styleMappingMat[3].g;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_line_type == LineTypeDash) {\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n} else {\ndiscard;\n};\n}\nif(u_animate.x == Animate) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \nfloat arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\nfloat count = styleMappingMat[3].b;\nfloat u = fract(arcRadio * count - animateSpeed * count);\nif(u_animate.x == Animate) {\nu = gl_FragColor.a/opacity;\n}\nfloat v = styleMappingMat[3].a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:bH,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(r,o)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),r}(PV),mW=function(t){A(i,t);var n,r=I(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.sourceColor,o=t.targetColor,a=t.arrow,s=void 0===a?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:a,u=0,l=[0,0,0,0],c=[0,0,0,0];if(i&&o&&(l=Ay(i),c=Ay(o),u=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var h=this.layer.getEncodedData(),f=this.calDataFrame(this.cellLength,h,this.cellProperties),p=f.data,d=f.width,v=f.height;this.rowCount=v,this.dataTexture=this.cellLength>0&&p.length>0?this.createTexture2D({flipY:!0,data:p,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:d,height:v}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(r)?r:1,u_linearColor:u,u_sourceColor:l,u_targetColor:c,u_arrow:Number(s.enable),u_arrowHeight:s.arrowHeight||3,u_arrowWidth:s.arrowWidth||2,u_tailWidth:void 0===s.tailWidth?1:s.tailWidth}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"buildModels",value:(n=_(g().mark((function e(t){var n,r,i,o,a,s,u,l,c,h;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=n.depth,u=void 0!==s&&s,l=this.getShaders(),c=l.frag,h=l.vert,this.layer.triangulation=lH,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:h,fragmentShader:c,triangulation:lH,depth:{enable:u},blend:this.getBlend(),stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:'#define COORDINATE_SYSTEM_LNGLAT 1.0\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n#define COORDINATE_SYSTEM_P20_2 8.0\nuniform float u_CoordinateSystem;\nvarying vec4 v_color;\nuniform float u_arrow: 0.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "picking"\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat distanceAndIndex = styleMappingMat[0][3];\nfloat miter = styleMappingMat[0][2];\nfloat opacity = styleMappingMat[0][0];\nfloat d_distance_ratio = styleMappingMat[3].r;\nif(u_arrow > 0.0 && distanceAndIndex < 2.0) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { \nif(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) {\ndiscard;\n}\n} else {\nif(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { \ndiscard;\n}\n}\n} else {\nif(miter < 0.0) {\ndiscard;\n}\n}\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec4 a_dirPoints;\nattribute vec3 a_DistanceAndIndex;\nuniform vec4 u_lineDir;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\nvec2 calculateArrow(vec2 offset) {\nfloat arrowFlag = -1.0;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\narrowFlag = 1.0;\n}\nfloat pi = arrowFlag * 3.1415926/2.;\nif(a_Miter < 0.) {\npi = -pi;\n}\nhighp float angle_sin = sin(pi);\nhighp float angle_cos = cos(pi);\nmat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\nfloat arrowWidth = u_arrowWidth;\nfloat arrowHeight = u_arrowHeight;\nvec2 arrowOffset = vec2(0.0);\nif(a_DistanceAndIndex.y == 0.0) {\noffset = vec2(0.0);\n} else if(a_DistanceAndIndex.y == 1.0) {\narrowOffset = rotation_matrix*(offset * arrowHeight);\noffset += arrowOffset;\noffset = offset * arrowWidth;\n} else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\narrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\noffset += arrowOffset;\n}\nreturn offset;\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nstyleMappingMat[0][3] = a_DistanceAndIndex.y;\nstyleMappingMat[0][2] = a_Miter;\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nvec2 copyOffset = vec2(offset.x, offset.y);\nfloat lineDistance = a_DistanceAndIndex.x;\nfloat total_Distance = a_DistanceAndIndex.z;\nfloat currentLinePointRatio = lineDistance / total_Distance;\nif(u_arrow > 0.0) {\noffset = calculateArrow(offset);\nif(a_DistanceAndIndex.y > 4.0) {\noffset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n}\n}\nfloat lineOffsetWidth = length(offset + offset * sign(a_Miter));\nfloat linePixelSize = project_pixel(a_Size.x) * 2.0;\nstyleMappingMat[3][0] = currentLinePointRatio;\nstyleMappingMat[3][1] = lineDistance;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat h = float(a_Position.z);\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nlineHeight *= 0.2;\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n}\nif(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {\nvec2 startPoint = a_dirPoints.rg;\nvec2 endPoint = a_dirPoints.ba;\nvec4 t1 = project_position(vec4(startPoint, 0, 1.0));\nvec4 t2 = project_position(vec4(endPoint, 0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;\nvec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;\nstyleMappingMat[1].rg = normalize(p1 - p2);\nstyleMappingMat[1].ba = normalize(gl_Position.xy - p2);\n} else {\nvec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;\nvec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;\nstyleMappingMat[1].rg = normalize(p1 - p2);\nstyleMappingMat[1].ba = normalize(gl_Position.xy - p2);\n}\n}\nsetPickingColor(a_PickingColor);\n}',type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:e.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10,n[5]]:[n[3],o,n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:e.AttributeType.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e){var t=e.coordinates[0]||[0,0],n=e.coordinates[3]||[0,0];return[t[0],t[1],n[0],n[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}})}}]),i}(PV),yW='#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\nvec2 calculateArrow(vec2 offset) {\nfloat arrowFlag = -1.0;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\narrowFlag = 1.0;\n}\nfloat pi = arrowFlag * 3.1415926/2.;\nif(a_Miter < 0.) {\npi = -pi;\n}\nhighp float angle_sin = sin(pi);\nhighp float angle_cos = cos(pi);\nmat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\nfloat arrowWidth = u_arrowWidth;\nfloat arrowHeight = u_arrowHeight;\nvec2 arrowOffset = vec2(0.0);\nif(a_DistanceAndIndex.y == 0.0) {\noffset = vec2(0.0);\n} else if(a_DistanceAndIndex.y == 1.0) {\narrowOffset = rotation_matrix*(offset * arrowHeight);\noffset += arrowOffset;\noffset = offset * arrowWidth;\n} else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\narrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\noffset += arrowOffset;\n}\nreturn offset;\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nfloat d_texPixelLen;\nv_iconMapUV = a_iconMapUV;\nd_texPixelLen = project_float_pixel(u_icon_step);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nd_texPixelLen *= 10.0;\n}\nv_color = a_Color;\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nfloat lineDistance = a_DistanceAndIndex.x;\nfloat currentLinePointRatio = lineDistance / a_Total_Distance;\nif(u_arrow > 0.0) {\noffset = calculateArrow(offset);\nif(a_DistanceAndIndex.y > 4.0) {\noffset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n}\n}\nfloat lineOffsetWidth = length(offset + offset * sign(a_Miter));\nfloat linePixelSize = project_pixel(a_Size.x) * 2.0;\nfloat texV = lineOffsetWidth/linePixelSize;\nstyleMappingMat[3][0] = currentLinePointRatio;\nstyleMappingMat[3][1] = lineDistance;\nstyleMappingMat[3][2] = d_texPixelLen;\nstyleMappingMat[3][3] = texV;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat h = float(a_Position.z) * u_vertexScale;\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nlineHeight *= 0.2;\nh *= 0.2;\nif(u_heightfixed < 1.0) {\nlineHeight = project_pixel(a_Size.y);\n}\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nh *= mapboxZoomScale;\nh += u_raisingHeight * mapboxZoomScale;\nif(u_heightfixed > 0.0) {\nlineHeight *= mapboxZoomScale;\n}\n} else {\nh += u_raisingHeight;\nif(u_heightfixed < 1.0) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',_W={solid:0,dash:1},bW=function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"texture",void 0),E(P(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5,0,0]:c,f=t.lineTexture,p=void 0!==f&&f,d=t.iconStep,v=void 0===d?100:d,g=t.vertexHeightScale,m=void 0===g?20:g,y=t.borderWidth,_=void 0===y?0:y,b=t.borderColor,x=void 0===b?"#ccc":b,S=t.raisingHeight,E=void 0===S?0:S,A=t.heightfixed,C=void 0!==A&&A,T=t.linearDir,w=void 0===T?e.LinearDir.VERTICAL:T,M=t.blur,k=void 0===M?[1,1,1]:M,O=t.arrow,P=void 0===O?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:O;2===h.length&&h.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var L=0,I=[0,0,0,0],R=[0,0,0,0];if(i&&o&&(I=Ay(i),R=Ay(o),L=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var N=this.layer.getEncodedData(),D=this.calDataFrame(this.cellLength,N,this.cellProperties),F=D.data,B=D.width,z=D.height;this.rowCount=z,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:B,height:z}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(r)?r:1,u_textureBlend:s===e.TextureBlend.NORMAL?0:1,u_line_type:_W[l],u_dash_array:h,u_blur:k,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:_,u_borderColor:Ay(x),u_linearDir:w===e.LinearDir.VERTICAL?1:0,u_linearColor:L,u_sourceColor:I,u_targetColor:R,u_heightfixed:Number(C),u_vertexScale:m,u_raisingHeight:Number(E),u_arrow:Number(P.enable),u_arrowHeight:P.arrowHeight||3,u_arrowWidth:P.arrowWidth||2,u_tailWidth:void 0===P.tailWidth?1:P.tailWidth}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=t.depth,s=void 0!==a&&a,u=t.workerEnabled,l=void 0!==u&&u,c=t.enablePicking,h=this.getShaders(),f=h.frag,p=h.vert,d=h.type;this.layer.triangulation=lx,this.layer.buildLayerModel({moduleName:"line"+d,vertexShader:p,fragmentShader:f,triangulation:lx,depth:{enable:s},blend:this.getBlend(),stencil:Oy(r,o),workerEnabled:l,workerOptions:{modelType:"line"+d,enablePicking:c,iconMap:this.iconService.getIconMap()}}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'#define LineTypeSolid 0.0\nuniform float u_opacity : 1.0;\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\n#pragma include "picking"\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_distance_ratio = styleMappingMat[3].r;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nfloat dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n} else {\ndiscard;\n};\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_vertexScale: 1.0;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\nv_color = a_Color;\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nstyleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance;\nstyleMappingMat[3][1] = a_DistanceAndIndex.x;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n} else {\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"Dash"}:t&&n?{frag:'varying vec4 v_color;\nuniform float u_linearDir: 1.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "picking"\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat linearRadio = styleMappingMat[3][0];\nif(u_linearDir < 1.0) {\nlinearRadio = styleMappingMat[3][3];\n}\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:yW,type:"Linear"}:{frag:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_borderWidth: 0.0;\nuniform vec3 u_blur;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying vec2 v_iconMapUV;\n#pragma include "picking"\nuniform float u_time;\nuniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ];\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = styleMappingMat[3].r;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nif(u_animate.x == Animate) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture) {\nfloat aDistance = styleMappingMat[3].g;\nfloat d_texPixelLen = styleMappingMat[3].b;\nfloat u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\nfloat v = styleMappingMat[3].a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor += pattern;\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = pattern;\n}\n} \nfloat v = styleMappingMat[3].a;\nfloat borderWidth = min(0.5, u_borderWidth);\nif(borderWidth > 0.01) {\nfloat borderOuterWidth = borderWidth/2.0;\nif(v >= 1.0 - borderWidth || v <= borderWidth) {\nif(v > borderWidth) {\nfloat linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\ngl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n} else if(v <= borderWidth) {\nfloat linear = smoothstep(0.0, 1.0, v/borderWidth);\ngl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n}\n}\nif(v < borderOuterWidth) {\ngl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n} else if(v > 1.0 - borderOuterWidth) {\ngl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n}\n}\nfloat blurV = styleMappingMat[3][3];\nif(blurV < 0.5) {\ngl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n} else {\ngl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:yW,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:e.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),r}(PV),xW=function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"colorTexture",void 0),E(P(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;t.colorTexture&&t.colorTexture.destroy();var r=wy(t.layer.getLayerConfig().rampColors);t.colorTexture=n({data:new Uint8Array(r.data),width:r.width,height:r.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.NEAREST,mag:e.gl.NEAREST,flipY:!1})})),t}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.vertexHeightScale,o=void 0===i?20:i,a=t.raisingHeight,s=void 0===a?0:a,u=t.heightfixed,l=void 0!==u&&u,c=t.linearDir,h=void 0===c?e.LinearDir.VERTICAL:c;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var f=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,f,this.cellProperties),d=p.data,v=p.width,g=p.height;this.rowCount=g,this.dataTexture=this.cellLength>0&&d.length>0?this.createTexture2D({flipY:!0,data:d,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:v,height:g}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:h===e.LinearDir.VERTICAL?1:0,u_opacity:XF(r)?r:1,u_texture:this.colorTexture,u_heightfixed:Number(l),u_vertexScale:o,u_raisingHeight:Number(s)}}},{key:"initModels",value:function(e){this.updateTexture(),this.buildModels(e)}},{key:"clearModels",value:function(){var e,t;null===(e=this.colorTexture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=t.depth,s=void 0!==a&&a;this.layer.triangulation=lH,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:'attribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\n#pragma include "projection"\n#pragma include "picking"\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nfloat lineDistance = a_DistanceAndIndex.x;\nfloat currentLinePointRatio = lineDistance / a_Total_Distance;\nfloat lineOffsetWidth = length(offset + offset * sign(a_Miter));\nfloat linePixelSize = project_pixel(a_Size.x) * 2.0;\nfloat texV = lineOffsetWidth/linePixelSize;\nstyleMappingMat[3][0] = currentLinePointRatio;\nstyleMappingMat[3][3] = texV;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat h = float(a_Position.z) * u_vertexScale;\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nlineHeight *= 0.2;\nh *= 0.2;\nif(u_heightfixed < 1.0) {\nlineHeight = project_pixel(a_Size.y);\n}\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nh *= mapboxZoomScale;\nh += u_raisingHeight * mapboxZoomScale;\nif(u_heightfixed > 0.0) {\nlineHeight *= mapboxZoomScale;\n}\n} else {\nh += u_raisingHeight;\nif(u_heightfixed < 1.0) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity : 1.0;\nuniform sampler2D u_texture;\nuniform float u_linearDir: 1.0;\n#pragma include "picking"\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat linearRadio = styleMappingMat[3].r;\nif(u_linearDir < 1.0) {\nlinearRadio = styleMappingMat[3][3];\n}\ngl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:lH,depth:{enable:s},blend:this.getBlend(),stencil:Oy(r,o)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:e.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}})}}]),r}(PV),SW='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\n#pragma include "projection"\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color; \nstyleMappingMat[3][0] = a_Distance / a_Total_Distance;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat h = float(a_Position.z) * u_vertexScale;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n} else {\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nh *= 2.0/pow(2.0, 20.0 - u_Zoom);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\ngl_PointSize = 10.0;\n}\n}',EW=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.sourceColor,o=t.targetColor,a=t.vertexHeightScale,s=void 0===a?20:a,u=0,l=[0,0,0,0],c=[0,0,0,0];if(i&&o&&(l=Ay(i),c=Ay(o),u=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var h=this.layer.getEncodedData(),f=this.calDataFrame(this.cellLength,h,this.cellProperties),p=f.data,d=f.width,v=f.height;this.rowCount=v,this.dataTexture=this.cellLength>0&&p.length>0?this.createTexture2D({flipY:!0,data:p,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:d,height:v}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(r)?r:1,u_linearColor:u,u_sourceColor:l,u_targetColor:c,u_vertexScale:s}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:"uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);\ngl_FragColor.a *= opacity;\n}",vert:SW,type:"lineSimpleLinear"}:{frag:"varying vec4 v_color;\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_distance_ratio = styleMappingMat[3].r;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\n}",vert:SW,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=this.getShaders(),u=s.frag,l=s.vert,c=s.type;this.layer.buildLayerModel({moduleName:c,vertexShader:l,fragmentShader:u,triangulation:cH,primitive:e.gl.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(i,a),pick:!1}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}})}}]),r}(PV),AW={arc:aW,arc3d:fW,greatcircle:gW,wall:function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"texture",void 0),E(P(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.heightfixed,u=void 0!==s&&s,l=e.lineTexture,c=void 0!==l&&l,h=e.iconStep,f=void 0===h?100:h,p=e.iconStepCount,d=void 0===p?1:p;this.rendererService.getDirty()&&this.texture.bind();var v=0,g=[0,0,0,0],m=[0,0,0,0];return r&&i&&(g=Ay(r),m=Ay(i),v=1),{u_heightfixed:Number(u),u_opacity:XF(n)?n:1,u_textureBlend:"normal"===a?0:1,u_texture:this.texture,u_line_texture:c?1:0,u_iconStepCount:d,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:g,u_targetColor:m}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(e){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\nuniform float u_linearColor: 0;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvarying vec2 v_iconMapUV;\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_dataset;\nvoid main() {\nfloat d_distance_ratio;\nfloat d_texPixelLen;\nv_iconMapUV = a_iconMapUV;\nif(u_heightfixed < 1.0) {\nd_texPixelLen = project_pixel(u_icon_step);\n} else {\nd_texPixelLen = u_icon_step;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nd_texPixelLen *= 10.0;\n}\nif(u_animate.x == Animate || u_linearColor == 1.0) {\nd_distance_ratio = a_Distance / a_Total_Distance;\n}\nfloat miter = (a_Miter + 1.0)/2.0;\nv_dataset[0] = d_distance_ratio;\nv_dataset[1] = a_Distance;\nv_dataset[2] = d_texPixelLen;\nv_dataset[3] = miter;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat originSize = a_Size.x;\nif(u_heightfixed < 1.0) {\noriginSize = project_float_pixel(a_Size.x);\n}\nfloat wallHeight = originSize * miter;\nfloat lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\nv_blur = min(project_float_pixel(2.0) / originSize, 0.05);\nv_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_color;\nvarying vec4 v_dataset;\n#pragma include "picking"\nvoid main() {\nfloat opacity = u_opacity;\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = v_dataset.r;\nfloat v = v_dataset.a;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_animate.x == Animate) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture) {\nfloat aDistance = v_dataset.g;\nfloat d_texPixelLen = v_dataset.b;\nfloat u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\nfloat v = v_dataset.a;\nfloat flag = 0.0;\nif(u > 1.0/u_iconStepCount) {\nflag = 1.0;\n}\nu = fract(u*u_iconStepCount);\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(flag > 0.0) {\npattern = vec4(0.0);\n}\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n}\nif(v < v_blur) {\ngl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n} else if(v > 1.0 - v_blur) {\ngl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:lH,depth:{enable:!1},blend:this.getBlend()}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),r}(PV),line:bW,halfLine:mW,simple:EW,linearline:xW,vectorline:iW,tileLine:nG,earthArc3d:dW},CW=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","LineLayer"),E(P(e),"arrowInsertCount",0),E(P(e),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new AW[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;if(XH(this.layerSource.getParserType()))return"vectorline";var t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}}]),n}(hV);or({target:"String",proto:!0},{repeat:lm});var TW=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"raiseCount",0),E(P(e),"raiseRepeat",0),e}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption,r=void 0===n?{enable:!1,speed:.01,repeat:!1}:n,i=t.opacity,o=void 0===i?1:i,a=t.sourceColor,s=t.targetColor,u=t.pickLight,l=void 0!==u&&u,c=t.heightfixed,h=void 0!==c&&c,f=t.opacityLinear,p=void 0===f?{enable:!1,dir:"up"}:f,d=t.lightEnable,v=void 0===d||d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var g=this.layer.getEncodedData(),m=this.calDataFrame(this.cellLength,g,this.cellProperties),y=m.data,_=m.width,b=m.height;this.rowCount=b,this.dataTexture=this.cellLength>0&&y.length>0?this.createTexture2D({flipY:!0,data:y,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:_,height:b}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}var x=0,S=[0,0,0,0],E=[0,0,0,0];if(a&&s&&(S=Ay(a),E=Ay(s),x=1),this.raiseCount<1&&this.raiseRepeat>0&&r.enable){var A=r.speed,C=void 0===A?.01:A;this.raiseCount+=C,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(l),u_heightfixed:Number(h),u_r:r.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(o)?o:1,u_linearColor:x,u_sourceColor:S,u_targetColor:E,u_opacitylinear:Number(p.enable),u_opacitylinear_dir:"up"===p.dir?1:0,u_lightEnable:Number(v)}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig().animateOption.repeat,n=void 0===t?1:t;this.raiseRepeat=n,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\nuniform float u_heightfixed: 0.0;\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nfloat getYRadian(float x, float z) {\nif(x > 0.0 && z > 0.0) {\nreturn atan(x/z);\n} else if(x > 0.0 && z <= 0.0){\nreturn atan(-z/x) + pi/2.0;\n} else if(x <= 0.0 && z <= 0.0) {\nreturn  pi + atan(x/z);\n} else {\nreturn atan(z/-x) + pi*3.0/2.0;\n}\n}\nfloat getXRadian(float y, float r) {\nreturn atan(y/r);\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec3 size = a_Size * a_Position;\nstyleMappingMat[2][3] =  a_Position.z;\nvec3 offset = size;\nif(u_heightfixed < 1.0) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\noffset = offset * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\noffset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\noffset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n}\n}\nvec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\nvec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\nfloat lightWeight = 1.0;\nif(u_lightEnable > 0.0) {\nlightWeight = calc_lighting(pos);\n}\nstyleMappingMat[1][3] = lightWeight;\nv_color =vec4(a_Color.rgb * lightWeight, a_Color.w);\nfloat r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\nfloat xRadian = getXRadian(a_Pos.y, r);\nfloat xcos = cos(xRadian);\nfloat xsin = sin(xRadian);\nmat4 mx = mat4(\n1,0,0,0,  \n0,xcos,-xsin,0,  \n0,xsin,xcos,0,  \n0,0,0,1);\nfloat yRadian = getYRadian(a_Pos.x, a_Pos.z);\nfloat ycos = cos(yRadian);\nfloat ysin = sin(yRadian);\nmat4 my = mat4(\nycos,0,-ysin,0,  \n0,1,0,0,  \nysin,0,ycos,0,  \n0,0,0,1);\ngl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\nuniform float u_pickLight: 0.0;\n#pragma include "picking"\nvarying mat4 styleMappingMat;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat lightWeight = styleMappingMat[1][3];\nfloat barLinearZ = styleMappingMat[2][3];\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);\ngl_FragColor.rgb *= lightWeight;\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_opacitylinear > 0.0) {\ngl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;\n}\nif(u_pickLight > 0.0) {\ngl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:sH,depth:{enable:!0},cull:{enable:!0,face:Cx(this.mapService.version)},blend:this.getBlend()}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e){var t=jm(e.coordinates);return NV([t[0],t[1]])}}})}}]),r}(PV),wW=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.strokeOpacity,o=void 0===i?1:i,a=t.strokeWidth,s=void 0===a?0:a,u=t.stroke,l=void 0===u?"rgba(0,0,0,0)":u,c=t.offsets,h=void 0===c?[0,0]:c,f=t.blend,p=t.blur,d=void 0===p?0:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:h})){this.judgeStyleAttributes({opacity:r,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:h});var v=this.layer.getEncodedData(),g=this.calDataFrame(this.cellLength,v,this.cellProperties),m=g.data,y=g.width,_=g.height;this.rowCount=_,this.dataTexture=this.cellLength>0&&m.length>0?this.createTexture2D({flipY:!0,data:m,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:y,height:_}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_blur:d,u_additive:"additive"===f?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(r)?r:1,u_stroke_opacity:XF(o)?o:1,u_stroke_width:XF(s)?s:1,u_stroke_color:this.getStrokeColor(l),u_offsets:this.isOffsetStatic(h)?h:[0,0]}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){this.layer.triangulation=aH,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nvarying mat4 styleMappingMat;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\nuniform float u_blur : 0.0;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nfloat shape_type = a_Shape;\nfloat newSize = setPickingSize(a_Size);\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = strokeOpacityAndOffset.r;\ntextureOffset = strokeOpacityAndOffset.g;\nvec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][2] = strokeWidthAndOffset.r;\ntextureOffset = strokeWidthAndOffset.g;\nvec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\nif(hasStroke()) {\nvec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\nif(u_stroke_color == vec4(0.0)) {\nstyleMappingMat[1][0] = v_color.r;\nstyleMappingMat[1][1] = v_color.g;\nstyleMappingMat[1][2] = v_color.b;\nstyleMappingMat[1][3] = v_color.a;\n} else {\nstyleMappingMat[1][0] = u_stroke_color.r;\nstyleMappingMat[1][1] = u_stroke_color.g;\nstyleMappingMat[1][2] = u_stroke_color.b;\nstyleMappingMat[1][3] = u_stroke_color.a;\n}\n}\nv_color = a_Color;\nv_radius = newSize;\nfloat antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\nv_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\ngl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_additive;\nvarying mat4 styleMappingMat;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nint shape = int(floor(v_data.w + 0.5));\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat opacity = styleMappingMat[0][0];\nfloat stroke_opacity = styleMappingMat[0][1];\nfloat strokeWidth = styleMappingMat[0][2];\nvec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius + strokeWidth);\nfloat outer_df;\nfloat inner_df;\nif (shape == 0) {\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\n} else if (shape == 1) {\nouter_df = sdEquilateralTriangle(1.1 * v_data.xy);\ninner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n} else if (shape == 2) {\nouter_df = sdBox(v_data.xy, vec2(1.));\ninner_df = sdBox(v_data.xy, vec2(r));\n} else if (shape == 3) {\nouter_df = sdPentagon(v_data.xy, 0.8);\ninner_df = sdPentagon(v_data.xy, r * 0.8);\n} else if (shape == 4) {\nouter_df = sdHexagon(v_data.xy, 0.8);\ninner_df = sdHexagon(v_data.xy, r * 0.8);\n} else if (shape == 5) {\nouter_df = sdOctogon(v_data.xy, 1.0);\ninner_df = sdOctogon(v_data.xy, r);\n} else if (shape == 6) {\nouter_df = sdHexagram(v_data.xy, 0.52);\ninner_df = sdHexagram(v_data.xy, r * 0.52);\n} else if (shape == 7) {\nouter_df = sdRhombus(v_data.xy, vec2(1.0));\ninner_df = sdRhombus(v_data.xy, vec2(r));\n} else if (shape == 8) {\nouter_df = sdVesica(v_data.xy, 1.1, 0.8);\ninner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n}\nif(outer_df > antialiasblur + 0.018) discard;\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\nfloat color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\nantialiasblur,\n0.0,\ninner_df\n);\nif(strokeWidth < 0.01) {\ngl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n} else {\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);\n}\nif(u_additive > 0.0) {\ngl_FragColor *= opacity_t;\ngl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n} else {\ngl_FragColor.a *= opacity_t;\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:aH,depth:{enable:!0},blend:this.getBlend()}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=D(n,3),o=i[0],a=i[1],s=i[2],u=mb(0,0,1),l=mb(o,0,s),c=o>=0?Ob(u,l):2*Math.PI-Ob(u,l),h=2*Math.PI-Math.asin(a/100),f=W_();eb(f,f,c),J_(f,f,h);var p=mb(1,1,0);kb(p,p,f),Tb(p,p);var d=mb(-1,1,0);kb(d,d,f),Tb(d,d);var v=mb(-1,-1,0);kb(v,v,f),Tb(v,v);var g=mb(1,-1,0);kb(g,g,f),Tb(g,g);var m=[].concat(F(p),F(d),F(v),F(g)),y=r%4*3;return[m[y],m[y+1],m[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:e.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n;return[t.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),r}(PV),MW=function(t){A(i,t);var n,r=I(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(P(e=r.call.apply(r,[this].concat(n))),"raiseCount",0),E(P(e),"raiseRepeat",0),e}return S(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption,r=void 0===n?{enable:!1,speed:.01,repeat:!1}:n,i=t.opacity,o=void 0===i?1:i,a=t.sourceColor,s=t.targetColor,u=t.pickLight,l=void 0!==u&&u,c=t.heightfixed,h=void 0!==c&&c,f=t.opacityLinear,p=void 0===f?{enable:!1,dir:"up"}:f,d=t.lightEnable,v=void 0===d||d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var g=this.layer.getEncodedData(),m=this.calDataFrame(this.cellLength,g,this.cellProperties),y=m.data,_=m.width,b=m.height;this.rowCount=b,this.dataTexture=this.cellLength>0&&y.length>0?this.createTexture2D({flipY:!0,data:y,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:_,height:b}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}var x=0,S=[0,0,0,0],E=[0,0,0,0];if(a&&s&&(S=Ay(a),E=Ay(s),x=1),this.raiseCount<1&&this.raiseRepeat>0&&r.enable){var A=r.speed,C=void 0===A?.01:A;this.raiseCount+=C,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(l),u_heightfixed:Number(h),u_r:r.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(o)?o:1,u_linearColor:x,u_sourceColor:S,u_targetColor:E,u_opacitylinear:Number(p.enable),u_opacitylinear_dir:"up"===p.dir?1:0,u_lightEnable:Number(v)}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:(n=_(g().mark((function e(t){var n,r,i,o,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.layer.getLayerConfig(),r=n.depth,i=void 0===r||r,o=n.animateOption.repeat,a=void 0===o?1:o,this.raiseRepeat=a,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'precision highp float;\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\nuniform float u_heightfixed: 0.0;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nfloat getYRadian(float x, float z) {\nif(x > 0.0 && z > 0.0) {\nreturn atan(x/z);\n} else if(x > 0.0 && z <= 0.0){\nreturn atan(-z/x) + pi/2.0;\n} else if(x <= 0.0 && z <= 0.0) {\nreturn  pi + atan(x/z);\n} else {\nreturn atan(z/-x) + pi*3.0/2.0;\n}\n}\nfloat getXRadian(float y, float r) {\nreturn atan(y/r);\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec3 size = a_Size * a_Position;\nstyleMappingMat[2][3] =  a_Position.z;\nvec3 offset = size;\nif(u_heightfixed < 1.0) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\noffset = offset * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\noffset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\noffset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n}\n}\nvec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\nvec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\nfloat lightWeight = 1.0;\nif(u_lightEnable > 0.0) {\nlightWeight = calc_lighting(pos);\n}\nstyleMappingMat[1][3] = lightWeight;\nv_color =vec4(a_Color.rgb * lightWeight, a_Color.w);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * pos;\n} else {\ngl_Position = project_common_position_to_clipspace(pos);\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\nuniform float u_pickLight: 0.0;\n#pragma include "picking"\nvarying mat4 styleMappingMat;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat lightWeight = styleMappingMat[1][3];\nfloat barLinearZ = styleMappingMat[2][3];\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);\ngl_FragColor.rgb *= lightWeight;\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_opacitylinear > 0.0) {\ngl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;\n}\nif(u_pickLight > 0.0) {\ngl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:sH,blend:this.getBlend(),cull:{enable:!0,face:Cx(this.mapService.version)},depth:{enable:i}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e){var t=jm(e.coordinates);return[t[0],t[1],0]}}})}}]),i}(PV),kW='uniform float u_additive;\nvarying mat4 styleMappingMat;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat opacity = styleMappingMat[0][0];\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius);\nfloat outer_df;\nfloat inner_df;\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\nfloat color_t = smoothstep(\nantialiasblur,\n0.0,\ninner_df\n);\nfloat PI = 3.14159;\nfloat N_RINGS = 3.0;\nfloat FREQ = 1.0;\ngl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\nfloat d = length(v_data.xy);\nif(d > 0.5) {\ndiscard;\n}\nfloat intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\nif(u_additive > 0.0) {\ngl_FragColor *= intensity;\ngl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n} else {\ngl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',OW='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nvarying mat4 styleMappingMat;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_meter2coord;\nuniform float u_meteryScale;\nuniform float u_isMeter;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\nuniform float u_blur : 0.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nfloat shape_type = a_Shape;\nfloat newSize = setPickingSize(a_Size) * u_meter2coord;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = strokeOpacityAndOffset.r;\ntextureOffset = strokeOpacityAndOffset.g;\nvec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][2] = strokeWidthAndOffset.r;\ntextureOffset = strokeWidthAndOffset.g;\nvec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\nif(hasStroke()) {\nvec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\nif(u_stroke_color == vec4(0.0)) {\nstyleMappingMat[1][0] = v_color.r;\nstyleMappingMat[1][1] = v_color.g;\nstyleMappingMat[1][2] = v_color.b;\nstyleMappingMat[1][3] = v_color.a;\n} else {\nstyleMappingMat[1][0] = u_stroke_color.r;\nstyleMappingMat[1][1] = u_stroke_color.g;\nstyleMappingMat[1][2] = u_stroke_color.b;\nstyleMappingMat[1][3] = u_stroke_color.a;\n}\n}\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nv_color = a_Color;\nv_radius = newSize;\nfloat antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\nvec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);\nvec3 aPosition = a_Position;\nif(u_isMeter < 1.0) {\noffset = project_pixel(offset);\n} else {\nif(newSize * pow(2.0, u_Zoom) < 48.0) {\nantialiasblur = max(antialiasblur, -0.05);\n} else if(newSize * pow(2.0, u_Zoom) < 128.0) {\nantialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));\n} else {\nantialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\naPosition.x += offset.x / u_meteryScale;\naPosition.y += offset.y;\noffset = vec2(0.0);\n}\n}\nv_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\nvec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\nfloat raisingHeight = u_raisingHeight;\nif(u_heightfixed < 1.0) {\nraisingHeight = project_pixel(u_raisingHeight);\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraisingHeight = u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',PW=function(t){A(i,t);var n,r=I(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(P(e=r.call.apply(r,[this].concat(n))),"meter2coord",1),E(P(e),"meterYScale",1),E(P(e),"isMeter",!1),E(P(e),"unit","l7size"),e}return S(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.strokeOpacity,o=void 0===i?1:i,a=t.strokeWidth,s=void 0===a?0:a,u=t.stroke,l=void 0===u?"rgba(0,0,0,0)":u,c=t.offsets,h=void 0===c?[0,0]:c,f=t.blend,p=t.blur,d=void 0===p?0:p,v=t.raisingHeight,g=void 0===v?0:v,m=t.heightfixed,y=void 0!==m&&m,_=t.unit,b=void 0===_?"l7size":_;if(this.updateUnit(b),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:h})){this.judgeStyleAttributes({opacity:r,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:h});var x=this.layer.getEncodedData(),S=this.calDataFrame(this.cellLength,x,this.cellProperties),E=S.data,A=S.width,C=S.height;this.rowCount=C,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:A,height:C}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(g),u_heightfixed:Number(y),u_meter2coord:this.meter2coord,u_meteryScale:this.meterYScale,u_isMeter:Number(this.isMeter),u_blur:d,u_additive:"additive"===f?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(r)?r:1,u_stroke_opacity:XF(o)?o:1,u_stroke_width:XF(s)?s:1,u_stroke_color:this.getStrokeColor(l),u_offsets:this.isOffsetStatic(h)?h:[0,0]}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),cx)}},{key:"initModels",value:function(e){this.updateUnit("l7size"),this.buildModels(e)}},{key:"calMeter2Coord",value:function(){var t=D(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],o=t[3],a=[(n+i)/2,(r+o)/2],s=this.mapService.version,u=null==Zv?void 0:Zv.mapboxgl;if(s===e.Version.MAPBOX&&null!=u&&u.MercatorCoordinate){var l=u.MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]},0),c=l.meterInMercatorCoordinateUnits(),h=new u.MercatorCoordinate(l.x-c,l.y,l.z).toLngLat(),f=new u.MercatorCoordinate(l.x,l.y-c,l.z).toLngLat();return this.meter2coord=a[0]-h.lng,void(this.meterYScale=(f.lat-a[1])/this.meter2coord)}var p=this.mapService.meterToCoord(a,[n,r]),d=this.mapService.meterToCoord(a,[i===n?i+.1:i,o===r?r+.1:o]);this.meter2coord=(p+d)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:(n=_(g().mark((function e(t){var n,r,i,o,a,s,u,l,c,h,f,p,d,v,m;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=n.animateOption,u=void 0===s?{enable:!1}:s,l=n.workerEnabled,c=void 0!==l&&l,h=n.enablePicking,f=n.shape2d,p=this.getShaders(u),d=p.frag,v=p.vert,m=p.type,this.layer.triangulation=cx,this.layer.buildLayerModel({moduleName:m,vertexShader:v,fragmentShader:d,triangulation:cx,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(i,a),workerEnabled:c,workerOptions:{modelType:m,enablePicking:h,shape2d:f}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getShaders",value:function(e){if(!e.enable)return{frag:'uniform float u_additive;\nvarying mat4 styleMappingMat;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nint shape = int(floor(v_data.w + 0.5));\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat opacity = styleMappingMat[0][0];\nfloat stroke_opacity = styleMappingMat[0][1];\nfloat strokeWidth = styleMappingMat[0][2];\nvec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius + strokeWidth);\nfloat outer_df;\nfloat inner_df;\nif (shape == 0) {\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\n} else if (shape == 1) {\nouter_df = sdEquilateralTriangle(1.1 * v_data.xy);\ninner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n} else if (shape == 2) {\nouter_df = sdBox(v_data.xy, vec2(1.));\ninner_df = sdBox(v_data.xy, vec2(r));\n} else if (shape == 3) {\nouter_df = sdPentagon(v_data.xy, 0.8);\ninner_df = sdPentagon(v_data.xy, r * 0.8);\n} else if (shape == 4) {\nouter_df = sdHexagon(v_data.xy, 0.8);\ninner_df = sdHexagon(v_data.xy, r * 0.8);\n} else if (shape == 5) {\nouter_df = sdOctogon(v_data.xy, 1.0);\ninner_df = sdOctogon(v_data.xy, r);\n} else if (shape == 6) {\nouter_df = sdHexagram(v_data.xy, 0.52);\ninner_df = sdHexagram(v_data.xy, r * 0.52);\n} else if (shape == 7) {\nouter_df = sdRhombus(v_data.xy, vec2(1.0));\ninner_df = sdRhombus(v_data.xy, vec2(r));\n} else if (shape == 8) {\nouter_df = sdVesica(v_data.xy, 1.1, 0.8);\ninner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n}\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\nfloat color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\nantialiasblur,\n0.0,\ninner_df\n);\nif(strokeWidth < 0.01) {\ngl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n} else {\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);\n}\nif(u_additive > 0.0) {\ngl_FragColor *= opacity_t;\ngl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n} else {\ngl_FragColor.a *= opacity_t;\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',vert:OW,type:"pointFill"};switch(e.type){case"wave":default:return{frag:kW,vert:OW,type:"pointWave"}}}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:e.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n;return[t.indexOf(r)]}}})}},{key:"updateUnit",value:function(t){var n=this.mapService.version;this.unit!==t&&("meter"!==this.unit&&"meter"===t&&n!==e.Version.L7MAP&&n!==e.Version.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):"meter"===this.unit&&"meter"!==t&&(this.isMeter=!1,this.meter2coord=1),this.unit=t)}}]),i}(PV),LW=function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"meter2coord",1),E(P(t),"texture",void 0),E(P(t),"isMeter",!1),E(P(t),"radian",0),E(P(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layerService.throttleRenderLayers();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.LINEAR,min:e.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.offsets,o=void 0===i?[0,0]:i,a=t.rotation,s=t.raisingHeight,u=void 0===s?0:s,l=t.heightfixed,c=void 0!==l&&l;this.rendererService.getDirty()&&this.texture.bind();var h=1;if("GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(h=-1),this.radian=void 0!==a?h*Math.PI*a/180:h*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,offsets:o})){this.judgeStyleAttributes({opacity:r,offsets:o});var f=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,f,this.cellProperties),d=p.data,v=p.width,g=p.height;this.rowCount=g,this.dataTexture=this.cellLength>0&&d.length>0?this.createTexture2D({flipY:!0,data:d,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:v,height:g}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(u),u_heightfixed:Number(c),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:XF(r)?r:1,u_offsets:this.isOffsetStatic(o)?o:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),oH)}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var n=this.layer.getLayerConfig().unit,r=void 0===n?"l7size":n,i=this.mapService.version;"meter"===r&&i!==e.Version.L7MAP&&i!==e.Version.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=D(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],o=t[3],a=[(n+i)/2,(r+o)/2];if(this.mapService.version===e.Version.MAPBOX&&window.mapboxgl.MercatorCoordinate){var s=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]},0),u=1*s.meterInMercatorCoordinateUnits(),l=new window.mapboxgl.MercatorCoordinate(s.x-u,s.y,s.z).toLngLat();this.meter2coord=a[0]-l.lng}else{var c=this.mapService.meterToCoord(a,[n,r]),h=this.mapService.meterToCoord(a,[i===n?i+.1:i,o===r?r+.1:o]);this.meter2coord=(c+h)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nattribute float a_Rotate;\nvarying mat4 styleMappingMat;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform float u_isMeter;\nvarying vec2 v_uv;\nvarying vec2 v_Iconuv;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nv_uv = (a_Extrude.xy + 1.0)/2.0;\nv_uv.y = 1.0 - v_uv.y;\nv_Iconuv = a_Uv;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nhighp float angle_sin = sin(a_Rotate);\nhighp float angle_cos = cos(a_Rotate);\nmat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\nvec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\nvec3 aPosition = a_Position;\nif(u_isMeter < 1.0) {\noffset = project_pixel(offset);\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\naPosition.xy += offset;\noffset.x = 0.0;\noffset.y = 0.0;\n}\n}\nvec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\nfloat raisingHeight = u_raisingHeight;\nif(u_heightfixed < 1.0) {\nraisingHeight = project_pixel(u_raisingHeight);\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraisingHeight = u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying mat4 styleMappingMat;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv;\nvarying vec2 v_Iconuv;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nvec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\ngl_FragColor = texture2D(u_texture, pos);\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:oH,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(r,o),cull:{enable:!0,face:Cx(this.mapService.version)}}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"clearModels",value:function(){var e,t;this.iconService.off("imageUpdate",this.updateTexture),null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:e.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var n=e.size,r=void 0===n?5:n;return Array.isArray(r)?[r[0]*t.meter2coord]:[r*t.meter2coord]}}})}}]),r}(PV),IW=function(t){A(r,t);var n=I(r);function r(){var t;b(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return E(P(t=n.call.apply(n,[this].concat(o))),"texture",void 0),E(P(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layerService.throttleRenderLayers();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.LINEAR,min:e.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.offsets,o=void 0===i?[0,0]:i,a=t.raisingHeight,s=void 0===a?0:a,u=t.heightfixed,l=void 0!==u&&u;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,offsets:o})){this.judgeStyleAttributes({opacity:r,offsets:o});var c=this.layer.getEncodedData(),h=this.calDataFrame(this.cellLength,c,this.cellProperties),f=h.data,p=h.width,d=h.height;this.rowCount=d,this.dataTexture=this.cellLength>0&&f.length>0?this.createTexture2D({flipY:!0,data:f,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:p,height:d}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(s),u_heightfixed:Number(l),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:XF(r)?r:1,u_offsets:this.isOffsetStatic(o)?o:[0,0]}}},{key:"initModels",value:function(e){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\nuniform float u_opacity : 1;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nstyleMappingMat[1][0] = a_Size;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nv_color = a_Color;\nv_uv = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nvec2 offset = project_pixel(textrueOffsets);\nfloat raisingHeight = u_raisingHeight;\nif(u_heightfixed < 1.0) {\nraisingHeight = project_pixel(u_raisingHeight);\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraisingHeight = u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main(){\nfloat opacity = styleMappingMat[0][0];\nfloat size = styleMappingMat[1][0];\nvec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\nvec4 textureColor;\ntextureColor = texture2D(u_texture, pos);\nfloat fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\nif(fragmengTocenter >= 0.5) {\nfloat luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\ntextureColor.a *= luma;\n}\nif(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\ngl_FragColor= textureColor;\n}else {\ngl_FragColor= step(0.01, textureColor.z) * v_color;\n}\ngl_FragColor.a = gl_FragColor.a * opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:uH,depth:{enable:!1},primitive:e.gl.POINTS,blend:this.getBlend(),stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[n.x,n.y]}}})}}]),r}(PV);function RW(e){var t=e.coordinates;return{vertices:F(t),indices:[0],size:t.length}}var NW=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:XF(t)?t:1}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o;this.layer.triangulation=RW,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n#pragma include "projection"\n#pragma include "project"\nvoid main() {\nv_color = a_Color;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\ngl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n}',fragmentShader:"uniform float u_opacity : 1;\nvarying vec4 v_color;\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\n}",triangulation:RW,depth:{enable:!1},primitive:e.gl.POINTS,blend:this.getBlend(),stencil:Oy(i,a),pick:!1}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),r}(PV),DW=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"meter2coord",1),E(P(e),"isMeter",!1),e}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.blend,i=e.speed,o=void 0===i?1:i;return{u_isMeter:Number(this.isMeter),u_speed:o,u_additive:"additive"===r?1:0,u_opacity:XF(n)?n:1}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),oH)}},{key:"initModels",value:function(t){var n=this.layer.getLayerConfig().unit,r=void 0===n?"l7size":n,i=this.mapService.version;"meter"===r&&i!==e.Version.L7MAP&&i!==e.Version.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=D(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],o=t[3],a=[(n+i)/2,(r+o)/2];if(this.mapService.version===e.Version.MAPBOX&&window.mapboxgl.MercatorCoordinate){var s=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]},0),u=1*s.meterInMercatorCoordinateUnits(),l=new window.mapboxgl.MercatorCoordinate(s.x-u,s.y,s.z).toLngLat();this.meter2coord=a[0]-l.lng}else{var c=this.mapService.meterToCoord(a,[n,r]),h=this.mapService.meterToCoord(a,[i===n?i+.1:i,o===r?r+.1:o]);this.meter2coord=(c+h)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nuniform float u_speed: 1.0;\nuniform float u_time;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_isMeter;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nfloat newSize = setPickingSize(a_Size);\nfloat time = u_time * u_speed;\nmat2 rotateMatrix = mat2( \ncos(time), sin(time), \n-sin(time), cos(time)\n);\nv_exteude = rotateMatrix * a_Extrude.xy;\nv_color = a_Color;\nv_radius = newSize;\nfloat blur = 0.0;\nfloat antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\nvec2 offset = (extrude.xy * (newSize));\nvec3 aPosition = a_Position;\nif(u_isMeter < 1.0) {\noffset = project_pixel(offset);\n} else {\nantialiasblur *= pow(19.0 - u_Zoom, 2.0);\nantialiasblur = max(antialiasblur, -0.01);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\naPosition.xy += offset;\noffset.x = 0.0;\noffset.y = 0.0;\n}\n}\nv_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);\nvec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_additive;\nuniform float u_opacity: 1.0;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius);\nfloat outer_df = sdCircle(v_data.xy, 1.0);\nfloat inner_df = sdCircle(v_data.xy, r);\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\ngl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\nif(u_additive > 0.0) {\ngl_FragColor *= opacity_t;\n} else {\ngl_FragColor.a *= opacity_t;\n}\nif(gl_FragColor.a > 0.0) {\ngl_FragColor = filterColor(gl_FragColor);\n}\nvec2 extrude =  v_exteude;\nvec2 dir = normalize(extrude);\nvec2 baseDir = vec2(1.0, 0.0);\nfloat pi = 3.14159265359;\nfloat flag = sign(dir.y);\nfloat rades = dot(dir, baseDir);\nfloat radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\nif(radar_v > 0.99) {\nradar_v = 1.0 - (radar_v - 0.99)/0.01;\n}\ngl_FragColor.a *= radar_v;\n}',triangulation:oH,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(r,o)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var n=e.size,r=void 0===n?5:n;return Array.isArray(r)?[r[0]*t.meter2coord]:[r*t.meter2coord]}}})}}]),r}(PV);function FW(e){var t=e.coordinates;return{vertices:F(t),indices:[0],size:t.length}}var BW=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.offsets,o=void 0===i?[0,0]:i,a=t.blend,s=t.strokeOpacity,u=void 0===s?1:s,l=t.strokeWidth,c=void 0===l?0:l,h=t.stroke,f=void 0===h?"#fff":h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,offsets:o})){this.judgeStyleAttributes({opacity:r,offsets:o});var p=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,p,this.cellProperties),v=d.data,g=d.width,m=d.height;this.rowCount=m,this.dataTexture=this.cellLength>0&&v.length>0?this.createTexture2D({flipY:!0,data:v,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:g,height:m}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_additive:"additive"===a?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:XF(r)?r:1,u_offsets:this.isOffsetStatic(o)?o:[0,0],u_stroke_opacity:XF(u)?u:1,u_stroke_width:XF(c)?c:1,u_stroke_color:this.getStrokeColor(f)}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o;this.layer.triangulation=FW,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\nvarying mat4 styleMappingMat;\nvarying float v_blur;\nvarying float v_innerRadius;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\nv_color = a_Color;\nv_blur = 1.0 - max(2.0/a_Size, 0.05);\nv_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nvec2 offset = project_pixel(textrueOffsets);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\ngl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_additive;\nuniform float u_stroke_opacity : 1;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\nvarying float v_blur;\nvarying float v_innerRadius;\n#pragma include "picking"\nvoid main() {\nvec2 center = vec2(0.5);\nfloat opacity = styleMappingMat[0][0];\nfloat fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\nfloat circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\nif(v_innerRadius < 0.99) {\nfloat blurWidth = (1.0 - v_blur)/2.0;\nvec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\nif(fragmengTocenter > v_innerRadius + blurWidth) {\ngl_FragColor = stroke;\n} else if(fragmengTocenter > v_innerRadius - blurWidth){\nfloat mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\ngl_FragColor = mix(v_color, stroke, mixR);\n} else {\ngl_FragColor = v_color;\n}\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\nif(u_additive > 0.0) {\ngl_FragColor *= circleClipOpacity;\n} else {\ngl_FragColor.a *= circleClipOpacity;\n}\n}',triangulation:FW,depth:{enable:!1},primitive:e.gl.POINTS,blend:this.getBlend(),stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),r}(PV),zW='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat strokeWidth = styleMappingMat[0][2];\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat dist = texture2D(u_sdf_map, v_uv).a;\nlowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;\nhighp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\nhighp float gamma_scaled = gamma * v_gamma_scale;\nhighp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));\ngl_FragColor.a= gl_FragColor.a * alpha;\ngl_FragColor = filterColor(gl_FragColor);\n}',jW='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying float v_fontScale;\nvarying mat4 styleMappingMat;\nuniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][2] = strokeWidthAndOffset.r;\ntextureOffset = strokeWidthAndOffset.g;\nvec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\nif(hasStroke()) {\nvec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\nif(u_stroke_color == vec4(0.0)) {\nstyleMappingMat[1][0] = v_color.r;\nstyleMappingMat[1][1] = v_color.g;\nstyleMappingMat[1][2] = v_color.b;\nstyleMappingMat[1][3] = v_color.a;\n} else {\nstyleMappingMat[1][0] = u_stroke_color.r;\nstyleMappingMat[1][1] = u_stroke_color.g;\nstyleMappingMat[1][2] = u_stroke_color.b;\nstyleMappingMat[1][3] = u_stroke_color.a;\n}\n}\nv_color = a_Color;\nv_uv = a_tex / u_sdf_map_size;\nfloat fontScale = a_Size / FONT_SIZE;\nv_fontScale = fontScale;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nhighp float angle_sin = sin(a_Rotate);\nhighp float angle_cos = cos(a_Rotate);\nmat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\nfloat raiseHeight = u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraiseHeight = u_raisingHeight * mapboxZoomScale;\n}\nvec4 projected_position;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nprojected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n} else {\nprojected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n}\ngl_Position = vec4(\nprojected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\nv_gamma_scale = gl_Position.w;\nsetPickingColor(a_PickingColor);\n}';function UW(e){var t=e.id,n=[],r=[];if(!this.glyphInfoMap||!this.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var i=this.glyphInfoMap[t].centroid,o=2===i.length?[i[0],i[1],0]:i;return this.glyphInfoMap[t].glyphQuads.forEach((function(e,t){n.push.apply(n,F(o).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],F(o),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],F(o),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],F(o),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),r.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:n,indices:r,size:7}}var VW=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"glyphInfo",void 0),E(P(e),"glyphInfoMap",{}),E(P(e),"texture",void 0),E(P(e),"currentZoom",-1),E(P(e),"extent",void 0),E(P(e),"textureHeight",0),E(P(e),"textCount",0),E(P(e),"preTextStyle",{}),E(P(e),"buildModels",function(){var t=_(g().mark((function t(n){var r,i,o,a,s;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.layer.getLayerConfig(),i=r.mask,o=void 0!==i&&i,a=r.maskInside,s=void 0===a||a,e.mapping(),e.layer.buildLayerModel({moduleName:"pointText",vertexShader:jW,fragmentShader:zW,triangulation:UW.bind(P(e)),depth:{enable:!1},blend:e.getBlend(),stencil:Oy(o,s)}).then((function(e){n([e])})).catch((function(e){console.warn(e),n([])}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),E(P(e),"mapping",(function(){e.initGlyph(),e.updateTexture(),e.filterGlyphs(),e.reBuildModel()})),e}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.stroke,o=void 0===i?"#fff":i,a=t.strokeWidth,s=void 0===a?0:a,u=t.textAnchor,l=void 0===u?"center":u,c=t.textAllowOverlap,h=void 0!==c&&c,f=t.halo,p=void 0===f?.5:f,d=t.gamma,v=void 0===d?2:d,g=t.raisingHeight,m=void 0===g?0:g,y=this.fontService,_=y.canvas,b=y.mapping;if(Object.keys(b).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(b).length),this.preTextStyle={textAnchor:l,textAllowOverlap:h},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,strokeWidth:s,stroke:o})){this.judgeStyleAttributes({opacity:r,strokeWidth:s,stroke:o});var x=this.layer.getEncodedData(),S=this.calDataFrame(this.cellLength,x,this.cellProperties),E=S.data,A=S.width,C=S.height;this.rowCount=C,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:A,height:C}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(m),u_opacity:XF(r)?r:1,u_stroke_width:XF(s)?s:1,u_stroke_color:this.getStrokeColor(o),u_sdf_map:this.texture,u_halo_blur:p,u_gamma_scale:v,u_sdf_map_size:[_.width,_.height]}}},{key:"initModels",value:function(e){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var t=this.layer.getLayerConfig(),n=t.textAnchor,r=void 0===n?"center":n,i=t.textAllowOverlap,o=void 0===i||i;this.preTextStyle={textAnchor:r,textAllowOverlap:o},this.buildModels(e)}},{key:"needUpdate",value:function(){var e=this.layer.getLayerConfig().textAllowOverlap,t=void 0!==e&&e,n=this.mapService.getZoom(),r=this.mapService.getBounds(),i=Rm(this.extent,r);return(!t&&(Math.abs(this.currentZoom-n)>1||!i)||t!==this.preTextStyle.textAllowOverlap)&&(this.reBuildModel(),!0)}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:e.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:e.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?12:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:e.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"textExtent",value:function(){return Im(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(e){var t,n=e.shape,r=void 0===n?"":n,i=j(r=r.toString());try{for(i.s();!(t=i.n()).done;){var o=t.value;-1===a.indexOf(o)&&a.push(o)}}catch(e){i.e(e)}finally{i.f()}})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n="".concat(n),-1===a.indexOf(n)&&a.push(n)})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!0})}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.fontService.mapping,r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=this.layer.getEncodedData();this.glyphInfo=u.map((function(r){var i=r.shape,a=void 0===i?"":i,u=r.id,l=r.size,c=void 0===l?1:l,h=r.textOffset,f=void 0===h?[0,0]:h,p=hG(a.toString(),n,c,s,"left",o,f,e),d=fG(p,f,!1);return r.shaping=p,r.glyphQuads=d,r.centroid=jm(r.coordinates),r.originCentroid="GAODE2.x"===r.version?jm(r.originCoordinates):r.originCentroid=r.centroid,t.glyphInfoMap[u]={shaping:p,glyphQuads:d,centroid:jm(r.coordinates)},r}))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[4,4]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new oG(a,s);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a="GAODE2.x"===t.version?t.originCentroid:t.centroid,s=t.size/24,l=e.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length)&&(u.insertCollisionBox(c,o),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig().iconfont,t=void 0!==e&&e;t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,n=this.fontService.canvas;this.textureHeight=n.height,this.texture&&this.texture.destroy(),this.texture=t({data:n,mag:e.gl.LINEAR,min:e.gl.LINEAR,width:n.width,height:n.height})}},{key:"reBuildModel",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:jW,fragmentShader:zW,triangulation:UW.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Oy(r,o)}).then((function(t){e.layer.models=[t],e.layerService.throttleRenderLayers()})).catch((function(t){console.warn(t),e.layer.models=[]}))}}]),r}(PV),HW={fillImage:LW,fill:PW,radar:DW,image:IW,normal:NW,simplePoint:BW,extrude:MW,text:VW,vectorPoint:iW,tile:_G,tileText:yG,earthFill:wW,earthExtrude:TW},GW=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","PointLayer"),E(P(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new HW[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,t=e.field,n=e.values,r=this.getLayerConfig().shape2d,i=this.iconService.getIconMap();if(t&&-1!==(null==r?void 0:r.indexOf(t)))return"fill";if(n&&n instanceof Array){var o,a=j(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if("string"==typeof s&&i.hasOwnProperty(s))return"image"}}catch(e){a.e(e)}finally{a.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorPoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}},{key:"getModelType",value:function(){if(XH(this.layerSource.getParserType()))return"vectorPoint";var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":"simple"===a?"simplePoint":"radar"===a?"radar":"fillImage"===this.layerType?"fillImage":-1!==(null==n?void 0:n.indexOf(a))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(a))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":i.hasOwnProperty(a)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),n}(hV),WW=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.heightfixed,o=void 0!==i&&i,a=t.raisingHeight,s=void 0===a?0:a,u=t.topsurface,l=void 0===u||u,c=t.sidesurface,h=void 0===c||c,f=t.sourceColor,p=t.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var d=this.layer.getEncodedData(),v=this.calDataFrame(this.cellLength,d,this.cellProperties),g=v.data,m=v.width,y=v.height;this.rowCount=y,this.dataTexture=this.cellLength>0&&g.length>0?this.createTexture2D({flipY:!0,data:g,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:m,height:y}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}var _=0,b=[1,1,1,1],x=[1,1,1,1];return f&&p&&(b=Ay(f),x=Ay(p),_=1),{u_topsurface:Number(l),u_sidesurface:Number(h),u_heightfixed:Number(o),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(s),u_opacity:XF(r)?r:1,u_linearColor:_,u_sourceColor:b,u_targetColor:x,u_texture:this.texture}}},{key:"initModels",value:function(e){this.loadTexture(),this.buildModels(e)}},{key:"buildModels",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=this.getShaders(),s=a.frag,u=a.vert,l=a.type;this.layer.buildLayerModel({moduleName:l,vertexShader:u,fragmentShader:s,triangulation:mH,stencil:Oy(r,o)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.pickLight;return e.mapTexture?{frag:'uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat isSide = styleMappingMat[0][3];\nfloat lightWeight = styleMappingMat[3][1];\nfloat topU = styleMappingMat[2][2];\nfloat topV = styleMappingMat[2][3];\nfloat sidey = styleMappingMat[3][0];\nif(isSide < 1.0) {\nif(u_sidesurface < 1.0) {\ndiscard;\n}\nif(u_linearColor == 1.0) {\nvec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\nlinearColor.rgb *= lightWeight;\ngl_FragColor = linearColor;\n} else {\ngl_FragColor = v_Color;\n}\n} else {\nif(u_topsurface < 1.0) {\ndiscard;\n}\ngl_FragColor = texture2D(u_texture, vec2(topU, topV));\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nv_Color = a_Color;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nstyleMappingMat[0][3] = a_Position.z;\nstyleMappingMat[2][2] = a_uvs[0];\nstyleMappingMat[2][3] = 1.0 - a_uvs[1];\nstyleMappingMat[3][0] = a_uvs[2];\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nif(u_heightfixed > 0.0) {\nproject_pos.z = a_Position.z * a_Size;\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nstyleMappingMat[3][1] = lightWeight;\nsetPickingColor(a_PickingColor);\n}',type:"polygonExtrudeTexture"}:t?{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat isSide = styleMappingMat[0][3];\nfloat sidey = styleMappingMat[3][0];\nfloat lightWeight = styleMappingMat[3][1];\nif(isSide < 1.0) {\nif(u_sidesurface < 1.0) {\ndiscard;\n}\nif( u_linearColor == 1.0) {\nvec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\nlinearColor.rgb *= lightWeight;\ngl_FragColor = linearColor;\n} else {\ngl_FragColor = v_Color;\n}\n} else {\nif(u_topsurface < 1.0) {\ndiscard;\n}\ngl_FragColor = v_Color;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}',vert:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nstyleMappingMat[0][3] = a_Position.z;\nstyleMappingMat[3][0] = a_uvs[2];\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nif(u_heightfixed > 0.0) {\nproject_pos.z = a_Position.z * a_Size;\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nstyleMappingMat[3][1] = lightWeight;\nsetPickingColor(a_PickingColor);\n}',type:"polygonExtrudePickLight"}:{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];  \nfloat isSide = styleMappingMat[0][3];\nfloat sidey = styleMappingMat[3][0];\nfloat lightWeight = styleMappingMat[3][1];\nif(isSide < 1.0) {\nif(u_sidesurface < 1.0) {\ndiscard;\n}\nif(u_linearColor == 1.0) {\nvec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\nlinearColor.rgb *= lightWeight;\ngl_FragColor = linearColor;\n} else {\ngl_FragColor = v_Color;\n}\n} else {\nif(u_topsurface < 1.0) {\ndiscard;\n}\ngl_FragColor = v_Color;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nstyleMappingMat[0][3] = a_Position.z;\nstyleMappingMat[3][0] = a_uvs[2];\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nif(u_heightfixed > 0.0) {\nproject_pos.z = a_Position.z * a_Size;\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nstyleMappingMat[3][1] = lightWeight;\nsetPickingColor(a_PickingColor);\n}',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e,t;null===(e=this.dataTexture)||void 0===e||e.destroy(),null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=D(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],o=t[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:e.AttributeType.Attribute,descriptor:{name:"a_uvs",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,i){var o=i[0],u=i[1];return[(o-n)/a,(u-r)/s,i[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:function(){var t=this,n=this.layer.getLayerConfig().mapTexture,r=this.rendererService.createTexture2D;if(this.texture=r({height:0,width:0}),n){var i=new Image;i.crossOrigin="",i.src=n,i.onload=function(){t.texture=r({data:i,width:i.width,height:i.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.LINEAR,mag:e.gl.LINEAR}),t.layerService.reRender()}}}}]),r}(PV),YW=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.raisingHeight,r=void 0===n?0:n,i=t.opacity,o=void 0===i?1:i,a=t.opacityLinear,s=void 0===a?{enable:!1,dir:"in"}:a;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var u=this.layer.getEncodedData(),l=this.calDataFrame(this.cellLength,u,this.cellProperties),c=l.data,h=l.width,f=l.height;this.rowCount=f,this.dataTexture=this.cellLength>0&&c.length>0?this.createTexture2D({flipY:!0,data:c,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:h,height:f}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(r),u_opacity:XF(o)?o:1,u_opacitylinear:Number(s.enable),u_dir:"in"===s.dir?1:0}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(t){var n=this.getModelParams(),r=n.frag,i=n.vert,o=n.triangulation,a=n.type,s=this.layer.getLayerConfig(),u=s.mask,l=void 0!==u&&u,c=s.maskInside,h=void 0===c||c,f=s.workerEnabled,p=void 0!==f&&f,d=s.enablePicking;this.layer.triangulation=o,this.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:r,triangulation:o,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Oy(l,h),workerEnabled:p,workerOptions:{modelType:a,enablePicking:d}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().opacityLinear;(void 0===t?{enable:!1,dir:"in"}:t).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:e.AttributeType.Attribute,descriptor:{name:"a_linear",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig().opacityLinear;return(void 0===e?{enable:!1}:e).enable?{frag:'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_Color;\nif(u_opacitylinear > 0.0) {\ngl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity: 1.0;\nuniform float u_raisingHeight: 0.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvoid main() {\nif(u_opacitylinear > 0.0) {\nv_linear = a_linear;\nv_pos = a_Position.xy;\n}\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"polygonLinear",triangulation:vH}:{frag:'uniform float u_opacity: 1.0;\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity: 1.0;\nuniform float u_raisingHeight: 0.0;\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"polygonFill",triangulation:hx}}}]),r}(PV),XW=function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture1",void 0),E(P(e),"texture2",void 0),E(P(e),"texture3",void 0),e}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.watercolor,i=void 0===r?"#6D99A8":r,o=e.watercolor2,a=void 0===o?"#0F121C":o;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Ay(i),u_watercolor2:Ay(a),u_opacity:XF(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.loadTexture(),this.buildModels(e)}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec2 v_uv;\n#pragma include "projection"\nvoid main() {\nv_uv = a_uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n}',fragmentShader:"uniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\nvarying vec2 v_uv;\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750;\nfloat large_wavesize        = 3.4;\nfloat small_waveheight      = 0.6;\nfloat small_wavesize        = 0.5;\nfloat water_softlight_fact  = 15.;\nfloat water_glossylight_fact= 120.;\nfloat particle_amount       = 70.;\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8)\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\nfloat hash( float n ) {\nreturn fract(sin(n)*43758.5453123);\n}\nfloat noise1( in vec2 x ) {\nvec2 p  = floor(x);\nvec2 f  = smoothstep(0.0, 1.0, fract(x));\nfloat n = p.x + p.y*57.0;\nreturn mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\nmix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\nfloat noise(vec2 p) {\nreturn texture2D(u_texture2,p*vec2(1./256.)).x;\n}\nvec4 highness(vec2 p) {\nvec4 t = texture2D(u_texture1,fract(p));\nfloat clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\nreturn clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\nfloat height_map( vec2 p ) {\nvec4 height=highness(p);\nmat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\nfloat f = 0.6000*noise1( p ); p = m*p*1.1*6.;\nf += 0.2500*noise( p ); p = m*p*1.32;\nf += 0.1666*noise( p ); p = m*p*1.11;\nf += 0.0834*noise( p ); p = m*p*1.12;\nf += 0.0634*noise( p ); p = m*p*1.13;\nf += 0.0444*noise( p ); p = m*p*1.14;\nf += 0.0274*noise( p ); p = m*p*1.15;\nf += 0.0134*noise( p ); p = m*p*1.16;\nf += 0.0104*noise( p ); p = m*p*1.17;\nf += 0.0084*noise( p );\nf = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\nconst float FLAT_LEVEL = 0.92525;\nif (f<FLAT_LEVEL)\nf = f;\nelse\nf = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL;\nreturn clamp(f, 0., 10.);\n}\nvec3 plasma_quintic( float x ) {\nx = clamp( x, 0.0, 1.0);\nvec4 x1 = vec4( 1.0, x, x * x, x * x * x );\nvec4 x2 = x1 * x1.w * x;\nreturn vec3(\ndot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\ndot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\ndot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\nvec4 color(vec2 p){\nvec4 c1 = vec4(1.7,1.6,.9,1);\nvec4 c2 = vec4(.2,.94,.1,1);\nvec4 c3 = vec4(.3,.2,.0,1);\nvec4 c4 = vec4(.99,.99,1.6,1);\nvec4 v = highness(p);\nfloat los = smoothstep(0.1,1.1,v.b);\nfloat his = smoothstep(3.5,6.5,v.b);\nfloat ces = smoothstep(1.,5.,v.a);\nvec4 lo = mix(c1,c2,los);\nvec4 hi = mix(c3,c4,his);\nvec4 ce = mix(lo,hi,ces);\nreturn vec4(plasma_quintic(ces),1).ragb;\n}\nvec3 terrain_map( vec2 p )\n{\nreturn color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5;\n}\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\nfloat water_map( vec2 p, float height ) {\nvec2 p2 = p*large_wavesize;\nvec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\nvec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\nfloat f = 0.6000*noise( p );\nf += 0.2500*noise( p*m );\nf += 0.1666*noise( p*m*m );\nfloat wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\np *= small_wavesize;\nf = 0.;\nfloat amp = 1.0, s = .5;\nfor (int i=0; i<9; i++)\n{ p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\nreturn wave+f*small_waveheight;\n}\nfloat nautic(vec2 p) {\np *= 18.;\nfloat f = 0.;\nfloat amp = 1.0, s = .5;\nfor (int i=0; i<3; i++)\n{ p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\nreturn pow(1.-f, 5.);\n}\nfloat particles(vec2 p) {\np *= 200.;\nfloat f = 0.;\nfloat amp = 1.0, s = 1.5;\nfor (int i=0; i<3; i++)\n{ p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\nreturn pow(f*.35, 7.)*particle_amount;\n}\nfloat test_shadow( vec2 xy, float height) {\nvec3 r0 = vec3(xy, height);\nvec3 rd = normalize( light - r0 );\nfloat hit = 1.0;\nfloat t   = 0.001;\nfor (int j=1; j<25; j++)\n{\nvec3 p = r0 + t*rd;\nfloat h = height_map( p.xy );\nfloat height_diff = p.z - h;\nif (height_diff<0.0)\n{\nreturn 0.0;\n}\nt += 0.01+height_diff*.02;\nhit = min(hit, 2.*height_diff/t);\n}\nreturn hit;\n}\nvec3 CalcTerrain(vec2 uv, float height) {\nvec3 col = terrain_map( uv );\nvec2 iResolution = vec2(512.);\nfloat h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\nfloat h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\nfloat h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\nfloat h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\nvec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\nvec3 r0 = vec3(uv, height);\nvec3 rd = normalize( light - r0 );\nfloat grad = dot(norm, rd);\ncol *= grad+pow(grad, 8.);\nfloat terrainshade = test_shadow( uv, height );\ncol = mix(col*.25, col, terrainshade);\nreturn col;\n}\nvoid main() {\nvec3 watercolor = u_watercolor.rgb;\nvec3 watercolor2 = u_watercolor2.rgb;\nvec2 uv = v_uv;\nfloat WATER_LEVEL = 0.84;\nfloat deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\nfloat height = height_map( uv );\nvec3 col;\nfloat waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\nfloat level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\nif (height > level)\n{\ncol = CalcTerrain(uv, height);\n}\nif (height <= level)\n{\nvec2 dif = vec2(.0, .01);\nvec2 pos = uv*15. + vec2(u_time*.01);\nfloat h1 = water_map(pos-dif,waveheight);\nfloat h2 = water_map(pos+dif,waveheight);\nfloat h3 = water_map(pos-dif.yx,waveheight);\nfloat h4 = water_map(pos+dif.yx,waveheight);\nvec3 normwater = normalize(vec3(h3-h4, h1-h2, .125));\nuv += normwater.xy*.002*(level-height);\ncol = CalcTerrain(uv, height);\nfloat coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\nfloat coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\nfloat intensity = col.r*.2126+col.g*.7152+col.b*.0722;\nwatercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\nvec3 r0 = vec3(uv, WATER_LEVEL);\nvec3 rd = normalize( light - r0 );\nfloat grad     = dot(normwater, rd);\nfloat specular = pow(grad, water_softlight_fact);\nfloat specular2= pow(grad, water_glossylight_fact);\nfloat gradpos  = dot(vec3(0., 0., 1.), rd);\nfloat specular1= smoothstep(0., 1., pow(gradpos, 5.));\nfloat watershade  = test_shadow( uv, level );\nwatercolor *= 2.2+watershade;\nwatercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\nwatercolor /= (1.+specular1*1.25);\nwatercolor += watershade*specular2*water_specularcolor;\nwatercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\ncol = mix(col, watercolor, coastfade);\n}\nfloat opacity = u_opacity;\ngl_FragColor = vec4(col, opacity);  \n}",triangulation:dH,primitive:e.gl.TRIANGLES,depth:{enable:!1},stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var e,t,n;null===(e=this.texture1)||void 0===e||e.destroy(),null===(t=this.texture2)||void 0===t||t.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=D(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],o=t[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:e.AttributeType.Attribute,descriptor:{name:"a_uv",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(t,i,o,u){var l=D(t.version===e.Version["GAODE2.x"]?t.originCoordinates[0][u]:o,2),c=l[0],h=l[1];return[(c-n)/a,(h-r)/s]}}})}},{key:"loadTexture",value:function(){var t,n,r,i=this,o=this.rendererService.createTexture2D,a={height:0,width:0};function s(t){return o({data:t,width:t.width,height:t.height,wrapS:e.gl.MIRRORED_REPEAT,wrapT:e.gl.MIRRORED_REPEAT,min:e.gl.LINEAR,mag:e.gl.LINEAR})}this.texture1=o(a),this.texture2=o(a),this.texture3=o(a),t=function(e){i.texture1=s(e[0]),i.texture2=s(e[1]),i.texture3=s(e[2]),i.layerService.reRender()},n=0,r=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(e){var i=new Image;i.crossOrigin="",i.src=e,r.push(i),i.onload=function(){3==++n&&t(r)}}))}}]),r}(PV),ZW={fill:YW,line:bW,extrude:WW,text:VW,point_fill:PW,point_image:IW,point_normal:NW,point_extrude:MW,water:function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.speed,i=void 0===r?.5:r;return{u_texture:this.texture,u_speed:i,u_opacity:XF(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.loadTexture(),this.buildModels(e)}},{key:"buildModels",value:function(t){var n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\n#pragma include "projection"\nvoid main() {\nv_uv = a_uv;\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n}',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\nfloat water(vec3 p) {\nfloat t = u_time * u_speed;\np.z += t * 2.; p.x += t * 2.;\nvec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\np.z += t * 3.; p.x += t * 0.52;\nvec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\np.z += t * 4.; p.x += t * 0.8;\nvec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\nc1 += c2 - c3;\nfloat z = (c1.x + c1.y + c1.z) / 3.;\nreturn p.y + z / 4.;\n}\nfloat map(vec3 p) {\nfloat d = 100.0;\nd = water(p);\nreturn d;\n}\nfloat intersect(vec3 ro, vec3 rd) {\nfloat d = 0.0;\nfor (int i = 0; i <= 100; i++) {\nfloat h = map(ro + rd * d);\nif (h < 0.1) return  d;\nd += h;\n}\nreturn 0.0;\n}\nvec3 norm(vec3 p) {\nfloat eps = .1;\nreturn normalize(vec3(\nmap(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\nmap(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\nmap(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n));\n} \nfloat calSpc() {\nvec3 l1 = normalize(vec3(1, 1, 1));\nvec3 ro = vec3(-3, 20, -8);\nvec3 rc = vec3(0, 0, 0);\nvec3 ww = normalize(rc - ro);\nvec3 uu = normalize(cross(vec3(0,1,0), ww));\nvec3 vv = normalize(cross(rc - ro, uu));\nvec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\nfloat d = intersect(ro, rd);\nvec3 p = ro + rd * d;\nvec3 n = norm(p);\nfloat spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\nreturn spc;\n}\nvoid main() {\nfloat opacity = u_opacity;\ngl_FragColor = v_Color;\ngl_FragColor.a *= opacity;\nfloat spc = calSpc();\ngl_FragColor += spc * 0.4;\n}",triangulation:dH,primitive:e.gl.TRIANGLES,depth:{enable:!1},stencil:Oy(i,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=D(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],o=t[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:e.AttributeType.Attribute,descriptor:{name:"a_uv",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(t,i,o,u){var l=D(t.version===e.Version["GAODE2.x"]?t.originCoordinates[0][u]:o,2),c=l[0],h=l[1];return[(c-n)/a,(h-r)/s]}}})}},{key:"loadTexture",value:function(){var t=this,n=this.layer.getLayerConfig().waterTexture,r=this.rendererService.createTexture2D;this.texture=r({height:0,width:0});var i=new Image;i.crossOrigin="",n?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),i.src=n):i.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",i.onload=function(){t.texture=r({data:i,width:i.width,height:i.height,wrapS:e.gl.MIRRORED_REPEAT,wrapT:e.gl.MIRRORED_REPEAT,min:e.gl.LINEAR,mag:e.gl.LINEAR}),t.layerService.reRender()}}}]),r}(PV),ocean:XW,vectorpolygon:iW,tile:bG},qW=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","PolygonLayer"),E(P(e),"defaultSourceConfig",void 0),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new ZW[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"getModelType",value:function(){var e;if(XH(this.layerSource.getParserType()))return"vectorpolygon";var t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"===n?"fill":"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":"tile"===n?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),n}(hV),KW=function(t){A(o,t);var n,r,i=I(o);function o(){var e;b(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(P(e=i.call.apply(i,[this].concat(n))),"texture",void 0),E(P(e),"colorTexture",void 0),E(P(e),"rampColors",void 0),e}return S(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,s=e.noDataValue,u=void 0===s?-9999999:s,l=e.domain,c=void 0===l?[0,1]:l,h=e.rampColors;return OV(this.rampColors,h)||(this.updateColorTexture(),this.rampColors=h),{u_opacity:n||1,u_texture:this.texture,u_domain:c,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:(r=_(g().mark((function e(t){var n,r,i,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return e.abrupt("return",{data:t.data,width:t.width,height:t.height});case 4:return e.next=6,t.data;case 6:return n=e.sent,r=n.rasterData,i=n.width,o=n.height,e.abrupt("return",{data:Array.from(r),width:i,height:o});case 11:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=_(g().mark((function t(n){var r,i,o,a,s,u,l,c,h,f,p,d,v,m,y;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.layer.getLayerConfig(),i=r.mask,o=void 0!==i&&i,a=r.maskInside,s=void 0===a||a,u=r.rampColorsData,l=r.rampColors,c=this.layer.getSource(),h=this.rendererService.createTexture2D,f=c.data.dataArray[0],t.next=6,this.getRasterData(f);case 6:p=t.sent,d=p.data,v=p.width,m=p.height,this.texture=h({data:d,width:v,height:m,format:e.gl.LUMINANCE,type:e.gl.FLOAT}),y=u||wy(l),this.colorTexture=h({data:y.data,width:y.width,height:y.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:BG,fragmentShader:FG,triangulation:_H,primitive:e.gl.TRIANGLES,depth:{enable:!1},stencil:Oy(o,s)}).then((function(e){n([e])})).catch((function(e){console.warn(e),n([])}));case 14:case"end":return t.stop()}}),t,this)}))),function(e){return n.apply(this,arguments)})},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D,t=wy(this.layer.getLayerConfig().rampColors);this.colorTexture=e({data:t.data,width:t.width,height:t.height,flipY:!1})}}]),o}(PV),QW={raster:KW,rasterRgb:jG,raster3d:KW,rasterTile:iW},$W=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","RasterLayer"),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new QW[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"getDefaultConfig",value:function(){return{raster:{},rasterRgb:{},raster3d:{},rasterTile:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rasterTile":return"rasterTile";default:return"raster"}}}]),n}(hV),JW=function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:XF(t)?t:1}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(e){this.layer.zIndex=-997,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\nvoid main() {\nfloat EARTH_RADIUS = 100.0;\nv_Color = a_Color;\nv_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\nvVertexNormal = a_Normal;\ngl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}",fragmentShader:"uniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\nfloat intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\nif(intensity > 1.0) intensity = 0.0;\ngl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}",triangulation:EH,depth:{enable:!1},blend:this.getBlend()}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),r}(PV),eY={base:function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(P(e),"earthTime",3.4),E(P(e),"sunX",1e3),E(P(e),"sunY",1e3),E(P(e),"sunZ",1e3),E(P(e),"sunRadius",Math.sqrt(e.sunX*e.sunX+e.sunY*e.sunY+e.sunZ*e.sunZ)),e}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=e.globalOptions;return null!=t&&t.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(e){this.earthTime=e,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:function(e){var t=this,n=this.layer.getLayerConfig().globalOptions;void 0!==(null==n?void 0:n.earthTime)&&this.setEarthTime(n.earthTime);var r=this.layer.getSource(),i=this.rendererService.createTexture2D;this.texture=i({height:0,width:0}),r.data.images.then((function(e){t.texture=i({data:e[0],width:e[0].width,height:e[0].height}),t.layerService.reRender()})),this.buildModels(e)}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(e){this.layer.zIndex=-998,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\nfloat calc_lighting(vec4 pos) {\nvec3 worldPos = vec3(pos * u_ModelMatrix);\nvec3 worldNormal = a_Normal;\nvec3 viewDir = normalize(u_CameraPosition - worldPos);\nvec3 lightDir = normalize(u_sunLight);\nvec3 halfDir = normalize(viewDir+lightDir);\nfloat lambert = dot(worldNormal, lightDir);\nfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\nfloat lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\nreturn lightWeight;\n}\nvarying float v_lightWeight;\nvoid main() {\nv_texCoord = a_Uv;\nfloat lightWeight = calc_lighting(vec4(a_Position, 1.0));\nv_lightWeight = lightWeight;\ngl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}",fragmentShader:"uniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ncolor.xyz = color.xyz * v_lightWeight;\ngl_FragColor = color;\n}",triangulation:EH,depth:{enable:!0},blend:this.getBlend()}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),r}(PV),atomSphere:JW,bloomSphere:function(t){A(r,t);var n=I(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:XF(t)?t:1}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(e){this.layer.zIndex=-999,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvoid main() {\nv_Color = a_Color;\nvVertexNormal = a_Normal;\ngl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}",fragmentShader:"uniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvoid main() {\nfloat intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\nif(intensity > 1.0) intensity = 0.0;\ngl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}",triangulation:AH,depth:{enable:!1},blend:this.getBlend()}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),r}(PV)},tY=["base","atomSphere","bloomSphere"],nY=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","EarthLayer"),E(P(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new eY[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"setEarthTime",value:function(e){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(e):console.warn("请在 scene loaded 之后执行该方法！")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"base";return tY.indexOf(n)<0&&(n="base"),n}}]),n}(hV),rY={fill:xG,vectorMask:iW},iY=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","MaskLayer"),E(P(e),"defaultSourceConfig",void 0),e}return S(n,[{key:"init",value:function(){var e=this,t=this.container.get(Hk.SceneID);this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.rendererService=this.container.get(Hk.IRendererService),this.layerService=this.container.get(Hk.ILayerService),this.mapService=this.container.get(Hk.IMapService),this.cameraService=this.container.get(Hk.ICameraService),this.coordinateService=this.container.get(Hk.ICoordinateSystemService),this.shaderModuleService=this.container.get(Hk.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Hk.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Hk.IFactoryNormalPass),this.styleAttributeService=this.container.get(Hk.IStyleAttributeService),this.pendingStyleAttributes.forEach((function(t){var n=t.attributeName,r=t.attributeField,i=t.attributeValues,o=t.updateOptions;e.styleAttributeService.updateStyleAttribute(n,{scale:v({field:r},e.splitValuesAndCallbackInAttribute(i,e.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Hk.ILayerPlugin);var n,r=j(this.plugins);try{for(r.s();!(n=r.n()).done;){n.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(e){r.e(e)}finally{r.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new rY[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"getModelType",value:function(){return XH(this.layerSource.getParserType())?"vectorMask":"fill"}}]),n}(hV);function oY(e,t,n){var r=aY(e,e.VERTEX_SHADER,t),i=aY(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=e.createProgram();if(!o)return null;if(e.attachShader(o,r),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){var a=e.getProgramInfoLog(o);return console.warn("Failed to link program: "+a),e.deleteProgram(o),e.deleteShader(i),e.deleteShader(r),null}for(var s=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var l=e.getActiveAttrib(o,u);o[l.name]=e.getAttribLocation(o,l.name)}for(var c=e.getProgramParameter(o,e.ACTIVE_UNIFORMS),h=0;h<c;h++){var f=e.getActiveUniform(o,h);o[f.name]=e.getUniformLocation(o,f.name)}return o.vertexShader=r,o.fragmentShader=i,o}function aY(e,t,n){var r=e.createShader(t);if(null==r)return console.warn("unable to create shader"),null;if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+i),e.deleteShader(r),null}return r}function sY(e,t,n,r,i){var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),o}function uY(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function lY(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}function cY(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];r.addColorStop(+a,e[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),t=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function hY(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function fY(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}var pY,dY,vY,gY,mY,yY,_Y,bY,xY=function(){function e(t){b(this,e),E(this,"width",512),E(this,"height",512),E(this,"pixels",void 0),E(this,"fadeOpacity",void 0),E(this,"speedFactor",void 0),E(this,"dropRate",void 0),E(this,"dropRateBump",void 0),E(this,"gl",void 0),E(this,"drawProgram",void 0),E(this,"fullScreenProgram",void 0),E(this,"updateProgram",void 0),E(this,"rampColors",void 0),E(this,"numParticles",65536),E(this,"numParticlesSize",void 0),E(this,"particleStateResolution",void 0),E(this,"quadBuffer",void 0),E(this,"particleIndexBuffer",void 0),E(this,"framebuffer",void 0),E(this,"colorRampTexture",void 0),E(this,"backgroundTexture",void 0),E(this,"screenTexture",void 0),E(this,"particleStateTexture0",void 0),E(this,"particleStateTexture1",void 0),E(this,"windTexture",void 0),E(this,"windData",void 0),this.gl=t.glContext,this.width=t.imageWidth,this.height=t.imageHeight,this.fadeOpacity=t.fadeOpacity,this.speedFactor=t.speedFactor,this.dropRate=t.dropRate,this.dropRateBump=t.dropRateBump,this.rampColors=t.rampColors,this.init()}return S(e,[{key:"init",value:function(){var e=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=oY(e,"\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=oY(e,"\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=oY(e,"\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }","\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=lY(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=e.createFramebuffer(),this.colorRampTexture=sY(this.gl,this.gl.LINEAR,cY(this.rampColors),16,16);var t=new Uint8Array(this.width*this.height*4);this.backgroundTexture=sY(e,e.NEAREST,t,this.width,this.height),this.screenTexture=sY(e,e.NEAREST,t,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=sY(e,e.NEAREST,r,n,n),this.particleStateTexture1=sY(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=lY(e,o)}},{key:"setWind",value:function(e){this.windData=e,this.windTexture=function(e,t,n){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),r}(this.gl,this.gl.LINEAR,e.image)}},{key:"updateParticelNum",value:function(e){var t=this.gl;if(e!==this.numParticles){this.numParticles=e;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=sY(t,t.NEAREST,r,n,n),this.particleStateTexture1=sY(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=lY(t,o)}}},{key:"updateWindDir",value:function(e,t,n,r){this.windData.uMin=e,this.windData.uMax=t,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(e){if(this.isColorChanged(e)){this.rampColors=e;var t=this.gl;t.deleteTexture(this.colorRampTexture),this.colorRampTexture=sY(t,t.LINEAR,cY(e),16,16)}}},{key:"isColorChanged",value:function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==e[i])return!0}return!1}},{key:"reSize",value:function(e,t){if(e!==this.width||t!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=e,this.height=t;var r=new Uint8Array(e*t*4);this.backgroundTexture=sY(n,n.NEAREST,r,e,t),this.screenTexture=sY(n,n.NEAREST,r,e,t)}}},{key:"draw",value:function(){var e;if(null!==(e=this.windData)&&void 0!==e&&e.image){var t=this.gl;return uY(t,this.windTexture,0),uY(t,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var e=this.gl;fY(e,this.framebuffer,this.screenTexture),e.viewport(0,0,this.width,this.height),e.disable(e.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels),fY(e,null,null),e.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var t=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=t}},{key:"drawFullTexture",value:function(e,t){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),uY(n,e,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,t),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var e=this.gl,t=this.drawProgram;e.useProgram(t),hY(e,this.particleIndexBuffer,t.a_index,1),uY(e,this.colorRampTexture,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1i(t.u_color_ramp,2),e.uniform1f(t.u_particles_res,this.particleStateResolution),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.drawArrays(e.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var e=this.gl;fY(e,this.framebuffer,this.particleStateTexture1),e.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var t=this.updateProgram;e.useProgram(t),hY(e,this.quadBuffer,t.a_pos,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1f(t.u_rand_seed,Math.random()),e.uniform2f(t.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.uniform1f(t.u_speed_factor,this.speedFactor),e.uniform1f(t.u_drop_rate,this.dropRate),e.uniform1f(t.u_drop_rate_bump,this.dropRateBump),e.drawArrays(e.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,fY(e,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),e}(),SY={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},EY={wind:function(t){A(r,t);var n=I(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(P(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(P(e),"colorModel",void 0),E(P(e),"wind",void 0),E(P(e),"imageCoords",void 0),E(P(e),"sizeScale",.5),E(P(e),"frequency",new Wm(7.2)),E(P(e),"cacheZoom",void 0),e}return S(r,[{key:"render",value:function(){var e=this;this.frequency.run((function(){e.drawWind()})),this.drawColorMode()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){var n,r,i,o=this,a=this.layer.getLayerConfig(),s=a.uMin,u=void 0===s?-21.32:s,l=a.uMax,c=void 0===l?26.8:l,h=a.vMin,f=void 0===h?-21.57:h,p=a.vMax,d=void 0===p?21.42:p,v=a.fadeOpacity,g=void 0===v?.996:v,m=a.speedFactor,y=void 0===m?.25:m,_=a.dropRate,b=void 0===_?.003:_,x=a.dropRateBump,S=void 0===x?.01:x,E=a.rampColors,A=void 0===E?SY:E,C=a.sizeScale,T=void 0===C?.5:C,w=a.mask,M=void 0!==w&&w,k=a.maskInside,O=void 0===k||k,P=this.rendererService.createTexture2D,L=this.layer.getSource();this.texture=P({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom());var I=this.rendererService.getGLContext();this.imageCoords=null===(n=L.data)||void 0===n?void 0:n.dataArray[0].coordinates,null===(r=L.data)||void 0===r||null===(i=r.images)||void 0===i||i.then((function(e){var t;o.sizeScale=T*o.getZoomScale();var n=o.getWindSize(),r=n.imageWidth,i=n.imageHeight,a={glContext:I,imageWidth:r,imageHeight:i,fadeOpacity:g,speedFactor:y,dropRate:b,dropRateBump:S,rampColors:A};o.wind=new xY(a),o.wind.setWind({uMin:u,uMax:c,vMin:f,vMax:d,image:e[0]}),null===(t=o.texture)||void 0===t||t.destroy(),o.texture=P({width:r,height:i}),o.layerService.reRender()})),this.layer.buildLayerModel({moduleName:"wind",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ngl_FragColor = color;\ngl_FragColor.a *= u_opacity;\n}",triangulation:_H,primitive:e.gl.TRIANGLES,depth:{enable:!1},stencil:Oy(M,O),blend:this.getBlend()}).then((function(e){o.colorModel=e,t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"getWindSize",value:function(){var e=this.mapService.lngLatToPixel(this.imageCoords[0]),t=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.min(Math.floor((t.x-e.x)*this.sizeScale),2048),imageHeight:Math.min(Math.floor((e.y-t.y)*this.sizeScale),2048)}}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.wind)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var e=this.layer.getLayerConfig(),t=e.uMin,n=void 0===t?-21.32:t,r=e.uMax,i=void 0===r?26.8:r,o=e.vMin,a=void 0===o?-21.57:o,s=e.vMax,u=void 0===s?21.42:s,l=e.numParticles,c=void 0===l?65535:l,h=e.fadeOpacity,f=void 0===h?.996:h,p=e.speedFactor,d=void 0===p?.25:p,v=e.dropRate,g=void 0===v?.003:v,m=e.dropRateBump,y=void 0===m?.01:m,_=e.rampColors,b=void 0===_?SY:_,x=e.sizeScale,S=void 0===x?.5:x,E=c,A=Math.floor(this.mapService.getZoom());if("number"==typeof S&&S!==this.sizeScale||A!==this.cacheZoom){var C=this.getZoomScale();this.sizeScale=S,E*=C;var T=this.getWindSize(),w=T.imageWidth,M=T.imageHeight;this.wind.reSize(w,M),this.cacheZoom=A}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(E),this.wind.updateColorRampTexture(b),this.wind.fadeOpacity=f,this.wind.speedFactor=d,this.wind.dropRate=g,this.wind.dropRateBump=y;var k=this.wind.draw(),O=k.d,P=k.w,L=k.h;this.rendererService.setBaseState(),this.texture.update({data:O,width:P,height:L})}}},{key:"drawColorMode",value:function(){var e,t=this.layer.getLayerConfig().opacity;this.layer.masks.map((function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.render(),e.hooks.afterRender.call()})),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:t||1,u_texture:this.texture}})}}]),r}(PV)},AY=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","WindLayer"),e}return S(n,[{key:"buildModels",value:function(){var e=this,t=this.getModelType();this.layerModel=new EY[t](this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels((function(t){e.dispatchModelLoad(t)}))}},{key:"renderModels",value:function(){return this.layerModel&&this.layerModel.render(),this}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),n}(hV),CY=function(e){A(n,e);var t=I(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(P(e=t.call.apply(t,[this].concat(i))),"type","TileDebugLayer"),E(P(e),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile",cancelExtent:!0}}}),e}return S(n,[{key:"buildModels",value:function(){var e=this;this.layerModel=new iW(this),this.layerModel.initModels((function(t){e.dispatchModelLoad(t)}))}}]),n}(hV),TY=(pY=NM(),dY=RM(Hk.IMapService),vY=RM(Hk.IFontService),pY((yY=V((mY=function(){function t(){b(this,t),U(this,"mapService",yY,this),U(this,"fontService",_Y,this)}return S(t,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("DataMappingPlugin",(function(){var t=e.getSource();t.inited?n.generateMaping(e,{styleAttributeService:r}):t.once("update",(function(){n.generateMaping(e,{styleAttributeService:r})}))})),e.hooks.beforeRenderData.tap("DataMappingPlugin",(function(){e.dataState.dataMappingNeedUpdate=!1;var t=e.getSource();return t.inited?n.generateMaping(e,{styleAttributeService:r}):t.once("update",(function(){n.generateMaping(e,{styleAttributeService:r})})),!0})),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){if("basemap"!==e.getLayerConfig().usage){var t=e.getSource();if(!e.layerModelNeedUpdate&&t&&t.inited){var i=e.getBottomColor(),o=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),s=t.data.dataArray,u=o.filter((function(e){return e.needRemapping})),l=s;if(null!=a&&a.needRemapping&&null!=a&&a.scale&&(l=s.filter((function(e){return n.applyAttributeMapping(a,e,i)[0]}))),u.length){if(null!=a&&a.needRemapping){var c=n.mapping(e,o,l,void 0,i);e.setEncodedData(c),a.needRemapping=!1}else{var h=n.mapping(e,u,l,e.getEncodedData(),i);e.setEncodedData(h)}e.emit("remapping",null)}}}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=e.getBottomColor(),o=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),s=e.getSource().data.dataArray,u=s;null!=a&&a.scale&&(u=s.filter((function(e){return n.applyAttributeMapping(a,e,i)[0]})));var l=this.mapping(e,o,u,void 0,i);e.setEncodedData(l),e.emit("dataUpdate",null)}},{key:"mapping",value:function(e,t,n,r,i){var o=this,a=e.getLayerConfig(),s=a.arrow,u=void 0===s?{enable:!1}:s;if("basemap"===a.usage)return this.mapLayerMapping(e,t,n,r);var l=t.filter((function(e){return void 0!==e.scale})),c=n.map((function(t,n){var a=r?r[n]:{},s=v({id:t._id,coordinates:t.coordinates},a);if(l.forEach((function(e){var n=o.applyAttributeMapping(e,t,i);e.needRemapping=!1,"color"===e.name&&(n=n.map((function(e){return Ay(e)}))),s[e.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===e.name&&(s.shape=o.fontService.getIconFontKey(s[e.name]))})),u.enable&&("line"===s.shape||"halfLine"===s.shape)){var c=s.coordinates;if(e.arrowInsertCount<e.encodeDataLength){var h=o.getArrowPoints(c[0],c[1]);s.coordinates.splice(1,0,h,h),e.arrowInsertCount++}}return s}));return this.adjustData2Amap2Coordinates(c,e),this.adjustData2SimpleCoordinates(c),c}},{key:"mapLayerMapping",value:function(e,t,n,r){var i=this,o=t.filter((function(e){return void 0!==e.scale})),a=n.map((function(t,n){var a=r?r[n]:{},s=v({id:t._id,coordinates:t.coordinates},a);return o.forEach((function(n){var r;if("shape"===n.name&&"simple"===(null===(r=e.shapeOption)||void 0===r?void 0:r.field))s[n.name]="simple",n.needRemapping=!1;else{var o=i.applyMapLayerAttributeMapping(n,t);n.needRemapping=!1,s[n.name]=Array.isArray(o)&&1===o.length?o[0]:o,"shape"===n.name&&(s.shape=i.fontService.getIconFontKey(s[n.name]))}})),void 0===s.size&&(s.size=1),s}));return this.adjustData2Amap2Coordinates(a,e),a}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var r=this;if(t.length>0&&this.mapService.version===e.Version["GAODE2.x"]){var i=n.coordCenter||n.getSource().center;"number"==typeof t[0].coordinates[0]?t.filter((function(e){return!e.originCoordinates})).map((function(t){t.version=e.Version["GAODE2.x"],t.originCoordinates=GT(t.coordinates),t.coordinates=r.mapService.lngLatToCoordByLayer(t.coordinates,i)})):t.filter((function(e){return!e.originCoordinates})).map((function(t){t.version=e.Version["GAODE2.x"],t.originCoordinates=GT(t.coordinates),t.coordinates=r.mapService.lngLatToCoordsByLayer(t.coordinates,i)}))}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===e.Version.SIMPLE&&t.map((function(e){e.simpleCoordinate||(e.coordinates=n.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(e){var t=this;if("number"==typeof e[0])return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),r}},{key:"applyAttributeMapping",value:function(e,t,n){var r;if(!e.scale)return[];var i=(null==e||null===(r=e.scale)||void 0===r?void 0:r.scalers)||[],o=[];i.forEach((function(n){var r,i=n.field;(t.hasOwnProperty(i)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&o.push(t[i])}));var a=e.mapping?e.mapping(o):[];return"color"!==e.name||Ey(a[0])?a:[n]}},{key:"applyMapLayerAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}},{key:"getArrowPoints",value:function(e,t){var n=Dm([t[0]-e[0],t[1]-e[1]]);return[e[0]+1e-4*n[0],e[1]+1e-4*n[1]]}}]),t}()).prototype,"mapService",[dY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_Y=V(mY.prototype,"fontService",[vY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gY=mY))||gY),wY=NM()(bY=function(){function e(){b(this,e),E(this,"mapService",void 0)}return S(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().get(Hk.IMapService),e.hooks.init.tap("DataSourcePlugin",(function(){var n=e.getSource();if(!n){var r=e.sourceOption||e.defaultSourceConfig,i=r.data,o=r.options;n=new Dw(i,o),e.setSource(n)}n.inited?t.updateClusterData(e):n.once("update",(function(){t.updateClusterData(e)}))})),e.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){var n=t.updateClusterData(e),r=e.dataState.dataSourceNeedUpdate;return e.dataState.dataSourceNeedUpdate=!1,n||r}))}},{key:"updateClusterData",value:function(e){if(e.isTileLayer||e.tileLayer)return!1;var t=e.getSource(),n=t.cluster,r=t.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=e.dataState.dataSourceNeedUpdate;return n&&a&&t.updateClusterData(Math.floor(o)),!!(n&&Math.abs(e.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&t.updateClusterData(Math.floor(o)),e.clusterZoom=o,!0)}}]),e}())||bY;function MY(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function kY(e){return 1===e.length&&(e=function(e){return function(t,n){return MY(e(t),n)}}(e)),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}}var OY=kY(MY).right;function PY(e){return null===e?NaN:+e}function LY(e,t){var n,r,i,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(n=e[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=e[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=i=n;++a<o;)null!=(n=t(e[a],a,e))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}var IY=Math.sqrt(50),RY=Math.sqrt(10),NY=Math.sqrt(2);function DY(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=FY(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(e+s)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(e-s)/a;return r&&o.reverse(),o}function FY(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=IY?10:o>=RY?5:o>=NY?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=IY?10:o>=RY?5:o>=NY?2:1)}function BY(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=IY?i*=10:o>=RY?i*=5:o>=NY&&(i*=2),t<e?-i:i}function zY(e,t,n){if(null==n&&(n=PY),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),a=+n(e[o],o,e);return a+(+n(e[o+1],o+1,e)-a)*(i-o)}}function jY(e){return function(){return e}}function UY(e){return 1==(e=+e)?VY:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):jY(isNaN(t)?n:t)}}function VY(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):jY(isNaN(e)?t:e)}var HY=function e(t){var n=UY(t);function r(e,t){var r=n((e=py(e)).r,(t=py(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=VY(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);var GY,WY=(GY=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],a=r>0?e[r-1]:2*i-o,s=r<t-1?e[r+2]:2*o-i;return function(e,t,n,r,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*r+a*i)/6}((n-r/t)*t,a,i,o,s)}},function(e){var t,n,r=e.length,i=new Array(r),o=new Array(r),a=new Array(r);for(t=0;t<r;++t)n=py(e[t]),i[t]=n.r||0,o[t]=n.g||0,a[t]=n.b||0;return i=GY(i),o=GY(o),a=GY(a),n.opacity=1,function(e){return n.r=i(e),n.g=o(e),n.b=a(e),n+""}});function YY(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function XY(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=eX(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function ZY(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function qY(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function KY(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=eX(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var QY=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$Y=new RegExp(QY.source,"g");function JY(e,t){var n,r,i,o=QY.lastIndex=$Y.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=QY.exec(e))&&(r=$Y.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:qY(n,r)})),o=$Y.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function eX(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?jY(t):("number"===i?qY:"string"===i?(n=ly(t))?(t=n,HY):JY:t instanceof ly?HY:t instanceof Date?ZY:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?XY:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?KY:qY:YY))(e,t)}function tX(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function nX(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function rX(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e)}return this}function iX(){}function oX(e,t){var n=new iX;if(e instanceof iX)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,o=e.length;if(null==t)for(;++i<o;)n.set(i,e[i]);else for(;++i<o;)n.set(t(r=e[i],i,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}function aX(){}iX.prototype=oX.prototype={constructor:iX,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var sX=oX.prototype;aX.prototype=function(e,t){var n=new aX;if(e instanceof aX)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}.prototype={constructor:aX,has:sX.has,add:function(e){return this["$"+(e+="")]=e,this},remove:sX.remove,clear:sX.clear,values:sX.keys,size:sX.size,empty:sX.empty,each:sX.each};var uX=Array.prototype,lX=uX.map,cX=uX.slice,hX={name:"implicit"};function fX(){var e=oX(),t=[],n=[],r=hX;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==hX)return r;e.set(o,a=t.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=oX();for(var r,o,a=-1,s=n.length;++a<s;)e.has(o=(r=n[a])+"")||e.set(o,t.push(r));return i},i.range=function(e){return arguments.length?(n=cX.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return fX(t,n).unknown(r)},nX.apply(i,arguments),i}function pX(e){return+e}var dX=[0,1];function vX(e){return e}function gX(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function mX(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function yX(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=gX(i,r),o=n(a,o)):(r=gX(r,i),o=n(o,a)),function(e){return o(r(e))}}function _X(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=gX(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=OY(e,t,1,r)-1;return o[n](i[n](t))}}function bX(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function xX(){var e,t,n,r,i,o,a=dX,s=dX,u=eX,l=vX;function c(){return r=Math.min(a.length,s.length)>2?_X:yX,i=o=null,h}function h(t){return isNaN(t=+t)?n:(i||(i=r(a.map(e),s,u)))(e(l(t)))}return h.invert=function(n){return l(t((o||(o=r(s,a.map(e),qY)))(n)))},h.domain=function(e){return arguments.length?(a=lX.call(e,pX),l===vX||(l=mX(a)),c()):a.slice()},h.range=function(e){return arguments.length?(s=cX.call(e),c()):s.slice()},h.rangeRound=function(e){return s=cX.call(e),u=tX,c()},h.clamp=function(e){return arguments.length?(l=e?mX(a):vX,h):l!==vX},h.interpolate=function(e){return arguments.length?(u=e,c()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,c()}}function SX(e,t){return xX()(e,t)}function EX(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function AX(e){return(e=EX(Math.abs(e)))?e[1]:NaN}var CX,TX=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function wX(e){if(!(t=TX.exec(e)))throw new Error("invalid format: "+e);var t;return new MX({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function MX(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function kX(e,t){var n=EX(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}wX.prototype=MX.prototype,MX.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var OX={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return kX(100*e,t)},r:kX,s:function(e,t){var n=EX(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(CX=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+EX(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function PX(e){return e}var LX,IX,RX,NX=Array.prototype.map,DX=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function FX(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?PX:(t=NX.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?PX:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(NX.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"-":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=wX(e)).fill,n=e.align,h=e.sign,f=e.symbol,p=e.zero,d=e.width,v=e.comma,g=e.precision,m=e.trim,y=e.type;"n"===y?(v=!0,y="g"):OX[y]||(void 0===g&&(g=12),m=!0,y="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var _="$"===f?i:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===f?o:/[%p]/.test(y)?u:"",x=OX[y],S=/[defgprs%]/.test(y);function E(e){var i,o,u,f=_,E=b;if("c"===y)E=x(e)+E,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:x(Math.abs(e),g),m&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==h&&(A=!1),f=(A?"("===h?h:l:"-"===h||"("===h?"":h)+f,E=("s"===y?DX[8+CX/3]:"")+E+(A&&"("===h?")":""),S)for(i=-1,o=e.length;++i<o;)if(48>(u=e.charCodeAt(i))||u>57){E=(46===u?a+e.slice(i+1):e.slice(i))+E,e=e.slice(0,i);break}}v&&!p&&(e=r(e,1/0));var C=f.length+e.length+E.length,T=C<d?new Array(d-C+1).join(t):"";switch(v&&p&&(e=r(T+e,T.length?d-E.length:1/0),T=""),n){case"<":e=f+e+E+T;break;case"=":e=f+T+e+E;break;case"^":e=T.slice(0,C=T.length>>1)+f+e+E+T.slice(C);break;default:e=T+f+e+E}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),E.toString=function(){return e+""},E}return{format:h,formatPrefix:function(e,t){var n=h(((e=wX(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(AX(t)/3))),i=Math.pow(10,-r),o=DX[8+r/3];return function(e){return n(i*e)+o}}}}function BX(e,t,n,r){var i,o=BY(e,t,n);switch((r=wX(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(AX(t)/3)))-AX(Math.abs(e)))}(o,a))||(r.precision=i),RX(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,AX(t)-AX(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-AX(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return IX(r)}function zX(e){var t=e.domain;return e.ticks=function(e){var n=t();return DY(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return BX(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=FY(s,u,n))>0?r=FY(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=FY(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,t(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,t(i)),e},e}function jX(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}function UX(e){return Math.log(e)}function VX(e){return Math.exp(e)}function HX(e){return-Math.log(-e)}function GX(e){return-Math.exp(-e)}function WX(e){return isFinite(e)?+("1e"+e):e<0?0:e}function YX(e){return function(t){return-e(-t)}}function XX(e){var t,n,r=e(UX,VX),i=r.domain,o=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(o),n=function(e){return 10===e?WX:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(o),i()[0]<0?(t=YX(t),n=YX(n),e(HX,GX)):e(UX,VX),r}return r.base=function(e){return arguments.length?(o=+e,a()):o},r.domain=function(e){return arguments.length?(i(e),a()):i()},r.ticks=function(e){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(f=s,s=u,u=f);var l,c,h,f=t(s),p=t(u),d=null==e?10:+e,v=[];if(!(o%1)&&p-f<d){if(f=Math.round(f)-1,p=Math.round(p)+1,s>0){for(;f<p;++f)for(c=1,l=n(f);c<o;++c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else for(;f<p;++f)for(c=o-1,l=n(f);c>=1;--c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else v=DY(f,p,Math.min(p-f,d)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=IX(i)),e===1/0)return i;null==e&&(e=10);var a=Math.max(1,o*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*o<o-.5&&(r*=o),r<=a?i(e):""}},r.nice=function(){return i(jX(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function ZX(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function qX(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function KX(e){return e<0?-e*e:e*e}function QX(e){var t=e(vX,vX),n=1;function r(){return 1===n?e(vX,vX):.5===n?e(qX,KX):e(ZX(n),ZX(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},zX(t)}LX=FX({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),IX=LX.format,RX=LX.formatPrefix;var $X=new Date,JX=new Date;function eZ(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return eZ((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return $X.setTime(+t),JX.setTime(+r),e($X),e(JX),Math.floor(n($X,JX))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var tZ=eZ((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));tZ.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?eZ((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):tZ:null};var nZ=eZ((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getUTCSeconds()})),rZ=eZ((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds())}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getMinutes()})),iZ=eZ((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds()-6e4*e.getMinutes())}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getHours()})),oZ=eZ((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),(function(e){return e.getDate()-1}));function aZ(e){return eZ((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5}))}var sZ=aZ(0),uZ=aZ(1),lZ=(aZ(2),aZ(3),aZ(4)),cZ=(aZ(5),aZ(6),eZ((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),hZ=eZ((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));hZ.every=function(e){return isFinite(e=Math.floor(e))&&e>0?eZ((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var fZ=eZ((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/864e5}),(function(e){return e.getUTCDate()-1}));function pZ(e){return eZ((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/6048e5}))}var dZ=pZ(0),vZ=pZ(1),gZ=(pZ(2),pZ(3),pZ(4)),mZ=(pZ(5),pZ(6),eZ((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));function yZ(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function _Z(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function bZ(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}mZ.every=function(e){return isFinite(e=Math.floor(e))&&e>0?eZ((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var xZ,SZ,EZ={"-":"",_:" ",0:"0"},AZ=/^\s*\d+/,CZ=/^%/,TZ=/[\\^$*+?|[\]().{}]/g;function wZ(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function MZ(e){return e.replace(TZ,"\\$&")}function kZ(e){return new RegExp("^(?:"+e.map(MZ).join("|")+")","i")}function OZ(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function PZ(e,t,n){var r=AZ.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function LZ(e,t,n){var r=AZ.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function IZ(e,t,n){var r=AZ.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function RZ(e,t,n){var r=AZ.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function NZ(e,t,n){var r=AZ.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function DZ(e,t,n){var r=AZ.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function FZ(e,t,n){var r=AZ.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function BZ(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function zZ(e,t,n){var r=AZ.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function jZ(e,t,n){var r=AZ.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function UZ(e,t,n){var r=AZ.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function VZ(e,t,n){var r=AZ.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function HZ(e,t,n){var r=AZ.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function GZ(e,t,n){var r=AZ.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function WZ(e,t,n){var r=AZ.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function YZ(e,t,n){var r=AZ.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function XZ(e,t,n){var r=AZ.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function ZZ(e,t,n){var r=CZ.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function qZ(e,t,n){var r=AZ.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function KZ(e,t,n){var r=AZ.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function QZ(e,t){return wZ(e.getDate(),t,2)}function $Z(e,t){return wZ(e.getHours(),t,2)}function JZ(e,t){return wZ(e.getHours()%12||12,t,2)}function eq(e,t){return wZ(1+oZ.count(hZ(e),e),t,3)}function tq(e,t){return wZ(e.getMilliseconds(),t,3)}function nq(e,t){return tq(e,t)+"000"}function rq(e,t){return wZ(e.getMonth()+1,t,2)}function iq(e,t){return wZ(e.getMinutes(),t,2)}function oq(e,t){return wZ(e.getSeconds(),t,2)}function aq(e){var t=e.getDay();return 0===t?7:t}function sq(e,t){return wZ(sZ.count(hZ(e)-1,e),t,2)}function uq(e){var t=e.getDay();return t>=4||0===t?lZ(e):lZ.ceil(e)}function lq(e,t){return e=uq(e),wZ(lZ.count(hZ(e),e)+(4===hZ(e).getDay()),t,2)}function cq(e){return e.getDay()}function hq(e,t){return wZ(uZ.count(hZ(e)-1,e),t,2)}function fq(e,t){return wZ(e.getFullYear()%100,t,2)}function pq(e,t){return wZ((e=uq(e)).getFullYear()%100,t,2)}function dq(e,t){return wZ(e.getFullYear()%1e4,t,4)}function vq(e,t){var n=e.getDay();return wZ((e=n>=4||0===n?lZ(e):lZ.ceil(e)).getFullYear()%1e4,t,4)}function gq(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+wZ(t/60|0,"0",2)+wZ(t%60,"0",2)}function mq(e,t){return wZ(e.getUTCDate(),t,2)}function yq(e,t){return wZ(e.getUTCHours(),t,2)}function _q(e,t){return wZ(e.getUTCHours()%12||12,t,2)}function bq(e,t){return wZ(1+fZ.count(mZ(e),e),t,3)}function xq(e,t){return wZ(e.getUTCMilliseconds(),t,3)}function Sq(e,t){return xq(e,t)+"000"}function Eq(e,t){return wZ(e.getUTCMonth()+1,t,2)}function Aq(e,t){return wZ(e.getUTCMinutes(),t,2)}function Cq(e,t){return wZ(e.getUTCSeconds(),t,2)}function Tq(e){var t=e.getUTCDay();return 0===t?7:t}function wq(e,t){return wZ(dZ.count(mZ(e)-1,e),t,2)}function Mq(e){var t=e.getUTCDay();return t>=4||0===t?gZ(e):gZ.ceil(e)}function kq(e,t){return e=Mq(e),wZ(gZ.count(mZ(e),e)+(4===mZ(e).getUTCDay()),t,2)}function Oq(e){return e.getUTCDay()}function Pq(e,t){return wZ(vZ.count(mZ(e)-1,e),t,2)}function Lq(e,t){return wZ(e.getUTCFullYear()%100,t,2)}function Iq(e,t){return wZ((e=Mq(e)).getUTCFullYear()%100,t,2)}function Rq(e,t){return wZ(e.getUTCFullYear()%1e4,t,4)}function Nq(e,t){var n=e.getUTCDay();return wZ((e=n>=4||0===n?gZ(e):gZ.ceil(e)).getUTCFullYear()%1e4,t,4)}function Dq(){return"+0000"}function Fq(){return"%"}function Bq(e){return+e}function zq(e){return Math.floor(+e/1e3)}!function(e){xZ=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,l=kZ(i),c=OZ(i),h=kZ(o),f=OZ(o),p=kZ(a),d=OZ(a),v=kZ(s),g=OZ(s),m=kZ(u),y=OZ(u),_={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:QZ,e:QZ,f:nq,g:pq,G:vq,H:$Z,I:JZ,j:eq,L:tq,m:rq,M:iq,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Bq,s:zq,S:oq,u:aq,U:sq,V:lq,w:cq,W:hq,x:null,X:null,y:fq,Y:dq,Z:gq,"%":Fq},b={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:mq,e:mq,f:Sq,g:Iq,G:Nq,H:yq,I:_q,j:bq,L:xq,m:Eq,M:Aq,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Bq,s:zq,S:Cq,u:Tq,U:wq,V:kq,w:Oq,W:Pq,x:null,X:null,y:Lq,Y:Rq,Z:Dq,"%":Fq},x={a:function(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=f[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return A(e,t,n,r)},d:UZ,e:UZ,f:XZ,g:FZ,G:DZ,H:HZ,I:HZ,j:VZ,L:YZ,m:jZ,M:GZ,p:function(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:zZ,Q:qZ,s:KZ,S:WZ,u:LZ,U:IZ,V:RZ,w:PZ,W:NZ,x:function(e,t,r){return A(e,n,t,r)},X:function(e,t,n){return A(e,r,t,n)},y:FZ,Y:DZ,Z:BZ,"%":ZZ};function S(e,t){return function(n){var r,i,o,a=[],s=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(i=EZ[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}}function E(e,t){return function(n){var r,i,o=bZ(1900,void 0,1);if(A(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=_Z(bZ(o.y,0,1))).getUTCDay(),r=i>4||0===i?vZ.ceil(r):vZ(r),r=fZ.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=yZ(bZ(o.y,0,1))).getDay(),r=i>4||0===i?uZ.ceil(r):uZ(r),r=oZ.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?_Z(bZ(o.y,0,1)).getUTCDay():yZ(bZ(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,_Z(o)):yZ(o)}}function A(e,t,n,r){for(var i,o,a=0,s=t.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=x[i in EZ?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=S(n,_),_.X=S(r,_),_.c=S(t,_),b.x=S(n,b),b.X=S(r,b),b.c=S(t,b),{format:function(e){var t=S(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=E(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+="",b);return t.toString=function(){return e},t},utcParse:function(e){var t=E(e+="",!0);return t.toString=function(){return e},t}}}(e),SZ=xZ.format,xZ.parse,xZ.utcFormat,xZ.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var jq,Uq;function Vq(e){return new Date(e)}function Hq(e){return e instanceof Date?+e:+new Date(+e)}function Gq(e,t,n,r,i,o,a,s,u){var l=SX(vX,vX),c=l.invert,h=l.domain,f=u(".%L"),p=u(":%S"),d=u("%I:%M"),v=u("%I %p"),g=u("%a %d"),m=u("%b %d"),y=u("%B"),_=u("%Y"),b=[[a,1,1e3],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,6e4],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,31536e6]];function x(s){return(a(s)<s?f:o(s)<s?p:i(s)<s?d:r(s)<s?v:t(s)<s?n(s)<s?g:m:e(s)<s?y:_)(s)}function S(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=kY((function(e){return e[2]})).right(b,o);a===b.length?(i=BY(n/31536e6,r/31536e6,t),t=e):a?(i=(a=b[o/b[a-1][2]<b[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(BY(n,r,t),1),t=s)}return null==i?t:t.every(i)}return l.invert=function(e){return new Date(c(e))},l.domain=function(e){return arguments.length?h(lX.call(e,Hq)):h().map(Vq)},l.ticks=function(e,t){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=S(e,i,o,t))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(e,t){return null==t?x:u(t)},l.nice=function(e,t){var n=h();return(e=S(e,n[0],n[n.length-1],t))?h(jX(n,e)):l},l.copy=function(){return bX(l,Gq(e,t,n,r,i,o,a,s,u))},l}function Wq(){var e,t,n,r,i,o=0,a=1,s=vX,u=!1;function l(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}return l.domain=function(i){return arguments.length?(e=r(o=+i[0]),t=r(a=+i[1]),n=e===t?0:1/(t-e),l):[o,a]},l.clamp=function(e){return arguments.length?(u=!!e,l):u},l.interpolator=function(e){return arguments.length?(s=e,l):s},l.unknown=function(e){return arguments.length?(i=e,l):i},function(i){return r=i,e=i(o),t=i(a),n=e===t?0:1/(t-e),l}}function Yq(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Xq(){var e,t,n,r,i,o,a,s=0,u=.5,l=1,c=vX,h=!1;function f(e){return isNaN(e=+e)?a:(e=.5+((e=+o(e))-t)*(e<t?r:i),c(h?Math.max(0,Math.min(1,e)):e))}return f.domain=function(a){return arguments.length?(e=o(s=+a[0]),t=o(u=+a[1]),n=o(l=+a[2]),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),f):[s,u,l]},f.clamp=function(e){return arguments.length?(h=!!e,f):h},f.interpolator=function(e){return arguments.length?(c=e,f):c},f.unknown=function(e){return arguments.length?(a=e,f):a},function(a){return o=a,e=a(s),t=a(u),n=a(l),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),f}}var Zq,qq,Kq,Qq,$q=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Jq=(E(jq={},e.ScaleTypes.LINEAR,(function e(){var t=SX(vX,vX);return t.copy=function(){return bX(t,e())},nX.apply(t,arguments),zX(t)})),E(jq,e.ScaleTypes.POWER,(function e(){var t=QX(xX());return t.copy=function(){return bX(t,e()).exponent(t.exponent())},nX.apply(t,arguments),t})),E(jq,e.ScaleTypes.LOG,(function e(){var t=XX(xX()).domain([1,10]);return t.copy=function(){return bX(t,e()).base(t.base())},nX.apply(t,arguments),t})),E(jq,e.ScaleTypes.IDENTITY,(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=lX.call(e,pX),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?lX.call(t,pX):[0,1],zX(r)})),E(jq,e.ScaleTypes.SEQUENTIAL,(function e(){var t=zX(Wq()(vX));return t.copy=function(){return Yq(t,e())},rX.apply(t,arguments)})),E(jq,e.ScaleTypes.TIME,(function(){return nX.apply(Gq(hZ,cZ,sZ,oZ,iZ,rZ,nZ,tZ,SZ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),E(jq,e.ScaleTypes.QUANTILE,(function e(){var t,n=[],r=[],i=[];function o(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=zY(n,e/t);return a}function a(e){return isNaN(e=+e)?t:r[OY(i,e)]}return a.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(MY),o()},a.range=function(e){return arguments.length?(r=cX.call(e),o()):r.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return i.slice()},a.copy=function(){return e().domain(n).range(r).unknown(t)},nX.apply(a,arguments)})),E(jq,e.ScaleTypes.QUANTIZE,(function e(){var t,n=0,r=1,i=1,o=[.5],a=[0,1];function s(e){return e<=e?a[OY(o,e,0,i)]:t}function u(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],u()):[n,r]},s.range=function(e){return arguments.length?(i=(a=cX.call(e)).length-1,u()):a.slice()},s.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,o[0]]:t>=i?[o[i-1],r]:[o[t-1],o[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return e().domain([n,r]).range(a).unknown(t)},nX.apply(zX(s),arguments)})),E(jq,e.ScaleTypes.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function o(e){return e<=e?r[OY(n,e,0,i)]:t}return o.domain=function(e){return arguments.length?(n=cX.call(e),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(e){return arguments.length?(r=cX.call(e),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},o.unknown=function(e){return arguments.length?(t=e,o):t},o.copy=function(){return e().domain(n).range(r).unknown(t)},nX.apply(o,arguments)})),E(jq,e.ScaleTypes.CAT,fX),E(jq,e.ScaleTypes.DIVERGING,(function e(){var t=zX(Xq()(vX));return t.copy=function(){return Yq(t,e())},rX.apply(t,arguments)})),jq),eK=NM()(Uq=function(){function t(){b(this,t),E(this,"scaleOptions",{})}return S(t,[{key:"getSourceData",value:function(e,t){var n=e.getSource();n.inited?t(n.data):n.once("update",(function(){t(n.data)}))}},{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("FeatureScalePlugin",(function(){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes();n.getSourceData(e,(function(e){var r=e.dataArray;Array.isArray(r)&&0===r.length||n.caculateScalesForAttributes(t||[],r)}))})),e.hooks.beforeRenderData.tap("FeatureScalePlugin",(function(){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes();return n.getSourceData(e,(function(r){var i=r.dataArray;Array.isArray(i)&&0===i.length||(n.caculateScalesForAttributes(t||[],i),e.layerModelNeedUpdate=!0)})),!0})),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){var t=e.getLayerConfig().usage;if(!e.layerModelNeedUpdate&&"basemap"!==t){n.scaleOptions=e.getScaleOptions();var i=r.getLayerStyleAttributes();i&&n.getSourceData(e,(function(e){var t=e.dataArray;if(0!==t.length){var r=i.filter((function(e){return e.needRescale}));r.length&&n.caculateScalesForAttributes(r,t)}}))}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(t,n){var r=this;t.forEach((function(t){if(t.scale){var i=t.scale;i.names=r.parseFields(t.scale.field||[]);var o=[];i.names.forEach((function(e){var i;o.push(r.createScale(e,t.name,null===(i=t.scale)||void 0===i?void 0:i.values,n))})),o.some((function(t){return t.type===e.StyleScaleType.VARIABLE}))?(i.type=e.StyleScaleType.VARIABLE,o.forEach((function(t){var n,r;if(!i.callback&&"text"!==i.values)switch(null===(n=t.option)||void 0===n?void 0:n.type){case e.ScaleTypes.LOG:case e.ScaleTypes.LINEAR:case e.ScaleTypes.POWER:if(i.values&&i.values.length>2){var o=t.scale.ticks(i.values.length);t.scale.domain(o)}i.values?t.scale.range(i.values):t.scale.range(t.option.domain);break;case e.ScaleTypes.QUANTILE:case e.ScaleTypes.QUANTIZE:case e.ScaleTypes.THRESHOLD:t.scale.range(i.values);break;case e.ScaleTypes.CAT:i.values?t.scale.range(i.values):t.scale.range(t.option.domain);break;case e.ScaleTypes.DIVERGING:case e.ScaleTypes.SEQUENTIAL:t.scale.interpolator(WY(i.values))}"text"===i.values&&t.scale.range(null===(r=t.option)||void 0===r?void 0:r.domain)}))):(i.type=e.StyleScaleType.CONSTANT,i.defaultValues=o.map((function(e,t){return e.scale(i.names[t])}))),i.scalers=o.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),t.needRescale=!1}}))}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:KC(e)?e.split("*"):[e]}},{key:"createScale",value:function(t,n,r,i){var o,a,s=this.scaleOptions[n]&&(null===(o=this.scaleOptions[n])||void 0===o?void 0:o.field)===t?this.scaleOptions[n]:this.scaleOptions[t],u={field:t,scale:void 0,type:e.StyleScaleType.VARIABLE,option:s};if(!i||!i.length)return s&&s.type?u.scale=this.createDefaultScale(s):(u.scale=fX([t]),u.type=e.StyleScaleType.CONSTANT),u;var l=null===(a=i.find((function(e){return!QI(e[t])})))||void 0===a?void 0:a[t];if(this.isNumber(t)||QI(l)&&!s)u.scale=fX([t]),u.type=e.StyleScaleType.CONSTANT;else{var c=s&&s.type||this.getDefaultType(l);"text"===r&&(c=e.ScaleTypes.CAT);var h=this.createScaleConfig(c,t,s,i);u.scale=this.createDefaultScale(h),u.option=h}return u}},{key:"getDefaultType",value:function(t){var n=e.ScaleTypes.LINEAR;return"string"==typeof t&&(n=$q.test(t)?e.ScaleTypes.TIME:e.ScaleTypes.CAT),n}},{key:"createScaleConfig",value:function(t,n,r,i){var o={type:t},a=(null==i?void 0:i.map((function(e){return e[n]})))||[];if(null!=r&&r.domain)o.domain=null==r?void 0:r.domain;else if(t!==e.ScaleTypes.CAT&&t!==e.ScaleTypes.QUANTILE&&t!==e.ScaleTypes.DIVERGING)o.domain=LY(a);else if(t===e.ScaleTypes.CAT)o.domain=eN(a);else if(t===e.ScaleTypes.QUANTILE)o.domain=a;else if(t===e.ScaleTypes.DIVERGING){var s=LY(a),u=void 0!==(null==r?void 0:r.neutral)?null==r?void 0:r.neutral:(s[0]+s[1])/2;o.domain=[s[0],u,s[1]]}return v(v({},o),r)}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=e.unknown,i=e.clamp,o=e.nice,a=Jq[t]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),t}())||Uq,tK=NM()(Zq=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.animateStatus&&e.models.forEach((function(t){t.addUniforms(v({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}())||Zq,nK=NM()(qq=function(){function e(){b(this,e)}return S(e,[{key:"initLayerModel",value:function(e){e.prepareBuildModel(),e.buildModels(),e.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(e){var t;e.prepareBuildModel(),null===(t=e.layerModel)||void 0===t||t.clearModels(),e.buildModels(),e.layerModelNeedUpdate=!1}},{key:"apply",value:function(e){var t=this;e.hooks.init.tap("LayerModelPlugin",(function(){e.inited=!0,e.modelLoaded=!1,e.getSource().inited&&t.initLayerModel(e)})),e.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){var n=e.getSource();return e.modelLoaded=!1,n.inited?t.prepareLayerModel(e):n.once("update",(function(){t.prepareLayerModel(e)})),!1}))}}]),e}())||qq,rK=NM()(Kq=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){e.updateLayerConfig({});var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&setTimeout((function(){e.fitBounds(r)}),100)}))}}]),e}())||Kq,iK=["type"],oK={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},aK={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},sK={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},uK={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var lK,cK,hK,fK,pK,dK,vK,gK,mK,yK,_K,bK,xK,SK,EK,AK,CK=NM()(Qq=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(v({},(n={u_DirectionalLights:new Array(3).fill(v({},sK)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(v({},uK)),u_NumOfSpotLights:0},t&&t.length||(t=[aK]),t.forEach((function(e){var t=e.type,r=void 0===t?"directional":t,i=O(e,iK),o=oK[r].lights,a=oK[r].num,s=n[a];n[o][s]=v(v({},n[o][s]),i),n[a]++})),n)));var t,n}))}))}}]),e}())||Qq,TK=NM()(lK=function(){function e(){b(this,e),E(this,"enabled",void 0)}return S(e,[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.postProcessingPassFactory,o=t.normalPassFactory;e.hooks.init.tap("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),r=t.enableMultiPassRenderer,a=t.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=rV(e,s,i,o),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var t=r.getViewportSize(),i=t.width,o=t.height;e.multiPassRenderer.resize(i,o)}}))}}]),e}())||lK,wK=1,MK=2,kK=NM()(cK=function(){function t(){b(this,t)}return S(t,[{key:"apply",value:function(t,n){var r=n.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",(function(){var n=t.getLayerConfig().enablePicking;r.registerStyleAttribute({name:"pickingColor",type:e.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:e.gl.FLOAT},size:3,update:function(e){var t=e.id;return n?Ty(t):[0,0,0]}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(e){return e.addUniforms({u_PickingStage:wK})}))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(e){return e.addUniforms({u_PickingStage:MK})}))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.highlightColor,i=n.activeMix,o=void 0===i?0:i,a="string"==typeof r?Ay(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Cy(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:MK,u_PickingColor:e,u_HighlightColor:a.map((function(e){return 255*e})),u_activeMix:o})}))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.selectColor,i=n.selectMix,o=void 0===i?0:i,a="string"==typeof r?Ay(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Cy(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:MK,u_PickingColor:e,u_HighlightColor:a.map((function(e){return 255*e})),u_activeMix:o,u_CurrentSelectedId:e,u_SelectColor:a.map((function(e){return 255*e})),u_EnableSelect:1})}))}))}}]),t}())||cK,OK=NM()(hK=function(){function t(){b(this,t)}return S(t,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("RegisterStyleAttributePlugin",(function(){(function(e){var t=e.getSource();return YH.includes(t.parser.type)})(e)||n.registerBuiltinAttributes(r,e)}))}},{key:"registerBuiltinAttributes",value:function(e,t){if("MaskLayer"!==t.type)if("basemap"!==t.getLayerConfig().usage){if(t.isTileLayer)return this.registerPositionAttribute(e),void this.registerColorAttribute(e);this.registerPositionAttribute(e),this.registerFilterAttribute(e),this.registerColorAttribute(e),this.registerVertexIdAttribute(e)}else this.registerPositionAttribute(e);else this.registerPositionAttribute(e)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:e.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerFilterAttribute",value:function(t){t.registerStyleAttribute({name:"filter",type:e.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e){return e.filter?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:e.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:e.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t){return[t]}}})}}]),t}())||hK,PK=(fK=NM(),pK=RM(Hk.ICameraService),dK=RM(Hk.ICoordinateSystemService),vK=RM(Hk.IRendererService),gK=RM(Hk.IMapService),fK((_K=V((yK=function(){function e(){b(this,e),U(this,"cameraService",_K,this),U(this,"coordinateSystemService",bK,this),U(this,"rendererService",xK,this),U(this,"mapService",SK,this)}return S(e,[{key:"apply",value:function(e){var t=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[0,0];e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var o=e.getLayerConfig().tileOrigin;t.coordinateSystemService.refresh(o),"GAODE2.x"===n&&(t.setLayerCenter(e),r=t.mapService.map.customCoords.getMVPMatrix(),i=t.mapService.getCustomCoordCenter());var a=t.rendererService.getViewportSize(),s=a.width,u=a.height;e.models.forEach((function(n){var o;n.addUniforms((E(o={},TF.ProjectionMatrix,t.cameraService.getProjectionMatrix()),E(o,TF.ViewMatrix,t.cameraService.getViewMatrix()),E(o,TF.ViewProjectionMatrix,t.cameraService.getViewProjectionMatrix()),E(o,TF.Zoom,t.cameraService.getZoom()),E(o,TF.ZoomScale,t.cameraService.getZoomScale()),E(o,TF.FocalDistance,t.cameraService.getFocalDistance()),E(o,TF.CameraPosition,t.cameraService.getCameraPosition()),E(o,dI.CoordinateSystem,t.coordinateSystemService.getCoordinateSystem()),E(o,dI.ViewportCenter,t.coordinateSystemService.getViewportCenter()),E(o,dI.ViewportCenterProjection,t.coordinateSystemService.getViewportCenterProjection()),E(o,dI.PixelsPerDegree,t.coordinateSystemService.getPixelsPerDegree()),E(o,dI.PixelsPerDegree2,t.coordinateSystemService.getPixelsPerDegree2()),E(o,dI.PixelsPerMeter,t.coordinateSystemService.getPixelsPerMeter()),E(o,dI.Mvp,r),E(o,"u_SceneCenterMKT",i),E(o,"u_ViewportSize",[s,u]),E(o,"u_ModelMatrix",t.cameraService.getModelMatrix()),E(o,"u_DevicePixelRatio",Zv.devicePixelRatio),E(o,"u_PickingBuffer",e.getLayerConfig().pickingBuffer||0),E(o,"u_shaderPick",Number(e.getShaderPickStat())),o))}))}))}},{key:"setLayerCenter",value:function(e){void 0===e.coordCenter&&(e.coordCenter=e.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(e.coordCenter)}}]),e}()).prototype,"cameraService",[pK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bK=V(yK.prototype,"coordinateSystemService",[dK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xK=V(yK.prototype,"rendererService",[vK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SK=V(yK.prototype,"mapService",[gK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mK=yK))||mK),LK=NM()(EK=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate()}))}}]),e}())||EK,IK=NM()(AK=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){var t=e.getLayerConfig().usage;e.layerModelNeedUpdate||e.tileLayer||"basemap"===t||e.modelLoaded&&n.updateStyleAttribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex,e),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}]),e}())||AK;cF.bind(Hk.ILayerPlugin).to(wY).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(OK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(eK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(TY).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(rK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(IK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(LK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(TK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(PK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(tK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(CK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(kK).inRequestScope(),cF.bind(Hk.ILayerPlugin).to(nK).inRequestScope();var RK={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},NK="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",DK={5:NK,"5module":NK+" export import",6:NK+" const class extends export import super"},FK=/^in(stanceof)?$/,BK="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࣇऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-鿼ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-ꟊꟵ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",zK="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿᫀᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",jK=new RegExp("["+BK+"]"),UK=new RegExp("["+BK+zK+"]");BK=zK=null;var VK=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],HK=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function GK(e,t){for(var n=65536,r=0;r<t.length;r+=2){if((n+=t[r])>e)return!1;if((n+=t[r+1])>=e)return!0}}function WK(e,t){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&jK.test(String.fromCharCode(e)):!1!==t&&GK(e,VK)))}function YK(e,t){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&UK.test(String.fromCharCode(e)):!1!==t&&(GK(e,VK)||GK(e,HK)))))}var XK=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function ZK(e,t){return new XK(e,{beforeExpr:!0,binop:t})}var qK={beforeExpr:!0},KK={startsExpr:!0},QK={};function $K(e,t){return void 0===t&&(t={}),t.keyword=e,QK[e]=new XK(e,t)}var JK={num:new XK("num",KK),regexp:new XK("regexp",KK),string:new XK("string",KK),name:new XK("name",KK),eof:new XK("eof"),bracketL:new XK("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new XK("]"),braceL:new XK("{",{beforeExpr:!0,startsExpr:!0}),braceR:new XK("}"),parenL:new XK("(",{beforeExpr:!0,startsExpr:!0}),parenR:new XK(")"),comma:new XK(",",qK),semi:new XK(";",qK),colon:new XK(":",qK),dot:new XK("."),question:new XK("?",qK),questionDot:new XK("?."),arrow:new XK("=>",qK),template:new XK("template"),invalidTemplate:new XK("invalidTemplate"),ellipsis:new XK("...",qK),backQuote:new XK("`",KK),dollarBraceL:new XK("${",{beforeExpr:!0,startsExpr:!0}),eq:new XK("=",{beforeExpr:!0,isAssign:!0}),assign:new XK("_=",{beforeExpr:!0,isAssign:!0}),incDec:new XK("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new XK("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:ZK("||",1),logicalAND:ZK("&&",2),bitwiseOR:ZK("|",3),bitwiseXOR:ZK("^",4),bitwiseAND:ZK("&",5),equality:ZK("==/!=/===/!==",6),relational:ZK("</>/<=/>=",7),bitShift:ZK("<</>>/>>>",8),plusMin:new XK("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:ZK("%",10),star:ZK("*",10),slash:ZK("/",10),starstar:new XK("**",{beforeExpr:!0}),coalesce:ZK("??",1),_break:$K("break"),_case:$K("case",qK),_catch:$K("catch"),_continue:$K("continue"),_debugger:$K("debugger"),_default:$K("default",qK),_do:$K("do",{isLoop:!0,beforeExpr:!0}),_else:$K("else",qK),_finally:$K("finally"),_for:$K("for",{isLoop:!0}),_function:$K("function",KK),_if:$K("if"),_return:$K("return",qK),_switch:$K("switch"),_throw:$K("throw",qK),_try:$K("try"),_var:$K("var"),_const:$K("const"),_while:$K("while",{isLoop:!0}),_with:$K("with"),_new:$K("new",{beforeExpr:!0,startsExpr:!0}),_this:$K("this",KK),_super:$K("super",KK),_class:$K("class",KK),_extends:$K("extends",qK),_export:$K("export"),_import:$K("import",KK),_null:$K("null",KK),_true:$K("true",KK),_false:$K("false",KK),_in:$K("in",{beforeExpr:!0,binop:7}),_instanceof:$K("instanceof",{beforeExpr:!0,binop:7}),_typeof:$K("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:$K("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:$K("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},eQ=/\r\n?|\n|\u2028|\u2029/,tQ=new RegExp(eQ.source,"g");function nQ(e,t){return 10===e||13===e||!t&&(8232===e||8233===e)}var rQ=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,iQ=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,oQ=Object.prototype,aQ=oQ.hasOwnProperty,sQ=oQ.toString;function uQ(e,t){return aQ.call(e,t)}var lQ=Array.isArray||function(e){return"[object Array]"===sQ.call(e)};function cQ(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var hQ=function(e,t){this.line=e,this.column=t};hQ.prototype.offset=function(e){return new hQ(this.line,this.column+e)};var fQ=function(e,t,n){this.start=t,this.end=n,null!==e.sourceFile&&(this.source=e.sourceFile)};function pQ(e,t){for(var n=1,r=0;;){tQ.lastIndex=r;var i=tQ.exec(e);if(!(i&&i.index<t))return new hQ(n,t-r);++n,r=i.index+i[0].length}}var dQ={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function vQ(e){var t={};for(var n in dQ)t[n]=e&&uQ(e,n)?e[n]:dQ[n];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),lQ(t.onToken)){var r=t.onToken;t.onToken=function(e){return r.push(e)}}return lQ(t.onComment)&&(t.onComment=function(e,t){return function(n,r,i,o,a,s){var u={type:n?"Block":"Line",value:r,start:i,end:o};e.locations&&(u.loc=new fQ(this,a,s)),e.ranges&&(u.range=[i,o]),t.push(u)}}(t,t.onComment)),t}function gQ(e,t){return 2|(e?4:0)|(t?8:0)}var mQ=function(e,t,n){this.options=e=vQ(e),this.sourceFile=e.sourceFile,this.keywords=cQ(DK[e.ecmaVersion>=6?6:"module"===e.sourceType?"5module":5]);var r="";if(!0!==e.allowReserved){for(var i=e.ecmaVersion;!(r=RK[i]);i--);"module"===e.sourceType&&(r+=" await")}this.reservedWords=cQ(r);var o=(r?r+" ":"")+RK.strict;this.reservedWordsStrict=cQ(o),this.reservedWordsStrictBind=cQ(o+" "+RK.strictBind),this.input=String(t),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(eQ).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=JK.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},yQ={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};mQ.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)},yQ.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},yQ.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},yQ.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},yQ.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},yQ.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},yQ.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},mQ.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},mQ.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=this,r=0;r<e.length;r++)n=e[r](n);return n},mQ.parse=function(e,t){return new this(t,e).parse()},mQ.parseExpressionAt=function(e,t,n){var r=new this(n,e,t);return r.nextToken(),r.parseExpression()},mQ.tokenizer=function(e,t){return new this(t,e)},Object.defineProperties(mQ.prototype,yQ);var _Q=mQ.prototype,bQ=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function xQ(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}_Q.strictDirective=function(e){for(;;){iQ.lastIndex=e,e+=iQ.exec(this.input)[0].length;var t=bQ.exec(this.input.slice(e));if(!t)return!1;if("use strict"===(t[1]||t[2])){iQ.lastIndex=e+t[0].length;var n=iQ.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||eQ.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}e+=t[0].length,iQ.lastIndex=e,e+=iQ.exec(this.input)[0].length,";"===this.input[e]&&e++}},_Q.eat=function(e){return this.type===e&&(this.next(),!0)},_Q.isContextual=function(e){return this.type===JK.name&&this.value===e&&!this.containsEsc},_Q.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},_Q.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},_Q.canInsertSemicolon=function(){return this.type===JK.eof||this.type===JK.braceR||eQ.test(this.input.slice(this.lastTokEnd,this.start))},_Q.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},_Q.semicolon=function(){this.eat(JK.semi)||this.insertSemicolon()||this.unexpected()},_Q.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},_Q.expect=function(e){this.eat(e)||this.unexpected()},_Q.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},_Q.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},_Q.checkExpressionErrors=function(e,t){if(!e)return!1;var n=e.shorthandAssign,r=e.doubleProto;if(!t)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},_Q.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},_Q.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var SQ=mQ.prototype;SQ.parseTopLevel=function(e){var t={};for(e.body||(e.body=[]);this.type!==JK.eof;){var n=this.parseStatement(null,!0,t);e.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var o=i[r];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var EQ={kind:"loop"},AQ={kind:"switch"};SQ.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;iQ.lastIndex=this.pos;var t=iQ.exec(this.input),n=this.pos+t[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(e)return!1;if(123===r)return!0;if(WK(r,!0)){for(var i=n+1;YK(this.input.charCodeAt(i),!0);)++i;var o=this.input.slice(n,i);if(!FK.test(o))return!0}return!1},SQ.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;iQ.lastIndex=this.pos;var e=iQ.exec(this.input),t=this.pos+e[0].length;return!(eQ.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!==this.input.length&&YK(this.input.charAt(t+8)))},SQ.parseStatement=function(e,t,n){var r,i=this.type,o=this.startNode();switch(this.isLet(e)&&(i=JK._var,r="let"),i){case JK._break:case JK._continue:return this.parseBreakContinueStatement(o,i.keyword);case JK._debugger:return this.parseDebuggerStatement(o);case JK._do:return this.parseDoStatement(o);case JK._for:return this.parseForStatement(o);case JK._function:return e&&(this.strict||"if"!==e&&"label"!==e)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1,!e);case JK._class:return e&&this.unexpected(),this.parseClass(o,!0);case JK._if:return this.parseIfStatement(o);case JK._return:return this.parseReturnStatement(o);case JK._switch:return this.parseSwitchStatement(o);case JK._throw:return this.parseThrowStatement(o);case JK._try:return this.parseTryStatement(o);case JK._const:case JK._var:return r=r||this.value,e&&"var"!==r&&this.unexpected(),this.parseVarStatement(o,r);case JK._while:return this.parseWhileStatement(o);case JK._with:return this.parseWithStatement(o);case JK.braceL:return this.parseBlock(!0,o);case JK.semi:return this.parseEmptyStatement(o);case JK._export:case JK._import:if(this.options.ecmaVersion>10&&i===JK._import){iQ.lastIndex=this.pos;var a=iQ.exec(this.input),s=this.pos+a[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(o,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===JK._import?this.parseImport(o):this.parseExport(o,n);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(o,!0,!e);var l=this.value,c=this.parseExpression();return i===JK.name&&"Identifier"===c.type&&this.eat(JK.colon)?this.parseLabeledStatement(o,l,c,e):this.parseExpressionStatement(o,c)}},SQ.parseBreakContinueStatement=function(e,t){var n="break"===t;this.next(),this.eat(JK.semi)||this.insertSemicolon()?e.label=null:this.type!==JK.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(e.label&&n)break}}return r===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,n?"BreakStatement":"ContinueStatement")},SQ.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},SQ.parseDoStatement=function(e){return this.next(),this.labels.push(EQ),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(JK._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(JK.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},SQ.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(EQ),this.enterScope(0),this.expect(JK.parenL),this.type===JK.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var n=this.isLet();if(this.type===JK._var||this.type===JK._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===JK._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===JK._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,r)):(t>-1&&this.unexpected(t),this.parseFor(e,r))}var o=new xQ,a=this.parseExpression(!0,o);return this.type===JK._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===JK._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(a,!1,o),this.checkLVal(a),this.parseForIn(e,a)):(this.checkExpressionErrors(o,!0),t>-1&&this.unexpected(t),this.parseFor(e,a))},SQ.parseFunctionStatement=function(e,t,n){return this.next(),this.parseFunction(e,TQ|(n?0:wQ),!1,t)},SQ.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(JK._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},SQ.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(JK.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},SQ.parseSwitchStatement=function(e){var t;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(JK.braceL),this.labels.push(AQ),this.enterScope(0);for(var n=!1;this.type!==JK.braceR;)if(this.type===JK._case||this.type===JK._default){var r=this.type===JK._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),r?t.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,t.test=null),this.expect(JK.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},SQ.parseThrowStatement=function(e){return this.next(),eQ.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var CQ=[];SQ.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===JK._catch){var t=this.startNode();if(this.next(),this.eat(JK.parenL)){t.param=this.parseBindingAtom();var n="Identifier"===t.param.type;this.enterScope(n?32:0),this.checkLVal(t.param,n?4:2),this.expect(JK.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0);t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(JK._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},SQ.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},SQ.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(EQ),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},SQ.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},SQ.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},SQ.parseLabeledStatement=function(e,t,n,r){for(var i=0,o=this.labels;i<o.length;i+=1){o[i].name===t&&this.raise(n.start,"Label '"+t+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===JK._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var u=this.labels[s];if(u.statementStart!==e.start)break;u.statementStart=this.start,u.kind=a}return this.labels.push({name:t,kind:a,statementStart:this.start}),e.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")},SQ.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},SQ.parseBlock=function(e,t,n){for(void 0===e&&(e=!0),void 0===t&&(t=this.startNode()),t.body=[],this.expect(JK.braceL),e&&this.enterScope(0);this.type!==JK.braceR;){var r=this.parseStatement(null);t.body.push(r)}return n&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")},SQ.parseFor=function(e,t){return e.init=t,this.expect(JK.semi),e.test=this.type===JK.semi?null:this.parseExpression(),this.expect(JK.semi),e.update=this.type===JK.parenR?null:this.parseExpression(),this.expect(JK.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},SQ.parseForIn=function(e,t){var n=this.type===JK._in;return this.next(),"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==t.kind||"Identifier"!==t.declarations[0].id.type)?this.raise(t.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===t.type&&this.raise(t.start,"Invalid left-hand side in for-loop"),e.left=t,e.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(JK.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,n?"ForInStatement":"ForOfStatement")},SQ.parseVar=function(e,t,n){for(e.declarations=[],e.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(JK.eq)?r.init=this.parseMaybeAssign(t):"const"!==n||this.type===JK._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||t&&(this.type===JK._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),e.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(JK.comma))break}return e},SQ.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLVal(e.id,"var"===t?1:2,!1)};var TQ=1,wQ=2;SQ.parseFunction=function(e,t,n,r){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===JK.star&&t&wQ&&this.unexpected(),e.generator=this.eat(JK.star)),this.options.ecmaVersion>=8&&(e.async=!!r),t&TQ&&(e.id=4&t&&this.type!==JK.name?null:this.parseIdent(),!e.id||t&wQ||this.checkLVal(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?1:2:3));var i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(gQ(e.async,e.generator)),t&TQ||(e.id=this.type===JK.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n,!1),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(e,t&TQ?"FunctionDeclaration":"FunctionExpression")},SQ.parseFunctionParams=function(e){this.expect(JK.parenL),e.params=this.parseBindingList(JK.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},SQ.parseClass=function(e,t){this.next();var n=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),i=!1;for(r.body=[],this.expect(JK.braceL);this.type!==JK.braceR;){var o=this.parseClassElement(null!==e.superClass);o&&(r.body.push(o),"MethodDefinition"===o.type&&"constructor"===o.kind&&(i&&this.raise(o.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},SQ.parseClassElement=function(e){var t=this;if(this.eat(JK.semi))return null;var n=this.startNode(),r=function(e,r){void 0===r&&(r=!1);var i=t.start,o=t.startLoc;return!!t.eatContextual(e)&&(!(t.type===JK.parenL||r&&t.canInsertSemicolon())||(n.key&&t.unexpected(),n.computed=!1,n.key=t.startNodeAt(i,o),n.key.name=e,t.finishNode(n.key,"Identifier"),!1))};n.kind="method",n.static=r("static");var i=this.eat(JK.star),o=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(o=!0,i=this.options.ecmaVersion>=9&&this.eat(JK.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key,s=!1;return n.computed||n.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),o&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor",s=e),this.parseClassMethod(n,i,o,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},SQ.parseClassMethod=function(e,t,n,r){return e.value=this.parseMethod(t,n,r),this.finishNode(e,"MethodDefinition")},SQ.parseClassId=function(e,t){this.type===JK.name?(e.id=this.parseIdent(),t&&this.checkLVal(e.id,2,!1)):(!0===t&&this.unexpected(),e.id=null)},SQ.parseClassSuper=function(e){e.superClass=this.eat(JK._extends)?this.parseExprSubscripts():null},SQ.parseExport=function(e,t){if(this.next(),this.eat(JK.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==JK.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(JK._default)){var n;if(this.checkExport(t,"default",this.lastTokStart),this.type===JK._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(r,4|TQ,!1,n)}else if(this.type===JK._class){var i=this.startNode();e.declaration=this.parseClass(i,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==JK.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var o=0,a=e.specifiers;o<a.length;o+=1){var s=a[o];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},SQ.checkExport=function(e,t,n){e&&(uQ(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)},SQ.checkPatternExport=function(e,t){var n=t.type;if("Identifier"===n)this.checkExport(e,t.name,t.start);else if("ObjectPattern"===n)for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.checkPatternExport(e,o)}else if("ArrayPattern"===n)for(var a=0,s=t.elements;a<s.length;a+=1){var u=s[a];u&&this.checkPatternExport(e,u)}else"Property"===n?this.checkPatternExport(e,t.value):"AssignmentPattern"===n?this.checkPatternExport(e,t.left):"RestElement"===n?this.checkPatternExport(e,t.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(e,t.expression)},SQ.checkVariableExport=function(e,t){if(e)for(var n=0,r=t;n<r.length;n+=1){var i=r[n];this.checkPatternExport(e,i.id)}},SQ.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},SQ.parseExportSpecifiers=function(e){var t=[],n=!0;for(this.expect(JK.braceL);!this.eat(JK.braceR);){if(n)n=!1;else if(this.expect(JK.comma),this.afterTrailingComma(JK.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(e,r.exported.name,r.exported.start),t.push(this.finishNode(r,"ExportSpecifier"))}return t},SQ.parseImport=function(e){return this.next(),this.type===JK.string?(e.specifiers=CQ,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===JK.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},SQ.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===JK.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,2),e.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(JK.comma))return e}if(this.type===JK.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,2),e.push(this.finishNode(r,"ImportNamespaceSpecifier")),e}for(this.expect(JK.braceL);!this.eat(JK.braceR);){if(t)t=!1;else if(this.expect(JK.comma),this.afterTrailingComma(JK.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,2),e.push(this.finishNode(i,"ImportSpecifier"))}return e},SQ.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},SQ.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var MQ=mQ.prototype;MQ.toAssignable=function(e,t,n){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.toAssignable(o,t),"RestElement"!==o.type||"ArrayPattern"!==o.argument.type&&"ObjectPattern"!==o.argument.type||this.raise(o.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,n);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return e},MQ.toAssignableList=function(e,t){for(var n=e.length,r=0;r<n;r++){var i=e[r];i&&this.toAssignable(i,t)}if(n){var o=e[n-1];6===this.options.ecmaVersion&&t&&o&&"RestElement"===o.type&&"Identifier"!==o.argument.type&&this.unexpected(o.argument.start)}return e},MQ.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},MQ.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==JK.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},MQ.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case JK.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(JK.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case JK.braceL:return this.parseObj(!0)}return this.parseIdent()},MQ.parseBindingList=function(e,t,n){for(var r=[],i=!0;!this.eat(e);)if(i?i=!1:this.expect(JK.comma),t&&this.type===JK.comma)r.push(null);else{if(n&&this.afterTrailingComma(e))break;if(this.type===JK.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),r.push(o),this.type===JK.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),r.push(a)}return r},MQ.parseBindingListItem=function(e){return e},MQ.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(JK.eq))return n;var r=this.startNodeAt(e,t);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},MQ.checkLVal=function(e,t,n){switch(void 0===t&&(t=0),e.type){case"Identifier":2===t&&"let"===e.name&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(uQ(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),0!==t&&5!==t&&this.declareName(e.name,t,e.start);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":t&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.checkLVal(o,t,n)}break;case"Property":this.checkLVal(e.value,t,n);break;case"ArrayPattern":for(var a=0,s=e.elements;a<s.length;a+=1){var u=s[a];u&&this.checkLVal(u,t,n)}break;case"AssignmentPattern":this.checkLVal(e.left,t,n);break;case"RestElement":this.checkLVal(e.argument,t,n);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,n);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var kQ=mQ.prototype;kQ.checkPropClash=function(e,t,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type||this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,i=e.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var o=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===o&&(t.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0);else{var a=t[r="$"+r];if(a)("init"===o?this.strict&&a.init||a.get||a.set:a.init||a[o])&&this.raiseRecoverable(i.start,"Redefinition of property");else a=t[r]={init:!1,get:!1,set:!1};a[o]=!0}}},kQ.parseExpression=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===JK.comma){var o=this.startNodeAt(n,r);for(o.expressions=[i];this.eat(JK.comma);)o.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(o,"SequenceExpression")}return i},kQ.parseMaybeAssign=function(e,t,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var r=!1,i=-1,o=-1;t?(i=t.parenthesizedAssign,o=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new xQ,r=!0);var a=this.start,s=this.startLoc;this.type!==JK.parenL&&this.type!==JK.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(e,t);if(n&&(u=n.call(this,u,a,s)),this.type.isAssign){var l=this.startNodeAt(a,s);return l.operator=this.value,l.left=this.type===JK.eq?this.toAssignable(u,!1,t):u,r||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=l.left.start&&(t.shorthandAssign=-1),this.checkLVal(u),this.next(),l.right=this.parseMaybeAssign(e),this.finishNode(l,"AssignmentExpression")}return r&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),o>-1&&(t.trailingComma=o),u},kQ.parseMaybeConditional=function(e,t){var n=this.start,r=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(JK.question)){var o=this.startNodeAt(n,r);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(JK.colon),o.alternate=this.parseMaybeAssign(e),this.finishNode(o,"ConditionalExpression")}return i},kQ.parseExprOps=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,e)},kQ.parseExprOp=function(e,t,n,r,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==JK._in)&&o>r){var a=this.type===JK.logicalOR||this.type===JK.logicalAND,s=this.type===JK.coalesce;s&&(o=JK.logicalAND.binop);var u=this.value;this.next();var l=this.start,c=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1),l,c,o,i),f=this.buildBinary(t,n,e,h,u,a||s);return(a&&this.type===JK.coalesce||s&&(this.type===JK.logicalOR||this.type===JK.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(f,t,n,r,i)}return e},kQ.buildBinary=function(e,t,n,r,i,o){var a=this.startNodeAt(e,t);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},kQ.parseMaybeUnary=function(e,t){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),t=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===JK.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),a?this.checkLVal(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):t=!0,n=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!t&&this.eat(JK.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},kQ.parseExprSubscripts=function(e){var t=this.start,n=this.startLoc,r=this.parseExprAtom(e);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,t,n);return e&&"MemberExpression"===i.type&&(e.parenthesizedAssign>=i.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=i.start&&(e.parenthesizedBind=-1)),i},kQ.parseSubscripts=function(e,t,n,r){for(var i=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start==5&&this.potentialArrowAt===e.start,o=!1;;){var a=this.parseSubscript(e,t,n,r,i,o);if(a.optional&&(o=!0),a===e||"ArrowFunctionExpression"===a.type){if(o){var s=this.startNodeAt(t,n);s.expression=a,a=this.finishNode(s,"ChainExpression")}return a}e=a}},kQ.parseSubscript=function(e,t,n,r,i,o){var a=this.options.ecmaVersion>=11,s=a&&this.eat(JK.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(JK.bracketL);if(u||s&&this.type!==JK.parenL&&this.type!==JK.backQuote||this.eat(JK.dot)){var l=this.startNodeAt(t,n);l.object=e,l.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),l.computed=!!u,u&&this.expect(JK.bracketR),a&&(l.optional=s),e=this.finishNode(l,"MemberExpression")}else if(!r&&this.eat(JK.parenL)){var c=new xQ,h=this.yieldPos,f=this.awaitPos,p=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(JK.parenR,this.options.ecmaVersion>=8,!1,c);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(JK.arrow))return this.checkPatternErrors(c,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=h,this.awaitPos=f,this.awaitIdentPos=p,this.parseArrowExpression(this.startNodeAt(t,n),d,!0);this.checkExpressionErrors(c,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=f||this.awaitPos,this.awaitIdentPos=p||this.awaitIdentPos;var v=this.startNodeAt(t,n);v.callee=e,v.arguments=d,a&&(v.optional=s),e=this.finishNode(v,"CallExpression")}else if(this.type===JK.backQuote){(s||o)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var g=this.startNodeAt(t,n);g.tag=e,g.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(g,"TaggedTemplateExpression")}return e},kQ.parseExprAtom=function(e){this.type===JK.slash&&this.readRegexp();var t,n=this.potentialArrowAt===this.start;switch(this.type){case JK._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type!==JK.parenL||this.allowDirectSuper||this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==JK.dot&&this.type!==JK.bracketL&&this.type!==JK.parenL&&this.unexpected(),this.finishNode(t,"Super");case JK._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case JK.name:var r=this.start,i=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(JK._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(JK.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===JK.name&&!o)return a=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(JK.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case JK.regexp:var s=this.value;return(t=this.parseLiteral(s.value)).regex={pattern:s.pattern,flags:s.flags},t;case JK.num:case JK.string:return this.parseLiteral(this.value);case JK._null:case JK._true:case JK._false:return(t=this.startNode()).value=this.type===JK._null?null:this.type===JK._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case JK.parenL:var u=this.start,l=this.parseParenAndDistinguishExpression(n);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(l)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),l;case JK.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(JK.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case JK.braceL:return this.parseObj(!1,e);case JK._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case JK._class:return this.parseClass(this.startNode(),!1);case JK._new:return this.parseNew();case JK.backQuote:return this.parseTemplate();case JK._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},kQ.parseExprImport=function(){var e=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var t=this.parseIdent(!0);switch(this.type){case JK.parenL:return this.parseDynamicImport(e);case JK.dot:return e.meta=t,this.parseImportMeta(e);default:this.unexpected()}},kQ.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(JK.parenR)){var t=this.start;this.eat(JK.comma)&&this.eat(JK.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},kQ.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),"meta"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")},kQ.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),110===t.raw.charCodeAt(t.raw.length-1)&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")},kQ.parseParenExpression=function(){this.expect(JK.parenL);var e=this.parseExpression();return this.expect(JK.parenR),e},kQ.parseParenAndDistinguishExpression=function(e){var t,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o,a=this.start,s=this.startLoc,u=[],l=!0,c=!1,h=new xQ,f=this.yieldPos,p=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==JK.parenR;){if(l?l=!1:this.expect(JK.comma),i&&this.afterTrailingComma(JK.parenR,!0)){c=!0;break}if(this.type===JK.ellipsis){o=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===JK.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var d=this.start,v=this.startLoc;if(this.expect(JK.parenR),e&&!this.canInsertSemicolon()&&this.eat(JK.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=p,this.parseParenArrowList(n,r,u);u.length&&!c||this.unexpected(this.lastTokStart),o&&this.unexpected(o),this.checkExpressionErrors(h,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,u.length>1?((t=this.startNodeAt(a,s)).expressions=u,this.finishNodeAt(t,"SequenceExpression",d,v)):t=u[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(n,r);return g.expression=t,this.finishNode(g,"ParenthesizedExpression")}return t},kQ.parseParenItem=function(e){return e},kQ.parseParenArrowList=function(e,t,n){return this.parseArrowExpression(this.startNodeAt(e,t),n)};var OQ=[];kQ.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(JK.dot)){e.meta=t;var n=this.containsEsc;return e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(e.start,"'new.target' can only be used in functions"),this.finishNode(e,"MetaProperty")}var r=this.start,i=this.startLoc,o=this.type===JK._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),o&&"ImportExpression"===e.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(JK.parenL)?e.arguments=this.parseExprList(JK.parenR,this.options.ecmaVersion>=8,!1):e.arguments=OQ,this.finishNode(e,"NewExpression")},kQ.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===JK.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===JK.backQuote,this.finishNode(n,"TemplateElement")},kQ.parseTemplate=function(e){void 0===e&&(e={});var t=e.isTagged;void 0===t&&(t=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:t});for(n.quasis=[r];!r.tail;)this.type===JK.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(JK.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(JK.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(n,"TemplateLiteral")},kQ.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===JK.name||this.type===JK.num||this.type===JK.string||this.type===JK.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===JK.star)&&!eQ.test(this.input.slice(this.lastTokEnd,this.start))},kQ.parseObj=function(e,t){var n=this.startNode(),r=!0,i={};for(n.properties=[],this.next();!this.eat(JK.braceR);){if(r)r=!1;else if(this.expect(JK.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(JK.braceR))break;var o=this.parseProperty(e,t);e||this.checkPropClash(o,i,t),n.properties.push(o)}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")},kQ.parseProperty=function(e,t){var n,r,i,o,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(JK.ellipsis))return e?(a.argument=this.parseIdent(!1),this.type===JK.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===JK.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,t),this.type===JK.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(e||t)&&(i=this.start,o=this.startLoc),e||(n=this.eat(JK.star)));var s=this.containsEsc;return this.parsePropertyName(a),!e&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(JK.star),this.parsePropertyName(a,t)):r=!1,this.parsePropertyValue(a,e,n,r,i,o,t,s),this.finishNode(a,"Property")},kQ.parsePropertyValue=function(e,t,n,r,i,o,a,s){if((n||r)&&this.type===JK.colon&&this.unexpected(),this.eat(JK.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===JK.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,r);else if(t||s||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type===JK.comma||this.type===JK.braceR||this.type===JK.eq)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(e.key),"await"!==e.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),e.kind="init",t?e.value=this.parseMaybeDefault(i,o,e.key):this.type===JK.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,o,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var u="get"===e.kind?0:1;if(e.value.params.length!==u){var l=e.value.start;"get"===e.kind?this.raiseRecoverable(l,"getter should have no params"):this.raiseRecoverable(l,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},kQ.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(JK.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(JK.bracketR),e.key;e.computed=!1}return e.key=this.type===JK.num||this.type===JK.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},kQ.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},kQ.parseMethod=function(e,t,n){var r=this.startNode(),i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|gQ(t,r.generator)|(n?128:0)),this.expect(JK.parenL),r.params=this.parseBindingList(JK.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(r,"FunctionExpression")},kQ.parseArrowExpression=function(e,t,n){var r=this.yieldPos,i=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(16|gQ(n,!1)),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=o,this.finishNode(e,"ArrowFunctionExpression")},kQ.parseFunctionBody=function(e,t,n){var r=t&&this.type!==JK.braceL,i=this.strict,o=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);i&&!a||(o=this.strictDirective(this.end))&&a&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var s=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(e,!i&&!o&&!t&&!n&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLVal(e.id,5),e.body=this.parseBlock(!1,void 0,o&&!i),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=s}this.exitScope()},kQ.isSimpleParamList=function(e){for(var t=0,n=e;t<n.length;t+=1){if("Identifier"!==n[t].type)return!1}return!0},kQ.checkParams=function(e,t){for(var n={},r=0,i=e.params;r<i.length;r+=1){var o=i[r];this.checkLVal(o,1,t?null:n)}},kQ.parseExprList=function(e,t,n,r){for(var i=[],o=!0;!this.eat(e);){if(o)o=!1;else if(this.expect(JK.comma),t&&this.afterTrailingComma(e))break;var a=void 0;n&&this.type===JK.comma?a=null:this.type===JK.ellipsis?(a=this.parseSpread(r),r&&this.type===JK.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):a=this.parseMaybeAssign(!1,r),i.push(a)}return i},kQ.checkUnreserved=function(e){var t=e.start,n=e.end,r=e.name;(this.inGenerator&&"yield"===r&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(t,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(t,n).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+r+"' is reserved"))},kQ.parseIdent=function(e,t){var n=this.startNode();return this.type===JK.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(n,"Identifier"),e||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},kQ.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===JK.semi||this.canInsertSemicolon()||this.type!==JK.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(JK.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},kQ.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!1),this.finishNode(e,"AwaitExpression")};var PQ=mQ.prototype;PQ.raise=function(e,t){var n=pQ(this.input,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=this.pos,r},PQ.raiseRecoverable=PQ.raise,PQ.curPosition=function(){if(this.options.locations)return new hQ(this.curLine,this.pos-this.lineStart)};var LQ=mQ.prototype,IQ=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};LQ.enterScope=function(e){this.scopeStack.push(new IQ(e))},LQ.exitScope=function(){this.scopeStack.pop()},LQ.treatFunctionsAsVarInScope=function(e){return 2&e.flags||!this.inModule&&1&e.flags},LQ.declareName=function(e,t,n){var r=!1;if(2===t){var i=this.currentScope();r=i.lexical.indexOf(e)>-1||i.functions.indexOf(e)>-1||i.var.indexOf(e)>-1,i.lexical.push(e),this.inModule&&1&i.flags&&delete this.undefinedExports[e]}else if(4===t){this.currentScope().lexical.push(e)}else if(3===t){var o=this.currentScope();r=this.treatFunctionsAsVar?o.lexical.indexOf(e)>-1:o.lexical.indexOf(e)>-1||o.var.indexOf(e)>-1,o.functions.push(e)}else for(var a=this.scopeStack.length-1;a>=0;--a){var s=this.scopeStack[a];if(s.lexical.indexOf(e)>-1&&!(32&s.flags&&s.lexical[0]===e)||!this.treatFunctionsAsVarInScope(s)&&s.functions.indexOf(e)>-1){r=!0;break}if(s.var.push(e),this.inModule&&1&s.flags&&delete this.undefinedExports[e],3&s.flags)break}r&&this.raiseRecoverable(n,"Identifier '"+e+"' has already been declared")},LQ.checkLocalExport=function(e){-1===this.scopeStack[0].lexical.indexOf(e.name)&&-1===this.scopeStack[0].var.indexOf(e.name)&&(this.undefinedExports[e.name]=e)},LQ.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},LQ.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags)return t}},LQ.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags&&!(16&t.flags))return t}};var RQ=function(e,t,n){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new fQ(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},NQ=mQ.prototype;function DQ(e,t,n,r){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=r),this.options.ranges&&(e.range[1]=n),e}NQ.startNode=function(){return new RQ(this,this.start,this.startLoc)},NQ.startNodeAt=function(e,t){return new RQ(this,e,t)},NQ.finishNode=function(e,t){return DQ.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},NQ.finishNodeAt=function(e,t,n,r){return DQ.call(this,e,t,n,r)};var FQ=function(e,t,n,r,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!n,this.override=r,this.generator=!!i},BQ={b_stat:new FQ("{",!1),b_expr:new FQ("{",!0),b_tmpl:new FQ("${",!1),p_stat:new FQ("(",!1),p_expr:new FQ("(",!0),q_tmpl:new FQ("`",!0,!0,(function(e){return e.tryReadTemplateToken()})),f_stat:new FQ("function",!1),f_expr:new FQ("function",!0),f_expr_gen:new FQ("function",!0,!1,null,!0),f_gen:new FQ("function",!1,!1,null,!0)},zQ=mQ.prototype;zQ.initialContext=function(){return[BQ.b_stat]},zQ.braceIsBlock=function(e){var t=this.curContext();return t===BQ.f_expr||t===BQ.f_stat||(e!==JK.colon||t!==BQ.b_stat&&t!==BQ.b_expr?e===JK._return||e===JK.name&&this.exprAllowed?eQ.test(this.input.slice(this.lastTokEnd,this.start)):e===JK._else||e===JK.semi||e===JK.eof||e===JK.parenR||e===JK.arrow||(e===JK.braceL?t===BQ.b_stat:e!==JK._var&&e!==JK._const&&e!==JK.name&&!this.exprAllowed):!t.isExpr)},zQ.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if("function"===t.token)return t.generator}return!1},zQ.updateContext=function(e){var t,n=this.type;n.keyword&&e===JK.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr},JK.parenR.updateContext=JK.braceR.updateContext=function(){if(1!==this.context.length){var e=this.context.pop();e===BQ.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},JK.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?BQ.b_stat:BQ.b_expr),this.exprAllowed=!0},JK.dollarBraceL.updateContext=function(){this.context.push(BQ.b_tmpl),this.exprAllowed=!0},JK.parenL.updateContext=function(e){var t=e===JK._if||e===JK._for||e===JK._with||e===JK._while;this.context.push(t?BQ.p_stat:BQ.p_expr),this.exprAllowed=!0},JK.incDec.updateContext=function(){},JK._function.updateContext=JK._class.updateContext=function(e){!e.beforeExpr||e===JK.semi||e===JK._else||e===JK._return&&eQ.test(this.input.slice(this.lastTokEnd,this.start))||(e===JK.colon||e===JK.braceL)&&this.curContext()===BQ.b_stat?this.context.push(BQ.f_stat):this.context.push(BQ.f_expr),this.exprAllowed=!1},JK.backQuote.updateContext=function(){this.curContext()===BQ.q_tmpl?this.context.pop():this.context.push(BQ.q_tmpl),this.exprAllowed=!1},JK.star.updateContext=function(e){if(e===JK._function){var t=this.context.length-1;this.context[t]===BQ.f_expr?this.context[t]=BQ.f_expr_gen:this.context[t]=BQ.f_gen}this.exprAllowed=!0},JK.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==JK.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var jQ="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",UQ=jQ+" Extended_Pictographic",VQ={9:jQ,10:UQ,11:"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS Extended_Pictographic"},HQ="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",GQ="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",WQ=GQ+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",YQ={9:GQ,10:WQ,11:"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},XQ={};function ZQ(e){var t=XQ[e]={binary:cQ(VQ[e]+" "+HQ),nonBinary:{General_Category:cQ(HQ),Script:cQ(YQ[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}ZQ(9),ZQ(10),ZQ(11);var qQ=mQ.prototype,KQ=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":""),this.unicodeProperties=XQ[e.options.ecmaVersion>=11?11:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function QQ(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function $Q(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function JQ(e){return e>=65&&e<=90||e>=97&&e<=122}function e$(e){return JQ(e)||95===e}function t$(e){return e$(e)||n$(e)}function n$(e){return e>=48&&e<=57}function r$(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function i$(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function o$(e){return e>=48&&e<=55}KQ.prototype.reset=function(e,t,n){var r=-1!==n.indexOf("u");this.start=0|e,this.source=t+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},KQ.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},KQ.prototype.at=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return-1;var i=n.charCodeAt(e);if(!t&&!this.switchU||i<=55295||i>=57344||e+1>=r)return i;var o=n.charCodeAt(e+1);return o>=56320&&o<=57343?(i<<10)+o-56613888:i},KQ.prototype.nextIndex=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return r;var i,o=n.charCodeAt(e);return!t&&!this.switchU||o<=55295||o>=57344||e+1>=r||(i=n.charCodeAt(e+1))<56320||i>57343?e+1:e+2},KQ.prototype.current=function(e){return void 0===e&&(e=!1),this.at(this.pos,e)},KQ.prototype.lookahead=function(e){return void 0===e&&(e=!1),this.at(this.nextIndex(this.pos,e),e)},KQ.prototype.advance=function(e){void 0===e&&(e=!1),this.pos=this.nextIndex(this.pos,e)},KQ.prototype.eat=function(e,t){return void 0===t&&(t=!1),this.current(t)===e&&(this.advance(t),!0)},qQ.validateRegExpFlags=function(e){for(var t=e.validFlags,n=e.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===t.indexOf(i)&&this.raise(e.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}},qQ.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},qQ.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,n=e.backReferenceNames;t<n.length;t+=1){var r=n[t];-1===e.groupNames.indexOf(r)&&e.raise("Invalid named capture referenced")}},qQ.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},qQ.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},qQ.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!!(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},qQ.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!n,!0}return e.pos=t,!1},qQ.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},qQ.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},qQ.regexp_eatBracedQuantifier=function(e,t){var n=e.pos;if(e.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return-1!==i&&i<r&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=n}return!1},qQ.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},qQ.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},qQ.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},qQ.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},qQ.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},qQ.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},qQ.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!$Q(t)&&(e.lastIntValue=t,e.advance(),!0)},qQ.regexp_eatPatternCharacters=function(e){for(var t=e.pos,n=0;-1!==(n=e.current())&&!$Q(n);)e.advance();return e.pos!==t},qQ.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t)&&(e.advance(),!0)},qQ.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return-1!==e.groupNames.indexOf(e.lastStringValue)&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},qQ.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},qQ.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=QQ(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=QQ(e.lastIntValue);return!0}return!1},qQ.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),function(e){return WK(e,!0)||36===e||95===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},qQ.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),function(e){return YK(e,!0)||36===e||95===e||8204===e||8205===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},qQ.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},qQ.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var n=e.lastIntValue;if(e.switchU)return n>e.maxBackReference&&(e.maxBackReference=n),!0;if(n<=e.numCapturingParens)return!0;e.pos=t}return!1},qQ.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},qQ.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},qQ.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},qQ.regexp_eatZero=function(e){return 48===e.current()&&!n$(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},qQ.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},qQ.regexp_eatControlLetter=function(e){var t=e.current();return!!JQ(t)&&(e.lastIntValue=t%32,e.advance(),!0)},qQ.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){void 0===t&&(t=!1);var n,r=e.pos,i=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var o=e.lastIntValue;if(i&&o>=55296&&o<=56319){var a=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var s=e.lastIntValue;if(s>=56320&&s<=57343)return e.lastIntValue=1024*(o-55296)+(s-56320)+65536,!0}e.pos=a,e.lastIntValue=o}return!0}if(i&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&((n=e.lastIntValue)>=0&&n<=1114111))return!0;i&&e.raise("Invalid unicode escape"),e.pos=r}return!1},qQ.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t)&&(e.lastIntValue=t,e.advance(),!0)},qQ.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1},qQ.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(function(e){return 100===e||68===e||115===e||83===e||119===e||87===e}(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(80===t||112===t)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1},qQ.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var n=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var r=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,n,r),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1},qQ.regexp_validateUnicodePropertyNameAndValue=function(e,t,n){uQ(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(n)||e.raise("Invalid property value")},qQ.regexp_validateUnicodePropertyNameOrValue=function(e,t){e.unicodeProperties.binary.test(t)||e.raise("Invalid property name")},qQ.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";e$(t=e.current());)e.lastStringValue+=QQ(t),e.advance();return""!==e.lastStringValue},qQ.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";t$(t=e.current());)e.lastStringValue+=QQ(t),e.advance();return""!==e.lastStringValue},qQ.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},qQ.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},qQ.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var n=e.lastIntValue;!e.switchU||-1!==t&&-1!==n||e.raise("Invalid character class"),-1!==t&&-1!==n&&t>n&&e.raise("Range out of order in character class")}}},qQ.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var n=e.current();(99===n||o$(n))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var r=e.current();return 93!==r&&(e.lastIntValue=r,e.advance(),!0)},qQ.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},qQ.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!n$(t)&&95!==t)&&(e.lastIntValue=t%32,e.advance(),!0)},qQ.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},qQ.regexp_eatDecimalDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;n$(n=e.current());)e.lastIntValue=10*e.lastIntValue+(n-48),e.advance();return e.pos!==t},qQ.regexp_eatHexDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;r$(n=e.current());)e.lastIntValue=16*e.lastIntValue+i$(n),e.advance();return e.pos!==t},qQ.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var n=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*n+e.lastIntValue:e.lastIntValue=8*t+n}else e.lastIntValue=t;return!0}return!1},qQ.regexp_eatOctalDigit=function(e){var t=e.current();return o$(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},qQ.regexp_eatFixedHexDigits=function(e,t){var n=e.pos;e.lastIntValue=0;for(var r=0;r<t;++r){var i=e.current();if(!r$(i))return e.pos=n,!1;e.lastIntValue=16*e.lastIntValue+i$(i),e.advance()}return!0};var a$=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new fQ(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},s$=mQ.prototype;function u$(e){return"function"!=typeof BigInt?null:BigInt(e.replace(/_/g,""))}function l$(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}s$.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new a$(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},s$.getToken=function(){return this.next(),new a$(this)},"undefined"!=typeof Symbol&&(s$[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===JK.eof,value:t}}}}),s$.curContext=function(){return this.context[this.context.length-1]},s$.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(JK.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},s$.readToken=function(e){return WK(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},s$.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);return e<=55295||e>=57344?e:(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},s$.skipBlockComment=function(){var e,t=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(tQ.lastIndex=n;(e=tQ.exec(this.input))&&e.index<this.pos;)++this.curLine,this.lineStart=e.index+e[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,t,this.curPosition())},s$.skipLineComment=function(e){for(var t=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!nQ(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,n,this.curPosition())},s$.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&rQ.test(String.fromCharCode(e))))break e;++this.pos}}},s$.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)},s$.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(JK.ellipsis)):(++this.pos,this.finishToken(JK.dot))},s$.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(JK.assign,2):this.finishOp(JK.slash,1)},s$.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,r=42===e?JK.star:JK.modulo;return this.options.ecmaVersion>=7&&42===e&&42===t&&(++n,r=JK.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(JK.assign,n+1):this.finishOp(r,n)},s$.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(JK.assign,3);return this.finishOp(124===e?JK.logicalOR:JK.logicalAND,2)}return 61===t?this.finishOp(JK.assign,2):this.finishOp(124===e?JK.bitwiseOR:JK.bitwiseAND,1)},s$.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(JK.assign,2):this.finishOp(JK.bitwiseXOR,1)},s$.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!==t||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!eQ.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(JK.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(JK.assign,2):this.finishOp(JK.plusMin,1)},s$.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(JK.assign,n+1):this.finishOp(JK.bitShift,n)):33!==t||60!==e||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===t&&(n=2),this.finishOp(JK.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},s$.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(JK.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(JK.arrow)):this.finishOp(61===e?JK.eq:JK.prefix,1)},s$.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(46===t){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(JK.questionDot,2)}if(63===t){if(e>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(JK.assign,3);return this.finishOp(JK.coalesce,2)}}return this.finishOp(JK.question,1)},s$.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(JK.parenL);case 41:return++this.pos,this.finishToken(JK.parenR);case 59:return++this.pos,this.finishToken(JK.semi);case 44:return++this.pos,this.finishToken(JK.comma);case 91:return++this.pos,this.finishToken(JK.bracketL);case 93:return++this.pos,this.finishToken(JK.bracketR);case 123:return++this.pos,this.finishToken(JK.braceL);case 125:return++this.pos,this.finishToken(JK.braceR);case 58:return++this.pos,this.finishToken(JK.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(JK.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(JK.prefix,1)}this.raise(this.pos,"Unexpected character '"+l$(e)+"'")},s$.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)},s$.readRegexp=function(){for(var e,t,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(eQ.test(r)&&this.raise(n,"Unterminated regular expression"),e)e=!1;else{if("["===r)t=!0;else if("]"===r&&t)t=!1;else if("/"===r&&!t)break;e="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var o=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(o);var s=this.regexpState||(this.regexpState=new KQ(this));s.reset(n,i,a),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,a)}catch(e){}return this.finishToken(JK.regexp,{pattern:i,flags:a,value:u})},s$.readInt=function(e,t,n){for(var r=this.options.ecmaVersion>=12&&void 0===t,i=n&&48===this.input.charCodeAt(this.pos),o=this.pos,a=0,s=0,u=0,l=null==t?1/0:t;u<l;++u,++this.pos){var c=this.input.charCodeAt(this.pos),h=void 0;if(r&&95===c)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=c;else{if((h=c>=97?c-97+10:c>=65?c-65+10:c>=48&&c<=57?c-48:1/0)>=e)break;s=c,a=a*e+h}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===o||null!=t&&this.pos-o!==t?null:a},s$.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var n=this.readInt(e);return null==n&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=u$(this.input.slice(t,this.pos)),++this.pos):WK(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(JK.num,n)},s$.readNumber=function(e){var t=this.pos;e||null!==this.readInt(10,void 0,!0)||this.raise(t,"Invalid number");var n=this.pos-t>=2&&48===this.input.charCodeAt(t);n&&this.strict&&this.raise(t,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!e&&this.options.ecmaVersion>=11&&110===r){var i=u$(this.input.slice(t,this.pos));return++this.pos,WK(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(JK.num,i)}n&&/[89]/.test(this.input.slice(t,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),WK(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var o=function(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}(this.input.slice(t,this.pos),n);return this.finishToken(JK.num,o)},s$.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},s$.readString=function(e){for(var t="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===e)break;92===r?(t+=this.input.slice(n,this.pos),t+=this.readEscapedChar(!1),n=this.pos):(nQ(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(n,this.pos++),this.finishToken(JK.string,t)};var c$={};s$.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==c$)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},s$.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw c$;this.raise(e,t)},s$.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==JK.template&&this.type!==JK.invalidTemplate?(e+=this.input.slice(t,this.pos),this.finishToken(JK.template,e)):36===n?(this.pos+=2,this.finishToken(JK.dollarBraceL)):(++this.pos,this.finishToken(JK.backQuote));if(92===n)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(nQ(n)){switch(e+=this.input.slice(t,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(n)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},s$.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(JK.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},s$.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return l$(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(e){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,t=this.input.charCodeAt(this.pos),"0"===r&&56!==t&&57!==t||!this.strict&&!e||this.invalidStringToken(this.pos-1-r.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return nQ(t)?"":String.fromCharCode(t)}},s$.readHexChar=function(e){var t=this.pos,n=this.readInt(16,e);return null===n&&this.invalidStringToken(t,"Bad character escape sequence"),n},s$.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,n=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(YK(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,e+=this.input.slice(n,this.pos);var o=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(t?WK:YK)(a,r)||this.invalidStringToken(o,"Invalid Unicode escape"),e+=l$(a),n=this.pos}t=!1}return e+this.input.slice(n,this.pos)},s$.readWord=function(){var e=this.readWord1(),t=JK.name;return this.keywords.test(e)&&(t=QK[e]),this.finishToken(t,e)};function h$(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function f$(e){var t="function"==typeof Map?new Map:void 0;return(f$=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return d$(e,arguments,g$(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v$(r,e)})(e)}function p$(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function d$(e,t,n){return(d$=p$()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&v$(i,n.prototype),i}).apply(null,arguments)}function v$(e,t){return(v$=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g$(e){return(g$=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}mQ.acorn={Parser:mQ,version:"7.4.1",defaultOptions:dQ,Position:hQ,SourceLocation:fQ,getLineInfo:pQ,Node:RQ,TokenType:XK,tokTypes:JK,keywordTypes:QK,TokContext:FQ,tokContexts:BQ,isIdentifierChar:YK,isIdentifierStart:WK,Token:a$,isNewLine:nQ,lineBreak:eQ,lineBreakG:tQ,nonASCIIwhitespace:rQ};var m$=function(e){function t(){return e.apply(this,arguments)||this}return h$(t,e),t}(f$(Error)),y$=function(e){function t(){return e.apply(this,arguments)||this}return h$(t,e),t}(f$(SyntaxError)),_$=function(e){function t(){return e.apply(this,arguments)||this}return h$(t,e),t}(f$(ReferenceError)),b$=function(e){function t(){return e.apply(this,arguments)||this}return h$(t,e),t}(f$(TypeError)),x$=function(e){function t(){return e.apply(this,arguments)||this}return h$(t,e),t}(m$),S$=function(e){function t(){return e.apply(this,arguments)||this}return h$(t,e),t}(y$),E$=function(e){function t(){return e.apply(this,arguments)||this}return h$(t,e),t}(_$),A$={UnknownError:[3001,"%0",x$],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",x$],NodeTypeSyntaxError:[1001,"Unknown node type: %0",E$],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",E$],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",E$],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",E$],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",E$],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",E$],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",E$],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",E$],ParamTypeSyntaxError:[1009,"Unknown param type: %0",E$],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",E$],FunctionUndefinedReferenceError:[2001,"%0 is not a function",_$],VariableUndefinedReferenceError:[2002,"%0 is not defined",_$],IsNotConstructor:[2003,"%0 is not a constructor",b$]};function C$(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function T$(e,t,n){return(T$=C$()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&w$(i,n.prototype),i}).apply(null,arguments)}function w$(e,t){return(w$=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M$(e,t){Object.defineProperty(e,"name",{value:t,writable:!1,enumerable:!1,configurable:!0})}var k$=Object.prototype.hasOwnProperty,O$=Symbol("Break"),P$=Symbol("Continue"),L$=Symbol("DefaultCase"),I$=Symbol("EmptyStatementReturn"),R$=Symbol("WithScopeName"),N$=Symbol("SuperScopeName"),D$=Symbol("RootScopeName"),F$=Symbol("GlobalScopeName");function B$(e){return"function"==typeof e}var z$=function(){function e(e){this.interpreter=e}return e.prototype.generator=function(){var e=this.interpreter;return{getOptions:e.getOptions.bind(e),getCurrentScope:function(){return this.getCurrentScope()}.bind(e),getGlobalScope:function(){return this.getGlobalScope()}.bind(e),getCurrentContext:function(){return this.getCurrentContext()}.bind(e),getExecStartTime:e.getExecStartTime.bind(e)}},e}();function j$(e,t,n){if(void 0===n&&(n=!0),!(e instanceof z$))throw new Error("Illegal call");if("string"!=typeof t)return t;if(t){var r=e.generator(),i={timeout:r.getOptions().timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},o=n?r.getGlobalScope():r.getCurrentScope();return new q$(o,i).evaluate(t)}}function U$(e){if(!(e instanceof z$))throw new Error("Illegal call");for(var t=e.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r.pop(),a=new q$(t.getGlobalScope(),t.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+o+"\n\t\t    });\n\t\t    ";return a.evaluate(s)}Object.defineProperty(j$,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(U$,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var V$=function(e){this.value=e},H$=function(e){this.value=e},G$=function(e){this.value=e},W$=function(e,t,n){void 0===t&&(t=null),this.name=n,this.parent=t,this.data=e,this.labelStack=[]};function Y$(){}function X$(e,t){return void 0===e&&(e=null),new W$(Object.create(null),e,t)}var Z$={NaN:NaN,Infinity:1/0,undefined:void 0,Object:Object,Array:Array,String:String,Boolean:Boolean,Number:Number,Date:Date,RegExp:RegExp,Error:Error,URIError:URIError,TypeError:TypeError,RangeError:RangeError,SyntaxError:SyntaxError,ReferenceError:ReferenceError,Float32Array:Float32Array,Float64Array:Float64Array,Uint32Array:Uint32Array,Math:Math,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,decodeURI:decodeURI,decodeURIComponent:decodeURIComponent,encodeURI:encodeURI,encodeURIComponent:encodeURIComponent,escape:escape,unescape:unescape,eval:j$,Function:U$};"undefined"!=typeof JSON&&(Z$.JSON=JSON),"undefined"!=typeof Promise&&(Z$.Promise=Promise),"undefined"!=typeof Set&&(Z$.Set=Set),"undefined"!=typeof Map&&(Z$.Map=Map),"undefined"!=typeof Symbol&&(Z$.Symbol=Symbol),"undefined"!=typeof Proxy&&(Z$.Proxy=Proxy),"undefined"!=typeof WeakMap&&(Z$.WeakMap=WeakMap),"undefined"!=typeof WeakSet&&(Z$.WeakSet=WeakSet),"undefined"!=typeof Reflect&&(Z$.Reflect=Reflect);var q$=function(){function e(t,n){void 0===t&&(t=e.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||e.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?e.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=t||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var t=e.prototype;return t.initEnvironment=function(e){var t;if(e instanceof W$)t=e;else{var n=null,r=this.createSuperScope(e);this.options.rootContext&&(n=new W$(function(e){return Object.create(e)}(this.options.rootContext),r,D$)),t=new W$(e,n||r,F$)}this.globalScope=t,this.currentScope=this.globalScope,this.globalContext=t.data,this.currentContext=t.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},t.getExecStartTime=function(){return this.execStartTime},t.getExecutionTime=function(){return this.execEndTime-this.execStartTime},t.setExecTimeout=function(e){void 0===e&&(e=0),this.options.timeout=e},t.getOptions=function(){return this.options},t.getGlobalScope=function(){return this.globalScope},t.getCurrentScope=function(){return this.currentScope},t.getCurrentContext=function(){return this.currentContext},t.isInterruptThrow=function(e){return e instanceof x$||e instanceof E$||e instanceof S$},t.createSuperScope=function(e){var t=Object.assign({},Z$);return Object.keys(t).forEach((function(n){n in e&&delete t[n]})),new W$(t,null,N$)},t.setCurrentContext=function(e){this.currentContext=e},t.setCurrentScope=function(e){this.currentScope=e},t.evaluate=function(t){var n;if(void 0===t&&(t=""),t)return n=function(e,t){return mQ.parse(e,t)}(t,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||e.ecmaVersion}),this.evaluateNode(n,t)},t.appendCode=function(e){return this.evaluate(e)},t.evaluateNode=function(e,t){var n=this;void 0===t&&(t=""),this.value=void 0,this.source=t,this.sourceList.push(t),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),o=r.labelStack.concat([]),a=this.callStack.concat([]);try{var s=this.createClosure(e);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),s()}catch(e){throw e}finally{n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=o,n.callStack=a,this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},t.createErrorMessage=function(e,t,n){var r=e[1].replace("%0",String(t));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},t.createError=function(e,t){return new t(e)},t.createThrowError=function(e,t){return this.createError(e,t)},t.createInternalThrowError=function(e,t,n){return this.createError(this.createErrorMessage(e,t,n),e[2])},t.checkTimeout=function(){if(!this.isRunning)return!1;var e=this.options.timeout||0;return Date.now()-this.execStartTime>e},t.getNodePosition=function(e){if(e){return e.loc?" ["+e.loc.start.line+":"+e.loc.start.column+"]":""}return""},t.createClosure=function(e){var t,n=this;switch(e.type){case"BinaryExpression":t=this.binaryExpressionHandler(e);break;case"LogicalExpression":t=this.logicalExpressionHandler(e);break;case"UnaryExpression":t=this.unaryExpressionHandler(e);break;case"UpdateExpression":t=this.updateExpressionHandler(e);break;case"ObjectExpression":t=this.objectExpressionHandler(e);break;case"ArrayExpression":t=this.arrayExpressionHandler(e);break;case"CallExpression":t=this.callExpressionHandler(e);break;case"NewExpression":t=this.newExpressionHandler(e);break;case"MemberExpression":t=this.memberExpressionHandler(e);break;case"ThisExpression":t=this.thisExpressionHandler(e);break;case"SequenceExpression":t=this.sequenceExpressionHandler(e);break;case"Literal":t=this.literalHandler(e);break;case"Identifier":t=this.identifierHandler(e);break;case"AssignmentExpression":t=this.assignmentExpressionHandler(e);break;case"FunctionDeclaration":t=this.functionDeclarationHandler(e);break;case"VariableDeclaration":t=this.variableDeclarationHandler(e);break;case"BlockStatement":case"Program":t=this.programHandler(e);break;case"ExpressionStatement":t=this.expressionStatementHandler(e);break;case"EmptyStatement":t=this.emptyStatementHandler(e);break;case"ReturnStatement":t=this.returnStatementHandler(e);break;case"FunctionExpression":t=this.functionExpressionHandler(e);break;case"IfStatement":t=this.ifStatementHandler(e);break;case"ConditionalExpression":t=this.conditionalExpressionHandler(e);break;case"ForStatement":t=this.forStatementHandler(e);break;case"WhileStatement":t=this.whileStatementHandler(e);break;case"DoWhileStatement":t=this.doWhileStatementHandler(e);break;case"ForInStatement":t=this.forInStatementHandler(e);break;case"WithStatement":t=this.withStatementHandler(e);break;case"ThrowStatement":t=this.throwStatementHandler(e);break;case"TryStatement":t=this.tryStatementHandler(e);break;case"ContinueStatement":t=this.continueStatementHandler(e);break;case"BreakStatement":t=this.breakStatementHandler(e);break;case"SwitchStatement":t=this.switchStatementHandler(e);break;case"LabeledStatement":t=this.labeledStatementHandler(e);break;case"DebuggerStatement":t=this.debuggerStatementHandler(e);break;default:throw this.createInternalThrowError(A$.NodeTypeSyntaxError,e.type,e)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(A$.ExecutionTimeOutError,r,null);return n.lastExecNode=e,t.apply(void 0,arguments)}},t.binaryExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){var i=n(),o=r();switch(e.operator){case"==":return i==o;case"!=":return i!=o;case"===":return i===o;case"!==":return i!==o;case"<":return i<o;case"<=":return i<=o;case">":return i>o;case">=":return i>=o;case"<<":return i<<o;case">>":return i>>o;case">>>":return i>>>o;case"+":return i+o;case"-":return i-o;case"*":return i*o;case"**":return Math.pow(i,o);case"/":return i/o;case"%":return i%o;case"|":return i|o;case"^":return i^o;case"&":return i&o;case"in":return i in o;case"instanceof":return i instanceof o;default:throw t.createInternalThrowError(A$.BinaryOperatorSyntaxError,e.operator,e)}}},t.logicalExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){switch(e.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw t.createInternalThrowError(A$.LogicalOperatorSyntaxError,e.operator,e)}}},t.unaryExpressionHandler=function(e){var t=this;switch(e.operator){case"delete":var n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){return delete n()[r()]};default:var i;if("typeof"===e.operator&&"Identifier"===e.argument.type){var o=this.createObjectGetter(e.argument),a=this.createNameGetter(e.argument);i=function(){return o()[a()]}}else i=this.createClosure(e.argument);return function(){var n=i();switch(e.operator){case"-":return-n;case"+":return+n;case"!":return!n;case"~":return~n;case"void":return;case"typeof":return typeof n;default:throw t.createInternalThrowError(A$.UnaryOperatorSyntaxError,e.operator,e)}}}},t.updateExpressionHandler=function(e){var t=this,n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){var i=n(),o=r();switch(t.assertVariable(i,o,e),e.operator){case"++":return e.prefix?++i[o]:i[o]++;case"--":return e.prefix?--i[o]:i[o]--;default:throw t.createInternalThrowError(A$.UpdateOperatorSyntaxError,e.operator,e)}}},t.objectExpressionHandler=function(e){var t=this,n=[];var r=Object.create(null);return e.properties.forEach((function(e){var i=e.kind,o=function(e){return"Identifier"===e.type?e.name:"Literal"===e.type?e.value:this.throwError(A$.ObjectStructureSyntaxError,e.type,e)}(e.key);r[o]&&"init"!==i||(r[o]={}),r[o][i]=t.createClosure(e.value),n.push({key:o,property:e})})),function(){for(var e={},t=n.length,i=0;i<t;i++){var o=n[i],a=o.key,s=r[a],u=s.init?s.init():void 0,l=s.get?s.get():function(){},c=s.set?s.set():function(e){};if("set"in s||"get"in s){var h={configurable:!0,enumerable:!0,get:l,set:c};Object.defineProperty(e,a,h)}else{var f=o.property,p=f.kind;"Identifier"!==f.key.type||"FunctionExpression"!==f.value.type||"init"!==p||f.value.id||M$(u,f.key.name),e[a]=u}}return e}},t.arrayExpressionHandler=function(e){var t=this,n=e.elements.map((function(e){return e?t.createClosure(e):e}));return function(){for(var e=n.length,t=Array(e),r=0;r<e;r++){var i=n[r];i&&(t[r]=i())}return t}},t.safeObjectGet=function(e,t,n){return e[t]},t.createCallFunctionGetter=function(e){var t=this;switch(e.type){case"MemberExpression":var n=this.createClosure(e.object),r=this.createMemberKeyGetter(e),i=this.source;return function(){var o=n(),a=r(),s=t.safeObjectGet(o,a,e);if(!s||!B$(s)){var u=i.slice(e.start,e.end);throw t.createInternalThrowError(A$.FunctionUndefinedReferenceError,u,e)}return s.__IS_EVAL_FUNC?function(e){return s(new z$(t),e,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return s.apply(void 0,[new z$(t)].concat(n))}:s.bind(o)};default:var o=this.createClosure(e);return function(){var n="";"Identifier"===e.type&&(n=e.name);var r=o();if(!r||!B$(r))throw t.createInternalThrowError(A$.FunctionUndefinedReferenceError,n,e);if("Identifier"===e.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(e){var i=t.getScopeFromName(n,t.getCurrentScope()),o=i.name===N$||i.name===F$||i.name===D$;return r(new z$(t),e,!o)};if(r.__IS_EVAL_FUNC)return function(e){return r(new z$(t),e,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.apply(void 0,[new z$(t)].concat(n))};var i=t.options.globalContextInFunction;if("Identifier"===e.type){var a=t.getIdentifierScope(e);a.name===R$&&(i=a.data)}return r.bind(i)}}},t.callExpressionHandler=function(e){var t=this,n=this.createCallFunctionGetter(e.callee),r=e.arguments.map((function(e){return t.createClosure(e)}));return function(){return n().apply(void 0,r.map((function(e){return e()})))}},t.functionExpressionHandler=function(e){var t=this,n=this,r=this.source,i=this.collectDeclVars,o=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var a=e.id?e.id.name:"",s=e.params.length,u=e.params.map((function(e){return t.createParamNameGetter(e)})),l=this.createClosure(e.body),c=this.collectDeclVars,h=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=o,function(){var t=n.getCurrentScope(),i=function e(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.callStack.push(""+a);var s=n.getCurrentScope(),f=X$(t,"FunctionScope("+a+")");n.setCurrentScope(f),n.addDeclarationsToScope(c,h,f),a&&(f.data[a]=e),f.data.arguments=arguments,u.forEach((function(e,t){f.data[e()]=i[t]}));var p=n.getCurrentContext();n.setCurrentContext(this);var d=l();if(n.setCurrentContext(p),n.setCurrentScope(s),n.callStack.pop(),d instanceof V$)return d.value};return M$(i,a),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),i}},t.newExpressionHandler=function(e){var t=this,n=this.source,r=this.createClosure(e.callee),i=e.arguments.map((function(e){return t.createClosure(e)}));return function(){var o=r();if(!B$(o)||o.__IS_EVAL_FUNC){var a=e.callee,s=n.slice(a.start,a.end);throw t.createInternalThrowError(A$.IsNotConstructor,s,e)}return o.__IS_FUNCTION_FUNC?o.apply(void 0,[new z$(t)].concat(i.map((function(e){return e()})))):T$(o,i.map((function(e){return e()})))}},t.memberExpressionHandler=function(e){var t=this.createClosure(e.object),n=this.createMemberKeyGetter(e);return function(){return t()[n()]}},t.thisExpressionHandler=function(e){var t=this;return function(){return t.getCurrentContext()}},t.sequenceExpressionHandler=function(e){var t=this,n=e.expressions.map((function(e){return t.createClosure(e)}));return function(){for(var e,t=n.length,r=0;r<t;r++){e=(0,n[r])()}return e}},t.literalHandler=function(e){return function(){return e.regex?new RegExp(e.regex.pattern,e.regex.flags):e.value}},t.identifierHandler=function(e){var t=this;return function(){var n=t.getCurrentScope(),r=t.getScopeDataFromName(e.name,n);return t.assertVariable(r,e.name,e),r[e.name]}},t.getIdentifierScope=function(e){var t=this.getCurrentScope();return this.getScopeFromName(e.name,t)},t.assignmentExpressionHandler=function(e){var t=this;"Identifier"!==e.left.type||"FunctionExpression"!==e.right.type||e.right.id||(e.right.id={type:"Identifier",name:e.left.name});var n=this.createObjectGetter(e.left),r=this.createNameGetter(e.left),i=this.createClosure(e.right);return function(){var o=n(),a=r(),s=i();switch("="!==e.operator&&t.assertVariable(o,a,e),e.operator){case"=":return o[a]=s;case"+=":return o[a]+=s;case"-=":return o[a]-=s;case"*=":return o[a]*=s;case"**=":return o[a]=Math.pow(o[a],s);case"/=":return o[a]/=s;case"%=":return o[a]%=s;case"<<=":return o[a]<<=s;case">>=":return o[a]>>=s;case">>>=":return o[a]>>>=s;case"&=":return o[a]&=s;case"^=":return o[a]^=s;case"|=":return o[a]|=s;default:throw t.createInternalThrowError(A$.AssignmentExpressionSyntaxError,e.type,e)}}},t.functionDeclarationHandler=function(e){if(e.id){var t=this.functionExpressionHandler(e);Object.defineProperty(t,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(e.id.name,t)}return function(){return I$}},t.getVariableName=function(e){if("Identifier"===e.type)return e.name;throw this.createInternalThrowError(A$.VariableTypeSyntaxError,e.type,e)},t.variableDeclarationHandler=function(e){for(var t,n=this,r=[],i=0;i<e.declarations.length;i++){var o=e.declarations[i];this.varDeclaration(this.getVariableName(o.id)),o.init&&r.push({type:"AssignmentExpression",operator:"=",left:o.id,right:o.init})}return r.length&&(t=this.createClosure({type:"BlockStatement",body:r})),function(){if(t){var e=n.isVarDeclMode;n.isVarDeclMode=!0,t(),n.isVarDeclMode=e}return I$}},t.assertVariable=function(e,t,n){if(e===this.globalScope.data&&!(t in e))throw this.createInternalThrowError(A$.VariableUndefinedReferenceError,t,n)},t.programHandler=function(e){var t=this,n=e.body.map((function(e){return t.createClosure(e)}));return function(){for(var e=I$,r=0;r<n.length;r++){var i=n[r],o=t.setValue(i());if(o!==I$&&((e=o)instanceof V$||e instanceof H$||e instanceof G$||e===O$||e===P$))break}return e}},t.expressionStatementHandler=function(e){return this.createClosure(e.expression)},t.emptyStatementHandler=function(e){return function(){return I$}},t.returnStatementHandler=function(e){var t=e.argument?this.createClosure(e.argument):Y$;return function(){return new V$(t())}},t.ifStatementHandler=function(e){var t=this.createClosure(e.test),n=this.createClosure(e.consequent),r=e.alternate?this.createClosure(e.alternate):
/*!important*/
function(){return I$};return function(){return t()?n():r()}},t.conditionalExpressionHandler=function(e){return this.ifStatementHandler(e)},t.forStatementHandler=function(e){var t=this,n=Y$,r=e.test?this.createClosure(e.test):function(){return!0},i=Y$,o=this.createClosure(e.body);return"ForStatement"===e.type&&(n=e.init?this.createClosure(e.init):n,i=e.update?this.createClosure(e.update):Y$),function(a){var s,u=I$,l="DoWhileStatement"===e.type;for(a&&"LabeledStatement"===a.type&&(s=a.label.name),n();l||r();i()){l=!1;var c=t.setValue(o());if(c!==I$&&c!==P$){if(c===O$)break;if((u=c)instanceof G$&&u.value===s)u=I$;else if(u instanceof V$||u instanceof H$||u instanceof G$)break}}return u}},t.whileStatementHandler=function(e){return this.forStatementHandler(e)},t.doWhileStatementHandler=function(e){return this.forStatementHandler(e)},t.forInStatementHandler=function(e){var t=this,n=e.left,r=this.createClosure(e.right),i=this.createClosure(e.body);return"VariableDeclaration"===e.left.type&&(this.createClosure(e.left)(),n=e.left.declarations[0].id),function(e){var o,a,s=I$;e&&"LabeledStatement"===e.type&&(o=e.label.name);var u=r();for(a in u){t.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:a}})();var l=t.setValue(i());if(l!==I$&&l!==P$){if(l===O$)break;if((s=l)instanceof G$&&s.value===o)s=I$;else if(s instanceof V$||s instanceof H$||s instanceof G$)break}}return s}},t.withStatementHandler=function(e){var t=this,n=this.createClosure(e.object),r=this.createClosure(e.body);return function(){var e=n(),i=t.getCurrentScope(),o=new W$(e,i,R$);t.setCurrentScope(o);var a=t.setValue(r());return t.setCurrentScope(i),a}},t.throwStatementHandler=function(e){var t=this,n=this.createClosure(e.argument);return function(){throw t.setValue(void 0),n()}},t.tryStatementHandler=function(e){var t=this,n=this.createClosure(e.block),r=e.handler?this.catchClauseHandler(e.handler):null,i=e.finalizer?this.createClosure(e.finalizer):null;return function(){var e,o,a=t.getCurrentScope(),s=t.getCurrentContext(),u=a.labelStack.concat([]),l=t.callStack.concat([]),c=I$,h=function(){t.setCurrentScope(a),t.setCurrentContext(s),a.labelStack=u,t.callStack=l};try{(c=t.setValue(n()))instanceof V$&&(e=c)}catch(n){if(h(),t.isInterruptThrow(n))throw n;if(r)try{(c=t.setValue(r(n)))instanceof V$&&(e=c)}catch(e){if(h(),t.isInterruptThrow(e))throw e;o=e}}if(i)try{(c=i())instanceof V$&&(e=c)}catch(e){if(h(),t.isInterruptThrow(e))throw e;o=e}if(o)throw o;return e||c}},t.catchClauseHandler=function(e){var t=this,n=this.createParamNameGetter(e.param),r=this.createClosure(e.body);return function(e){var i,o=t.getCurrentScope().data,a=n(),s=k$.call(o,a),u=o[a];return o[a]=e,i=r(),s?o[a]=u:delete o[a],i}},t.continueStatementHandler=function(e){return function(){return e.label?new G$(e.label.name):P$}},t.breakStatementHandler=function(e){return function(){return e.label?new H$(e.label.name):O$}},t.switchStatementHandler=function(e){var t=this,n=this.createClosure(e.discriminant),r=e.cases.map((function(e){return t.switchCaseHandler(e)}));return function(){for(var e,i,o,a=n(),s=!1,u=0;u<r.length;u++){var l=r[u](),c=l.testClosure();if(c!==L$){if(s||c===a){if(s=!0,(i=t.setValue(l.bodyClosure()))===I$)continue;if(i===O$)break;if((e=i)instanceof V$||e instanceof H$||e instanceof G$||e===P$)break}}else o=l}!s&&o&&((i=t.setValue(o.bodyClosure()))===I$||i===O$||i===P$||(e=i));return e}},t.switchCaseHandler=function(e){var t=e.test?this.createClosure(e.test):function(){return L$},n=this.createClosure({type:"BlockStatement",body:e.consequent});return function(){return{testClosure:t,bodyClosure:n}}},t.labeledStatementHandler=function(e){var t=this,n=e.label.name,r=this.createClosure(e.body);return function(){var i,o=t.getCurrentScope();return o.labelStack.push(n),(i=r(e))instanceof H$&&i.value===n&&(i=I$),o.labelStack.pop(),i}},t.debuggerStatementHandler=function(e){return function(){return I$}},t.createParamNameGetter=function(e){if("Identifier"===e.type)return function(){return e.name};throw this.createInternalThrowError(A$.ParamTypeSyntaxError,e.type,e)},t.createObjectKeyGetter=function(e){var t;return t="Identifier"===e.type?function(){return e.name}:this.createClosure(e),function(){return t()}},t.createMemberKeyGetter=function(e){return e.computed?this.createClosure(e.property):this.createObjectKeyGetter(e.property)},t.createObjectGetter=function(e){var t=this;switch(e.type){case"Identifier":return function(){return t.getScopeDataFromName(e.name,t.getCurrentScope())};case"MemberExpression":return this.createClosure(e.object);default:throw this.createInternalThrowError(A$.AssignmentTypeSyntaxError,e.type,e)}},t.createNameGetter=function(e){switch(e.type){case"Identifier":return function(){return e.name};case"MemberExpression":return this.createMemberKeyGetter(e);default:throw this.createInternalThrowError(A$.AssignmentTypeSyntaxError,e.type,e)}},t.varDeclaration=function(e){this.collectDeclVars[e]=void 0},t.funcDeclaration=function(e,t){this.collectDeclFuncs[e]=t},t.addDeclarationsToScope=function(e,t,n){var r=n.data;for(var i in t){var o=t[i];r[i]=o?o():o}for(var a in e)a in r||(r[a]=void 0)},t.getScopeValue=function(e,t){return this.getScopeFromName(e,t).data[e]},t.getScopeDataFromName=function(e,t){return this.getScopeFromName(e,t).data},t.getScopeFromName=function(e,t){var n=t;do{if(e in n.data)return n}while(n=n.parent);return this.globalScope},t.setValue=function(e){var t=this.callStack.length;return this.isVarDeclMode||t||e===I$||e===O$||e===P$||e instanceof H$||e instanceof G$||(this.value=e instanceof V$?e.value:e),e},t.getValue=function(){return this.value},e}();q$.version="0.0.3",q$.eval=j$,q$.Function=U$,q$.ecmaVersion=5,q$.globalContextInFunction=void 0,q$.global=Object.create(null);var K$,Q$,$$,J$,eJ,tJ,nJ,rJ,iJ,oJ,aJ,sJ,uJ,lJ,cJ,hJ=function(e,t,n){return function(e,t,n){return new q$(t,n).evaluate(e)}(e,t,n)},fJ=W((function(e,t){e.exports=function(e){var t=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},n=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e};function r(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function i(e){var t=new Error("(regl) "+e);throw console.error(t),t}function o(e,t){e||i(t)}function a(e){return e?": "+e:""}function s(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function u(e,t,n){t.indexOf(e)<0&&i("invalid value"+a(n)+". must be one of: "+t)}var l=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function h(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(e,t){this.number=e,this.line=t,this.errors=[]}function p(e,t,n){this.file=e,this.line=t,this.message=n}function d(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function v(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function g(e,t){var n=e.split("\n"),i=1,o=0,a={unknown:new h,0:new h};a.unknown.name=a[0].name=t||d(),a.unknown.lines.push(new f(0,""));for(var s=0;s<n.length;++s){var u=n[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(i=0|c[1],c[2]&&((o=0|c[2])in a||(a[o]=new h)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);p&&(a[o].name=p[1]?r(p[2]):p[2])}a[o].lines.push(new f(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function m(e){e._commandRef=d()}function y(e,t){var n=v();i(e+" in command "+(t||d())+("unknown"===n?"":" called from "+n))}function _(e,t,n,r){s(e,t)||y("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e,r||d())}var b={};function x(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:b[e]*t}function S(e){return!(e&e-1||!e)}b[5120]=b[5121]=1,b[5122]=b[5123]=b[36193]=b[33635]=b[32819]=b[32820]=2,b[5124]=b[5125]=b[5126]=b[34042]=4;var E=n(o,{optional:function(e){e()},raise:i,commandRaise:y,command:function(e,t,n){e||y(t,n||d())},parameter:function(e,t,n){e in t||i("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||y("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join(),r||d())},constructor:function(e){Object.keys(e).forEach((function(e){l.indexOf(e)<0&&i('invalid regl constructor argument "'+e+'". must be one of '+l)}))},type:function(e,t,n){s(e,t)||i("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e)},commandType:_,isTypedArray:function(e,n){t(e)||i("invalid parameter type"+a(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||i("invalid parameter type, ("+e+")"+a(t)+". must be a nonnegative integer")},oneOf:u,shaderError:function(e,t,n,r,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(t),s=r===e.FRAGMENT_SHADER?"fragment":"vertex";_(n,"string",s+" shader source must be a string",i);var u=g(n,i),l=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new p(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new p("unknown",0,e))}})),t}(a);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(u,l),Object.keys(u).forEach((function(e){var t=u[e];if(t.hasErrors){var n=[""],r=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var r=n.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(o){var a=o[1];switch(r=o[2],a){case"assign":a="="}t=Math.max(e.line.indexOf(a,t),0)}else t=0;i(c("| ",6)),i(c("^^^",t+3)+"\n","font-weight:bold"),i(c("| ",6)),i(r+"\n","font-weight:bold")})),i(c("| ",6)+"\n")}else i(c(e.number,4)+"|  "),i(e.line+"\n","color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(r[0]=n.join("%c"),console.log.apply(console,r))}function i(e,t){n.push(e),r.push(t||"")}})),o.raise("Error compiling "+s+" shader, "+u[0].name)}},linkError:function(e,t,n,r,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){var a=e.getProgramInfoLog(t),s=g(n,i),u='Error linking program with vertex shader, "'+g(r,i)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+"\n"+a),o.raise(u)}},callSite:v,saveCommandRef:m,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}m(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?u(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):u(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,n){var r,i=t.width,a=t.height,s=t.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),33071===e.wrapS&&33071===e.wrapT||o(S(i)&&S(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==a&&o(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(o(S(i)&&S(a),"texture must be a square power of 2 to support mipmapping"),o(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&o(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),o(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var l=i>>r,c=a>>r;o(t.mipmask&1<<r,"missing mipmap data");var h=u[r];if(o(h.width===l&&h.height===c,"invalid shape for mip images"),o(h.format===t.format&&h.internalformat===t.internalformat&&h.type===t.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(x(h.type,s)*l/h.unpackAlignment)*h.unpackAlignment;o(h.data.byteLength===f*c,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else e.genMipmaps||o(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&o(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var i=e.width,a=e.height,s=e.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(33071===t.wrapS&&33071===t.wrapT,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];o(l.width===i&&l.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(o(!l.compressed,"can not generate mipmap for compressed textures"),o(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,h=0;h<16;++h){var f=c[h];if(f){var p=i>>h,d=a>>h;o(l.mipmask&1<<h,"missing mipmap data"),o(f.width===p&&f.height===d,"invalid shape for mip images"),o(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,"incompatible type for mip image"),f.compressed||(f.data?o(f.data.byteLength===p*d*Math.max(x(f.type,s),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}}),A=0;function C(e,t){this.id=A++,this.type=e,this.data=t}function T(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function w(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+T(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var o=t.split(".");if(1===o.length)return['"'+T(t)+'"'];for(var a=[],s=0;s<o.length;++s)a=a.concat(e(o[s]));return a}(e).join("][")+"]"}var M={DynamicVariable:C,define:function(e,t){return new C(e,w(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof C},unbox:function e(t,n){return"function"==typeof t?new C(0,t):"number"==typeof t||"boolean"==typeof t?new C(5,t):Array.isArray(t)?new C(6,t.map((function(t,r){return e(t,n+"["+r+"]")}))):t instanceof C?t:void E(!1,"invalid option type in uniform "+n)},accessor:w},k={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},O="undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?function(){return+new Date}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function P(e){return"string"==typeof e?e.split():(E(Array.isArray(e),"invalid extension array"),e)}function L(e){return"string"==typeof e?(E("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function I(e){var t,r,i,o,a=e||{},s={},u=[],l=[],c="undefined"==typeof window?1:window.devicePixelRatio,h=!1,f=function(e){e&&E.raise(e)},p=function(){};if("string"==typeof a?(E("undefined"!=typeof document,"selector queries only supported in DOM environments"),t=document.querySelector(a),E(t,"invalid query string for element")):"object"==typeof a?function(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}(a)?t=a:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(a)?i=(o=a).canvas:(E.constructor(a),"gl"in a?o=a.gl:"canvas"in a?i=L(a.canvas):"container"in a&&(r=L(a.container)),"attributes"in a&&(s=a.attributes,E.type(s,"object","invalid context attributes")),"extensions"in a&&(u=P(a.extensions)),"optionalExtensions"in a&&(l=P(a.optionalExtensions)),"onDone"in a&&(E.type(a.onDone,"function","invalid or missing onDone callback"),f=a.onDone),"profile"in a&&(h=!!a.profile),"pixelRatio"in a&&(c=+a.pixelRatio,E(c>0,"invalid pixel ratio"))):E.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?i=t:r=t),!o){if(!i){E("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var d=function(e,t,r){var i,o=document.createElement("canvas");function a(){var t=window.innerWidth,n=window.innerHeight;if(e!==document.body){var i=o.getBoundingClientRect();t=i.right-i.left,n=i.bottom-i.top}o.width=r*t,o.height=r*n}return n(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(o),e===document.body&&(o.style.position="absolute",n(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,c);if(!d)return null;i=d.canvas,p=d.onDestroy}void 0===s.premultipliedAlpha&&(s.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,s)}return o?{gl:o,canvas:i,container:r,extensions:u,optionalExtensions:l,pixelRatio:c,profile:h,onDone:f,onDestroy:p}:(p(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function R(e,t){var n={};function r(t){E.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=function(t){return e.getExtension(t)?e.getExtension(t):e.getExtension(t.toLowerCase())?e.getExtension(t.toLowerCase()):null}(t)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}function N(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function D(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function F(){var e=N(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[D(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[D(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var B=F();function z(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}B.zero=F();var j=function(e){return Object.keys(e).map((function(t){return e[t]}))},U={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||B.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:V(e,t[0],t[1],t[2],a,0);break;default:!function e(t,n,r,i,o){for(var a=1,s=r+1;s<n.length;++s)a*=n[s];var u=n[r];if(n.length-r==4){var l=n[r+1],c=n[r+2],h=n[r+3];for(s=0;s<u;++s)V(t[s],l,c,h,i,o),o+=a}else for(s=0;s<u;++s)e(t[s],n,r+1,i,o),o+=a}(e,t,0,a,0)}return a}};function V(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],l=0;l<n;++l)for(var c=u[l],h=0;h<r;++h)i[a++]=c[h]}var H={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},G={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},W={dynamic:35048,stream:35040,static:35044},Y=U.flatten,X=U.shape,Z=[];function q(e){return 0|H[Object.prototype.toString.call(e)]}function K(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function Q(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)e[s++]=t[i*u+o*l+a]}Z[5120]=1,Z[5122]=2,Z[5124]=4,Z[5121]=1,Z[5123]=2,Z[5125]=4,Z[5126]=4;var $={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},J=new Float32Array(1),ee=new Uint32Array(J.buffer);function te(e){for(var t=B.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{J[0]=e[n];var r=ee[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function ne(e){return Array.isArray(e)||t(e)}var re=function(e){return!(e&e-1||!e)},ie=[9984,9986,9985,9987],oe=[0,6409,6410,6407,6408],ae={};function se(e){return"[object "+e+"]"}ae[6409]=ae[6406]=ae[6402]=1,ae[34041]=ae[6410]=2,ae[6407]=ae[35904]=3,ae[6408]=ae[35906]=4;var ue=se("HTMLCanvasElement"),le=se("OffscreenCanvas"),ce=se("CanvasRenderingContext2D"),he=se("ImageBitmap"),fe=se("HTMLImageElement"),pe=se("HTMLVideoElement"),de=Object.keys(H).concat([ue,le,ce,he,fe,pe]),ve=[];ve[5121]=1,ve[5126]=4,ve[36193]=2,ve[5123]=2,ve[5125]=4;var ge=[];function me(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function ye(e){return!!Array.isArray(e)&&!(0===e.length||!ne(e[0]))}function _e(e){return Object.prototype.toString.call(e)}function be(e){return _e(e)===ue}function xe(e){return _e(e)===le}function Se(e){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&e&&e.getContext)}function Ee(e){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&e&&"src"in e&&"crossOrigin"in e)}function Ae(e){if(!e)return!1;if(Se(e)||Ee(e))return!0;var t=_e(e);return de.indexOf(t)>=0||me(e)||ye(e)||z(e)}function Ce(e){return 0|H[Object.prototype.toString.call(e)]}function Te(e,t){return B.allocType(36193===e.type?5126:e.type,t)}function we(e,t){36193===e.type?(e.data=te(t),B.freeType(t)):e.data=t}function Me(e,t,n,r,i,o){var a;if(a=void 0!==ge[e]?ge[e]:ae[e]*ve[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function ke(e,r,i,o,a,s,u){var l={"don't care":4352,"dont care":4352,nice:4354,fast:4353},c={repeat:10497,clamp:33071,mirror:33648},h={nearest:9728,linear:9729},f=n({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},h),p={none:0,browser:37444},d={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},v={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},g={};r.ext_srgb&&(v.srgb=35904,v.srgba=35906),r.oes_texture_float&&(d.float32=d.float=5126),r.oes_texture_half_float&&(d.float16=d["half float"]=36193),r.webgl_depth_texture&&(n(v,{depth:6402,"depth stencil":34041}),n(d,{uint16:5123,uint32:5125,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&n(g,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),r.webgl_compressed_texture_atc&&n(g,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&n(g,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=36196);var m=Array.prototype.slice.call(e.getParameter(34467)||new Uint32Array(0));Object.keys(g).forEach((function(e){var t=g[e];m.indexOf(t)>=0&&(v[e]=t)}));var y=Object.keys(v);i.textureFormats=y;var _=[];Object.keys(v).forEach((function(e){var t=v[e];_[t]=e}));var b=[];Object.keys(d).forEach((function(e){var t=d[e];b[t]=e}));var x=[];Object.keys(h).forEach((function(e){x[h[e]]=e}));var S=[];Object.keys(f).forEach((function(e){var t=f[e];S[t]=e}));var A=[];Object.keys(c).forEach((function(e){A[c[e]]=e}));var C=y.reduce((function(e,t){var n=v[t];return 6409===n||6406===n||6409===n||6410===n||6402===n||34041===n||r.ext_srgb&&(35904===n||35906===n)?e[n]=n:32855===n||t.indexOf("rgba")>=0?e[n]=6408:e[n]=6407,e}),{});function T(){this.internalformat=6408,this.format=6408,this.type=5121,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function w(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function M(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(E.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(E.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(E.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(E.parameter(t.colorSpace,p,"invalid colorSpace"),e.colorSpace=p[t.colorSpace]),"type"in t){var n=t.type;E(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),E(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),E(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),E.parameter(n,d,"invalid texture type"),e.type=d[n]}var o=e.width,a=e.height,s=e.channels,u=!1;"shape"in t?(E(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],E(s>0&&s<=4,"invalid number of channels"),u=!0),E(o>=0&&o<=i.maxTextureSize,"invalid width"),E(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,E(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,E(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,E(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,E(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var l=!1;if("format"in t){var c=t.format;E(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),E.parameter(c,v,"invalid texture format");var h=e.internalformat=v[c];e.format=C[h],c in d&&("type"in t||(e.type=d[c])),c in g&&(e.compressed=!0),l=!0}!u&&l?e.channels=ae[e.format]:u&&!l?e.channels!==oe[e.format]&&(e.format=e.internalformat=oe[e.channels]):l&&u&&E(e.channels===ae[e.format],"number of channels inconsistent with specified format")}}function k(t){e.pixelStorei(37440,t.flipY),e.pixelStorei(37441,t.premultiplyAlpha),e.pixelStorei(37443,t.colorSpace),e.pixelStorei(3317,t.unpackAlignment)}function O(){T.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function P(e,n){var r=null;if(Ae(n)?r=n:n&&(E.type(n,"object","invalid pixel data type"),M(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),Ae(n.data)&&(r=n.data)),E(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){E(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;e.width=e.width||o-e.xOffset,e.height=e.height||s-e.yOffset,e.needsCopy=!0,E(e.xOffset>=0&&e.xOffset<o&&e.yOffset>=0&&e.yOffset<s&&e.width>0&&e.width<=o&&e.height>0&&e.height<=s,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||5121!==e.type||(e.type=Ce(r));else if(me(r))e.channels=e.channels||4,function(e,t){var n=t.length;switch(e.type){case 5121:case 5123:case 5125:case 5126:var r=B.allocType(e.type,n);r.set(t),e.data=r;break;case 36193:e.data=te(t);break;default:E.raise("unsupported texture type, must specify a typed array")}}(e,r),e.alignment=1,e.needsFree=!0;else if(z(r)){var u=r.data;Array.isArray(u)||5121!==e.type||(e.type=Ce(u));var l,c,h,f,p,d,v=r.shape,g=r.stride;3===v.length?(h=v[2],d=g[2]):(E(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),l=v[0],c=v[1],f=g[0],p=g[1],e.alignment=1,e.width=l,e.height=c,e.channels=h,e.format=e.internalformat=oe[h],e.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,l=Te(e,a*s*u),c=0,h=0;h<s;++h)for(var f=0;f<a;++f)for(var p=0;p<u;++p)l[c++]=t[n*f+r*h+i*p+o];we(e,l)}(e,u,f,p,d,r.offset)}else if(Se(r)||be(r)||xe(r)||function(e){return _e(e)===ce}(r))Se(r)||be(r)||xe(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(function(e){return _e(e)===he}(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(function(e){return _e(e)===fe}(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(Ee(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(function(e){return _e(e)===pe}(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(ye(r)){var m=e.width||r[0].length,y=e.height||r.length,_=e.channels;_=ne(r[0][0])?_||r[0][0].length:_||1;for(var b=U.shape(r),x=1,S=0;S<b.length;++S)x*=b[S];var A=Te(e,x);U.flatten(r,b,"",A),we(e,A),e.alignment=1,e.width=m,e.height=y,e.channels=_,e.format=e.internalformat=oe[_],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;5126===e.type?E(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):36193===e.type&&E(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function L(t,n,r){var i=t.element,a=t.data,s=t.internalformat,u=t.format,l=t.type,c=t.width,h=t.height;k(t),i?e.texImage2D(n,r,u,u,l,i):t.compressed?e.compressedTexImage2D(n,r,s,c,h,0,a):t.needsCopy?(o(),e.copyTexImage2D(n,r,u,t.xOffset,t.yOffset,c,h,0)):e.texImage2D(n,r,u,c,h,0,u,l,a||null)}function I(t,n,r,i,a){var s=t.element,u=t.data,l=t.internalformat,c=t.format,h=t.type,f=t.width,p=t.height;k(t),s?e.texSubImage2D(n,a,r,i,c,h,s):t.compressed?e.compressedTexSubImage2D(n,a,r,i,l,f,p,u):t.needsCopy?(o(),e.copyTexSubImage2D(n,a,r,i,t.xOffset,t.yOffset,f,p)):e.texSubImage2D(n,a,r,i,f,p,c,h,u)}var R=[];function N(){return R.pop()||new O}function D(e){e.needsFree&&B.freeType(e.data),O.call(e),R.push(e)}function F(){T.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function V(e,t,n){var r=e.images[0]=N();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function H(e,t){var n=null;if(Ae(t))w(n=e.images[0]=N(),e),P(n,t),e.mipmask=1;else if(M(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)w(n=e.images[i]=N(),e),n.width>>=i,n.height>>=i,P(n,r[i]),e.mipmask|=1<<i;else w(n=e.images[0]=N(),e),P(n,t),e.mipmask=1;w(e,e.images[0]),!e.compressed||33776!==e.internalformat&&33777!==e.internalformat&&33778!==e.internalformat&&33779!==e.internalformat||E(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function G(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;L(n[r],t,r)}}var W=[];function Y(){var e=W.pop()||new F;T.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function X(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&D(t[n]),t[n]=null;W.push(e)}function Z(){this.minFilter=9728,this.magFilter=9728,this.wrapS=33071,this.wrapT=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function q(e,t){if("min"in t){var n=t.min;E.parameter(n,f),e.minFilter=f[n],ie.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;E.parameter(r,h),e.magFilter=h[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(E.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(E.parameter(s[0],c),E.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in t){var u=t.wrapS;E.parameter(u,c),o=c[u]}if("wrapT"in t){var p=t.wrapT;E.parameter(p,c),a=c[p]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var d=t.anisotropic;E("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var v=!1;switch(typeof t.mipmap){case"string":E.parameter(t.mipmap,l,"invalid mipmap hint"),e.mipmapHint=l[t.mipmap],e.genMipmaps=!0,v=!0;break;case"boolean":v=e.genMipmaps=t.mipmap;break;case"object":E(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,v=!0;break;default:E.raise("invalid mipmap type")}v&&!("min"in t)&&(e.minFilter=9984)}}function K(t,n){e.texParameteri(n,10241,t.minFilter),e.texParameteri(n,10240,t.magFilter),e.texParameteri(n,10242,t.wrapS),e.texParameteri(n,10243,t.wrapT),r.ext_texture_filter_anisotropic&&e.texParameteri(n,34046,t.anisotropic),t.genMipmaps&&(e.hint(33170,t.mipmapHint),e.generateMipmap(n))}var Q=0,$={},J=i.maxTextureUnits,ee=Array(J).map((function(){return null}));function se(t){T.call(this),this.mipmask=0,this.internalformat=6408,this.id=Q++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Z,u.profile&&(this.stats={size:0})}function ue(t){e.activeTexture(33984),e.bindTexture(t.target,t.texture)}function le(){var t=ee[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(3553,null)}function de(t){var n=t.texture;E(n,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(e.activeTexture(33984+r),e.bindTexture(i,null),ee[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete $[t.id],s.textureCount--}return n(se.prototype,{bind:function(){this.bindCount+=1;var t=this.unit;if(t<0){for(var n=0;n<J;++n){var r=ee[n];if(r){if(r.bindCount>0)continue;r.unit=-1}ee[n]=this,t=n;break}t>=J&&E.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),this.unit=t,e.activeTexture(33984+t),e.bindTexture(this.target,this.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&de(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys($).forEach((function(t){e+=$[t].stats.size})),e}),{create2D:function(t,n){var r=new se(3553);function o(e,t){var n=r.texInfo;Z.call(n);var a=Y();return"number"==typeof e?V(a,0|e,"number"==typeof t?0|t:0|e):e?(E.type(e,"object","invalid arguments to regl.texture"),q(n,e),H(a,e)):V(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,w(r,a),E.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,ue(r),G(a,3553),K(n,3553),le(),X(a),u.profile&&(r.stats.size=Me(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=_[r.internalformat],o.type=b[r.type],o.mag=x[n.magFilter],o.min=S[n.minFilter],o.wrapS=A[n.wrapS],o.wrapT=A[n.wrapT],o}return $[r.id]=r,s.textureCount++,o(t,n),o.subimage=function(e,t,n,i){E(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,l=N();return w(l,r),l.width=0,l.height=0,P(l,e),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,E(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),E(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),E(r.mipmask&1<<u,"missing mipmap data"),E(l.data||l.element||l.needsCopy,"missing image data"),ue(r),I(l,3553,a,s,u),le(),D(l),o},o.resize=function(t,n){var i=0|t,a=0|n||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,ue(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=a>>s;if(!l||!c)break;e.texImage2D(3553,s,r.format,l,c,0,r.format,r.type,null)}return le(),u.profile&&(r.stats.size=Me(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(t,n,r,o,a,l){var c=new se(34067);$[c.id]=c,s.cubeCount++;var h=new Array(6);function f(e,t,n,r,o,a){var s,l=c.texInfo;for(Z.call(l),s=0;s<6;++s)h[s]=Y();if("number"!=typeof e&&e)if("object"==typeof e)if(t)H(h[0],e),H(h[1],t),H(h[2],n),H(h[3],r),H(h[4],o),H(h[5],a);else if(q(l,e),M(c,e),"faces"in e){var p=e.faces;for(E(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),s=0;s<6;++s)E("object"==typeof p[s]&&!!p[s],"invalid input for cube map face"),w(h[s],c),H(h[s],p[s])}else for(s=0;s<6;++s)H(h[s],e);else E.raise("invalid arguments to cube map");else{var d=0|e||1;for(s=0;s<6;++s)V(h[s],d,d)}for(w(c,h[0]),E.optional((function(){i.npotTextureCube||E(re(c.width)&&re(c.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?c.mipmask=(h[0].width<<1)-1:c.mipmask=h[0].mipmask,E.textureCube(c,l,h,i),c.internalformat=h[0].internalformat,f.width=h[0].width,f.height=h[0].height,ue(c),s=0;s<6;++s)G(h[s],34069+s);for(K(l,34067),le(),u.profile&&(c.stats.size=Me(c.internalformat,c.type,f.width,f.height,l.genMipmaps,!0)),f.format=_[c.internalformat],f.type=b[c.type],f.mag=x[l.magFilter],f.min=S[l.minFilter],f.wrapS=A[l.wrapS],f.wrapT=A[l.wrapT],s=0;s<6;++s)X(h[s]);return f}return f(t,n,r,o,a,l),f.subimage=function(e,t,n,r,i){E(!!t,"must specify image data"),E("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=N();return w(u,c),u.width=0,u.height=0,P(u,t),u.width=u.width||(c.width>>s)-o,u.height=u.height||(c.height>>s)-a,E(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),E(o>=0&&a>=0&&o+u.width<=c.width&&a+u.height<=c.height,"texture.subimage write out of bounds"),E(c.mipmask&1<<s,"missing mipmap data"),E(u.data||u.element||u.needsCopy,"missing image data"),ue(c),I(u,34069+e,o,a,s),le(),D(u),f},f.resize=function(t){var n=0|t;if(n!==c.width){f.width=c.width=n,f.height=c.height=n,ue(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)e.texImage2D(34069+r,i,c.format,n>>i,n>>i,0,c.format,c.type,null);return le(),u.profile&&(c.stats.size=Me(c.internalformat,c.type,f.width,f.height,!1,!0)),f}},f._reglType="textureCube",f._texture=c,u.profile&&(f.stats=c.stats),f.destroy=function(){c.decRef()},f},clear:function(){for(var t=0;t<J;++t)e.activeTexture(33984+t),e.bindTexture(3553,null),ee[t]=null;j($).forEach(de),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var t=0;t<J;++t){var n=ee[t];n&&(n.bindCount=0,n.unit=-1,ee[t]=null)}j($).forEach((function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var n=0;n<32;++n)if(0!=(t.mipmask&1<<n))if(3553===t.target)e.texImage2D(3553,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)e.texImage2D(34069+r,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);K(t.texInfo,t.target)}))},refresh:function(){for(var t=0;t<J;++t){var n=ee[t];n&&(n.bindCount=0,n.unit=-1,ee[t]=null),e.activeTexture(33984+t),e.bindTexture(3553,null),e.bindTexture(34067,null)}}}}ge[32854]=2,ge[32855]=2,ge[36194]=2,ge[34041]=4,ge[33776]=.5,ge[33777]=.5,ge[33778]=1,ge[33779]=1,ge[35986]=.5,ge[35987]=1,ge[34798]=1,ge[35840]=.5,ge[35841]=.25,ge[35842]=.5,ge[35843]=.25,ge[36196]=.5;var Oe=[];function Pe(e,t,n){return Oe[e]*t*n}Oe[32854]=2,Oe[32855]=2,Oe[36194]=2,Oe[33189]=2,Oe[36168]=1,Oe[34041]=4,Oe[35907]=4,Oe[34836]=16,Oe[34842]=8,Oe[34843]=6;var Le=[6407,6408],Ie=[];Ie[6408]=4,Ie[6407]=3;var Re=[];Re[5121]=1,Re[5126]=4,Re[36193]=2;var Ne=[32854,32855,36194,35907,34842,34843,34836],De={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Fe=["attributes","elements","offset","count","primitive","instances"];function Be(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}function ze(e,n,r,i,o,a,s){function u(u){var l;null===n.next?(E(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=5121):(E(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,E.optional((function(){a.oes_texture_float?(E(5121===l||5126===l,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===l&&E(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):E(5121===l,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,h=0,f=i.framebufferWidth,p=i.framebufferHeight,d=null;t(u)?d=u:u&&(E.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,h=0|u.y,E(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),E(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-c),p=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(5121===l?E(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===l&&E(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),E(f>0&&f+c<=i.framebufferWidth,"invalid width for read pixels"),E(p>0&&p+h<=i.framebufferHeight,"invalid height for read pixels"),r();var v=f*p*4;return d||(5121===l?d=new Uint8Array(v):5126===l&&(d=d||new Float32Array(v))),E.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),E(d.byteLength>=v,"data buffer for regl.read() too small"),e.pixelStorei(3333,4),e.readPixels(c,h,f,p,6408,l,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}(e):u(e)}}function je(e){return Array.prototype.slice.call(e)}function Ue(e){return je(e).join("")}var Ve="xyzw".split(""),He="profile",Ge="framebuffer",We="vert",Ye="frag",Xe="elements",Ze="primitive",qe="count",Ke="offset",Qe="instances",$e="vao",Je=Ge+"Width",et=Ge+"Height",tt=["blend.func","blend.equation","stencil.func","stencil.opFront","stencil.opBack","sample.coverage","viewport","scissor.box","polygonOffset.offset"],nt={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},rt=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],it={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ot={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},at={frag:35632,vert:35633},st={cw:2304,ccw:2305};function ut(e){return Array.isArray(e)||t(e)||z(e)}function lt(e){return e.sort((function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1}))}function ct(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function ht(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ft(e){return new ct(!1,!1,!1,e)}function pt(e,t){var n=e.type;if(0===n){var r=e.data.length;return new ct(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new ct(i.thisDep,i.contextDep,i.propDep,t)}if(5===n)return new ct(!1,!1,!1,t);if(6===n){for(var o=!1,a=!1,s=!1,u=0;u<e.data.length;++u){var l=e.data[u];if(1===l.type)s=!0;else if(2===l.type)a=!0;else if(3===l.type)o=!0;else if(0===l.type){o=!0;var c=l.data;c>=1&&(a=!0),c>=2&&(s=!0)}else 4===l.type&&(o=o||l.data.thisDep,a=a||l.data.contextDep,s=s||l.data.propDep)}return new ct(o,a,s,t)}return new ct(3===n,2===n,1===n,t)}var dt=new ct(!1,!1,!1,(function(){}));function vt(t,r,i,o,a,s,u,l,c,h,f,p,d,v,g){var m=h.Record,y={add:32774,subtract:32778,"reverse subtract":32779};i.ext_blend_minmax&&(y.min=32775,y.max=32776);var _=i.angle_instanced_arrays,b=i.webgl_draw_buffers,x=i.oes_vertex_array_object,S={dirty:!0,profile:g.profile},A={},C=[],T={},w={};function k(e){return e.replace(".","_")}function O(e,t,n){var r=k(e);C.push(e),A[r]=S[r]=!!n,T[r]=t}function P(e,t,n){var r=k(e);C.push(e),Array.isArray(n)?(S[r]=n.slice(),A[r]=n.slice()):S[r]=A[r]=n,w[r]=t}O("dither",3024),O("blend.enable",3042),P("blend.color","blendColor",[0,0,0,0]),P("blend.equation","blendEquationSeparate",[32774,32774]),P("blend.func","blendFuncSeparate",[1,0,1,0]),O("depth.enable",2929,!0),P("depth.func","depthFunc",513),P("depth.range","depthRange",[0,1]),P("depth.mask","depthMask",!0),P("colorMask","colorMask",[!0,!0,!0,!0]),O("cull.enable",2884),P("cull.face","cullFace",1029),P("frontFace","frontFace",2305),P("lineWidth","lineWidth",1),O("polygonOffset.enable",32823),P("polygonOffset.offset","polygonOffset",[0,0]),O("sample.alpha",32926),O("sample.enable",32928),P("sample.coverage","sampleCoverage",[1,!1]),O("stencil.enable",2960),P("stencil.mask","stencilMask",-1),P("stencil.func","stencilFunc",[519,0,-1]),P("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),P("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),O("scissor.enable",3089),P("scissor.box","scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),P("viewport","viewport",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var L={gl:t,context:d,strings:r,next:A,current:S,draw:p,elements:s,buffer:a,shader:f,attributes:h.state,vao:h,uniforms:c,framebuffer:l,extensions:i,timer:v,isBufferArgs:ut},I={primTypes:$,compareFuncs:it,blendFuncs:nt,blendEquations:y,stencilOps:ot,glTypes:G,orientationType:st};E.optional((function(){L.isArrayLike=ne})),b&&(I.backBuffer=[1029],I.drawBuffer=N(o.maxDrawbuffers,(function(e){return 0===e?[0]:N(e,(function(e){return 36064+e}))})));var R=0;function D(){var t=function(){var t=0,r=[],i=[];function o(){var e=[],r=[];return n((function(){e.push.apply(e,je(arguments))}),{def:function(){var n="v"+t++;return r.push(n),arguments.length>0&&(e.push(n,"="),e.push.apply(e,je(arguments)),e.push(";")),n},toString:function(){return Ue([r.length>0?"var "+r.join(",")+";":"",Ue(e)])}})}function a(){var e=o(),t=o(),r=e.toString,i=t.toString;function a(n,r){t(n,r,"=",e.def(n,r),";")}return n((function(){e.apply(e,je(arguments))}),{def:e.def,entry:e,exit:t,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+i()}})}var s=o(),u={};return{global:s,link:function(e){for(var n=0;n<i.length;++n)if(i[n]===e)return r[n];var o="g"+t++;return r.push(o),i.push(e),o},block:o,proc:function(e,t){var r=[];function i(){var e="a"+r.length;return r.push(e),e}t=t||0;for(var o=0;o<t;++o)i();var s=a(),l=s.toString;return u[e]=n(s,{arg:i,toString:function(){return Ue(["function(",r.join(),"){",l(),"}"])}})},scope:a,cond:function(){var e=Ue(arguments),t=a(),r=a(),i=t.toString,o=r.toString;return n(t,{then:function(){return t.apply(t,je(arguments)),this},else:function(){return r.apply(r,je(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),Ue(["if(",e,"){",i(),"}",t])}})},compile:function(){var t=['"use strict";',s,"return {"];Object.keys(u).forEach((function(e){t.push('"',e,'":',u[e].toString(),",")})),t.push("}");var n=Ue(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?e.Function.apply(null,r.concat(n)):Function.apply(null,r.concat(n))).apply(null,i)}}}(),i=t.link,o=t.global;t.id=R++,t.batchId="0";var a=i(L),s=t.shared={props:"a0"};Object.keys(L).forEach((function(e){s[e]=o.def(a,".",e)})),E.optional((function(){t.CHECK=i(E),t.commandStr=E.guessCommand(),t.command=i(t.commandStr),t.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",i(n),",",this.command,");")},I.invalidBlendCombinations=rt}));var u=t.next={},l=t.current={};Object.keys(w).forEach((function(e){Array.isArray(S[e])&&(u[e]=o.def(s.next,".",e),l[e]=o.def(s.current,".",e))}));var c=t.constants={};Object.keys(I).forEach((function(e){c[e]=o.def(JSON.stringify(I[e]))})),t.invoke=function(e,n){switch(n.type){case 0:var r=["this",s.context,s.props,t.batchId];return e.def(i(n.data),".call(",r.slice(0,Math.max(n.data.length+1,4)),")");case 1:return e.def(s.props,n.data);case 2:return e.def(s.context,n.data);case 3:return e.def("this",n.data);case 4:return n.data.append(t,e),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return t.invoke(e,n)}))}},t.attribCache={};var f={};return t.scopeAttrib=function(e){var t=r.id(e);if(t in f)return f[t];var n=h.scope[t];return n||(n=h.scope[t]=new m),f[t]=i(n)},t}function F(e,t,n,u,c){var p=e.static,d=e.dynamic;E.optional((function(){var e=[Ge,We,Ye,Xe,Ze,Ke,qe,Qe,He,$e].concat(C);function t(t){Object.keys(t).forEach((function(t){E.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',c.commandStr)}))}t(p),t(d)}));var v=function(e,t){var n=e.static;if("string"==typeof n[Ye]&&"string"==typeof n[We]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)E("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),g=function(e,t){var n=e.static,r=e.dynamic;if(Ge in n){var i=n[Ge];return i?(i=l.getFramebuffer(i),E.command(i,"invalid framebuffer object"),ft((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+Je,n+".width"),t.set(o,"."+et,n+".height"),n}))):ft((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Je,r+".drawingBufferWidth"),t.set(r,"."+et,r+".drawingBufferHeight"),"null"}))}if(Ge in r){var o=r[Ge];return pt(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");E.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+Je,a+"?"+a+".width:"+s+".drawingBufferWidth"),t.set(s,"."+et,a+"?"+a+".height:"+s+".drawingBufferHeight"),a}))}return null}(e),b=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];E.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,E.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,E.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new ct(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",Je,"-",l));var i=s;return"height"in o||(i=t.def(n,".",et,"-",c)),[l,c,r,i]}))}if(e in i){var h=i[e],f=pt(h,(function(t,n){var r=t.invoke(n,h);E.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Je,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",et,"-",a,")");return E.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(f.thisDep=f.thisDep||t.thisDep,f.contextDep=f.contextDep||t.contextDep,f.propDep=f.propDep||t.propDep),f}return t?new ct(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Je),t.def(n,".",et)]})):null}var a=o("viewport");if(a){var s=a;a=new ct(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n}))}return{viewport:a,scissor_box:o("scissor.box")}}(e,g,c),x=function(e,t){var n=e.static,r=e.dynamic,i={},o=!1,a=function(){if($e in n){var e=n[$e];return null!==e&&null===h.getVAO(e)&&(e=h.createVAO(e)),o=!0,i.vao=e,ft((function(t){var n=h.getVAO(e);return n?t.link(n):"null"}))}if($e in r){o=!0;var t=r[$e];return pt(t,(function(e,n){var r=e.invoke(n,t);return n.def(e.shared.vao+".getVAO("+r+")")}))}return null}(),u=!1,l=function(){if(Xe in n){var e=n[Xe];if(i.elements=e,ut(e)){var l=i.elements=s.create(e,!0);e=s.getElements(l),u=!0}else e&&(e=s.getElements(e),u=!0,E.command(e,"invalid elements",t.commandStr));var c=ft((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return c.value=e,c}if(Xe in r){u=!0;var h=r[Xe];return pt(h,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,o=e.invoke(t,h),a=t.def("null"),s=t.def(r,"(",o,")"),u=e.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return E.optional((function(){e.assert(u.else,"!"+o+"||"+a,"invalid elements")})),t.entry(u),t.exit(e.cond(s).then(i,".destroyStream(",a,");")),e.ELEMENTS=a,a}))}return o?new ct(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")})):null}();function c(e,s){if(e in n){var l=0|n[e];return s?i.offset=l:i.instances=l,E.command(!s||l>=0,"invalid "+e,t.commandStr),ft((function(e,t){return s&&(e.OFFSET=l),l}))}if(e in r){var c=r[e];return pt(c,(function(t,n){var r=t.invoke(n,c);return s&&(t.OFFSET=r,E.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}if(s){if(u)return ft((function(e,t){return e.OFFSET=0,0}));if(o)return new ct(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")}))}else if(o)return new ct(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")}));return null}var f=c(Ke,!0),p=function(){if(Ze in n){var e=n[Ze];return i.primitive=e,E.commandParameter(e,$,"invalid primitve",t.commandStr),ft((function(t,n){return $[e]}))}if(Ze in r){var s=r[Ze];return pt(s,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,s);return E.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys($))})),t.def(n,"[",r,"]")}))}return u?ht(l)?l.value?ft((function(e,t){return t.def(e.ELEMENTS,".primType")})):ft((function(){return 4})):new ct(l.thisDep,l.contextDep,l.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):o?new ct(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:4")})):null}(),d=function(){if(qe in n){var e=0|n[qe];return i.count=e,E.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),ft((function(){return e}))}if(qe in r){var s=r[qe];return pt(s,(function(e,t){var n=e.invoke(t,s);return E.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(u){if(ht(l)){if(l)return f?new ct(f.thisDep,f.contextDep,f.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return E.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):ft((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var c=ft((function(){return-1}));return E.optional((function(){c.MISSING=!0})),c}var h=new ct(l.thisDep||f.thisDep,l.contextDep||f.contextDep,l.propDep||f.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return E.optional((function(){h.DYNAMIC=!0})),h}return o?new ct(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")})):null}(),v=c(Qe,!1);return{elements:l,primitive:p,count:d,instances:v,offset:f,vao:a,vaoActive:o,elementsActive:u,static:i}}(e,c),S=function(e,t){var n=e.static,r=e.dynamic,i={};return C.forEach((function(e){var a=k(e);function s(t,o){if(e in n){var s=t(n[e]);i[a]=ft((function(){return s}))}else if(e in r){var u=r[e];i[a]=pt(u,(function(e,t){return o(e,t,e.invoke(t,u))}))}}switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return s((function(n){return E.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return E.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case"depth.func":return s((function(n){return E.commandParameter(n,it,"invalid "+e,t.commandStr),it[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return E.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(it))})),n.def(i,"[",r,"]")}));case"depth.range":return s((function(e){return E.command(ne(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return E.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case"blend.func":return s((function(e){E.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return E.commandParameter(n,nt,a+".srcRGB",t.commandStr),E.commandParameter(r,nt,a+".srcAlpha",t.commandStr),E.commandParameter(i,nt,a+".dstRGB",t.commandStr),E.commandParameter(o,nt,a+".dstAlpha",t.commandStr),E.command(-1===rt.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[nt[n],nt[i],nt[r],nt[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return E.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(nt))})),s}E.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");E.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case"blend.equation":return s((function(n){return"string"==typeof n?(E.commandParameter(n,y,"invalid "+e,t.commandStr),[y[n],y[n]]):"object"==typeof n?(E.commandParameter(n.rgb,y,e+".rgb",t.commandStr),E.commandParameter(n.alpha,y,e+".alpha",t.commandStr),[y[n.rgb],y[n.alpha]]):void E.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return E.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case"blend.color":return s((function(e){return E.command(ne(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),N(4,(function(t){return+e[t]}))}),(function(e,t,n){return E.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),N(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case"stencil.mask":return s((function(e){return E.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,n){return E.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case"stencil.func":return s((function(n){E.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return E.commandParameter(r,it,e+".cmp",t.commandStr),E.commandType(i,"number",e+".ref",t.commandStr),E.commandType(o,"number",e+".mask",t.commandStr),[it[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return E.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",7680),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return s((function(n){E.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return E.commandParameter(r,ot,e+".fail",t.commandStr),E.commandParameter(i,ot,e+".zfail",t.commandStr),E.commandParameter(o,ot,e+".zpass",t.commandStr),["stencil.opBack"===e?1029:1028,ot[r],ot[i],ot[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return E.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(ot))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",7680)}return E.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),["stencil.opBack"===e?1029:1028,o("fail"),o("zfail"),o("zpass")]}));case"polygonOffset.offset":return s((function(e){E.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return E.commandType(n,"number",a+".factor",t.commandStr),E.commandType(r,"number",a+".units",t.commandStr),[n,r]}),(function(t,n,r){return E.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case"cull.face":return s((function(e){var n=0;return"front"===e?n=1028:"back"===e&&(n=1029),E.command(!!n,a,t.commandStr),n}),(function(e,t,n){return E.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',1028,":",1029)}));case"lineWidth":return s((function(e){return E.command("number"==typeof e&&e>=o.lineWidthDims[0]&&e<=o.lineWidthDims[1],"invalid line width, must be a positive number between "+o.lineWidthDims[0]+" and "+o.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return E.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+o.lineWidthDims[0]+"&&"+n+"<="+o.lineWidthDims[1],"invalid line width")})),n}));case"frontFace":return s((function(e){return E.commandParameter(e,st,a,t.commandStr),st[e]}),(function(e,t,n){return E.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:2305')}));case"colorMask":return s((function(e){return E.command(ne(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return E.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),N(4,(function(e){return"!!"+n+"["+e+"]"}))}));case"sample.coverage":return s((function(e){E.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return E.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return E.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),i}(e,c),A=function(e,t,n){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=r.id(i[e]);E.optional((function(){f.shader(at[e],t,E.guessCommand())}));var n=ft((function(){return t}));return n.id=t,n}if(e in o){var a=o[e];return pt(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return E.optional((function(){n(t.shared.shader,".shader(",at[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(Ye),l=a(We),c=null;return ht(u)&&ht(l)?(c=f.program(l.id,u.id,null,n),s=ft((function(e,t){return e.link(c)}))):s=new ct(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",Ye);var i=r+".program("+(l?l.append(e,t):t.def(r,".",We))+","+n;return E.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}(e,0,v);function T(e){var t=b[e];t&&(S[e]=t)}T("viewport"),T(k("scissor.box"));var w=Object.keys(S).length>0,M={framebuffer:g,draw:x,shader:A,state:S,dirty:w,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(M.profile=function(e){var t,n=e.static,r=e.dynamic;if(He in n){var i=!!n[He];(t=ft((function(e,t){return i}))).enable=i}else if(He in r){var o=r[He];t=pt(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),M.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=ft((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=ft((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(E.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=ft((function(e){return e.link(o.color[0])}))):E.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else ne(o)?r=ft((function(t){return t.global.def("[",N(o.length,(function(n){return E.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):E.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=pt(t,(function(e,n){return e.invoke(n,t)}))})),i}(n,c),M.drawVAO=M.scopeVAO=x.vao,!M.drawVAO&&A.program&&!v&&i.angle_instanced_arrays&&x.static.elements){var O=!0,P=A.program.attributes.map((function(e){var n=t.static[e];return O=O&&!!n,n}));if(O&&P.length>0){var L=h.getVAO(h.createVAO({attributes:P,elements:x.static.elements}));M.drawVAO=new ct(null,null,null,(function(e,t){return e.link(L)})),M.useVAO=!0}}return v?M.useVAO=!0:M.attributes=function(e,t){var n=e.static,i=e.dynamic,o={};return Object.keys(n).forEach((function(e){var i=n[e],s=r.id(e),u=new m;if(ut(i))u.state=1,u.buffer=a.getBuffer(a.create(i,34962,!1,!0)),u.type=0;else{var l=a.getBuffer(i);if(l)u.state=1,u.buffer=l,u.type=0;else if(E.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=2,"number"==typeof c?u.x=c:(E.command(ne(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,t.commandStr),Ve.forEach((function(e,t){t<c.length&&(u[e]=c[t])})))}else{l=ut(i.buffer)?a.getBuffer(a.create(i.buffer,34962,!1,!0)):a.getBuffer(i.buffer),E.command(!!l,'missing buffer for attribute "'+e+'"',t.commandStr);var h=0|i.offset;E.command(h>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var f=0|i.stride;E.command(f>=0&&f<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var p=0|i.size;E.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var d=!!i.normalized,v=0;"type"in i&&(E.commandParameter(i.type,G,"invalid type for attribute "+e,t.commandStr),v=G[i.type]);var g=0|i.divisor;E.optional((function(){"divisor"in i&&(E.command(0===g||_,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),E.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr));var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){E.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),u.buffer=l,u.state=1,u.size=p,u.normalized=d,u.type=v||l.dtype,u.offset=h,u.stride=f,u.divisor=g}}o[e]=ft((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];o[e]=pt(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;E.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=1,Object.keys(c).forEach((function(e){l[e]=r.def(""+c[e])}));var h=l.buffer,f=l.type;function p(e){r(l[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",h,"=",u,".createStream(",34962,",",i,");",f,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",2,";","if(typeof "+i+'.constant === "number"){',l[Ve[0]],"=",i,".constant;",Ve.slice(1).map((function(e){return l[e]})).join("="),"=0;","}else{",Ve.map((function(e,t){return l[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",34962,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",l.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",h,");","}"),l}))})),o}(t,c),M.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=ft((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=pt(t,(function(e,n){return e.invoke(n,t)}))})),r}(u),M}function B(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o].append(e,t);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),t(i)}function z(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,l=e.constants,c=l.drawBuffer,h=l.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),b&&t(i,".drawBuffersWEBGL(",h,");"),t("}",s,".cur=",u,";"),r||t("}")}function j(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,l=e.cond(s,".dirty");C.forEach((function(t){var r,c,h=k(t);if(!(h in n.state))if(h in a){r=a[h],c=o[h];var f=N(S[h].length,(function(e){return l.def(r,"[",e,"]")}));l(e.cond(f.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(i,".",w[h],"(",f,");",f.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{r=l.def(u,".",h);var p=e.cond(r,"!==",s,".",h);l(p),h in T?p(e.cond(r).then(i,".enable(",T[h],");").else(i,".disable(",T[h],");"),s,".",h,"=",r,";"):p(i,".",w[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),t(l)}function U(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;lt(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(e,t);if(T[i]){var c=T[i];ht(u)?t(s,l?".enable(":".disable(",c,");"):t(e.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),t(a,".",i,"=",l,";")}else if(ne(l)){var h=o[i];t(s,".",w[i],"(",l,");",l.map((function(e,t){return h+"["+t+"]="+e})).join(";"),";")}else t(s,".",w[i],"(",l,");",a,".",i,"=",l,";")}}))}function V(e,t){_&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function H(e,t,n,r,i){var o,a,s,u=e.shared,l=e.stats,c=u.current,h=u.timer,f=n.profile;function p(){return"undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM||"undefined"==typeof performance?"Date.now()":"performance.now()"}function d(e){e(o=t.def(),"=",p(),";"),"string"==typeof i?e(l,".count+=",i,";"):e(l,".count++;"),v&&(r?e(a=t.def(),"=",h,".getNumPendingQueries();"):e(h,".beginQuery(",l,");"))}function g(e){e(l,".cpuTime+=",p(),"-",o,";"),v&&(r?e(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",l,");"):e(h,".endQuery();"))}function m(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(f){if(ht(f))return void(f.enable?(d(t),g(t.exit),m("true")):m("false"));m(s=f.append(e,t))}else s=t.def(c,".profile");var y=e.block();d(y),t("if(",s,"){",y,"}");var _=e.block();g(_),t.exit("if(",s,"){",_,"}")}function W(e,t,n,r,i){var o=e.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(dt))return;var l=e.scopeAttrib(s);E.optional((function(){e.assert(t,l+".state","missing attribute "+s)})),a={},Object.keys(new m).forEach((function(e){a[e]=t.def(l,".",e)}))}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,h=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function p(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",f.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",34962,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",f.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),_){var l=i.divisor;t("if(",u,".divisor!==",l,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Ve.map((function(e,t){return u+"."+e+"!=="+h[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",Ve.map((function(e,t){return u+"."+e+"="+h[t]+";"})).join(""),"}")}1===l?p():2===l?d():(t("if(",l,"===",1,"){"),p(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(r.info.type),a)}))}function Y(e,t,n,i,o,a){for(var s,u=e.shared,l=u.gl,c=0;c<i.length;++c){var h,f=i[c],p=f.name,d=f.info.type,v=n.uniforms[p],g=e.link(f)+".location";if(v){if(!o(v))continue;if(ht(v)){var m=v.value;if(E.command(null!=m,'missing uniform "'+p+'"',e.commandStr),35678===d||35680===d){E.command("function"==typeof m&&(35678===d&&("texture2d"===m._reglType||"framebuffer"===m._reglType)||35680===d&&("textureCube"===m._reglType||"framebufferCube"===m._reglType)),"invalid texture for uniform "+p,e.commandStr);var y=e.link(m._texture||m.color[0]._texture);t(l,".uniform1i(",g,",",y+".bind());"),t.exit(y,".unbind();")}else if(35674===d||35675===d||35676===d){E.optional((function(){E.command(ne(m),"invalid matrix for uniform "+p,e.commandStr),E.command(35674===d&&4===m.length||35675===d&&9===m.length||35676===d&&16===m.length,"invalid length for matrix uniform "+p,e.commandStr)}));var _=e.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),b=2;35675===d?b=3:35676===d&&(b=4),t(l,".uniformMatrix",b,"fv(",g,",false,",_,");")}else{switch(d){case 5126:E.commandType(m,"number","uniform "+p,e.commandStr),s="1f";break;case 35664:E.command(ne(m)&&2===m.length,"uniform "+p,e.commandStr),s="2f";break;case 35665:E.command(ne(m)&&3===m.length,"uniform "+p,e.commandStr),s="3f";break;case 35666:E.command(ne(m)&&4===m.length,"uniform "+p,e.commandStr),s="4f";break;case 35670:E.commandType(m,"boolean","uniform "+p,e.commandStr),s="1i";break;case 5124:E.commandType(m,"number","uniform "+p,e.commandStr),s="1i";break;case 35671:case 35667:E.command(ne(m)&&2===m.length,"uniform "+p,e.commandStr),s="2i";break;case 35672:case 35668:E.command(ne(m)&&3===m.length,"uniform "+p,e.commandStr),s="3i";break;case 35673:case 35669:E.command(ne(m)&&4===m.length,"uniform "+p,e.commandStr),s="4i"}t(l,".uniform",s,"(",g,",",ne(m)?Array.prototype.slice.call(m):m,");")}continue}h=v.append(e,t)}else{if(!o(dt))continue;h=t.def(u.uniforms,"[",r.id(p),"]")}35678===d?(E(!Array.isArray(h),"must specify a scalar prop for textures"),t("if(",h,"&&",h,'._reglType==="framebuffer"){',h,"=",h,".color[0];","}")):35680===d&&(E(!Array.isArray(h),"must specify a scalar prop for cube maps"),t("if(",h,"&&",h,'._reglType==="framebufferCube"){',h,"=",h,".color[0];","}")),E.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+p+'".  '+r)}function r(e){E(!Array.isArray(h),"must not specify an array type for uniform"),n("typeof "+h+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){Array.isArray(h)?E(h.length===t,"must have length "+t):n(u.isArrayLike+"("+h+")&&"+h+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){E(!Array.isArray(h),"must not specify a value type"),n("typeof "+h+'==="function"&&'+h+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(d){case 5124:r("number");break;case 35667:i(2);break;case 35668:i(3);break;case 35669:i(4);break;case 5126:r("number");break;case 35664:i(2);break;case 35665:i(3);break;case 35666:i(4);break;case 35670:r("boolean");break;case 35671:i(2);break;case 35672:i(3);break;case 35673:case 35674:i(4);break;case 35675:i(9);break;case 35676:i(16);break;case 35678:o(3553);break;case 35680:o(34067)}}));var x=1;switch(d){case 35678:case 35680:var S=t.def(h,"._texture");t(l,".uniform1i(",g,",",S,".bind());"),t.exit(S,".unbind();");continue;case 5124:case 35670:s="1i";break;case 35667:case 35671:s="2i",x=2;break;case 35668:case 35672:s="3i",x=3;break;case 35669:case 35673:s="4i",x=4;break;case 5126:s="1f";break;case 35664:s="2f",x=2;break;case 35665:s="3f",x=3;break;case 35666:s="4f",x=4;break;case 35674:s="Matrix2fv";break;case 35675:s="Matrix3fv";break;case 35676:s="Matrix4fv"}if("M"===s.charAt(0)){t(l,".uniform",s,"(",g,",");var A=Math.pow(d-35674+2,2),C=e.global.def("new Float32Array(",A,")");Array.isArray(h)?t("false,(",N(A,(function(e){return C+"["+e+"]="+h[e]})),",",C,")"):t("false,(Array.isArray(",h,")||",h," instanceof Float32Array)?",h,":(",N(A,(function(e){return C+"["+e+"]="+h+"["+e+"]"})),",",C,")"),t(");")}else if(x>1){for(var T=[],w=[],M=0;M<x;++M)Array.isArray(h)?w.push(h[M]):w.push(t.def(h+"["+M+"]")),a&&T.push(t.def());a&&t("if(!",e.batchId,"||",T.map((function(e,t){return e+"!=="+w[t]})).join("||"),"){",T.map((function(e,t){return e+"="+w[t]+";"})).join("")),t(l,".uniform",s,"(",g,",",w.join(","),");"),a&&t("}")}else{if(E(!Array.isArray(h),"uniform value must not be an array"),a){var k=t.def();t("if(!",e.batchId,"||",k,"!==",h,"){",k,"=",h,";")}t(l,".uniform",s,"(",g,",",h,");"),a&&t("}")}}}function X(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw,u=function(){var u,l=s.elements,c=t;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(c=n),u=l.append(e,c),s.elementsActive&&c("if("+u+")"+o+".bindBuffer(34963,"+u+".buffer.buffer);")):(u=c.def(),c(u,"=",a,".",Xe,";","if(",u,"){",o,".bindBuffer(",34963,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",e.shared.elements+".getElements("+i.vao,".currentVAO.elements);",x?"":"if("+u+")"+o+".bindBuffer(34963,"+u+".buffer.buffer);","}")),u}();function l(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var c,h,f=l(Ze),p=l(Ke),d=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),E.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",qe),E.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");_&&(c=l(Qe),h=e.instancing);var v=u+".type",g=s.elements&&ht(s.elements)&&!s.vaoActive;function m(){function e(){n(h,".drawElementsInstancedANGLE(",[f,d,v,p+"<<(("+v+"-5121)>>1)",c],");")}function t(){n(h,".drawArraysInstancedANGLE(",[f,p,d,c],");")}u&&"null"!==u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function y(){function e(){n(o+".drawElements("+[f,d,v,p+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(o+".drawArrays("+[f,p,d]+");")}u&&"null"!==u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}_&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),m(),n("}else if(",c,"<0){"),y(),n("}")):m():y()}function Z(e,t,n,r,i){var o=D(),a=o.proc("body",i);return E.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),_&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function q(e,t,n,r){V(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),W(e,t,n,r.attributes,(function(){return!0}))),Y(e,t,n,r.uniforms,(function(){return!0}),!1),X(e,t,t,n)}function K(e,t,n,r){function i(){return!0}e.batchId="a1",V(e,t),W(e,t,n,r.attributes,i),Y(e,t,n,r.uniforms,i,!1),X(e,t,t,n)}function Q(e,t,n,r){V(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function l(e){return e.contextDep&&i||e.propDep}function c(e){return!l(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&B(e,u,n.context),n.needsFramebuffer&&z(e,u,n.framebuffer),U(e,u,n.state,l),n.profile&&l(n.profile)&&H(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),W(e,s,n,r.attributes,c),W(e,u,n,r.attributes,l)),Y(e,s,n,r.uniforms,c,!1),Y(e,u,n,r.uniforms,l,!0),X(e,s,u,n);else{var h=e.global.def("{}"),f=n.shader.progVar.append(e,u),p=u.def(f,".id"),d=u.def(h,"[",p,"]");u(e.shared.gl,".useProgram(",f,".program);","if(!",d,"){",d,"=",h,"[",p,"]=",e.link((function(t){return Z(K,e,n,t,2)})),"(",f,");}",d,".call(this,a0[",o,"],",o,");")}}function J(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!ne(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(M.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,l=e.global.def("{}");o.forEach((function(t){var n=r[t];if(M.isDynamic(n)){"function"==typeof n&&(n=r[t]=M.unbox(n));var o=pt(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(l,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new M.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:l,append:function(e,t){o.forEach((function(n){var i=r[n];if(M.isDynamic(i)){var o=e.invoke(t,i);t(l,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:A,current:S,procs:function(){var e=D(),t=e.proc("poll"),n=e.proc("refresh"),r=e.block();t(r),n(r);var a,s=e.shared,u=s.gl,l=s.next,c=s.current;r(c,".dirty=false;"),z(e,t),z(e,n,null,!0),_&&(a=e.link(_)),i.oes_vertex_array_object&&n(e.link(i.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<o.maxAttributes;++h){var f=n.def(s.attributes,"[",h,"]"),p=e.cond(f,".buffer");p.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",34962,",",f,".buffer.buffer);",u,".vertexAttribPointer(",h,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(p),_&&n(a,".vertexAttribDivisorANGLE(",h,",",f,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(T).forEach((function(i){var o=T[i],a=r.def(l,".",i),s=e.block();s("if(",a,"){",u,".enable(",o,")}else{",u,".disable(",o,")}",c,".",i,"=",a,";"),n(s),t("if(",a,"!==",c,".",i,"){",s,"}")})),Object.keys(w).forEach((function(i){var o,a,s=w[i],h=S[i],f=e.block();if(f(u,".",s,"("),ne(h)){var p=h.length;o=e.global.def(l,".",i),a=e.global.def(c,".",i),f(N(p,(function(e){return o+"["+e+"]"})),");",N(p,(function(e){return a+"["+e+"]="+o+"["+e+"];"})).join("")),t("if(",N(p,(function(e){return o+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",f,"}")}else o=r.def(l,".",i),a=r.def(c,".",i),f(o,");",c,".",i,"=",o,";"),t("if(",o,"!==",a,"){",f,"}");n(f)})),e.compile()}(),compile:function(e,t,i,o,a){var s=D();s.stats=s.link(a),Object.keys(t.static).forEach((function(e){J(s,t,e)})),tt.forEach((function(t){J(s,e,t)}));var u=F(e,t,i,o,s);return function(e,t){var n=e.proc("draw",1);V(e,n),B(e,n,t.context),z(e,n,t.framebuffer),j(e,n,t),U(e,n,t.state),H(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return Z(q,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}(s,u),function(e,t){var n=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(r){var o=t.shader[r];o&&n.set(i.shader,"."+r,o.append(e,n))}B(e,n,t.context),t.framebuffer&&t.framebuffer.append(e,n),lt(Object.keys(t.state)).forEach((function(r){var o=t.state[r].append(e,n);ne(o)?o.forEach((function(t,i){n.set(e.next[r],"["+i+"]",t)})):n.set(i.next,"."+r,o)})),H(e,n,t,!0,!0),[Xe,Ke,qe,Qe,Ze].forEach((function(r){var o=t.draw[r];o&&n.set(i.draw,"."+r,""+o.append(e,n))})),Object.keys(t.uniforms).forEach((function(o){var a=t.uniforms[o].append(e,n);Array.isArray(a)&&(a="["+a.join()+"]"),n.set(i.uniforms,"["+r.id(o)+"]",a)})),Object.keys(t.attributes).forEach((function(r){var i=t.attributes[r].append(e,n),o=e.scopeAttrib(r);Object.keys(new m).forEach((function(e){n.set(o,"."+e,i[e])}))})),t.scopeVAO&&n.set(i.vao,".targetVAO",t.scopeVAO.append(e,n)),a(We),a(Ye),Object.keys(t.state).length>0&&(n(o,".dirty=true;"),n.exit(o,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}(s,u),function(e,t){var n=e.proc("batch",2);e.batchId="0",V(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(B(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||z(e,n,o)):z(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),j(e,n,t),U(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||H(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)Q(e,n,t,null);else{var l=u.append(e,n);if(n(e.shared.gl,".useProgram(",l,".program);"),t.shader.program)Q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),h=n.def(l,".id"),f=n.def(c,"[",h,"]");n(e.cond(f).then(f,".call(this,a0,a1);").else(f,"=",c,"[",h,"]=",e.link((function(n){return Z(Q,e,t,n,2)})),"(",l,");",f,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}(s,u),n(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var gt=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function l(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var c=[],h=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),l(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:l,update:function(){var e,n,o=i.length;if(0!==o){h.length=Math.max(h.length,o+1),c.length=Math.max(c.length,o+1),c[0]=0,h[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var l=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),r(l)):i[e++]=l,c[n+1]=a,h[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var f=u[n],p=f.startQueryIndex,d=f.endQueryIndex;f.sum+=c[d]-c[p];var v=h[p],g=h[d];g===v?(f.stats.gpuTime+=f.sum/1e6,s(f)):(f.startQueryIndex=v,f.endQueryIndex=g,u[e++]=f)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}};function mt(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(e){var r=I(e);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=R(i,r);if(!s)return null;var u,l,c=(u={"":0},l=[""],{id:function(e){var t=u[e];return t||(t=u[e]=l.length,l.push(e),t)},str:function(e){return l[e]}}),h={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},f=s.extensions,p=gt(0,f),d=O(),v=i.drawingBufferWidth,g=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:v,viewportHeight:g,framebufferWidth:v,framebufferHeight:g,drawingBufferWidth:v,drawingBufferHeight:g,pixelRatio:r.pixelRatio},y={elements:null,primitive:4,count:-1,offset:0,instances:-1},_=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=B.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),B.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=e.createTexture(),h=B.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,6408,3,3,0,6408,5121,h),B.freeType(h),e.bindTexture(34067,null),e.deleteTexture(c),l=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:l}}(i,f),b=function(e,n,r,i){var o=0,a={};function s(t){this.id=o++,this.buffer=e.createBuffer(),this.type=t,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function l(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function c(e,n,r,i,o,a){var s,u;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||5126,n.length>0)if(Array.isArray(n[0])){s=X(n);for(var c=1,h=1;h<s.length;++h)c*=s[h];e.dimension=c,l(e,u=Y(n,s,e.dtype),r),a?e.persistentData=u:B.freeType(u)}else if("number"==typeof n[0]){e.dimension=o;var f=B.allocType(e.dtype,n.length);K(f,n),l(e,f,r),a?e.persistentData=f:B.freeType(f)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||q(n[0])||5126,l(e,u=Y(n,[n.length,n[0].length],e.dtype),r),a?e.persistentData=u:B.freeType(u)):E.raise("invalid buffer data")}else if(t(n))e.dtype=i||q(n),e.dimension=o,l(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(z(n)){s=n.shape;var p=n.stride,d=n.offset,v=0,g=0,m=0,y=0;1===s.length?(v=s[0],g=1,m=p[0],y=0):2===s.length?(v=s[0],g=s[1],m=p[0],y=p[1]):E.raise("invalid shape"),e.dtype=i||q(n.data)||5126,e.dimension=g;var _=B.allocType(e.dtype,v*g);Q(_,n.data,v,g,m,y,d),l(e,_,r),a?e.persistentData=_:B.freeType(_)}else n instanceof ArrayBuffer?(e.dtype=5121,e.dimension=o,l(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):E.raise("invalid buffer data")}function h(t){n.bufferCount--,i(t);var r=t.buffer;E(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete a[t.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,u,l){n.bufferCount++;var f=new s(o);function p(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||t(n)||z(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(E.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(E(null===o||Array.isArray(o)||t(o)||z(o),"invalid data for buffer"),o=n.data),"usage"in n&&(E.parameter(n.usage,W,"invalid buffer usage"),i=W[n.usage]),"type"in n&&(E.parameter(n.type,G,"invalid buffer type"),s=G[n.type]),"dimension"in n&&(E.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(E.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),f.bind(),o?c(f,o,i,s,u,l):(a&&e.bufferData(f.type,a,i),f.dtype=s||5121,f.usage=i,f.dimension=u,f.byteLength=a),r.profile&&(f.stats.size=f.byteLength*Z[f.dtype]),p}function d(t,n){E(n+t.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),e.bufferSubData(f.type,n,t)}return a[f.id]=f,u||p(i),p._reglType="buffer",p._buffer=f,p.subdata=function(e,n){var r,i=0|(n||0);if(f.bind(),t(e)||e instanceof ArrayBuffer)d(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var o=B.allocType(f.dtype,e.length);K(o,e),d(o,i),B.freeType(o)}else if(Array.isArray(e[0])||t(e[0])){r=X(e);var a=Y(e,r,f.dtype);d(a,i),B.freeType(a)}else E.raise("invalid buffer data")}else if(z(e)){r=e.shape;var s=e.stride,u=0,l=0,c=0,h=0;1===r.length?(u=r[0],l=1,c=s[0],h=0):2===r.length?(u=r[0],l=r[1],c=s[0],h=s[1]):E.raise("invalid shape");var v=Array.isArray(e.data)?f.dtype:q(e.data),g=B.allocType(v,u*l);Q(g,e.data,u,l,c,h,e.offset),d(g,i),B.freeType(g)}else E.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=f.stats),p.destroy=function(){h(f)},p},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),c(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){j(a).forEach(h),u.forEach(h)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){j(a).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))},_initBuffer:c}}(i,h,r,(function(e){return S.destroyBuffer(e)})),x=function(e,n,r,i){var o={},a=0,s={uint8:5121,uint16:5123};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=5125),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(i,o,a,s,u,l,c){var h;if(i.buffer.bind(),o){var f=c;c||t(o)&&(!z(o)||t(o.data))||(f=n.oes_element_index_uint?5125:5123),r._initBuffer(i.buffer,o,a,f,3)}else e.bufferData(34963,l,a),i.buffer.dtype=h||5121,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(h=c,!c){switch(i.buffer.dtype){case 5121:case 5120:h=5121;break;case 5123:case 5122:h=5123;break;case 5125:case 5124:h=5125;break;default:E.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,E(5125!==h||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,5123===h?p>>=1:5125===h&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var v=i.buffer.dimension;1===v&&(d=0),2===v&&(d=1),3===v&&(d=4)}i.primType=d}function h(e){i.elementsCount--,E(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(e,n){var o=r.create(null,34963,!0),a=new u(o._buffer);function l(e){if(e)if("number"==typeof e)o(e),a.primType=4,a.vertCount=0|e,a.type=5121;else{var n=null,r=35044,i=-1,u=-1,h=0,f=0;Array.isArray(e)||t(e)||z(e)?n=e:(E.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,E(Array.isArray(n)||t(n)||z(n),"invalid data for element buffer")),"usage"in e&&(E.parameter(e.usage,W,"invalid element buffer usage"),r=W[e.usage]),"primitive"in e&&(E.parameter(e.primitive,$,"invalid element buffer primitive"),i=$[e.primitive]),"count"in e&&(E("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(E.parameter(e.type,s,"invalid buffer type"),f=s[e.type]),"length"in e?h=0|e.length:(h=u,5123===f||5122===f?h*=2:5125!==f&&5124!==f||(h*=4))),c(a,n,r,i,u,h,f)}else o(),a.primType=4,a.vertCount=0,a.type=5121;return l}return i.elementsCount++,l(e),l._reglType="elements",l._elements=a,l.subdata=function(e,t){return o.subdata(e,t),l},l.destroy=function(){h(a)},l},createStream:function(e){var t=l.pop();return t||(t=new u(r.create(null,34963,!0,!1)._buffer)),c(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){l.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){j(o).forEach(h)}}}(i,f,b,h),S=function(e,n,r,i,o,a,s){for(var u=r.maxAttributes,l=new Array(u),c=0;c<u;++c)l[c]=new Be;var h=0,f={},p={Record:Be,scope:{},state:l,currentVAO:null,targetVAO:null,restore:d()?function(){d()&&j(f).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(e){var r=new g;function s(e){var i;if(Array.isArray(e))i=e,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(E("object"==typeof e,"invalid arguments for create vao"),E("attributes"in e,"must specify attributes for vao"),e.elements){var l=e.elements;r.ownsElements?"function"==typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):a.getElements(e.elements)?(r.elements=e.elements,r.ownsElements=!1):(r.elements=a.create(e.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=e.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in e&&(r.offset=0|e.offset),"count"in e&&(r.count=0|e.count),"instances"in e&&(r.instances=0|e.instances),"primitive"in e&&(E(e.primitive in $,"bad primitive type: "+e.primitive),r.primitive=$[e.primitive]),E.optional((function(){for(var t=Object.keys(e),n=0;n<t.length;++n)E(Fe.indexOf(t[n])>=0,'invalid option for vao: "'+t[n]+'" valid options are '+Fe)})),E(Array.isArray(i),"attributes must be an array")}E(i.length<u,"too many attributes"),E(i.length>0,"must specify at least one attribute");var c={},h=r.attributes;h.length=i.length;for(var f=0;f<i.length;++f){var p,d=i[f],v=h[f]=new Be,g=d.data||d;Array.isArray(g)||t(g)||z(g)?(r.buffers[f]&&(p=r.buffers[f],t(g)&&p._buffer.byteLength>=g.byteLength?p.subdata(g):(p.destroy(),r.buffers[f]=null)),r.buffers[f]||(p=r.buffers[f]=o.create(d,34962,!1,!0)),v.buffer=o.getBuffer(p),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1,c[f]=1):o.getBuffer(d)?(v.buffer=o.getBuffer(d),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1):o.getBuffer(d.buffer)?(v.buffer=o.getBuffer(d.buffer),v.size=0|(+d.size||v.buffer.dimension),v.normalized=!!d.normalized||!1,"type"in d?(E.parameter(d.type,G,"invalid buffer type"),v.type=G[d.type]):v.type=v.buffer.dtype,v.offset=0|(d.offset||0),v.stride=0|(d.stride||0),v.divisor=0|(d.divisor||0),v.state=1,E(v.size>=1&&v.size<=4,"size must be between 1 and 4"),E(v.offset>=0,"invalid offset"),E(v.stride>=0&&v.stride<=255,"stride must be between 0 and 255"),E(v.divisor>=0,"divisor must be positive"),E(!v.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(E(f>0,"first attribute must not be a constant"),v.x=+d.x||0,v.y=+d.y||0,v.z=+d.z||0,v.w=+d.w||0,v.state=2):E(!1,"invalid attribute spec for location "+f)}for(var m=0;m<r.buffers.length;++m)!c[m]&&r.buffers[m]&&(r.buffers[m].destroy(),r.buffers[m]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(e)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(t){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}},setVAO:d()?function(e){if(e!==p.currentVAO){var t=d();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),p.currentVAO=e}}:function(t){if(t!==p.currentVAO){if(t)t.bindAttrs();else{for(var n=v(),r=0;r<l.length;++r){var i=l[r];i.buffer?(e.enableVertexAttribArray(r),i.buffer.bind(),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?e.bindBuffer(34963,s.elements.buffer.buffer):e.bindBuffer(34963,null)}p.currentVAO=t}},clear:d()?function(){j(f).forEach((function(e){e.destroy()}))}:function(){}};function d(){return n.oes_vertex_array_object}function v(){return n.angle_instanced_arrays}function g(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var e=d();this.vao=e?e.createVertexArrayOES():null,f[this.id]=this,this.buffers=[]}return g.prototype.bindAttrs=function(){for(var t=v(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(34962,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<u;++o)e.disableVertexAttribArray(o);var s=a.getElements(this.elements);s?e.bindBuffer(34963,s.buffer.buffer):e.bindBuffer(34963,null)},g.prototype.refresh=function(){var e=d();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),p.currentVAO=null,e.bindVertexArrayOES(null))},g.prototype.destroy=function(){if(this.vao){var e=d();this===p.currentVAO&&(p.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),f[this.id]&&(delete f[this.id],i.vaoCount-=1)},p}(i,f,_,h,b,x,y),A=function(e,t,r,i){var o={},a={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function l(n,r,i){var s=35632===n?o:a,u=s[r];if(!u){var l=t.str(r);u=e.createShader(n),e.shaderSource(u,l),e.compileShader(u),E.shaderError(e,u,l,n,i),s[r]=u}return u}var c={},h=[],f=0;function p(e,t){this.id=f++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,o){var a,c,h=l(35632,n.fragId),f=l(35633,n.vertId),p=n.program=e.createProgram();if(e.attachShader(p,h),e.attachShader(p,f),o)for(a=0;a<o.length;++a){var d=o[a];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),E.linkError(e,p,t.str(n.fragId),t.str(n.vertId),r);var v=e.getProgramParameter(p,35718);i.profile&&(n.stats.uniformsCount=v);var g=n.uniforms;for(a=0;a<v;++a)if(c=e.getActiveUniform(p,a))if(c.size>1)for(var m=0;m<c.size;++m){var y=c.name.replace("[0]","["+m+"]");u(g,new s(y,t.id(y),e.getUniformLocation(p,y),c))}else u(g,new s(c.name,t.id(c.name),e.getUniformLocation(p,c.name),c));var _=e.getProgramParameter(p,35721);i.profile&&(n.stats.attributesCount=_);var b=n.attributes;for(a=0;a<_;++a)(c=e.getActiveAttrib(p,a))&&u(b,new s(c.name,t.id(c.name),e.getAttribLocation(p,c.name),c))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return h.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return h.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);j(o).forEach(t),o={},j(a).forEach(t),a={},h.forEach((function(t){e.deleteProgram(t.program)})),h.length=0,c={},r.shaderCount=0},program:function(t,i,s,u){E.command(t>=0,"missing vertex shader",s),E.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var f=l[t];if(f&&(f.refCount++,!u))return f;var v=new p(i,t);return r.shaderCount++,d(v,s,u),f||(l[t]=v),h.push(v),n(v,{destroy:function(){if(v.refCount--,v.refCount<=0){e.deleteProgram(v.program);var t=h.indexOf(v);h.splice(t,1),r.shaderCount--}l[v.vertId].refCount<=0&&(e.deleteShader(a[v.vertId]),delete a[v.vertId],delete c[v.fragId][v.vertId]),Object.keys(c[v.fragId]).length||(e.deleteShader(o[v.fragId]),delete o[v.fragId],delete c[v.fragId])}})},restore:function(){o={},a={};for(var e=0;e<h.length;++e)d(h[e],null,h[e].attributes.map((function(e){return[e.location,e.name]})))},shader:l,frag:-1,vert:-1}}(i,c,h,r),C=ke(i,f,_,(function(){P.procs.poll()}),m,h,r),T=function(e,t,n,r,i){var o={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var s=0,u={};function l(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(t){var n=t.renderbuffer;E(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:function(t,s){var c=new l(e.createRenderbuffer());function h(t,r){var s=0,u=0,l=32854;if("object"==typeof t&&t){var f=t;if("shape"in f){var p=f.shape;E(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),s=0|p[0],u=0|p[1]}else"radius"in f&&(s=u=0|f.radius),"width"in f&&(s=0|f.width),"height"in f&&(u=0|f.height);"format"in f&&(E.parameter(f.format,o,"invalid renderbuffer format"),l=o[f.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?E.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(E(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return h.width=c.width=s,h.height=c.height=u,c.format=l,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,l,s,u),E(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=Pe(c.format,c.width,c.height)),h.format=a[c.format],h}return u[c.id]=c,r.renderbufferCount++,h(t,s),h.resize=function(t,r){var o=0|t,a=0|r||o;return o===c.width&&a===c.height||(E(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=c.width=o,h.height=c.height=a,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,c.format,o,a),E(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=Pe(c.format,c.width,c.height))),h},h._reglType="renderbuffer",h._renderbuffer=c,i.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h},clear:function(){j(u).forEach(c)},restore:function(){j(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)})),e.bindRenderbuffer(36161,null)}}}(i,f,_,h,r),w=function(e,t,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&l.push("srgba"),t.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function h(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);E(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;E(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(36160,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,n.renderbuffer._renderbuffer.renderbuffer))}function v(e){var t=3553,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),E.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,E(3553===t)):"textureCube"===o?(n=i,E(t>=34069&&t<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,t=36161):E.raise("invalid regl object for attachment"),new h(t,n,r)}function g(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new h(3553,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new h(36161,null,u)}function m(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}t.oes_texture_half_float&&c.push("half float","float16"),t.oes_texture_float&&c.push("float","float32");var _=0,b={};function x(){this.id=_++,b[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function S(e){e.colorAttachments.forEach(f),f(e.depthAttachment),f(e.stencilAttachment),f(e.depthStencilAttachment)}function A(t){var n=t.framebuffer;E(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete b[t.id]}function C(t){var n;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)d(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(36160,36064+n,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),d(36096,t.depthAttachment),d(36128,t.stencilAttachment),d(33306,t.depthStencilAttachment);var o=e.checkFramebufferStatus(36160);e.isContextLost()||36053===o||E.raise("framebuffer configuration not supported, status = "+De[o]),e.bindFramebuffer(36160,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function T(e,i){var o=new x;function h(e,n){var i;E(s.next!==o,"can not update framebuffer which is currently in use");var a=0,f=0,d=!0,y=!0,_=null,b=!0,x="rgba",A="uint8",T=1,w=null,M=null,k=null,O=!1;if("number"==typeof e)a=0|e,f=0|n||a;else if(e){E.type(e,"object","invalid arguments for framebuffer");var P=e;if("shape"in P){var L=P.shape;E(Array.isArray(L)&&L.length>=2,"invalid shape for framebuffer"),a=L[0],f=L[1]}else"radius"in P&&(a=f=P.radius),"width"in P&&(a=P.width),"height"in P&&(f=P.height);("color"in P||"colors"in P)&&(_=P.color||P.colors,Array.isArray(_)&&E(1===_.length||t.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in P&&(T=0|P.colorCount,E(T>0,"invalid color buffer count")),"colorTexture"in P&&(b=!!P.colorTexture,x="rgba4"),"colorType"in P&&(A=P.colorType,b?(E(t.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),E(t.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(E(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==A&&"float32"!==A||(E(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),E.oneOf(A,c,"invalid color type")),"colorFormat"in P&&(x=P.colorFormat,u.indexOf(x)>=0?b=!0:l.indexOf(x)>=0?b=!1:E.optional((function(){b?E.oneOf(P.colorFormat,u,"invalid color format for texture"):E.oneOf(P.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in P||"depthStencilTexture"in P)&&(O=!(!P.depthTexture&&!P.depthStencilTexture),E(!O||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in P&&("boolean"==typeof P.depth?d=P.depth:(w=P.depth,y=!1)),"stencil"in P&&("boolean"==typeof P.stencil?y=P.stencil:(M=P.stencil,d=!1)),"depthStencil"in P&&("boolean"==typeof P.depthStencil?d=y=P.depthStencil:(k=P.depthStencil,d=!1,y=!1))}else a=f=1;var I=null,R=null,N=null,D=null;if(Array.isArray(_))I=_.map(v);else if(_)I=[v(_)];else for(I=new Array(T),i=0;i<T;++i)I[i]=g(a,f,b,x,A);E(t.webgl_draw_buffers||I.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),E(I.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||I[0].width,f=f||I[0].height,w?R=v(w):d&&!y&&(R=g(a,f,O,"depth","uint32")),M?N=v(M):y&&!d&&(N=g(a,f,!1,"stencil","uint8")),k?D=v(k):!w&&!M&&y&&d&&(D=g(a,f,O,"depth stencil","depth stencil")),E(!!w+!!M+!!k<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<I.length;++i)if(p(I[i],a,f),E(!I[i]||I[i].texture&&Le.indexOf(I[i].texture._texture.format)>=0||I[i].renderbuffer&&Ne.indexOf(I[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),I[i]&&I[i].texture){var B=Ie[I[i].texture._texture.format]*Re[I[i].texture._texture.type];null===F?F=B:E(F===B,"all color attachments much have the same number of bits per pixel.")}return p(R,a,f),E(!R||R.texture&&6402===R.texture._texture.format||R.renderbuffer&&33189===R.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),p(N,a,f),E(!N||N.renderbuffer&&36168===N.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),p(D,a,f),E(!D||D.texture&&34041===D.texture._texture.format||D.renderbuffer&&34041===D.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),S(o),o.width=a,o.height=f,o.colorAttachments=I,o.depthAttachment=R,o.stencilAttachment=N,o.depthStencilAttachment=D,h.color=I.map(m),h.depth=m(R),h.stencil=m(N),h.depthStencil=m(D),h.width=o.width,h.height=o.height,C(o),h}return a.framebufferCount++,h(e,i),n(h,{resize:function(e,t){E(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return h;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=h.width=n,o.height=h.height=r,C(o),h},_reglType:"framebuffer",_framebuffer:o,destroy:function(){A(o),S(o)},use:function(e){s.setFBO({framebuffer:h},e)}})}return n(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof x)return t}return null},create:T,createCube:function(e){var o=Array(6);function a(e){var r;E(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,h={color:null},f=0,p=null,d="rgba",v="uint8",g=1;if("number"==typeof e)f=0|e;else if(e){E.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;E(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),E(y[0]===y[1],"cube framebuffer must be square"),f=y[0]}else"radius"in m&&(f=0|m.radius),"width"in m?(f=0|m.width,"height"in m&&E(m.height===f,"must be square")):"height"in m&&(f=0|m.height);("color"in m||"colors"in m)&&(p=m.color||m.colors,Array.isArray(p)&&E(1===p.length||t.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in m&&(g=0|m.colorCount,E(g>0,"invalid color buffer count")),"colorType"in m&&(E.oneOf(m.colorType,c,"invalid color type"),v=m.colorType),"colorFormat"in m&&(d=m.colorFormat,E.oneOf(m.colorFormat,u,"invalid color format for texture"))),"depth"in m&&(h.depth=m.depth),"stencil"in m&&(h.stencil=m.stencil),"depthStencil"in m&&(h.depthStencil=m.depthStencil)}else f=1;if(p)if(Array.isArray(p))for(l=[],r=0;r<p.length;++r)l[r]=p[r];else l=[p];else{l=Array(g);var _={radius:f,format:d,type:v};for(r=0;r<g;++r)l[r]=i.createCube(_)}for(h.color=Array(l.length),r=0;r<l.length;++r){var b=l[r];E("function"==typeof b&&"textureCube"===b._reglType,"invalid cube map"),f=f||b.width,E(b.width===f&&b.height===f,"invalid cube map shape"),h.color[r]={target:34069,data:l[r]}}for(r=0;r<6;++r){for(var x=0;x<l.length;++x)h.color[x].target=34069+r;r>0&&(h.depth=o[0].depth,h.stencil=o[0].stencil,h.depthStencil=o[0].depthStencil),o[r]?o[r](h):o[r]=T(h)}return n(a,{width:f,height:f,color:l})}return a(e),n(a,{faces:o,resize:function(e){var t,n=0|e;if(E(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){j(b).forEach(A)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,j(b).forEach((function(t){t.framebuffer=e.createFramebuffer(),C(t)}))}})}(i,f,_,C,T,h),P=vt(i,c,f,_,b,x,0,w,{},S,A,y,m,p,r),L=ze(i,w,P.procs.poll,m,o,f,_),N=P.next,D=i.canvas,F=[],U=[],V=[],H=[r.onDestroy],J=null;function ee(){if(0===F.length)return p&&p.update(),void(J=null);J=k.next(ee),he();for(var e=F.length-1;e>=0;--e){var t=F[e];t&&t(m,null,0)}i.flush(),p&&p.update()}function te(){!J&&F.length>0&&(J=k.next(ee))}function ne(){J&&(k.cancel(ee),J=null)}function re(e){e.preventDefault(),a=!0,ne(),U.forEach((function(e){e()}))}function ie(e){i.getError(),a=!1,s.restore(),A.restore(),b.restore(),C.restore(),T.restore(),w.restore(),S.restore(),p&&p.restore(),P.procs.refresh(),te(),V.forEach((function(e){e()}))}var oe="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;function ae(e){function t(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var o=e[i];if(M.isDynamic(o))r[i]=M.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(M.isDynamic(o[a]))return void(r[i]=M.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}E(!!e,"invalid args to regl({...})"),E.type(e,"object","invalid args to regl({...})");var r=t(e.context||{},!0),i=t(e.uniforms||{},!0),o=t(e.attributes||{},!1),s=t(function(e){var t=n({},e);function r(e){if(e in t){var n=t[e];delete t[e],Object.keys(n).forEach((function(r){t[e+"."+r]=n[r]}))}}return delete t.uniforms,delete t.attributes,delete t.context,delete t.vao,"stencil"in t&&t.stencil.op&&(t.stencil.opBack=t.stencil.opFront=t.stencil.op,delete t.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(t.vao=e.vao),t}(e),!1),u={gpuTime:0,cpuTime:0,count:0},l=P.compile(s,o,i,r,u),c=l.draw,h=l.batch,f=l.scope,p=[];return n((function(e,t){var n;if(a&&E.raise("context lost"),"function"==typeof e)return f.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)f.call(this,null,t,n);else{if(!Array.isArray(e))return f.call(this,e,t,0);for(n=0;n<e.length;++n)f.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return h.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return h.call(this,e,e.length)}}),{stats:u,destroy:function(){l.destroy()}})}!oe&&D&&(D.addEventListener("webglcontextlost",re,!1),D.addEventListener("webglcontextrestored",ie,!1));var se=w.setFBO=ae({framebuffer:M.define.call(null,1,"framebuffer")});function ue(e,t){var n=0;P.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),E(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function le(e){return E.type(e,"function","regl.frame() callback must be a function"),F.push(e),te(),{cancel:function(){var t=mt(F,e);E(t>=0,"cannot cancel a frame twice"),F[t]=function e(){var t=mt(F,e);F[t]=F[F.length-1],F.length-=1,F.length<=0&&ne()}}}}function ce(){var e=N.viewport,t=N.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function he(){m.tick+=1,m.time=pe(),ce(),P.procs.poll()}function fe(){C.refresh(),ce(),P.procs.refresh(),p&&p.update()}function pe(){return(O()-d)/1e3}fe();var de=n(ae,{clear:function(e){if(E("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)se(n({framebuffer:e.framebuffer.faces[t]},e),ue);else se(e,ue);else ue(0,e)},prop:M.define.bind(null,1),context:M.define.bind(null,2),this:M.define.bind(null,3),draw:ae({}),buffer:function(e){return b.create(e,34962,!1,!1)},elements:function(e){return x.create(e,!1)},texture:C.create2D,cube:C.createCube,renderbuffer:T.create,framebuffer:w.create,framebufferCube:w.createCube,vao:S.createVAO,attributes:o,frame:le,on:function(e,t){var n;switch(E.type(t,"function","listener callback must be a function"),e){case"frame":return le(t);case"lost":n=U;break;case"restore":n=V;break;case"destroy":n=H;break;default:E.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:_,hasExtension:function(e){return _.extensions.indexOf(e.toLowerCase())>=0},read:L,destroy:function(){F.length=0,ne(),!oe&&D&&(D.removeEventListener("webglcontextlost",re),D.removeEventListener("webglcontextrestored",ie)),A.clear(),w.clear(),T.clear(),S.clear(),C.clear(),x.clear(),b.clear(),p&&p.clear(),H.forEach((function(e){e()}))},_gl:i,_refresh:fe,poll:function(){he(),p&&p.update()},now:pe,stats:h});return r.onDone(null,de),de}}(hJ)})),pJ=function(){function e(t,n){b(this,e),E(this,"attribute",void 0),E(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return S(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),dJ=(E(K$={},e.gl.POINTS,"points"),E(K$,e.gl.LINES,"lines"),E(K$,e.gl.LINE_LOOP,"line loop"),E(K$,e.gl.LINE_STRIP,"line strip"),E(K$,e.gl.TRIANGLES,"triangles"),E(K$,e.gl.TRIANGLE_FAN,"triangle fan"),E(K$,e.gl.TRIANGLE_STRIP,"triangle strip"),K$),vJ=(E(Q$={},e.gl.STATIC_DRAW,"static"),E(Q$,e.gl.DYNAMIC_DRAW,"dynamic"),E(Q$,e.gl.STREAM_DRAW,"stream"),Q$),gJ=(E($$={},e.gl.BYTE,"int8"),E($$,e.gl.UNSIGNED_INT,"int16"),E($$,e.gl.INT,"int32"),E($$,e.gl.UNSIGNED_BYTE,"uint8"),E($$,e.gl.UNSIGNED_SHORT,"uint16"),E($$,e.gl.UNSIGNED_INT,"uint32"),E($$,e.gl.FLOAT,"float"),$$),mJ=(E(J$={},e.gl.ALPHA,"alpha"),E(J$,e.gl.LUMINANCE,"luminance"),E(J$,e.gl.LUMINANCE_ALPHA,"luminance alpha"),E(J$,e.gl.RGB,"rgb"),E(J$,e.gl.RGBA,"rgba"),E(J$,e.gl.RGBA4,"rgba4"),E(J$,e.gl.RGB5_A1,"rgb5 a1"),E(J$,e.gl.RGB565,"rgb565"),E(J$,e.gl.DEPTH_COMPONENT,"depth"),E(J$,e.gl.DEPTH_STENCIL,"depth stencil"),J$),yJ=(E(eJ={},e.gl.DONT_CARE,"dont care"),E(eJ,e.gl.NICEST,"nice"),E(eJ,e.gl.FASTEST,"fast"),eJ),_J=(E(tJ={},e.gl.NEAREST,"nearest"),E(tJ,e.gl.LINEAR,"linear"),E(tJ,e.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),E(tJ,e.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),E(tJ,e.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),E(tJ,e.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),tJ),bJ=(E(nJ={},e.gl.REPEAT,"repeat"),E(nJ,e.gl.CLAMP_TO_EDGE,"clamp"),E(nJ,e.gl.MIRRORED_REPEAT,"mirror"),nJ),xJ=(E(rJ={},e.gl.NONE,"none"),E(rJ,e.gl.BROWSER_DEFAULT_WEBGL,"browser"),rJ),SJ=(E(iJ={},e.gl.NEVER,"never"),E(iJ,e.gl.ALWAYS,"always"),E(iJ,e.gl.LESS,"less"),E(iJ,e.gl.LEQUAL,"lequal"),E(iJ,e.gl.GREATER,"greater"),E(iJ,e.gl.GEQUAL,"gequal"),E(iJ,e.gl.EQUAL,"equal"),E(iJ,e.gl.NOTEQUAL,"notequal"),iJ),EJ=(E(oJ={},e.gl.FUNC_ADD,"add"),E(oJ,e.gl.MIN_EXT,"min"),E(oJ,e.gl.MAX_EXT,"max"),E(oJ,e.gl.FUNC_SUBTRACT,"subtract"),E(oJ,e.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),oJ),AJ=(E(aJ={},e.gl.ZERO,"zero"),E(aJ,e.gl.ONE,"one"),E(aJ,e.gl.SRC_COLOR,"src color"),E(aJ,e.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),E(aJ,e.gl.SRC_ALPHA,"src alpha"),E(aJ,e.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),E(aJ,e.gl.DST_COLOR,"dst color"),E(aJ,e.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),E(aJ,e.gl.DST_ALPHA,"dst alpha"),E(aJ,e.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),E(aJ,e.gl.CONSTANT_COLOR,"constant color"),E(aJ,e.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),E(aJ,e.gl.CONSTANT_ALPHA,"constant alpha"),E(aJ,e.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),E(aJ,e.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),aJ),CJ=(E(sJ={},e.gl.NEVER,"never"),E(sJ,e.gl.ALWAYS,"always"),E(sJ,e.gl.LESS,"less"),E(sJ,e.gl.LEQUAL,"lequal"),E(sJ,e.gl.GREATER,"greater"),E(sJ,e.gl.GEQUAL,"gequal"),E(sJ,e.gl.EQUAL,"equal"),E(sJ,e.gl.NOTEQUAL,"notequal"),sJ),TJ=(E(uJ={},e.gl.ZERO,"zero"),E(uJ,e.gl.KEEP,"keep"),E(uJ,e.gl.REPLACE,"replace"),E(uJ,e.gl.INVERT,"invert"),E(uJ,e.gl.INCR,"increment"),E(uJ,e.gl.DECR,"decrement"),E(uJ,e.gl.INCR_WRAP,"increment wrap"),E(uJ,e.gl.DECR_WRAP,"decrement wrap"),uJ),wJ=(E(lJ={},e.gl.FRONT,"front"),E(lJ,e.gl.BACK,"back"),lJ),MJ=function(){function t(n,r){b(this,t),E(this,"buffer",void 0);var i=r.data,o=r.usage,a=r.type;this.buffer=n.buffer({data:i,usage:vJ[o||e.gl.STATIC_DRAW],type:gJ[a||e.gl.UNSIGNED_BYTE]})}return S(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),t}(),kJ=function(){function t(n,r){b(this,t),E(this,"elements",void 0);var i=r.data,o=r.usage,a=r.type,s=r.count;this.elements=n.elements({data:i,usage:vJ[o||e.gl.STATIC_DRAW],type:gJ[a||e.gl.UNSIGNED_BYTE],count:s})}return S(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),t}(),OJ=function(){function e(t,n){b(this,e),E(this,"framebuffer",void 0);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=t.framebuffer(s)}return S(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}(),PJ=function(){function t(n,r){b(this,t),E(this,"reGl",void 0),E(this,"destroyed",!1),E(this,"drawCommand",void 0),E(this,"drawPickCommand",void 0),E(this,"drawParams",void 0),E(this,"options",void 0),E(this,"uniforms",{}),this.reGl=n;var i=r.pick,o=void 0===i||i,a=r.vs,s=r.fs,u=r.attributes,l=r.uniforms,c=r.primitive,h=r.count,f=r.elements,p=r.depth,d=r.blend,g=r.stencil,m=r.cull,y=r.instances,_={};this.options=r,l&&(this.uniforms=this.extractUniforms(l),Object.keys(l).forEach((function(e){_[e]=n.prop(e)})));var x={};Object.keys(u).forEach((function(e){x[e]=u[e].get()}));var S={attributes:x,frag:s,uniforms:_,vert:a,blend:{},primitive:dJ[void 0===c?e.gl.TRIANGLES:c]};if(y&&(S.instances=y),h?S.count=h:f&&(S.elements=f.get()),this.initDepthDrawParams({depth:p},S),this.initBlendDrawParams({blend:d},S),this.initStencilDrawParams({stencil:g},S),this.initCullDrawParams({cull:m},S),this.drawCommand=n(S),o){var A=GT(S);A.blend=v(v({},A.blend),{},{enable:!1}),this.drawPickCommand=n(A)}this.drawParams=S}return S(t,[{key:"updateAttributesAndElements",value:function(e,t){var n={};if(Object.keys(e).forEach((function(t){n[t]=e[t].get()})),this.drawParams.attributes=n,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var r=GT(this.drawParams);r.blend=v(v({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}}},{key:"updateAttributes",value:function(e){var t={};if(Object.keys(e).forEach((function(n){t[n]=e[n].get()})),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var n=GT(this.drawParams);n.blend=v(v({},n.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(n)}}},{key:"addUniforms",value:function(e){this.uniforms=v(v({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=v(v({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach((function(e){var t=m(n[e]);"boolean"===t||"number"===t||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()})),t?this.drawPickCommand&&this.drawPickCommand(r):this.drawCommand(r)}}},{key:"destroy",value:function(){var e,t;null===(e=this.drawParams)||void 0===e||null===(t=e.elements)||void 0===t||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){null==e||e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var r=t.depth;r&&(n.depth={enable:void 0===r.enable||!!r.enable,mask:void 0===r.mask||!!r.mask,func:SJ[r.func||e.gl.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var r=t.blend;if(r){var i=r.enable,o=r.func,a=r.equation,s=r.color,u=void 0===s?[0,0,0,0]:s;n.blend={enable:!!i,func:{srcRGB:AJ[o&&o.srcRGB||e.gl.SRC_ALPHA],srcAlpha:AJ[o&&o.srcAlpha||e.gl.SRC_ALPHA],dstRGB:AJ[o&&o.dstRGB||e.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:AJ[o&&o.dstAlpha||e.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:EJ[a&&a.rgb||e.gl.FUNC_ADD],alpha:EJ[a&&a.alpha||e.gl.FUNC_ADD]},color:u}}}},{key:"initStencilDrawParams",value:function(t,n){var r=t.stencil;if(r){var i=r.enable,o=r.mask,a=void 0===o?-1:o,s=r.func,u=void 0===s?{cmp:e.gl.ALWAYS,ref:0,mask:-1}:s,l=r.opFront,c=void 0===l?{fail:e.gl.KEEP,zfail:e.gl.KEEP,zpass:e.gl.KEEP}:l,h=r.opBack,f=void 0===h?{fail:e.gl.KEEP,zfail:e.gl.KEEP,zpass:e.gl.KEEP}:h;n.stencil={enable:!!i,mask:a,func:v(v({},u),{},{cmp:CJ[u.cmp]}),opFront:{fail:TJ[c.fail],zfail:TJ[c.zfail],zpass:TJ[c.zpass]},opBack:{fail:TJ[f.fail],zfail:TJ[f.zfail],zpass:TJ[f.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var r=t.cull;if(r){var i=r.enable,o=r.face,a=void 0===o?e.gl.BACK:o;n.cull={enable:!!i,face:wJ[a]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||OC(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(CC(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),t}(),LJ=function(){function t(n,r){b(this,t),E(this,"texture",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"isDistroy",!1);var i=r.data,o=r.type,a=void 0===o?e.gl.UNSIGNED_BYTE:o,s=r.width,u=r.height,l=r.flipY,c=void 0!==l&&l,h=r.format,f=void 0===h?e.gl.RGBA:h,p=r.mipmap,d=void 0!==p&&p,v=r.wrapS,g=void 0===v?e.gl.CLAMP_TO_EDGE:v,m=r.wrapT,y=void 0===m?e.gl.CLAMP_TO_EDGE:m,_=r.aniso,x=void 0===_?0:_,S=r.alignment,A=void 0===S?1:S,C=r.premultiplyAlpha,T=void 0!==C&&C,w=r.mag,M=void 0===w?e.gl.NEAREST:w,k=r.min,O=void 0===k?e.gl.NEAREST:k,P=r.colorSpace,L=void 0===P?e.gl.BROWSER_DEFAULT_WEBGL:P,I=r.x,R=void 0===I?0:I,N=r.y,D=void 0===N?0:N,F=r.copy,B=void 0!==F&&F;this.width=s,this.height=u;var z={width:s,height:u,type:gJ[a],format:mJ[f],wrapS:bJ[g],wrapT:bJ[y],mag:_J[M],min:_J[O],alignment:A,flipY:c,colorSpace:xJ[L],premultiplyAlpha:T,aniso:x,x:R,y:D,copy:B};i&&(z.data=i),"number"==typeof d?z.mipmap=yJ[d]:"boolean"==typeof d&&(z.mipmap=d),this.texture=n.texture(z)}return S(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"destroy",value:function(){var e;this.isDistroy||(null===(e=this.texture)||void 0===e||e.destroy());this.isDistroy=!0}}]),t}(),IJ=NM()(cJ=function(){function e(){var t=this;b(this,e),E(this,"extensionObject",void 0),E(this,"gl",void 0),E(this,"$container",void 0),E(this,"canvas",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"isDirty",void 0),E(this,"createModel",(function(e){return new PJ(t.gl,e)})),E(this,"createAttribute",(function(e){return new pJ(t.gl,e)})),E(this,"createBuffer",(function(e){return new MJ(t.gl,e)})),E(this,"createElements",(function(e){return new kJ(t.gl,e)})),E(this,"createTexture2D",(function(e){return new LJ(t.gl,e)})),E(this,"createFramebuffer",(function(e){return new OJ(t.gl,e)})),E(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),E(this,"clear",(function(e){var n,r=e.color,i=e.depth,o=e.stencil,a=e.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=t.gl)||void 0===n||n.clear(u)})),E(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.gl._gl.viewport(n,r,i,o),t.width=i,t.height=o,t.gl._refresh()})),E(this,"readPixels",(function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)})),E(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),E(this,"getContainer",(function(){return Yv?t.canvas:null===(e=t.canvas)||void 0===e?void 0:e.parentElement;var e})),E(this,"getCanvas",(function(){return t.canvas})),E(this,"getGLContext",(function(){return t.gl._gl})),E(this,"destroy",(function(){var e,n,r;t.canvas=null,null===(e=t.gl)||void 0===e||null===(n=e._gl)||void 0===n||null===(r=n.getExtension("WEBGL_lose_context"))||void 0===r||r.loseContext(),t.gl.destroy(),t.gl=null}))}var t;return S(e,[{key:"init",value:(t=_(g().mark((function e(t,n,r){var i=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas=t,!r){e.next=5;break}this.gl=r,e.next=8;break;case 5:return e.next=7,new Promise((function(e,t){fJ({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 7:this.gl=e.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||cJ,RJ=["selectstart","selecting","selectend"],NJ=function(e){A(n,e);var t=I(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(this,n),E(P(r=t.call(this)),"scene",void 0),E(P(r),"options",void 0),E(P(r),"isEnable",!1),E(P(r),"box",void 0),E(P(r),"startEvent",void 0),E(P(r),"endEvent",void 0),E(P(r),"onDragStart",(function(e){r.box.style.display="block",r.startEvent=r.endEvent=e,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)})),E(P(r),"onDragging",(function(e){r.endEvent=e,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)})),E(P(r),"onDragEnd",(function(e){r.endEvent=e,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)})),r.scene=e,r.options=i,r}return S(n,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var t=eg("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,t=e.x,n=e.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(t,i),s=Math.min(n,o),u=Math.abs(t-i),l=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(l,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,t=e.lng,n=e.lat,r=this.endEvent.lngLat;return Vm([[t,n],[r.lng,r.lat]])}}]),n}(Kx),DJ=function(){function e(t){b(this,e),E(this,"sceneService",void 0),E(this,"mapService",void 0),E(this,"controlService",void 0),E(this,"layerService",void 0),E(this,"iconService",void 0),E(this,"markerService",void 0),E(this,"popupService",void 0),E(this,"fontService",void 0),E(this,"interactionService",void 0),E(this,"boxSelect",void 0),E(this,"container",void 0);var n=t.id,r=t.map,i=t.canvas,o=t.hasBaseMap,a=dF();this.container=a,r.setContainer(a,n,i,o),a.bind(Hk.IRendererService).to(IJ).inSingletonScope(),this.sceneService=a.get(Hk.ISceneService),this.mapService=a.get(Hk.IMapService),this.iconService=a.get(Hk.IIconService),this.fontService=a.get(Hk.IFontService),this.controlService=a.get(Hk.IControlService),this.layerService=a.get(Hk.ILayerService),this.markerService=a.get(Hk.IMarkerService),this.interactionService=a.get(Hk.IInteractionService),this.popupService=a.get(Hk.IPopupService),this.boxSelect=new NJ(this,{}),Yv?this.sceneService.initMiniScene(t):(this.initComponent(n),this.sceneService.init(t),this.initControl())}return S(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(e){return this.sceneService.exportPng(e)}},{key:"exportMap",value:function(e){return this.sceneService.exportPng(e)}},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"setBgColor",value:function(e){this.mapService.setBgColor(e)}},{key:"addLayer",value:function(e){var t=this,n=vF(this.container);if(e.setContainer(n,this.container),this.sceneService.addLayer(e),e.inited){var r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",(function(){var n=t.initMask(e);t.addMask(n,e.id)}))}},{key:"initMask",value:function(e){var t=e.getLayerConfig(),n=t.mask,r=t.maskfence,i=t.maskColor,o=void 0===i?"#000":i,a=t.maskOpacity,s=void 0===a?0:a;if(n)return(new iY).source(r).shape("fill").style({color:o,opacity:s})}},{key:"addMask",value:function(e,t){if(e){var n=this.getLayer(t);if(n){var r=vF(this.container);e.setContainer(r,this.container),n.addMaskLayer(e),this.sceneService.addLayer(e)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:function(e,t){this.layerService.remove(e,t)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(e){this.layerService.setEnableRender(e)}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=D(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){var n=this;this.fontService.once("fontloaded",(function(e){n.emit("fontloaded",e)})),this.fontService.addFontFace(e,t)}},{key:"addImage",value:function(e,t){Yv?this.iconService.addImageMini(e,t,this.sceneService):this.iconService.addImage(e,t)}},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"removePopup",value:function(e){this.popupService.removePopup(e)}},{key:"on",value:function(e,t){var n;RJ.includes(e)?null===(n=this.boxSelect)||void 0===n||n.on(e,t):wF.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}},{key:"once",value:function(e,t){var n;RJ.includes(e)?null===(n=this.boxSelect)||void 0===n||n.once(e,t):wF.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}},{key:"emit",value:function(e,t){-1===wF.indexOf(e)?this.mapService.on(e,t):this.sceneService.emit(e,t)}},{key:"off",value:function(e,t){var n;RJ.includes(e)?null===(n=this.boxSelect)||void 0===n||n.off(e,t):wF.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e,t){this.mapService.panBy(e,t)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||v(v({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e,t){this.container.bind(Hk.IPostProcessingPass).to(e).whenTargetNamed(t)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),t&&this.boxSelect.once("selectend",(function(){e.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(e){this.controlService.init({container:Qv(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new BF({position:n}))}}]),e}();e.$XMLHttpRequest=qv,e.$location=Kv,e.$window=Zv,e.AJAXError=zg,e.BKDRHash=function(e){var t=0;e+="x";for(var n=Math.floor(65745979961613.07),r=0;r<e.length;r++)t>n&&(t=Math.floor(t/137)),t=131*t+e.charCodeAt(r);return t},e.BaseLayer=hV,e.BaseMapService=BU,e.BaseMapWrapper=wB,e.BaseModel=PV,e.BasePostProcessingPass=zD,e.ButtonControl=LF,e.CameraUniform=TF,e.CanvasLayer=IV,e.CityBuildingLayer=wH,e.Control=PF,e.CoordinateUniform=dI,e.DOM=_g,e.Earth=VU,e.EarthLayer=nY,e.ExportImage=YF,e.FrequencyController=Wm,e.Fullscreen=WF,e.GaodeMap=Oz,e.GaodeMapV2=Dz,e.GeoLocate=qF,e.GeometryLayer=LH,e.HeatmapLayer=BH,e.ImageLayer=HH,e.LRUCache=Hm,e.LayerPopup=gB,e.LayerSwitch=JF,e.LineLayer=CW,e.LineTriangulation=lx,e.Logo=BF,e.Map=YU,e.MapServiceEvent=CF,e.MapTheme=$F,e.Mapbox=JU,e.Marker=MF,e.MarkerLayer=kF,e.MaskLayer=iY,e.MouseLocation=eB,e.PointFillTriangulation=cx,e.PointLayer=GW,e.PolygonLayer=qW,e.PopperControl=DF,e.Popup=rB,e.RasterLayer=$W,e.Satistics=Ng,e.Scale=nB,e.Scene=DJ,e.SceneEventList=wF,e.SelectControl=FF,e.Source=Dw,e.TYPES=Hk,e.Tile=Qx,e.TileDebugLayer=CY,e.TilesetManager=_S,e.Viewport=vz,e.WindLayer=AY,e.WorkerSourceMap=px,e.Zoom=tB,e.aProjectFlat=km,e.amap2Project=Om,e.amap2UnProject=Pm,e.anchorTranslate=My,e.applyAnchorClass=ky,e.bBoxToBounds=Nm,e.bindAll=Gm,e.boundsContains=Rm,e.calAngle=function(e,t){return 180*Math.acos(function(e,t){return e[0]*t[0]+e[1]*t[1]}(e,t)/(Bm(e)*Bm(t)))/Math.PI},e.calDistance=Fm,e.calculateCentroid=jm,e.calculatePointsCenterAndRadius=Um,e.container=cF,e.createLayerContainer=vF,e.createSceneContainer=dF,e.decodePickingColor=Cy,e.dispatchMapCameraParams=Mv,e.dispatchMouseDown=Uv,e.dispatchMouseMove=Vv,e.dispatchMouseUp=Hv,e.dispatchPointerDown=Fv,e.dispatchPointerMove=Bv,e.dispatchPointerUp=zv,e.dispatchTouchEnd=wv,e.dispatchTouchMove=Tv,e.dispatchTouchStart=Cv,e.djb2hash=function(e){for(var t=5381,n=(e=e.toString()).length;n;)t=33*t^e.charCodeAt(--n);return t>>>0},e.encodePickingColor=Ty,e.executeWorkerTask=_x,e.expandUrl=Tx,e.extent=Am,e.flow=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(e&&!(e.length<2)){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=Fm(o,a);n+=s;var u=[o[0]-a[0],o[1]-a[1]],l=zm(0,u);if(i>0){var c=r[i-1].rotation;c-l>360-c+l&&(l+=360)}r.push({start:o,end:a,dis:s,rotation:l,duration:0})}return r.map((function(e){e.duration=t*(e.dis/n)})),r}},e.generateColorRamp=wy,e.getAngle=zm,e.getArrayBuffer=Hg,e.getBBoxFromPoints=Vm,e.getCullFace=Cx,e.getImage=Wg,e.getJSON=function(e,t){return Vg(v(v({},e),{},{type:"json"}),t)},e.getMask=Oy,e.getReferrer=Bg,e.getTileIndices=Xx,e.getTileWarpXY=Zx,e.getURLFromTemplate=Mx,e.isColor=Ey,e.isImageBitmap=Dg,e.isMini=Yv,e.isMiniAli=Gv,e.isURLTemplate=function(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)},e.isWeChatMiniProgram=Wv,e.isWorker=Fg,e.latitude=wm,e.lazyInject=fF,e.lazyMultiInject=function(e){var t=hF.lazyMultiInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},e.lineAtOffset=kS,e.lineAtOffsetAsyc=function(e,t){return new Promise((function(n){e.inited?n(kS(e,t)):e.once("update",(function(){n(kS(e,t))}))}))},e.lngLatToMeters=Cm,e.lnglatDistance=Lm,e.longitude=Tm,e.makeXMLHttpRequestPromise=Ug,e.metersToLngLat=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=e[0],r=e[1],i=n/Em*180,o=r/Em*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=t&&(i=Number(i.toFixed(t)),o=Number(o.toFixed(t))),3===e.length?[i,o,e[2]]:[i,o]},e.miniWindow=Xv,e.normalize=Dm,e.osmLonLat2TileXY=Gx,e.osmTileXY2LonLat=Wx,e.packCircleVertex=function(e){var t=e.color,n=e.radius,r=e.tileX,i=e.tileY,o=e.shape,a=e.opacity,s=e.stroke,u=e.strokeWidth,l=e.strokeOpacity,c=[],h=[],f=[],p=[AF(t[0],t[1]),AF(t[2],t[3])],d=[AF(s[0],s[1]),AF(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e){var t=D(e,2),s=t[0],v=t[1];c.push([].concat(p,[8388608*(s+1)+2097152*(v+1)+131072*_F(o)+n,524288*(r+512)+64*(i+512)])),h.push([].concat(d,[u,l])),f.push([a,0,0,0])})),{packedBuffer:c,packedBuffer2:h,packedBuffer3:f}},e.padBounds=Im,e.polygonFillTriangulation=hx,e.postData=function(e,t){return Vg(v(v({},e),{},{method:"POST"}),t)},e.project=function(e){var t=Math.PI/180,n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=Math.sin(r*t);return[6378137*e[0]*t,6378137*Math.log((1+i)/(1-i))/2]},e.rgb2arr=Ay,e.sameOrigin=function(e){var t=Zv.document.createElement("a");return t.href=e,t.protocol===Zv.document.location.protocol&&t.host===Zv.document.location.host},e.setL7WorkerSource=mx,e.tileToBounds=Yx,e.tranfrormCoord=function(e,t){return function e(t,n){if(Array.isArray(t[0]))return t.map((function(t){return e(t,n)}));return n(t)}(e,t)},e.unProjectFlat=function(e){var t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=D(e,2),o=i[0],a=i[1];return o=(o/(256<<20)-.5)/t,a=(a/(256<<20)-r)/n,a=2*(Math.atan(Math.pow(Math.E,a))-Math.PI/4),[o/(r=Math.PI/180),a/r]},e.validateLngLat=Mm,e.version="2.10.1",Object.defineProperty(e,"__esModule",{value:!0})}));